require=function t(e,i,s){function o(r,a){if(!i[r]){if(!e[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(n)return n(r,!0);throw new Error("Cannot find module '"+r+"'")}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){var i=e[r][1][t];return o(i?i:t)},h,h.exports,t,e,i,s)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<s.length;r++)o(s[r]);return o}({1:[function(t,e){"use strict";var i=t("prima/bootloader"),s=t("prima/lib/domeventor"),o=t("prima/lib/logger"),n=i.extend({setup:function(){i.prototype.setup.apply(this,arguments),s.init(),o.log("Exec","Bootstrap/DOMEventor"),o.log("Exec","Bootstrap/Legacy"),t("./legacy")},initialize:function(){this.context=new(t("context"))}});e.exports=n},{"./legacy":272,context:"NOGuuH","prima/bootloader":392,"prima/lib/domeventor":400,"prima/lib/logger":403}],2:[function(t,e){var i=t("prima/collection"),s=t("../models/tumblelog"),o=i.extend({model:s});e.exports=o},{"../models/tumblelog":278,"prima/collection":394}],3:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/account-popover"),n=t("app/lib/currentuser"),r=s.extend({name:"AccountPopover",view:function(t){return t=i.extend({},{model:n(),pinnedTarget:this.container,isFixedPosition:!0},t),new o(t)},open:function(){this.append()},close:function(){this.view.teardown()},append:function(){return this.view.render(),this.trigger("append"),this}});e.exports=r},{"./views/account-popover":9,"app/lib/currentuser":275,lodash:"K2RcUv","prima/component":395}],4:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<ul data-blog-details-inner class="blog-sub-nav-details">',"0"!==model.post_count&&(__p+='<li class="blog-sub-nav-item"><a href="/blog/'+(null==(__t=model.name)?"":_.escape(__t))+'" class="blog-sub-nav-item-link"><div class="blog-sub-nav-item-label">'+(null==(__t=__("Posts"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data">'+(null==(__t=model.post_count)?"":_.escape(__t))+"</div></a></li>"),__p+="","0"!==model.follower_count&&(__p+='<li class="blog-sub-nav-item"><a href="/blog/'+(null==(__t=model.name)?"":_.escape(__t))+'/followers" class="blog-sub-nav-item-link"><div class="blog-sub-nav-item-label">'+(null==(__t=__("Followers"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data">'+(null==(__t=model.follower_count)?"":_.escape(__t))+"</div></a></li>"),__p+="",model.activity_info&&model.activity_info.sparkline&&(__p+='<li class="blog-sub-nav-item"><a href="/blog/'+(null==(__t=model.name)?"":_.escape(__t))+'/activity" class="blog-sub-nav-item-link"><div class="blog-sub-nav-item-label">'+(null==(__t=__("Activity"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data sparkline" data-sparkline="'+(null==(__t=model.activity_info.sparkline)?"":_.escape(__t))+'"></div></a></li>'),__p+="","0"!==model.member_count&&(__p+='<li class="blog-sub-nav-item"><a href="'+(null==(__t=model.dashboard_url)?"":_.escape(__t))+'/members" class="blog-sub-nav-item-link"><div class="blog-sub-nav-item-label">'+(null==(__t=__("Members"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data">'+(null==(__t=model.member_count)?"":_.escape(__t))+"</div></a></li>"),__p+="","0"!==model.draft_count&&(__p+='<li class="blog-sub-nav-item"><a href="'+(null==(__t=model.dashboard_url)?"":_.escape(__t))+'/drafts" class="blog-sub-nav-item-link"><div class="blog-sub-nav-item-label">'+(null==(__t=__("Drafts"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data">'+(null==(__t=model.draft_count)?"":_.escape(__t))+"</div></a></li>"),__p+="","0"!==model.queued_post_count&&(__p+='<li class="blog-sub-nav-item"><a href="'+(null==(__t=model.dashboard_url)?"":_.escape(__t))+'/queue" class="blog-sub-nav-item-link"><div class="blog-sub-nav-item-label">'+(null==(__t=__("Queue"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data">'+(null==(__t=model.queued_post_count)?"":_.escape(__t))+"</div></a></li>"),__p+="","0"!==model.transcoding_count&&(__p+='<li class="blog-sub-nav-item"><a href="'+(null==(__t=model.dashboard_url)?"":_.escape(__t))+'/processing" class="blog-sub-nav-item-link"><div class="blog-sub-nav-item-label">'+(null==(__t=__("Processing"))?"":_.escape(__t))+'</div><div class="blog-sub-nav-item-data">'+(null==(__t=model.transcoding_count)?"":_.escape(__t))+"</div></a></li>"),__p+='<li class="blog-sub-nav-item"><a href="/customize/'+(null==(__t=model.name)?"":_.escape(__t))+'?redirect_to=/dashboard" class="blog-sub-nav-item-link"><div class="blog-sub-nav-item-label">'+(null==(__t=__("Edit appearance"))?"":_.escape(__t))+"</div></a></li></ul>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],5:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-action-open class="popover_menu_item_blog_header"><img class="popover_menu_item_blog_avatar" src="'+(null==(__t=avatarUrl)?"":_.escape(__t))+'"><div class="popover_menu_item_blog_info"><span class="popover_menu_item_info_name">'+(null==(__t=model.name)?"":_.escape(__t))+'</span><br><span class="popover_menu_item_info_title">'+(null==(__t=model.directory_safe_title)?"":_.escape(__t))+"</span></div>",model.unread_count>0&&(__p+='<span class="tab_notice active on-light"><span class="tab_notice_value">'+(null==(__t=model.unread_count)?"":_.escape(__t))+"</span></span>"),__p+=' <i class="icon_lock_12 ',model.is_private_group_channel||(__p+=" hidden "),__p+='"></i></div>'+(null==(__t=_subview("details"))?"":__t);return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],6:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover popover_menu popover_gradient"><div class="popover_inner"><ul data-js-account-list class="popover_inner_list"><li class="popover_header">'+(null==(__t=__("Account"))?"":_.escape(__t)),viewFlags.account&&(__p+='<div class="popover_item_suffix"><a data-js-action-logout class="logout" href="/logout" id="logout_button">'+(null==(__t=__("Log out"))?"":_.escape(__t))+"</a></div>"),__p+="</li>",viewFlags.account&&(__p+="",model.liked_post_count&&(__p+='<li class="popover_menu_item"><a class="popover_menu_item_anchor" href="/likes"><i class="popover_menu_item_anchor_icon icon_like"></i>'+(null==(__t=__("Likes"))?"":_.escape(__t))+'<div class="popover_item_suffix">'+(null==(__t=Number(model.liked_post_count).toLocaleString())?"":_.escape(__t))+"</div></a></li>"),__p+="",model.friend_count&&(__p+='<li class="popover_menu_item"><a class="popover_menu_item_anchor" href="/following"><i class="popover_menu_item_anchor_icon icon_following"></i>'+(null==(__t=__("Following"))?"":_.escape(__t))+'<div class="popover_item_suffix">'+(null==(__t=Number(model.friend_count).toLocaleString())?"":_.escape(__t))+"</div></a></li>"),__p+=""),__p+='<li class="popover_menu_item"><a class="popover_menu_item_anchor" href="/settings"><i class="popover_menu_item_anchor_icon icon_settings"></i>'+(null==(__t=__("Settings"))?"":_.escape(__t))+'</a></li><li class="popover_menu_item"><a class="popover_menu_item_anchor" href="/help"><i class="popover_menu_item_anchor_icon icon_help"></i>'+(null==(__t=__("Help"))?"":_.escape(__t))+"</a></li>",viewFlags.channels?__p+='<li class="popover_header">'+(null==(__t=__("Blogs"))?"":_.escape(__t))+'<div class="popover_item_suffix"><a href="/new/blog">+&nbsp;'+(null==(__t=__("New"))?"":_.escape(__t))+"</a></div></li>":viewFlags.account||(__p+='<li class="popover_menu_item"><a data-js-action-logout class="popover_menu_item_anchor logout" href="/logout" id="logout_button"><i class="popover_menu_item_anchor_icon icon_logout"></i>'+(null==(__t=__("Log out"))?"":_.escape(__t))+"</a></li>"),__p+='<li class="popover_menu_sublist popover_menu_sublist--scrollable"><ul data-js-channel-list class="popover_sublist"></ul></li></ul></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],7:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate"),o=t("prima/views/base"),n=t("../templates/account-popover-blog-sub-nav-details.tpl"),r=o.extend({template:n,className:"popover_menu_item_blog_details",defaults:{animate:!0},addSparkline:function(){var t=this.$el.find(".sparkline"),e=t.data("sparkline");e&&0!==i.max(e)&&i.isFunction(t.sparkline)&&(t.sparkline(e,{type:"line",lineColor:"#888",fillColor:!1,lineWidth:4,chartRangeMin:0,spotColor:!1,minSpotColor:!1,maxSpotColor:!1,disableInteraction:!0,width:"72px",height:"30px"}),t.find("canvas").css({height:"15px",width:"36px"}))},afterRender:function(){this.cacheElements({$detailsInner:"[data-blog-details-inner]"})},show:function(){this.animateOpen()},hide:function(){this.animateClosed()},animateOpen:function(){var t=this.$detailsInner.outerHeight();return s(this.$el,{height:t},{duration:250,easing:"ease-in-out"})},animateClosed:function(){return s(this.$el,"reverse")},teardown:function(){return this.remove(),this}});e.exports=r},{"../templates/account-popover-blog-sub-nav-details.tpl":4,lodash:"K2RcUv","prima/views/base":461,"velocity-animate":"lWl/mc"}],8:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("prima/views/base"),n=t("../templates/account-popover-blog-sub-nav.tpl"),r=t("./account-popover-blog-sub-nav-details"),a=t("app/lib/avatar-size"),l=o.extend({tagName:"li",className:"popover_menu_item popover_menu_item_blog",template:n,events:{"click [data-js-action-open]":"onClickItem"},defaults:{open:!1,detailsReady:!1},initialize:function(){this.on("change:open",this.toggleOpen),this.setAvatarSize()},setAvatarSize:function(){var t=a(this.model.get("avatar_url"));this.set("avatarUrl",t(64))},toggleOpen:function(t,e){i.isObject(t)||(e=!!t),this.toggleAnimate(e?!0:!1)},toggleAnimate:function(t,e){i.isObject(t)||(e=!!t),this.getDetailsView().then(e?function(t){t.show()}:function(t){t.hide()})},onClickItem:function(){this.toggle("open")},isLoaded:function(){return this.model.has("follower_count")},loadDetails:function(){return this.model.fetch_analytics_data()},getDetailsView:function(){return s.promise(i.bind(function(t,e){return this.subviews.details?void t(this.subviews.details):void(this.isLoaded()?t(this.renderDetailsView()):this.loadDetails().then(i.bind(function(){t(this.renderDetailsView())},this)).catch(function(t){e(t)}))},this))},renderDetailsView:function(){return this.subviews.details=new r({model:this.model}),this.renderSubviews(),this.subviews.details.addSparkline(),this.subviews.details},teardown:function(){return this.remove(),this}});e.exports=l},{"../templates/account-popover-blog-sub-nav.tpl":5,"./account-popover-blog-sub-nav-details":7,"app/lib/avatar-size":273,lodash:"K2RcUv","prima/views/base":461,when:"RG2dij"}],9:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/view"),r=t("prima/mixins/popoverbase"),a=t("app/components/dialog"),l=t("prima/lib/flags"),h=t("prima/mixins/selectorcache"),d=t("../templates/account-popover.tpl"),c=t("./account-popover-blog-sub-nav"),u=n.extend({className:"popover--account-popover",mixins:[r,h],template:d,defaults:{popoverData:{},preventInteraction:!0},events:{"click [data-js-action-logout]":"logout"},initialize:function(t){this.options=s.extend({},this.defaults,t),this.on("subview:change:open",this.onSubviewOpen,this)},logout:function(t){t.preventDefault();var e=i(t.currentTarget),n=o("Are you sure you want to log out?"),r=e.attr("href");return this.teardown(),a.confirm(n,s.bind(function(){window.location.href=r})),!1},render:function(){return this.$el.html(this.template({viewFlags:{channels:l.bool("nav_redesign_blog"),account:l.bool("nav_redesign_account")},model:this.model.toJSON()})),l.bool("nav_redesign_blog")&&this.renderUserChannels(),this},onSubviewOpen:function(t,e){e&&this.closeOtherSubviews(t)},closeOtherSubviews:function(t){s.each(this.subViews,function(e){t.cid!==e.cid&&e.set("open",!1)})},renderUserChannels:function(){var t=document.createDocumentFragment();this.model.channels.each(function(e){t.appendChild(this.renderUserChannelItem(e).el)},this),this.js$("channel-list").append(t),this.$pinned.addClass("active")},renderUserChannelItem:function(t){return this.subViews[t.get("name")]=new c({model:t}),this.listenTo(this.subViews[t.get("name")],"all",this._onSubviewEvent,this),this.subViews[t.get("name")].render()},_onSubviewEvent:function(){var t=s.toArray(arguments);t[0]="subview:"+t[0],this.trigger.apply(this,t)},_removeSubviewReference:function(t){t.off("all",this._onSubviewEvent,this)},beforeTeardown:function(){return s.each(this.subViews,function(t){this._removeSubviewReference(t)},this),this.remove(),this.$pinned.removeClass("active"),this}});e.exports=u},{"../templates/account-popover.tpl":6,"./account-popover-blog-sub-nav":8,"app/components/dialog":20,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/flags":"f/LVtH","prima/lib/translate":423,"prima/mixins/popoverbase":432,"prima/mixins/selectorcache":435,"prima/view":460}],10:[function(t,e){"use strict";e.exports=t("./views/blog_card_view")},{"./views/blog_card_view":14}],11:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var is_popover="boolean"==typeof popover?popover:!1,has_avatar=avatar_url&&global_theme_params.show_avatar,has_bg_img=global_theme_params.header_image_focused&&global_theme_params.show_header_image,has_title=title&&global_theme_params.show_title,has_description=description_sanitized&&global_theme_params.show_description,expanded_name=cname?cname:name+".tumblr.com",description_color=title_color_rgb?"rgba("+title_color_rgb+",0.7)":global_theme_params.title_color,header_class=global_theme_params.header_stretch?"":" no_stretch_header";header_class+=has_bg_img?"":" no_header_image",header_class+=has_avatar?"":" no_avatar",header_class+=!has_bg_img||has_avatar||has_title||has_description?"":" header_image_only",header_class+=has_title||has_description?" has_info":" no_info",__p+='<div class="indash_header_wrapper '+(null==(__t=header_class)?"":__t)+" tumblelog_name_"+(null==(__t=name)?"":_.escape(__t))+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; color:"+(null==(__t=global_theme_params.title_color)?"":__t)+'">',show_navigation&&(__p+='<div class="navigation"><div class="navigation_bg" style="background-color: '+(null==(__t=global_theme_params.background_color)?"":__t)+'"></div><div class="navigation_inner">',"undefined"!==name&&(__p+='<h3><a href="'+(null==(__t=url)?"":__t)+'" target="_blank" class="blog_name" data-peepr="{&quot;tumblelog&quot;: &quot;'+(null==(__t=name)?"":_.escape(__t))+'&quot;}"><span class="name">'+(null==(__t=name)?"":_.escape(__t))+'</span> <span class="full_url">'+(null==(__t=expanded_name)?"":_.escape(__t))+"</span></a></h3>"),__p+="",show_share_controls&&(__p+='<a class="open_blog_button nav_icon icon_export"></a>'),__p+="",!customizable&&show_user_controls&&(__p+=' <a class="info_popover_button nav_icon user_dropdown_lockup"><i class="user_dropdown_icon user_dropdown_icon_user icon_user_settings"></i> <i class="user_dropdown_icon user_dropdown_icon_arrow icon_arrow_carrot_down"></i></a>'),__p+="",!customizable&&show_follow_button&&(__p+="",__p+=following?' <button class="chrome unfollow" type="button">Unfollow</button> <button class="chrome follow" type="button" style="display:none">Follow</button>':' <button class="chrome unfollow" type="button" style="display:none">Unfollow</button> <button class="chrome follow" type="button">Follow</button>',__p+=""),__p+="</div></div>"),__p+="",global_theme_params.header_image_focused&&global_theme_params.show_header_image&&(__p+='<div class="header_image_wrapper',has_avatar&&(__p+=" has_avatar"),__p+='"><div class="header_image" style="background-image:url('+(null==(__t=global_theme_params.header_image_focused)?"":__t)+')">',__p+=is_popover||!customizable?'<a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+(null==(__t=global_theme_params.header_image_focused)?"":__t)+'" alt="'+(null==(__t=title)?"":_.escape(__t))+'"></a>':' <img src="'+(null==(__t=global_theme_params.header_image_focused)?"":__t)+'" alt="">',__p+="</div></div>"),__p+="",avatar_url&&global_theme_params.show_avatar&&(__p+='<div class="avatar '+(null==(__t=global_theme_params.avatar_shape)?"":__t)+'" style="background-color:'+(null==(__t=global_theme_params.background_color)?"":__t)+"; background-image:url("+(null==(__t=avatar_url)?"":__t)+"); color:"+(null==(__t=global_theme_params.background_color)?"":__t)+'">',__p+=is_popover||!customizable?'<a href="'+(null==(__t=url)?"":__t)+'" target="_blank"><img src="'+(null==(__t=avatar_url)?"":__t)+'" alt="'+(null==(__t=title)?"":_.escape(__t))+'"></a>':' <img src="'+(null==(__t=avatar_url)?"":__t)+'" alt="">',__p+="</div>"),__p+="",(has_title||has_description)&&(__p+='<div class="info_wrapper"><div class="info">',has_title&&(__p+='<h1 class="title" style="font-family:'+(null==(__t=title_font_family||"inherit")?"":__t)+"; font-weight:"+(null==(__t=global_theme_params.title_font_weight)?"":__t)+'">'+(null==(__t=title)?"":_.escape(__t))+"</h1>"),__p+="",has_description&&(__p+='<div class="description" style="color:'+(null==(__t=description_color)?"":__t)+'"><div class="description_inner">'+(null==(__t=description_sanitized)?"":__t)+"</div></div>"),__p+="</div></div>"),__p+="</div>"}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],12:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var color="undefined"!=typeof loader_color?loader_color:"#D9D9D9";__p+='<div class="Knight-Rider-loader centered animate"><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div><div class="Knight-Rider-bar" style="background-color:'+(null==(__t=color)?"":__t)+'"></div></div>'}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],13:[function(t,e){"use strict";var i={"1785 GLC Baskerville":{display_name:"1785 Baskerville",family:"'1785 GLC Baskerville', serif",path:"1785glcbaskerville",_v:"1"},"Alternate Gothic":{display_name:"Alternate Gothic",family:"'Alternate Gothic', sans-serif",path:"alternategothic",_v:"3"},Arquitecta:{display_name:"Arquitecta",family:"'Arquitecta', sans-serif",path:"arquitecta",_v:"3"},Avalon:{display_name:"Avalon",family:"'Avalon', sans-serif",path:"avalon",_v:"1"},Baskerville:{display_name:"Baskerville",family:"Baskerville, 'Times New Roman', Times, serif"},"Bodoni Recut FS":{display_name:"Bodoni",family:"'Bodoni Recut FS', serif",path:"bodonirecutfs",_v:"3"},Bookmania:{display_name:"Bookmania",family:"'Bookmania', serif",path:"bookmania",_v:"1"},"Brutal Type":{display_name:"Brutal Type",family:"'Brutal Type', sans-serif",path:"brutaltype",_v:"1"},Calluna:{display_name:"Calluna",family:"'Calluna', serif",path:"calluna",_v:"3"},"Calluna Sans":{display_name:"Calluna Sans",family:"'Calluna Sans', sans-serif",path:"callunasans",_v:"3"},Capita:{display_name:"Capita",family:"'Capita', serif",path:"capita",_v:"1"},"Caslon FS":{display_name:"Caslon FS",family:"'Caslon FS', serif",path:"caslonfs",_v:"3"},"Clarendon Text Pro":{display_name:"Clarendon",family:"'Clarendon Text Pro', serif",path:"clarendontextpro",_v:"3"},"Clearface FS":{display_name:"Clearface",family:"'Clearface FS', serif",path:"clearface",_v:"4"},"Courier New":{display_name:"Courier New",family:"'Courier New', Courier, monospace"},Futura:{display_name:"Futura",family:"Futura, 'Century Gothic', AppleGothic, sans-serif"},"Garamond Classic FS":{display_name:"Garamond",family:"'Garamond Classic FS', serif",path:"garamondclassicfs",_v:"3"},Georgia:{display_name:"Georgia",family:"Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif"},Gibson:{display_name:"Gibson",family:"'Gibson', sans-serif",path:"gibson",_v:"3"},"Grumpy Black 48":{display_name:"Grumpy",family:"'Grumpy Black 48', serif",path:"grumpyblack48",_v:"3"},"Helvetica Neue":{display_name:"Helvetica",family:"'Helvetica Neue', Arial, Helvetica, sans-serif"},"Lorimer No 2":{display_name:"Lorimer No 2",family:"'Lorimer No 2', sans-serif",path:"lorimerno2",_v:"3"},"Lucida Sans":{display_name:"Lucida Sans",family:"'Lucida Sans', 'Lucida Grande', 'Lucida Sans Unicode', sans-serif"},"News Gothic FS":{display_name:"News Gothic",family:"'News Gothic FS', sans-serif",path:"newsgothicfs",_v:"3"},"Pratt Pro":{display_name:"Pratt Pro",family:"'Pratt Pro', serif",path:"prattpro",_v:"1"},Quadrat:{display_name:"Quadrat",family:"'Quadrat', serif",path:"quadrat",_v:"1"},"Sofia Pro":{display_name:"Sofia Pro",family:"'Sofia Pro', sans-serif",path:"sofiapro",_v:"2"},Spade:{display_name:"Spade",family:"'Spade', serif",path:"spade",_v:"1"},"Square Serif":{display_name:"Square Serif",family:"'Square Serif', serif",path:"squareserif",_v:"4"},Streetscript:{display_name:"Streetscript",family:"'Streetscript', sans-serif",path:"streetscript",_v:"1"},"Typewriter FS":{display_name:"Typewriter",family:"'Typewriter FS', serif",path:"typewriterfs",_v:"1"},Verdana:{display_name:"Verdana",family:"Verdana, Geneva, Tahoma, sans-serif"},Ziclets:{display_name:"Ziclets",family:"'Ziclets', serif",path:"ziclets",_v:"1"}};e.exports=i},{}],14:[function(t,e){"use strict";var i=t("prima/view"),s=t("./header/compact"),o=t("./posts/highlighted"),n=i.extend({className:"poptica_header",initialize:function(){this.header=new s({model:this.model}),this.posts=new o({model:this.model}),this.bindEvents()},bindEvents:function(){this.listenToOnce(this.header,"ready",this._triggerReady)},_triggerReady:function(){this.trigger("ready")},render:function(){return this.$el.append(this.header.render().el,this.posts.render().el),this}});e.exports=n},{"./header/compact":15,"./posts/highlighted":16,"prima/view":460}],15:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/lib/flags"),n=t("prima/lib/data"),r=t("prima/view"),a=t("prima/events"),l=t("prima/utils/colors"),h=t("prima/utils/url"),d=t("prima/lib/translate"),c=t("../../templates/blog_card.tpl"),u=t("../../utils/webfonts"),p=r.extend({className:"indash_tumblelog_compact",template:c,defaults:{current_data:{},unfollow_data:{},follow_data:{},template_data:{},hide_posts_on_unfollow:!1,stripDescriptionLineBreaks:!1,include_info_popover:!0},events:{"click .description a":"_descriptionLinkClicked","click .info_popover_button":"_infoPopoverButtonClicked","click .follow":"_onFollowClick","click .unfollow":"_onFollowClick"},initialize:function(t){if(this.options=i.extend({},this.defaults,t||{}),this.bindEvents(),this.is_rendered=!1,this.assets_host=n.get("Context/hosts/assets_host")||"",this.$description=null,this.$description_inner=null,!i.isEmpty(this.current_data)){var e=i.extend({},this.current_data,this.model.toJSON());this.model.set(e,{silent:!0})}this.model.get("global_theme_params")&&i.delay(i.bind(this.render,this),1)},bindEvents:function(){this.listenTo(this.model,"change:following",this._renderFollowButton),this.listenTo(this.model,"change:global_theme_params",this.render)},render:function(){var t=this.model.toJSON();if(t.following||(t.following=!1),this.is_rendered||!t.global_theme_params)return this;var e=i.result(u,t.global_theme_params.title_font),s=l.hexToRgb(t.global_theme_params.title_color);return this.$el.html(this.template(i.merge(t,{show_navigation:!0,show_share_controls:!1,show_user_controls:!1,show_follow_button:!0,title_font_family:e?e.family:!1,title_color_rgb:String(i.values(s).join(","))},this.options.template_data))),this.$description=this.$(".description"),this.$description_inner=this.$description.find(".description_inner"),this._renderFontStyles(),this._renderInlineStyles(),this.is_rendered=!0,this.$description.length&&(i.delay(i.bind(this.truncateDescription,this),100),this.options.stripDescriptionLineBreaks&&this.stripDescriptionLineBreaks()),this.trigger("ready"),this},stripDescriptionLineBreaks:function(){this.$description_inner.find("br").remove();var t=this.$description_inner.html(),e=t.replace(/[\n\r]/g," ");this.$description_inner.html(e)},truncateDescription:function(){var t=this.$description_inner.get(0);if(!(t.scrollHeight<=t.clientHeight)){var e=this.model.get("global_theme_params"),s=e.background_color,o=l.hexToRgb(s);this.$description.append(this.description_gradient_template({background_color:String(i.values(o).join(","))}))}},_onFollowClick:function(t){if(t.preventDefault(),!o.bool("is_logged_in"))return void window.open("/follow/"+this.model.get("name"),"_self");var e={follow_data:this.options.follow_data};this.model.get("following")?this._confirm_unfollow(e):(a.trigger("tumblelog:log_follow"),this.model.follow(e))},_confirm_unfollow:function(){var t=d("Are you sure you want to unfollow %1$s?").replace("%1$s","<strong>"+this.model.get("name")+"</strong>"),e={text:t,text_ok:d("Ok"),text_cancel:d("Nevermind")},i=this.model.requestUnfollow(),s={tumblelog:this.model.get("name")};i.promise.then(function(){a.trigger("tumblelog:log_unfollow",{loggingData:s})}),a.trigger("dialog:confirm:promise",i,e)},_infoPopoverButtonClicked:function(t){t.preventDefault(),this.info_popover.show()},_descriptionLinkClicked:function(t){t.preventDefault();var e=s(t.currentTarget).attr("href");try{if(h&&h.hasAllowedProtocol(e)){if(!h.isAbsoluteUrl(e)){var i="http://"+this.model.get("name")+".tumblr.com/";e="/"===e.charAt(0)?e.substr(1):e,e=i+e}window.open(e,"_blank")}}catch(o){}},_renderFollowButton:function(){var t=this.model.get("following");this.$el.find(".follow").toggle(!t),this.$el.find(".unfollow").toggle(t)},_hidePosts:function(){},_open_dialog:function(t,e){function s(t,e){t.is_disabled=t.is_menu_open,e&&e()}this.is_disabled=!0,t.fail(i.bind(s,null,this)),t.done(i.bind(s,null,this,e))},_renderInlineStyles:function(){var t=this.model.get("global_theme_params"),e=t.header_image_focused&&t.header_stretch&&t.show_header_image,i=l.hexToHsv(t.background_color),s=l.hexToHsv(t.link_color),o=t.link_color;return l.compare(s,i)&&(o=l.readable(i)),e||(this.$(".navigation .nav_icon").css("color",o),this.$(".navigation .blog_name").css("color",o),this.$(".navigation button").css({color:t.background_color,"background-color":o})),this.$(".description a").css("color",t.link_color),this},_renderFontStyles:function(){if(u){var t=this.model.get("global_theme_params");if(i.has(u,t.title_font)){var e=i.result(u,t.title_font),o="webfont_"+e.path;if(e.path&&!s("head #"+o).length){var n=this.assets_host+"/fonts/"+e.path+"/stylesheet.css";n+=i.has(e,"_v")?"?v="+e._v:"",s("<link>",{id:o,rel:"stylesheet",type:"text/css",href:n}).appendTo(s("head"))}}}},description_gradient_template:i.template('<div class="description_gradient" style="background: -moz-linear-gradient(top,  rgba(<%= background_color %>,0) 0%, rgba(<%= background_color %>,0.75) 50%, rgba(<%= background_color %>,1) 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(<%= background_color %>,0)), color-stop(50%,rgba(<%= background_color %>,0.75)), color-stop(100%,rgba(<%= background_color %>,1)));background: -webkit-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -o-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -ms-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: linear-gradient(to bottom,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);"></div>')});e.exports=p},{"../../templates/blog_card.tpl":11,"../../utils/webfonts":13,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/data":398,"prima/lib/flags":"f/LVtH","prima/lib/translate":423,"prima/utils/colors":445,"prima/utils/url":459,"prima/view":460}],16:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),r=t("../../templates/posts/highlighted_posts.tpl"),a=o.extend({className:"recent_posts",template:r,events:{"click a":"onPostClick",mouseenter:"onMouseEnter"},defaults:{on_bottom:!0,$popover:s(),min_load_time:500,model:{},dashboard_post:{}},initialize:function(t){i.extend(this,this.defaults,t),this.model&&(this.renderLoader(),this.renderInlineStyles(),this.posts=this.model.get("highlighted_posts"),i.isUndefined(this.posts)&&this.fetchPosts(),this.bindEvents())},bindEvents:function(){this.listenTo(this.model,"change:highlighted_posts",this.render),this.listenTo(this.model,"change:global_theme_params",this.renderInlineStyles)},fetchPosts:function(){this.model.fetch_popover_data({is_tumblelog_popover:!0})},updatePosts:function(t){this.model=t,this.posts=this.model.get("highlighted_posts"),i.isUndefined(this.posts)?this.fetchPosts():this.render(!0)},renderLoader:function(){var t=this.model.toJSON();this.$el.html(this.template({loader_color:t.global_theme_params?t.global_theme_params.title_color:"#D9D9D9"}))},renderInlineStyles:function(){var t=this.model.get("global_theme_params");t&&this.$el.css("background-color",t.background_color)},render:function(t){var e=this.posts||this.model.get("highlighted_posts");if(!i.isArray(e))return this;var s=e.join("");return e.length<2?(setTimeout(i.bind(function(){this.$popover.addClass("is_empty"),this.$el.html("")},this),this.min_load_time),this):(this.$el.addClass("has_"+e.length+"_posts"),t===!0?(this.$el.addClass("is_cached").html(s),this):(setTimeout(i.bind(function(){this.$el.addClass("is_loaded").html(s)},this),this.min_load_time),this))},onPostClick:function(){},onMouseEnter:function(){n.trigger("TumblelogPopover:mouseenter_posts")}});e.exports=a},{"../../templates/posts/highlighted_posts.tpl":12,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/view":460}],17:[function(t,e){"use strict";var i=t("app/vendor/ace"),s=i.acequire("ace/lib/dom"),o=t("./post_form.scss").getCSSText(),n={isDark:!1,cssClass:"ace-post-form",cssText:o};s.importCssString(n.cssText,n.cssClass),e.exports=n},{"./post_form.scss":18,"app/vendor/ace":"4e8++S"}],18:[function(t,e){var i,s=t("sassr/style"),o=".ace-post-form .ace_selection{background-color:rgba(220, 235, 244, 0.8);}.ace-post-form .ace_entity{color:#f2992e;}.ace-post-form .ace_string{color:#748089;}.ace-post-form .ace_underline{color:#56bc8a;text-decoration:underline;}.ace-post-form .ace_storage{color:#d95e40;}.ace-post-form .ace_operator{color:#748089;}.ace-post-form .ace_identifier{color:#444444;}.ace-post-form .ace_function{color:#f2992e;}.ace-post-form .ace_type{color:#a77dc2;}.ace-post-form .ace_constant{color:#d95e40;}.ace-post-form .ace_variable{color:#56bc8a;}.ace-post-form .ace_keyword{color:#f2992e;}.ace-post-form .ace_tag,.ace-post-form .ace_attribute-equals,.ace-post-form .ace_attribute-name{color:#529ecc;}.ace-post-form .ace_attribute-value{color:#a77dc2;}.ace-post-form .ace_heading{color:#529ecc;}.ace-post-form .ace_strong{color:#000000;}.ace-post-form .ace_emphasis{color:#748089;}.ace-post-form .ace_list.ace_markup{color:#a77dc2;}";e.exports.getStyleElement=function(){return s.style},e.exports.getCSSText=function(){return o},e.exports.append=function(){return i||s.inject(o),i=!0,s.style},e.exports.remove=function(){return i&&s.eject(o),i=!1,s.style
}},{"sassr/style":480}],19:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=o.extend({id:"milestone-confetti",tagName:"canvas",defaults:{amount:100,autoParty:!1,colors:["#D95E40","#F2992E","#56BC8A","#529ECC","#A77DC2","#748089"],size:40,speed:.5,onDone:i.noop},__resize:function(){this.$parent.length&&(this.el.width=this.$parent.width(),this.el.height=this.$parent.height())},_updateConfetti:function(t,e){this.confettiAngle+=.001,t.off||(t.tiltAngle+=t.tiltAngleIncrement,t.tilt=15*Math.sin(t.tiltAngle-e/3),t.y+=(Math.cos(this.confettiAngle+t.density)+.5*t.radius)*this.options.speed),t.y>this.el.height+20&&(this.isAnimating?(t.tilt=r.range(-10,10,!0),t.tileAngle=0,t.tiltAngleIncrement=r.range(.05,.1),t.x=Math.random()*this.el.width,t.y=-20):t.off||(t.off=!0,this.confettiOffscreen++))},_stopAnimating:function(){this.animationInterval&&(clearInterval(this.animationInterval),this.animationInterval=null),this.isAnimating=!1},_startAnimating:function(t){t=t||!1,this._stopAnimating(),this.animationInterval=setInterval(s.bind(this.draw,this),15),this.isAnimating=t?!0:this.isAnimating},initialize:function(t){this.options=s.extend({},this.defaults,t||{}),this.colors=this.options.colors,this.$win=i(window),this.$parent=i(),this.context=this.el.getContext("2d"),this.animationInterval=null,this.confetti=[],this.confettiAngle=0,this.confettiOffscreen=0,this.isAnimating=!1},render:function(){return s.defer(s.bind(this.setup,this)),this},setup:function(){this.$parent=this.$el.parent(),this.$parent.length&&(this.el.width=this.$parent.width(),this.el.height=this.$parent.height()),this.listenTo(n,"DOMEventor:flatresize",this.__resize);for(var t=this.options.size,e=.5*t,i=0,s=this.options.amount;s>i;i++)this.confetti.push({x:Math.random()*this.el.width,y:Math.random()*this.el.height,radius:r.range(e,t),density:r.range(10,s),tilt:r.range(-10,10,!0),tiltAngle:0,tiltAngleIncrement:r.range(.05,.1),color:this.colors[r.range(0,this.colors.length-1,!0)],off:!1});this.options.autoParty&&this.party()},draw:function(){if(this.context.clearRect(0,0,this.el.width,this.el.height),this.confettiOffscreen===this.confetti.length)return void this.remove();for(var t=5,e=0;e<this.confetti.length;e++){var i=this.confetti[e];this.context.beginPath(),this.context.lineWidth=.5*i.radius,this.context.strokeStyle=i.color,this.context.moveTo(i.x+i.tilt+i.radius/t,i.y),this.context.lineTo(i.x+i.tilt,i.y+i.tilt+i.radius/t),this.context.stroke(),this._updateConfetti(i,e)}},party:function(){return this.confettiOffscreen=0,this._startAnimating(!0),this},stopPartying:function(){return this.isAnimating=!1,this},remove:function(){return this._stopAnimating(),this.options.onDone(),o.prototype.remove.call(this)}},{range:function(t,e,i){i=i||!1;var s=(e-t)*Math.random()+t;return i?Math.round(s):s}});e.exports=r},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/view":460}],20:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/dialog"),n=s.extend({name:"Dialog",initialize:function(t){this.dialogView=o,this.options=i.extend({},this.defaults,t)},alert:function(t,e,i){return this.dialogView.alert.call(this.dialogView,t,e,i)},confirm:function(t,e,i,s,o){return this.dialogView.confirm.call(this.dialogView,t,e,i,s,o)},dialog:function(t){return this.dialogView.dialog.call(this.dialogView,t)},isActive:function(t){return this.dialogView.isActive.call(this.dialogView,t)},close:function(t){return this.dialogView.close.call(this.dialogView,t)},getDialogEl:function(){return this.dialogView.getDialogEl.call(this.dialogView)},__:function(t){return this.dialogView.__.call(this.dialogView,t)}});e.exports=new n},{"./views/dialog":24,lodash:"K2RcUv","prima/component":395}],21:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<button class="ui_button btn_'+(null==(__t=btn_id)?"":__t)+" chrome "+(null==(__t=btn_class)?"":__t)+'" data-btn-id="'+(null==(__t=btn_id)?"":__t)+'"><span>'+(null==(__t=text)?"":__t)+"</span></button>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],22:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<span class="text">'+(null==(__t=text)?"":__t)+"</span>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],23:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="ui_dialog '+(null==(__t=type)?"":__t)+'">'+(null==(__t=content_html)?"":__t)+'<div class="buttons">'+(null==(__t=buttons_html)?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],24:[function(t,e,i){"use strict";var s=t("jquery"),o=t("lodash"),n=t("prima/view"),r=t("prima/events"),a=t("prima/lib/translate"),l=n.extend({el:".ui_dialog",translations:{},defaultTemplates:{dialog:t("../templates/dialog.tpl"),content:t("../templates/content.tpl"),button:t("../templates/button.tpl")},events:{"click .ui_button":"buttonClick"},defaultDialog:{text:"",type:"default",has_form:"auto",visible_glass:!0,confirm_by_enter:!0,close_by_space:!0,key_tab:!0,key_close:!0,scroll_lock:!1,keycommand_maintain:!1,animate:!0,animate_in:{dialog_el:".ui_dialog",dialog_class:"add_animation fadeIn"},on_close:function(){},on_open:function(){}},initialize:function(){this.options=o.extend(this.defaults,this.options),this.templates=this.defaultTemplates,this.is_visible=!1,this.dialogQueueOrder=[],this.dialogQueue={},this.queueCounter=0,this.currentDialog=!1,this.currentDialogId=0,this.uid=0,this.$body=s("body"),this._initClickLock(),this._setupKeys(),r&&!i.Dialog&&(this.listenTo(r,"dialog:dialog",this.dialog),this.listenTo(r,"dialog:confirm",this.confirm),this.listenTo(r,"dialog:confirm:promise",this.confirmPromise),this.listenTo(r,"dialog:alert",this.alert),this.listenTo(r,"dialog:close",this.close))},dialog:function(t){return o.isObject(t)?this._dialog(t):!1},confirm:function(t,e,i,s,n){o.isString(t)&&(t={text:t});var r={callback_ok:e,callback_cancel:i,text_ok:s,text_cancel:n};t=o.extend({},r,t);var l={text:t.text,type:"confirm",visible_glass:!0,keycommand_maintain:t.keycommand_maintain||!1,templates:t.templates||null,escape_button:0,buttons:{0:{text:t.text_cancel||a("Cancel"),close:!0,callback:o.isFunction(t.callback_cancel)?t.callback_cancel:function(){}},1:{text:t.text_ok||a("OK"),selected:!0,btn_class:"blue",close:!0,callback:o.isFunction(t.callback_ok)?t.callback_ok:function(){}}}};return this._dialog(l)},confirmPromise:function(t,e){this.confirm(e,t.resolve,t.reject)},alert:function(t,e,i){o.isString(t)&&(t={text:t});var s={callback_ok:e,text_ok:i};t=o.extend({},s,t);var n={text:t.text,type:"alert",visible_glass:!0,keycommand_maintain:t.keycommand_maintain||!1,templates:t.templates||null,escape_button:0,buttons:{0:{text:t.text_ok||a("OK"),selected:!0,btn_class:"blue",close:!0,callback:o.isFunction(t.callback_ok)?t.callback_ok:function(){}}}};return this._dialog(n)},getDialogEl:function(){return this.el},buttonClick:function(t){var e=s(t.currentTarget),i=e.data("btn-id");if(o.isUndefined(this.currentDialog.buttons[i])||e.hasClass("disabled"))return!1;var n=this.currentDialog.buttons[i],r=null;o.isFunction(n.callback)&&(r=n.callback(this)),r!==!1&&(!o.isUndefined(n.close)&&n.close||o.isUndefined(n.close))&&this.close()},isActive:function(t){return this.currentDialog===!1||this.currentDialog.uid!==t?!1:!0},close:function(t){if(this.currentDialog===!1)return!1;if(o.isUndefined(t)&&(t=!1),t!==!1&&this.currentDialog.uid!==t)return!1;if(this.$dialog_lock.hide(),s(".ui_dialog_pos").remove(),this.is_visible=!1,this.currentDialog.keycommand_maintain||r.trigger("keycommands:resume"),o.isFunction(this.currentDialog.on_close)&&this.currentDialog.on_close(),r.trigger("dialog:closed"),this.currentDialog=!1,s("html").removeClass("dialog_lock"),this.dialogQueueOrder.length>0){var e=this.dialogQueueOrder.shift(),i=this.dialogQueue[e];delete this.dialogQueue[e],this._dialog(i)}},_tab:function(){var t=this.$el.find(".buttons .tab_frame"),e=t.filter(".focus"),i=t.index(e),s=t.length,o=!1;o=s>i+1?i+1:0,e.removeClass("focus init_focus");var n=t.eq(o);n.length>0&&(n.addClass("focus"),n.find("button").focus())},_formIsTabToButton:function(t,e){var i=this.$el.find(":focus");if(0===i.length)return!0;var s=this.$el.find(".buttons .tab_frame"),o=this.$el.find(":input:visible"),n=o.index(i);if(e&&n===o.length-1)return this.$el.find(":input:visible:first").focus(),t.preventDefault(),s.removeClass("focus init_focus"),!1;if(n>=0){var r=this.$el.find(":input:visible:eq("+(n+1)+")");if(r.length>0&&r.hasClass("ui_button"))return!0}return s.removeClass("focus init_focus"),!1},_select:function(){var t=this.$el.find(".buttons .tab_frame.focus"),e=t;1===e.length&&e.find(".ui_button").click()},_formIsFocusOnButton:function(){var t=this.$el.find(":focus");return 0===t.length?!1:t.hasClass("ui_button")},_escape:function(){if(!o.isUndefined(this.currentDialog.escape_button)){var t=this.$el.find(".btn_"+this.currentDialog.escape_button);t.length&&t.click()}},_dialog:function(t){if(o.isUndefined(t.uid)&&(t.uid=this._getUid()),this.currentDialog!==!1)return this.dialogQueueOrder.push(this.queueCounter),this.dialogQueue[this.queueCounter]=t,this.queueCounter++,t.uid;o.defaults(t,this.defaultDialog);var e=this._buildButtons(t.buttons);o.extend(t,{buttons_html:e});var i=this.templates;o.isObject(t.templates)&&(i=o.extend({},this.templates,t.templates));var n=o.isString(i.dialog)?o.template(i.dialog):i.dialog,a=o.isString(i.content)?o.template(i.content):i.content;t.content_html=a(t);var l=n(t);this.$dialog_lock.show(),o.isUndefined(t.visible_glass)?this.$dialog_lock.removeClass("opaque"):t.visible_glass&&this.$dialog_lock.addClass("opaque"),!o.isUndefined(t.scroll_lock)&&t.scroll_lock&&s("html").addClass("dialog_lock"),this.currentDialogId=t.uid,this.currentDialog=t;var h=s('<div id="dialog_'+this.currentDialogId+'" class="ui_dialog_pos">'+l+"</div>");return h.appendTo(this.$body),this.setElement(h),this.is_visible=!0,t.animate&&o.isObject(t.animate_in)&&this.$el.find(t.animate_in.dialog_el).length&&this.$el.find(t.animate_in.dialog_el).addClass(t.animate_in.dialog_class),this._focus(),this.currentDialog.keycommand_maintain||r.trigger("keycommands:suspend"),o.isUndefined(t.has_form)&&(t.has_form="auto"),"auto"===t.has_form&&(t.has_form=this.$el.find("form, input").length>0),o.isFunction(t.on_open)&&t.on_open(),this.el=this.$el[0],this.delegateEvents(),r.trigger("dialog:opened"),t.uid},_button:function(t,e,i,s){var n,r=o.isString(this.templates.button)?o.template(this.templates.button):this.templates.button;o.isObject(this.currentDialog.templates)&&(n=this.currentDialog.templates.button),s&&(e+=" default-pulse");var a=r({btn_class:e,text:t,btn_id:o.isUndefined(i)?"":i});return a='<div class="tab_frame">'+a+"</div>"},_focus:function(){if(!this.currentDialog)return!1;for(var t in this.currentDialog.buttons){var e=this.currentDialog.buttons[t];if(!o.isUndefined(e.selected)&&e.selected){var i=this.$el.find(".btn_"+t);i.length>0&&i.parent().addClass("focus init_focus")}}},_setupKeys:function(){s(document).on("keydown",o.bind(function(t){var e=t.ctrlKey||t.shiftKey||t.metaKey;if(this.is_visible&&!e){var i=t.keyCode||t.which;if(9===i&&this.currentDialog.key_tab){if(this.currentDialog.has_form&&!this._formIsTabToButton(t,!0))return;t.preventDefault(),this._tab(t)}if(13===i&&this.currentDialog.confirm_by_enter||32===i&&this.currentDialog.close_by_space){if(this.currentDialog.has_form&&32===i&&!this._formIsFocusOnButton(t))return;t.preventDefault(),this._select(t)}27===i&&this.currentDialog.key_close&&(t.preventDefault(),this._escape(t))}},this))},_buildButtons:function(t){if(!o.isObject(t))return"";var e=0;for(var i in t)t.hasOwnProperty(i)&&e++;for(var s="",n=0;e>n;n++)if(!o.isUndefined(t[n])){var r=o.isUndefined(t[n].text)?"":t[n].text,a=o.isUndefined(t[n].btn_class)?"":t[n].btn_class,l=o.isUndefined(t[n].selected)?!1:t[n].selected;s+=this._button(r,a,n,l)}return s},_initClickLock:function(){var t=this.$dialog_lock=s("<div>",{"class":"ui_dialog_lock"});s(document).ready(function(){t.prependTo("body")})},_getUid:function(){return this.uid++},__:function(t){return a(t)}});e.exports=new l},{"../templates/button.tpl":21,"../templates/content.tpl":22,"../templates/dialog.tpl":23,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/view":460}],25:[function(t,e){"use strict";var i,s=t("jquery"),o=t("lodash"),n=t("prima/lib/translate"),r=t("prima/component"),a=t("prima/events"),l=t("app/components/dialog"),h=t("./views/drawer-view"),d=r.extend({name:"drawer",selector:"body",defaults:{suspended:!1,needsCloseConfirmation:!1},initialize:function(){this.$glass=null,this.$container=s(this.container),this.bindEvents()},bindEvents:function(){this.listenTo(a,"DOMEventor:keydown:escape",this.initiateClose),this.listenTo(a,"post:form:show",this.suspend),this.listenTo(a,"post:form:hide",this.resume),this.listenTo(a,"drawer:suspend",this.suspend),this.listenTo(a,"drawer:resume",this.resume),this.listenTo(a,"drawer:enableCloseConfirmation",this.enableCloseConfirmation),this.listenTo(a,"drawer:disableCloseConfirmation",this.disableCloseConfirmation),this.$container.on("click.drawerOpen","[data-drawer-open]",o.bind(this.onClickOpen,this))},suspend:function(){this.set("suspended",!0)},resume:function(){this.set("suspended",!1)},enableCloseConfirmation:function(){this.set("needsCloseConfirmation",!0)},disableCloseConfirmation:function(){this.set("needsCloseConfirmation",!1)},canOpen:function(){return!this.get("suspended")&&!this.view},toggle:function(t,e){this.canOpen?this.open(t,e):this.close()},open:function(t,e){this.view=new h({subviews:{"drawer-content":{constructor:t,options:e||{}}}}),this.showGlass(),a.trigger("keycommands:suspend"),this.append(),this.trigger("open"),a.trigger("drawer:open")},onClickOpen:function(t){t.preventDefault();var e=s(t.currentTarget).attr("data-drawer-open");this.trigger("open:"+e),a.trigger("drawer:open:"+e)},initiateClose:function(){this.view&&(this.get("needsCloseConfirmation")===!0?l.confirm(n("Close without sending?"),o.bind(this.close,this),this.noop,n("OK"),n("Cancel")):this.close())},close:function(){this.view&&(this.view.animateRemove(),this.view=null,this.hideGlass(),a.trigger("keycommands:resume"),this.trigger("close"),a.trigger("drawer:close"))},remove:function(){return this.close(),this},showGlass:function(){this.$glass=s("<div>",{"class":"ui_peepr_glass"}).appendTo(this.$container);var t=o.bind(function(){this.$container.addClass("peepr")},this);o.delay(t,50),this.$glass.on("click",o.bind(this.initiateClose,this))},hideGlass:function(){var t=this.$glass;this.$glass=null,this.$container.removeClass("peepr"),o.delay(function(){t.remove()},150)}});e.exports=function(){return i||(i=new d),i}},{"./views/drawer-view":27,"app/components/dialog":20,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396,"prima/lib/translate":423}],26:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+=""+(null==(__t=_subview("drawer-content"))?"":__t);return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],27:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("velocity-animate"),n=t("prima/events"),r=t("prima/views/base"),a=t("../templates/drawer-view.tpl"),l=r.extend({template:a,className:"drawer",defaults:{visible:!1},initialize:function(t){t.subviews&&(this.cacheElements({$body:i("body")}),this.bindEvents())},bindEvents:function(){this.listenTo(n,"DOMEventor:keydown:tab",this.disableKey)},afterRender:function(){this.show()},disableKey:function(t){var e=i(t.target).is("input");e||t.preventDefault()},show:function(){this.get("visible")||(this.set("visible",!0),o.animate(this.el,{translateX:["0%","100%"]},{duration:200}))},hide:function(t){this.get("visible")?(this.set("visible",!1),o.animate(this.el,{translateX:["100%","0%"]},{duration:200,complete:t})):t()},animateRemove:function(){return this.hide(s.bind(function(){this.remove()},this)),this}});e.exports=l},{"../templates/drawer-view.tpl":26,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/views/base":461,"velocity-animate":"lWl/mc"}],28:[function(t,e){"use strict";var i=t("prima/component"),s=t("prima/lib/flags"),o=t("./views/elevator"),n=i.extend({name:"elevator",selector:"body",autoAppend:!0,view:function(t){return s.bool("is_mobile")?!1:new o(t)}});e.exports=n},{"./views/elevator":30,"prima/component":395,"prima/lib/flags":"f/LVtH"}],29:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="elevator"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],30:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/views/base"),o=t("prima/events"),n=s.extend({template:t("../templates/elevator.tpl"),className:"elevator-wrapper",defaults:{fadeScrollDistance:2e3,visible:!1},events:{click:"elevate"},initialize:function(){this.listenTo(o,"DOMEventor:flatscroll",this.onScroll),this.on("change:visible",this.toggleVisibility)},elevate:function(){i("html").velocity("scroll",1e3)},onScroll:function(t){t&&(t.windowScrollY>=this.get("fadeScrollDistance")?this.set("visible",!0):this.set("visible",!1))},toggleVisibility:function(t,e){this.$el.toggleClass("visible",e)}});e.exports=n},{"../templates/elevator.tpl":29,jquery:"HlZQrA","prima/events":396,"prima/views/base":461}],31:[function(t,e){"use strict";var i=(t("jquery"),t("prima/component")),s=t("./views/flat-select"),o=i.extend({name:"FlatSelect",view:function(t){return new s(t)}});e.exports=o},{"./views/flat-select":32,jquery:"HlZQrA","prima/component":395}],32:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=o.extend({el:"body",defaults:{},events:{"change .flat_select select":"__selectChange"},__selectChange:function(t){var e=i(t.currentTarget);this.updateSelect(e)},initialize:function(t){this.options=s.extend({},this.defaults,t)},updateSelect:function(t){var e=t.siblings("label");e.text(t.find(":selected").text())}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","prima/view":460}],33:[function(t,e){"use strict";var i,s=t("jquery"),o=t("prima/component"),n=t("./views/footer"),r=t("./views/sidebar_footer"),a=o.extend({name:"footer",initialize:function(){this.createFooter()},createFooter:function(){s(".l-footer").length&&(this.footerView=new n({el:".l-footer"})),s(".sidebar_nav").length&&(this.sidebarFooterView=new r({el:".sidebar_nav"}))}});e.exports=function(){return i||(i=new a),i}},{"./views/footer":34,"./views/sidebar_footer":35,jquery:"HlZQrA","prima/component":395}],34:[function(t,e){"use strict";var i=t("prima/view"),s=i.extend({initialize:function(){}});e.exports=s},{"prima/view":460}],35:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/events"),o=t("prima/mixins/accessor"),n=i.extend({mixins:[o],defaults:{fadeScrollDistance:2e3,visible:!0},initialize:function(){this.listenTo(s,"DOMEventor:flatscroll",this.onScroll),this.on("change:visible",this.toggleVisibility)},onScroll:function(t){t&&(t.windowScrollY>=this.get("fadeScrollDistance")?this.set("visible",!1):this.set("visible",!0))},toggleVisibility:function(t,e){this.$el.toggleClass("visible",e)}});e.exports=n},{"prima/events":396,"prima/mixins/accessor":425,"prima/view":460}],36:[function(t,e){"use strict";var i=t("prima/component"),s=t("prima/lib/domeventor"),o=t("prima/events"),n=t("jquery"),r=t("lodash"),a=i.extend({name:"GutterMediaManager",gutteredView:null,gutterMargin:20,gutterWidth:215,maxViewWidth:300,viewportTransitionWidth:900,initialize:function(){this.layoutHasGutter=this.$right_column().length>0,this.layoutHasGutter||(this.gutterMargin=-65)},$right_column:function(){return this._$right_column||(this._$right_column=n(".right_column")),this._$right_column},toggleBackground:function(t){this.layoutHasGutter&&(t?(this.$right_column().addClass("has_docked_post"),this.$right_column().on("click.gutterManager",r.bind(this.handleGutterClick,this))):(this.$right_column().removeClass("has_docked_post"),this.$right_column().off("click.gutterManager")))},putViewInGutter:function(t,e){e=r.defaults(e||{},{winRect:s.rect(),gutterPosition:this.gutterPosition(),animation:null,dimRadar:!0,removeOnGutterClick:!1,onDock:r.noop,onUndock:r.noop,dockLoggingName:"post:docked",dockLoggingData:null,undockLoggingName:"post:undocked",undockLoggingData:null});var i={view:t,options:e};return this.isDockable(i)?(e.onDock=e.onDock||r.noop,this.gutteredView&&this.removeGutteredView(),this.gutteredView=i,e.onDock.call(t,e),e.dimRadar&&this.toggleBackground(!0),e.dockLoggingName&&e.dockLoggingData&&o.trigger(e.dockLoggingName,{loggingData:e.dockLoggingData}),this.gutteredView):!1},removeGutteredView:function(){if(this.gutteredView){var t=this.gutteredView.options,e=this.gutteredView.view;t.onUndock=t.onUndock||r.noop,t.onUndock.call(e,t),this.gutteredView=null,t.dimRadar&&this.toggleBackground(!1),t.undockLoggingName&&t.undockLoggingData&&o.trigger(t.undockLoggingName,{loggingData:t.undockLoggingData})}},isViewInGutter:function(t){return this.gutteredView&&this.gutteredView.view===t},isDockable:function(t){if(!this.gutteredView)return!0;var e=this.gutteredView?this.gutteredView.options.alwaysEvict:!0,i=t.options.alwaysEvict;return this.gutteredView.view===t.view||i&&!e?!1:!0},handleGutterClick:function(t){this.gutteredView&&(t.preventDefault(),this.gutteredView.options.removeOnGutterClick&&this.removeGutteredView())},gutterPosition:function(){var t=s.rect(),e=this.viewportTransitionWidth/2-this.gutterMargin-this.gutterWidth,i={width:this.maxViewWidth,left:"50%",bottom:20,translateX:e},o=this.maxViewWidth-this.gutterWidth+this.viewportTransitionWidth;return t.windowWidth<o&&(i.width=o-t.windowWidth),i.width<this.gutterWidth&&(i.width=this.gutterWidth),i}});e.exports=new a},{jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396,"prima/lib/domeventor":400}],37:[function(t,e){"use strict";var i,s=(t("lodash"),t("prima/component")),o=(t("prima/lib/flags"),t("./views/header")),n=s.extend({name:"header",autoAppend:!0,append:function(){this.headerView=new o({el:this.container}),this.enableFunctionality()},enableFunctionality:function(){this.headerView.enableCompose()},disableSticky:function(){this.headerView.disableSticky()}});e.exports=function(){return i||(i=new n),i}},{"./views/header":40,lodash:"K2RcUv","prima/component":395,"prima/lib/flags":"f/LVtH"}],38:[function(t,e){"use strict";var i=t("prima/view"),s=t("app/components/account-popover"),o=i.extend({events:{click:"openPopover"},initialize:function(){this.popover=null,this.popoverOptions={container:this.$el}},openPopover:function(t){t.preventDefault(),this.popover||(this.popover=new s(this.popoverOptions)),this.popover.open()}});e.exports=o},{"app/components/account-popover":3,"prima/view":460}],39:[function(t,e){"use strict";var i=t("prima/lib/flags"),s=t("prima/view"),o=t("prima/events"),n=t("prima/mixins/accessor"),r=s.extend({mixins:[n],el:".compose-button",events:{click:"toggleOpen"},defaults:{open:!1},loggingData:{source:"compose-button"},initialize:function(){this.on("change:open",this.onChangeOpen),i.bool("dashboard_refresh")?(this.listenTo(o,"fastCompose:init:complete",this.open),this.listenTo(o,"fastCompose:dismiss:complete",this.close)):(this.listenTo(o,"fastCompose:init:complete",this.open),this.listenTo(o,"fastCompose:dismiss:complete",this.close))},toggleOpen:function(){this.toggle("open")},open:function(){this.set("open",!0)},close:function(){this.set("open",!1)},onChangeOpen:function(t,e){i.bool("dashboard_refresh")?e?o.trigger("fastCompose:init",{loggingData:this.loggingData}):o.trigger("fastCompose:dismiss",{loggingData:this.loggingData}):o.trigger(e?"fastCompose:init":"fastCompose:dismiss")}});e.exports=r},{"prima/events":396,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":425,"prima/view":460}],40:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/view"),o=t("prima/events"),n=t("prima/mixins/accessor"),r=t("./compose_btn"),a=t("app/components/switcher"),l=t("./logo"),h=t("./account-menu"),d=s.extend({mixins:[n],defaults:{headerHeight:52},initialize:function(){this.logo=new l({el:'[prima-component="logo"]'}),this.accountMenu=new h({el:".tab_nav_account"}),this.listenTo(o,"Header:hide",this.hide),this.listenTo(o,"Header:show",this.show),this.$window=i(window)},enableCompose:function(){this.composeBtn=new r,this.composeBtn.$el.length&&this.$el.find(".move_search_bar_left").removeClass("hide_compose_btn"),this.switcher=new a},disableSticky:function(){this.$el.addClass("l-header-container--unstuck")},hide:function(){var t=this.$window.scrollTop(),e=t<this.get("headerHeight")?t:this.get("headerHeight");this.$el.css({position:"absolute",top:t+"px"}),this.$el.velocity({translateY:[-e,0],translateZ:"0px"},150).velocity({translateY:"0px",translateZ:"0px",top:0},0)},show:function(){var t=this.$window.scrollTop(),e=t<this.get("headerHeight")?t:this.get("headerHeight");this.$el.css({position:"absolute",top:t+"px",transform:"translateY("+-e+"px) translateZ(0)"}),this.$el.velocity({translateY:[0,-e],translateZ:"0px"},150).css({position:"fixed",top:0})}});e.exports=d},{"./account-menu":38,"./compose_btn":39,"./logo":41,"app/components/switcher":234,jquery:"HlZQrA","prima/events":396,"prima/mixins/accessor":425,"prima/view":460}],41:[function(t,e){"use strict";var i=t("prima/view"),s=t("components/tumblr-dot"),o=i.extend({initialize:function(){this.$el.find('[prima-component="TumblrDot"]')&&(this.dot=new s)}});e.exports=o},{"components/tumblr-dot":373,"prima/view":460}],42:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/component"),o=t("prima/events"),n=t("app/components/drawer"),r=t("prima/mixins/keycommands"),a=t("./views/keycommand_guide.js"),l=s.extend({name:"keycommandguide",mixins:[r],defaults:{canOpen:!0},keycommands:{"keydown:shift+forwardslash":"open"},initialize:function(){this.drawerManager=n(),this.listenTo(this.drawerManager,"open:keycommand-guide",this.open),this.listenTo(o,"dialog:opened",this.disableKeys),this.listenTo(o,"dialog:closed",this.enableKeys)},open:function(){o.trigger("keycommands:open_guide");var t=i(document.activeElement).is("input,textarea,div[contenteditable]");this.drawerManager.canOpen()&&!t?(this.drawerManager.open(a),this.soloKeys()):(this.drawerManager.close(),this.unSoloKeys())}});e.exports=l},{"./views/keycommand_guide.js":44,"app/components/drawer":25,jquery:"HlZQrA","prima/component":395,"prima/events":396,"prima/mixins/keycommands":429}],43:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<h1 class="keycommand-guide-title">'+(null==(__t=__("Keyboard shortcuts"))?"":__t)+'</h1><ul class="keycommand-guide-section shortcuts-navigation"><li class="section_header">'+(null==(__t=__("Navigation"))?"":__t)+'</li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("Move forward through posts"))?"":__t)+'</div><span class="shortcut"><b class="key">J</b></span></li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("Move backward through posts"))?"":__t)+'</div><span class="shortcut"><b class="key">K</b></span></li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("Return to the top"))?"":__t)+'</div><span class="shortcut"><b class="key">.</b></span></li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("Like current post"))?"":__t)+'</div><span class="shortcut"><b class="key">L</b></span></li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("View current post's notes"))?"":__t)+'</div><span class="shortcut"><b class="key">N</b></span></li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("View blog of current post"))?"":__t)+'</div><span class="shortcut"><b class="key">enter</b></span></li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("Follow a recommended blog"))?"":__t)+'</div><span class="shortcut"><b class="key">F</b></span></li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("Reject a recommended blog"))?"":__t)+'</div><span class="shortcut"><b class="key">X</b></span></li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("Search Tumblr"))?"":__t)+'</div><span class="shortcut"><b class="key modifier">tab</b></span></li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("Switch between blogs"))?"":__t)+'</div><span class="shortcut"><b class="key modifier">option</b> + <b class="key modifier">tab</b></span></li></ul><ul class="keycommand-guide-section shortcuts-posting"><li class="section_header">'+(null==(__t=__("Posting"))?"":__t)+'</li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("Compose a new post"))?"":__t)+'</div><span class="shortcut"><b class="key modifier">option</b> + <b class="key">C</b></span></li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("Fast reblog a post"))?"":__t)+'</div><span class="shortcut"><b class="key modifier">option</b> + <b class="key">R</b></span></li><li class="keycommand-guide-section-item"><div class="controls-item">'+(null==(__t=__("Add a post to your queue"))?"":__t)+'</div><span class="shortcut"><b class="key modifier">option</b> + <b class="key">E</b></span></li></ul>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],44:[function(t,e){"use strict";function i(){return"Win32"===navigator.platform}var s=t("prima/lib/flags"),o=t("prima/views/base"),n=t("../templates/keycommand_guide.tpl"),r=o.extend({template:n,className:"keycommand-guide",defaults:function(){return{option:i()?"shift":"option",zOption:i()?"Z":"option",auto_paginate:s.bool("keycommand_auto_paginate")}}});e.exports=r},{"../templates/keycommand_guide.tpl":43,"prima/lib/flags":"f/LVtH","prima/views/base":461}],45:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/component"),n=t("components/post-message-channel"),r=t("prima/events"),a=(t("prima/lib/logger"),t("scrollmonitor")),l=o.extend({name:"MediaEmbedHarness",$post:null,channel:null,watcher:null,_data:{service:"",embedID:"",postID:"",source:""},initialize:function(t){t.embedID&&(this._data=s.pick(t,s.keys(this._data)),this.post=i("#"+this._data.embedID).closest(".post")[0],this.$post=i(this.post),this.postId=this.$post.data("post-id"),this.channel=new n({namespace:this._data.embedID+":"+this._data.service+":"+this._data.postID,window:this._data.source}),this.channel.on_connection(s.bind(function(){this.channel.listen_to("stateChanged",this.__onStateChange,this)},this)),this._setupWatcher())},play:function(){this.channel.send("play")},pause:function(){this.channel.send("pause")},getState:function(){this.channel.call("getState").then(function(t,e){return e})},getData:function(){return this._data},_setupWatcher:function(){this.post&&(this.watcher=a.create(this.post,-52),this.watcher.fullyEnterViewport(s.bind(function(){this.trigger("fullyEnterViewport")
},this)),this.watcher.partiallyExitViewport(s.bind(function(){this.trigger("partiallyExitViewport")},this)),this.watcher.exitViewport(s.bind(function(){this.trigger("exitViewport")},this)))},__onStateChange:function(t){var e={loggingData:s.extend({},this._data,{state:t})};e.loggingData.postID&&"null"!==e.loggingData.postID||(e.loggingData.postID=this.postId?this.postId.toString():""),this.trigger("stateChange",t,this),r.trigger("post:embed:stateChange",e)}});e.exports=l},{"components/post-message-channel":337,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396,"prima/lib/logger":403,scrollmonitor:"y33VHk"}],46:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/component"),n=t("prima/events"),r=t("components/post-message-channel"),a=t("./harness"),l=t("./services/tumblr"),h=o.extend({name:"EmbedManager",harnessCollection:{},harnessRequests:{},requestID:0,currentlyPlaying:null,initialize:function(){return r.on("embed*",i.bind(this._handleMessage,this)),this.listenTo(n,"CrtControl:playerCreated",this.createCrtHarness),this.on("harnessCreated",this.__onHarnessCreated),this},createCrtHarness:function(t){t.on("ready",i.bind(function(){var e=t.$el.attr("id");e in this.harnessCollection||(this.harnessCollection[e]=new l(t,e),this.trigger("harnessCreated",this.harnessCollection[e]))},this))},createHarness:function(t){t.embedID in this.harnessCollection?this.harnessCollection[t.embedID].channel.setWindow(t.source):(this.harnessCollection[t.embedID]=new a(t),this.trigger("harnessCreated",this.harnessCollection[t.embedID]))},getHarness:function(t){var e=s.Deferred();return void 0!==this.harnessCollection[t]?e.resolve(this.harnessCollection[t]):(e.requestID=++this.requestID,e.embedID=t,this.harnessRequests[e.requestID]=e),e.promise()},_handleMessage:function(t){var e,i=/^(embed\-.+?)\:(.+?)\:(.+?)\:_syn$/,s=JSON.parse(t.data);s&&s.method&&(e=s.method.match(i))&&(s.embedID=e[1],s.service=e[2],s.postID=e[3],s.source=t.source,this.createHarness(s))},__onHarnessCreated:function(t){i.forEach(this.harnessRequests,i.bind(function(e){e.embedID===t.getData().embedID&&(e.resolve(t),delete this.harnessRequests[e.requestID])},this)),this.listenTo(t,"stateChange",this.__onHarnessStateChange)},__onHarnessStateChange:function(t,e){"playing"===t||"focus"===t?(this.currentlyPlaying&&this.currentlyPlaying!==e&&this.currentlyPlaying.pause(),this.currentlyPlaying=e):this.currentlyPlaying===e&&(this.currentlyPlaying=null)}});e.exports=new h},{"./harness":45,"./services/tumblr":47,"components/post-message-channel":337,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396}],47:[function(t,e){"use strict";var i=t("jquery"),s=t("../harness"),o=s.extend({player:{},$post:{},initialize:function(t,e){this.player=t,this.post=this.player.$el.closest(".post")[0],this.$post=i(this.post),this._data={},this._data.embedID=e,this._data.service="tumblr",this._data.postID=this.$post.data("post-id"),this.connected=!0,this._setupWatcher(),this.listenTo(this.player,"change:paused",this.__onStateChange),this.listenTo(this.player,"change:autoplay",this.__onStateChange)},play:function(){var t=this.getState();"autoplaying"===t?this.player.restart():"playing"!==t&&this.player.play({onDock:!0})},pause:function(){"paused"!==this.getState()&&this.player.pause()},getState:function(){var t=this.player.get("paused"),e=this.player.get("autoplay");return t?"paused":e?"autoplaying":"playing"},__onStateChange:function(){var t=this.getState();s.prototype.__onStateChange.call(this,t)}});e.exports=o},{"../harness":45,jquery:"HlZQrA"}],48:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("../models/photo"),n=s.extend({model:o,getSubset:function(t){return i.isUndefined(t)?[]:i.map(i.isArray(t)?t:i.toArray(arguments),this.get,this)},getSubCollection:function(){return new n(this.getSubset.apply(this,arguments))},setIdOrder:function(t,e){e||(e={}),this.models=i.map(t,function(t){return this.get(t)},this),e.silent||this.trigger("sort",this,e)}});e.exports=n},{"../models/photo":50,lodash:"K2RcUv","prima/collection":394}],49:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./models/photoset"),n=(t("./models/photo"),t("./collections/photos"),t("./utils"),t("./views/photoset")),r=t("./views/photo"),a=s.extend({name:"Photoset",initialize:function(t){(i.isArray(t)||t instanceof o)&&(t={photoset:t}),this.options=t=i.extend({},t),this.model=t.photoset instanceof o?t.photoset:new o(t.photoset);var e=i.keys(n.prototype.defaults);e.push("PhotoView"),e.push("post");var s=i.pick(t,e);s.photoset=this.model,this._PhotosetView=t.PhotosetView||n,this._PhotoView=t.PhotoView||r,this.indexView=new this._PhotosetView(s),this.listenTo(this.model,"all",this._relayModelEvent),this.listenTo(this.model.photos,"all",this._relayModelEvent)},_relayModelEvent:function(){this.trigger.apply(this,arguments)},teardown:function(){return this.indexView.teardown(),this.stopListening(),this},remove:function(){return this.teardown(),this.indexView.remove(),this},render:function(){return this.indexView.render(),this},getElement:function(){return this.indexView.$el}});e.exports=a},{"./collections/photos":48,"./models/photo":50,"./models/photoset":51,"./utils":56,"./views/photo":59,"./views/photoset":60,lodash:"K2RcUv","prima/component":395}],50:[function(t,e){"use strict";var i=t("prima/model"),s=t("../utils/imagelayout"),o=i.extend({defaults:{width:null,height:null,x:"50%",y:"50%",url:"",caption:"",clickthroughUrl:""},getAspectRatio:function(){return s.aspectRatio(this.get("width"),this.get("height"))},getWidthForHeight:function(t){return s.widthForHeight(this.get("width"),this.get("height"),t)},getHeightForWidth:function(t){return s.heightForWidth(this.get("width"),this.get("height"),t)}});e.exports=o},{"../utils/imagelayout":55,"prima/model":439}],51:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=t("../collections/photos"),n=t("../utils/imagelayout"),r=["","1","11","12","13","123","133","1232","1323","12223"],a=3,l=s.extend({defaults:{layout:null},initialize:function(t,e){e=i.extend({},e),this.layouts=e.layouts||r,this.maxPerRow=e.maxPerRow||a,(i.isArray(t)||t instanceof o)&&(this.attributes=i.extend({photos:t},this.defaults)),this.photos=this.get("photos")instanceof o?this.get("photos"):new o(this.get("photos")),this.unset("photos"),this.fixLayout()},fixLayout:function(){var t=this.get("layout");return t=t?n.fix(t,this.photos.length,this.layouts,this.maxPerRow):n.calculateDefault(this.photos.length,this.layouts,this.maxPerRow),this.set("layout",t),t},getRows:function(t){return n.toArray(t||this.get("layout"),this.photos,this.layouts,this.maxPerRow)},getPhotoRow:function(t){var e={id:t};return i.findIndex(this.getRows(),function(t){return i.some(t,e)})},removePhoto:function(t){var e=this.getPhotoRow(t),s=this.photos.remove(t),o=i.reduce(this.get("layout").split(""),function(t,s,o){return s=i.parseInt(s),o===e&&s--,t+(s>0?s:"")},"");this.set("layout",o),s&&this.trigger("photo:remove",s,t,o)},toJSON:function(){var t=s.prototype.toJSON.apply(this,arguments);return t.photos=this.photos.toJSON(),t.rows=this.getRows(),t}}),h=["add","remove","reset","push","pop","unshift","shift","slice","where","findWhere","forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];i.forEach(h,function(t){var e=o.prototype[t];l.prototype[t]=function(){return e.apply(this.photos,i.toArray(arguments))}}),e.exports=l},{"../collections/photos":48,"../utils/imagelayout":55,lodash:"K2RcUv","prima/model":439}],52:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-imagecrop style="width:'+(null==(__t=displayWidth)?"":_.escape(__t))+"px;height:"+(null==(__t=displayHeight)?"":_.escape(__t))+'px" class="photoset--image-crop"><div data-js-imagewrap style="background-image:url('+(null==(__t=url)?"":_.escape(__t))+");background-position:"+(null==(__t=x)?"":_.escape(__t))+" "+(null==(__t=y)?"":_.escape(__t))+'" class="photoset--image-wrap"><img data-js-image src="'+(null==(__t=url)?"":_.escape(__t))+'" alt="'+(null==(__t=caption)?"":_.escape(__t))+'" data-width="'+(null==(__t=width)?"":_.escape(__t))+'" data-height="'+(null==(__t=height)?"":_.escape(__t))+'" class="photoset--image"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],53:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var rows=photoset.rows,cellId=0;__p+='<div data-js-layout class="photoset--layout">',_.forEach(rows,function(t,e){__p+="";var i=e>0?padding:0,s=e<rows.length-1?padding:0,o=_rowSize(t,width,padding),n=o.height;__p+='<div data-photoset-row="'+(null==(__t=e)?"":_.escape(__t))+'" style="height:'+(null==(__t=n+i+s)?"":_.escape(__t))+'px" class="photoset--row">',_.forEach(t,function(e,r){__p+="";var a=o.photos[r],l=a.width,h=a.height,d=n,c=r<t.length-1?padding:0,u=r>0?padding:0,p=l+u+c,m=_.map([i,c,s,u],function(t){return t?t+"px":0}).join(" ");__p+='<div data-photoset-position="'+(null==(__t=cellId)?"":_.escape(__t))+'" data-photo-id="'+(null==(__t=e.id)?"":_.escape(__t))+'" style="width:'+(null==(__t=p)?"":_.escape(__t))+"px;height:"+(null==(__t=n)?"":_.escape(__t))+"px;padding:"+(null==(__t=m)?"":_.escape(__t))+'" class="photoset--cell">'+(null==(__t=photoTemplate(_.defaults({scaledWidth:l,scaledHeight:h,displayWidth:a.width,displayHeight:d},e)))?"":__t)+"</div>",cellId++,__p+=""}),__p+="</div>"}),__p+="</div>"}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],54:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o={},n=function(t,e,o){var n=t instanceof s?t:s(t),r=e;i.isObject(e)||(r={},r[e]=o),n.attr(r);var a=i.transform(r,function(t,e,s){s.match(/^data\-/i)&&(t[i.camelize(s.replace(/^data\-/,""))]=e)},{});return n.data(a),n},r=function(t,e){var o=t instanceof s?t:s(t);return i.isString(e)&&(e=i.rest(arguments,1)),i.forEach(e,function(t){o.removeAttr(t),t.match(/^data\-/i)&&o.removeData(i.camelize(t.replace(/^data\-/,"")))}),o};o.set=n,o.remove=r,e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],55:[function(t,e){"use strict";var i=t("lodash"),s=t("../models/photo"),o={},n=function(t,e,s){return t<e.length?e[t]:i.trim(i.pad(t%s||" ",Math.floor(t/s)+1,s+"","right"))},r=function(t,e,s,o){var r=i.isNumber(e)?e:e.length;t?i.isString(t)||(t=t.toString()):t="";var a=r-i.reduce(t.split(""),function(t,e){return t+i.parseInt(e)},0);return a>0?t+=n(a,s,o):0>a&&(t=i(t.split("")).reverse().transform(function(t,e){a?(a+=i.parseInt(e),a>0&&(t.push(a),a=0)):t.push(e)},[]).reverse().value().join("")),t},a=function(t,e,s,o){var n=r(t,e,s,o).split(""),a=0;return i.map(n,function(t){t=i.parseInt(t);var s=i.map(e.slice(a,a+t),function(t){return i.isFunction(t.toJSON)?t.toJSON():t});return a+=t,s})},l=function(t,e){return t&&e?t/e:0},h=function(t,e,i){var s=e?i/e:0;return t*s},d=function(t,e,i){var s=t?i/t:0;return e*s},c=function(t,e){if(!t.length)return 0;var o=i.map(t,function(t){var i,o;return t instanceof s?(i=t.get("width"),o=t.get("height")):(i=t.width,o=t.height),d(i,o,e)});return i.min(o)},u=function(t,e,i){return i||(i=0),(i+e+i)/t-i-i};o.calculateDefault=n,o.fix=r,o.toArray=a,o.aspectRatio=l,o.widthForHeight=h,o.heightForWidth=d,o.rowHeightForWidth=c,o.rowImageWidth=u,e.exports=o},{"../models/photo":50,lodash:"K2RcUv"}],56:[function(t,e){"use strict";var i={ImageLoader:t("prima/utils/image/loader"),ImageLayout:t("./imagelayout")};e.exports=i},{"./imagelayout":55,"prima/utils/image/loader":454}],57:[function(t,e){"use strict";var i=t("lodash"),s=function(t,e){e||(e=t.originalEvent),i.extend(t,i.pick(e,"pageX","pageY"));var s,o,n;return null==t.pageX&&null!=e.clientX&&(s=t.target.ownerDocument||document,o=s.documentElement,n=s.body,t.pageX=e.clientX+(o&&o.scrollLeft||n&&n.scrollLeft||0)-(o&&o.clientLeft||n&&n.clientLeft||0),t.pageY=e.clientY+(o&&o.scrollTop||n&&n.scrollTop||0)-(o&&o.clientTop||n&&n.clientTop||0)),{x:t.pageX,y:t.pageY}};e.exports=s},{lodash:"K2RcUv"}],58:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,r=t("prima/events"),a=t("./photoset"),l=150,h=s(window),d=t("../utils/attrdata"),c=t("../utils/page_coords"),u=0,p=1,m=2,g=a.extend({className:"editable-photoset photoset",defaults:i.extend({x:null,y:null,dragId:null,sourceCell:null,targetCell:null,dragOverCell:null,isLocked:!1,isDragging:!1,dragScrollVelocityY:0,dragScrollUpdateMs:50,dragScrollHeight:100,dragSlide:20,ghostWidth:100,ghostMaxHeight:120},a.prototype.defaults),events:i.defaults({'mousedown [data-js-sortable][draggable="true"]':"_onMouseDownSortable","dragstart .photoset--photo-dragger":"_onDragStart"},a.prototype.events),initialize:function(){a.prototype.initialize.apply(this,arguments),this.__updateCursorPosition=i.throttle(i.bind(function(t){this.set(c(t))},this)),i.forEach(["_onDragStart","_onDragEnter","_onDragOver","_onDragLeave","_onDragEnd","_onDrop"],function(t){var e=this[t]||i.noop;this["_"+t]=i.bind(e,this)},this)},_onMouseDownSortable:function(t){if(this.get("isLocked"))return t.preventDefault(),void t.stopPropagation();if(1===t.which&&!t.ctrlKey){if(this.get("isDragging"))return this._onDragEnd(t);if(this.trigger("photoset:predrag",this),!window.DataTransfer||!i.isFunction(window.DataTransfer.prototype.setDragImage)){var e=s(t.target),o=e.closest(".photoset--photo"),n=this.photoset.photos.get(o.data("photoId")),r=n?n.get("url")||"":"";r&&(e.css({backgroundColor:"#ffffff",backgroundImage:"url("+r+")"}),e.one("mouseout mouseup",i.bind(function(){e.css({backgroundColor:"",backgroundImage:""})},this)))}}},_onDragStart:function(t){if(this.get("isLocked"))return t.preventDefault(),void t.stopPropagation();var e=s(t.target),o=e.closest(".photoset--photo"),n=o.data("photoId"),r=t.originalEvent.dataTransfer;if(r){r.effectAllowed="move",r.dropEffect="move";var a=this.$('[data-ghost-id="'+n+'"]');!i.isEmpty(a)&&i.isFunction(r.setDragImage)&&r.setDragImage(a.get(0),.5*a.outerWidth(),.5*a.outerHeight());try{var l=this.photoset.photos.get(n),d=l?l.get("url")||"":"";r.setData("text/uri-list",d),r.setData("text/plain",d)}catch(t){}}var c=o.closest(this.$$cacheKeys.cell),u=c.closest(this.$$cacheKeys.row);this.set({sourceCell:null,targetCell:null,dragOverCell:null,dragId:n}),this.listenTo(this,"change:targetCell",this._onChangeTargetCell),this.$el.on("dragover .photoset--cell",this.__onDragOver),this.$el.on("dragend",this.__onDragEnd),this.$el.on("drop .photoset--cell",this.__onDrop),h.on("dragover",this.__updateCursorPosition),this.startDragScroll(),i.defer(i.bind(function(){var t=this.$$cacheKeys.cell;this.set("isDragging",!0),c.addClass("photoset--placeholder-cell photoset--source-cell"),u.addClass("photoset--source-row"),i.isEmpty(c.siblings(t))&&c.closest(this.$$cacheKeys.row).addClass("photoset--placeholder-row"),e.css({backgroundColor:"",backgroundImage:""}),this.createPlaceholders(),this.set({sourceCell:c.data("placeholderCell"),targetCell:c.data("placeholderCell"),dragOverCell:c.data("dragOverCell")}),this.listenTo(this,"change:dragOverCell change:x change:y",this._onChangeDragTarget)},this))},_onDragOver:function(t){t.preventDefault(),t.stopPropagation(),this.__updateCursorPosition(t);var e=s(t.target),i=e.closest(this.$$cacheKeys.cell);this.set("dragOverCell",i.data("dragOverCell"))},_onDragEnd:function(t){t.preventDefault(),t.stopPropagation(),this.stopListening(this,"change:targetCell",this._onChangeTargetCell),this.stopListening(this,"change:dragOverCell change:x change:y",this._onChangeDragTarget);var e=this.get("dragId");if(null!=e){var s=this.placePhotoInCell(e,this.get("targetCell"));this.set({sourceCell:null,targetCell:null,dragId:null}),s.removeClass("photoset--placeholder-cell"),s.closest(this.$$cacheKeys.row).removeClass("photoset--placeholder-row")}this.removePlaceholders(),this.set("isDragging",!1);var o=this.determineLayout();this.photoset.photos.setIdOrder(o.order),this.photoset.set("layout",o.layout),this.set("isLocked",!0),this.resize().then(i.bind(function(){this.removeTemporary(),this.set("isLocked",!1)},this)),this._ensurePhotoInViewport(e),this.$el.off("dragover .photoset--cell",this.__onDragOver),this.$el.off("dragend",this.__onDragEnd),this.$el.off("drop .photoset--cell",this.__onDrop),h.off("dragover",this.__updateCursorPosition),this.stopDragScroll()},_onDrop:function(t){t.preventDefault(),t.stopPropagation()},_onChangeIsDragging:function(t,e){this.$el.toggleClass("photoset--drag-to-sort",e)},_onChangeIsLocked:function(t,e){this.$el.toggleClass("photoset--locked",e),e||this.$(".photoset--cropped-cell").removeClass("photoset--cropped-cell")},_onUpdate:function(){this.teardown().render(),this.photoset.photos.length>1&&this._ensurePhotoInViewport(this.photoset.photos.last().get("id"))},startDragScroll:function(){this.set({dragScrollTop:this.get("dragScrollHeight"),dragScrollBottom:h.height()-this.get("dragScrollHeight")}),this.listenTo(this,"change:y",this._onChangeDragY)},stopDragScroll:function(){clearInterval(this.dragScrollInterval),delete this.dragScrollInterval,this.stopListening(this,"change:y",this._onChangeDragY)},_onChangeDragY:function(t,e){var s=0,o=e-h.scrollTop();s=o<this.get("dragScrollTop")?Math.ceil(100*(o-this.get("dragScrollTop"))/this.get("dragScrollHeight")):o>this.get("dragScrollBottom")?Math.ceil(100*(o-this.get("dragScrollBottom"))/this.get("dragScrollHeight")):0,this.set("dragScrollVelocityY",s),s?this.dragScrollInterval||(this.dragScrollInterval=setInterval(i.bind(function(){var t=this.get("dragScrollVelocityY");t&&r.trigger("Photoset:dragScroll",t)},this),this.get("dragScrollUpdateMs"))):this.dragScrollInterval&&(clearInterval(this.dragScrollInterval),delete this.dragScrollInterval)},_ensurePhotoInViewport:function(t,e){i.isNumber(e)||(e=l);var s=this._layoutCache||this._updateLayoutCache(),o=this.$el.offset().top||0,n=i.find(s.rows,function(e){return i.find(e.cells,{photo:t})?!0:void(o+=e.height)});n&&r.trigger("Photoset:scrollToRow",o,n.height,e)},createPhotoSubView:function(){var t=a.prototype.createPhotoSubView.apply(this,arguments);return this.options.post&&(t.post=this.options.post),this.listenTo(t,"photoset:hover",function(){var e=i.toArray(arguments);e.unshift("photoset:unhover"),i(this.subViews).omit(t.photo.get("id")).invoke(function(){this.trigger.apply(this,e)})}),t},createPlaceholders:function(){var t=this.photoset.maxPerRow,e=".photoset--placeholder-row",o=".photoset--placeholder-cell",n=".photoset--source-row",r=".photoset--source-cell",a=this.$$cacheKeys.cell,l='<div class="photoset--row photoset--placeholder-row"></div>',h='<div class="photoset--cell photoset--placeholder-cell"></div>';this._createPlaceholders(this.js$("layout"),this.$$rows(),l,e),i.forEach(this.$$rows(!0),function(e){var i=s(e),r=i.children(this.$$cacheKeys.cell);(r.length<t||i.is(n))&&this._createPlaceholders(i,r,h,o)},this),i.forEach(this.$$cells(!0).filter(o),function(t,e){d.set(t,"data-placeholder-cell",e)},this);var c=this.determineLayout(),u=this.get("padding"),p=0;i.forEach(this.$$rows(!0),function(t){var l=s(t),h=l.index(),m=this.get("width"),g=h<=c.topRow||h>c.bottomRow?0:u,f=h>=c.bottomRow||h<c.topRow?0:u,_=l.height()||0;l.height(_);var v=l.children(a),b=l.prev(e).not(n).find(a),y=l.next(e).not(n).find(a),w=b.data("placeholderCell"),x=y.data("placeholderCell");i.forEach(v,function(t){var i=s(t);i.is(o)&&!i.is(r)&&i.css({paddingTop:g,paddingBottom:f,width:l.is(e)?m:0,height:_}),i.data("targetCells",{top:w,left:i.prev(o).data("placeholderCell"),center:i.data("placeholderCell"),right:i.next(o).data("placeholderCell"),bottom:x}),d.set(i,"data-drag-over-cell",p++)},!0)},this)},_createPlaceholders:function(t,e,o,n){e.first().is(n)||t.prepend(o),i.forEach(e.not(n),function(t){var e=s(t);i.isEmpty(e.next(n))&&e.after(o)},this)},removePlaceholders:function(){this.$$rows(!0).removeClass("photoset--source-row"),this.$$cells(!0).removeClass("photoset--source-cell").removeData("targetCells"),this.$$rows().filter(".photoset--placeholder-row").remove(),this.$$cells().filter(".photoset--placeholder-cell").remove(),this.renumberRowsAndCells(),d.remove(this.$$cells(),"data-drag-over-cell","data-placeholder-cell")},removeTemporary:function(){this.$(".photoset--temporary").remove(),this.$$rows(!0),this.$$cells(!0),this.renumberRowsAndCells()},resize:function(t){i.isNumber(t)||(t=l);var e=i.map(this.$$rows(),function(e,i){return this.resizeRow(e,t,i)},this);return this._updateLayoutCache(),o.all(e)},_calculateCellSize:function(t){var e=s(t),o=e.find(".photoset--photo [data-js-imageCrop]"),n={width:0,height:0,$content:o,$el:e},r=this.photoset.photos.get(e.data("photoId"));return r&&i.extend(n,{isCurrentCell:!0,width:r.get("width"),height:r.get("height")}),n},resizeRow:function(t,e,r){i.isNumber(e)||(e=l);var a=t instanceof s?t:s(t),h=this.determineLayout();i.isNumber(r)||(r=a.index());var d=this.get("width"),c=this.get("padding"),u=r<=h.topRow||r>h.bottomRow?0:c,p=r>=h.bottomRow||r<h.topRow?0:c,m=this.$$cacheKeys.cell,g=i.map(a.children(m),this._calculateCellSize,this),f=[],_=0;i.forEach(g,function(t,e){t.index=e,t.isCurrentCell&&(t.position=_++,t.id=f.length,f.push(t))});var v=this.rowSize(f,d),b=v.height,y=b?b+u+p:0,w=i.map(g,function(t){var s={width:t.width,height:b,paddingTop:u,paddingRight:0,paddingBottom:p,paddingLeft:0};null!=t.id&&(s.width=v.photos[t.id].width),null!=t.position&&(s.paddingRight=t.position<_-1?c:0,s.paddingLeft=t.position>0?c:0),i.isEmpty(t.$content)||(n(t.$content,"stop"),n(t.$content,{opacity:1,width:s.width,height:s.height,translateX:0,translateY:0},{duration:e}));var o=this.subViews[t.$el.data("photoId")];return o&&o.set({displayWidth:s.width,displayHeight:s.height}),n(t.$el,"stop"),n(t.$el,i.defaults({width:s.width+s.paddingLeft+s.paddingRight,height:s.height+s.paddingTop+s.paddingBottom},s),{duration:e})},this);n(a,"stop"),w.push(n(a,{height:y},{duration:e})),this.get("isDragging")&&(this._rowHeightCache[a.data("photosetRow")]=y);var x=o.all(w);return x},determineLayout:function(t){if(t&&this._determineLayout)return this._determineLayout;var e="",o=[],n=-1,r=-1,a=this.$$cacheKeys.cell;return i.forEach(this.$$rows(),function(t,l){var h=0;i.forEach(s(t).children(a),function(t){var e=s(t).data("photoId");(e||0===e)&&(o.push(e),h++)},this),h&&(e+=h,0>n&&(n=l),r=l)},this),this._determineLayout={topRow:n,bottomRow:r,order:o,layout:e},this._determineLayout},_onChangeTargetCell:function(t,e){if(null!=e){var o=this.$$cells().filter('[data-placeholder-cell="'+e+'"]'),r=o.closest(this.$$cacheKeys.row),a=o.data("dragOverCell"),h=u;h=o.is(".photoset--source-cell")?u:r.is(".photoset--placeholder-row")?p:m,i.forEach(this.$$cells(),function(t){var e=s(t),o=e.find(".photoset--image-crop");if(!i.isEmpty(o)){var d={translateX:0,translateY:0};switch(h){case p:i.isEmpty(r.find(e))&&(e.data("dragOverCell")<a?d.translateY=-this.get("dragSlide"):e.data("dragOverCell")>a&&(d.translateY=this.get("dragSlide")));break;case m:i.isEmpty(r.find(e))||(e.data("dragOverCell")<a?d.translateX=-this.get("dragSlide"):e.data("dragOverCell")>a&&(d.translateX=this.get("dragSlide")))}n(o,"stop"),n(o,d,l)}},this)}else i.forEach(this.$$cells(),function(t){var e=s(t).find(".photoset--image-crop");i.isEmpty(e)||(n(e,"stop"),n(e,{translateX:0,translateY:0},l))},this)},_onChangeDragTarget:function(){var t=this.get("dragOverCell");if(null!=t){var e=this.$$cells().filter('[data-drag-over-cell="'+t+'"]'),i=e.offset(),s=e.width(),o=e.height(),n=this.get("x")-(i.left+.5*s),r=this.get("y")-(i.top+.5*o),a=e.data("targetCells");null!=a.top&&-o/3>r?this.set("targetCell",a.top):null!=a.bottom&&r>o/3?this.set("targetCell",a.bottom):null!=a.center?null!=a.left&&-s/3>n?this.set("targetCell",a.left):null!=a.right&&n>s/3?this.set("targetCell",a.right):this.set("targetCell",a.center):null!=a.left&&0>n?this.set("targetCell",a.left):null!=a.right&&n>0&&this.set("targetCell",a.right)}},placePhotoInCell:function(t,e){var i=this.subViews[t],s=i.$el.closest(this.$$cacheKeys.cell),o=s.closest(this.$$cacheKeys.row),n=this.$$cells().filter('[data-placeholder-cell="'+e+'"]');return d.set(n,"data-photo-id",t),n.is(s)||(s.removeClass("photoset--placeholder-cell").addClass("photoset--temporary"),d.remove(s,"data-photo-id"),o.is(".photoset--placeholder-row")&&o.removeClass("photoset--placeholder-row").addClass("photoset--temporary"),i.js$("imageCrop").css({opacity:0,width:n.width(),height:n.height()}),i.$el.detach(),n.append(i.$el),n.addClass("photoset--cropped-cell")),n},beforeRender:function(){this.listenTo(this,"update",this._onUpdate),this.listenTo(this,"change:isDragging",this._onChangeIsDragging),this.listenTo(this,"change:isLocked",this._onChangeIsLocked)},afterRender:function(){this.renderSubViews(),this.$el.prepend('<div data-js-ghosts class="photoset--ghosts"></div>'),i.forEach(this.subViews,function(t,e){var i=t.thumbnailDimensions(this.get("ghostWidth"),this.get("ghostMaxHeight"));i["background-image"]="url("+t.photo.get("url")+")";var o=s('<div data-js-ghost class="photoset--ghost"></div>').css(i);d.set(o,"data-ghost-id",e),this.js$("ghosts").append(o)},this),this.js$("ghosts").append('<div class="photoset--ghost-cover"></div>').css({width:this.get("ghostWidth"),height:this.get("ghostMaxHeight")})}});e.exports=g},{"../utils/attrdata":54,"../utils/page_coords":57,"./photoset":60,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"velocity-animate":"lWl/mc",when:"RG2dij"}],59:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("prima/view"),r=150,a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("prima/mixins/accessor"),d=t("../models/photo"),c=t("../templates/photo.tpl"),u=n.extend({className:"photoset--photo",template:c,mixins:[a,l,h],defaults:{scaledWidth:null,scaledHeight:null,displayWidth:null,displayHeight:null},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.photo=t.photo||new d,this.photos=t.photos,this.photoset=t.photoset,this.$el.attr("data-photo-id",this.photo.get("id")),this.listenTo(this.photo,"change:id",function(t,e){this.$el.attr("data-photo-id",e)})},thumbnailDimensions:function(t,e){var i=this.photo.getHeightForWidth(100);return e&&i>e&&(i=e,t=this.photo.getWidthForHeight(100)),{width:Math.ceil(t),height:Math.ceil(i)}},resize:function(t){t||(t=r);var e=this.get("displayWidth")||0,i=this.get("displayHeight")||0,n=this.get("scaledWidth")||0,a=this.get("scaledHeight")||0;return o(this.js$("crop"),"stop"),o(this.js$("positioner"),"stop"),o(this.js$("image"),"stop"),s.join(o(this.js$("crop"),{width:e,height:i},{duration:t}),o(this.js$("positioner"),{width:Math.max(0,n-e),height:Math.max(0,a-i)},{duration:t}),o(this.js$("image"),{width:n,height:a},{duration:t}))},serialize:function(){return i.defaults(this.toJSON(),this.photo.toJSON())},beforeTeardown:function(){return this.stopListening(),this},render:function(){var t=this.serialize();return this.$el.html(this.template(t)),this.attachSubViews(),this}});e.exports=u},{"../models/photo":50,"../templates/photo.tpl":52,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460,"velocity-animate":"lWl/mc",when:"RG2dij"}],60:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("../utils/imagelayout"),r=(t("prima/lib/logger"),t("prima/mixins/subviewable")),a=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=t("../models/photo"),d=t("../models/photoset"),c=t("../templates/photoset.tpl"),u=t("./photo"),p=t("../utils/attrdata"),m=function(t,e,s){i.isNumber(s)||(s=0);var o=0,r=t.length,a=e-2*s*(r-1),l=a/r,d=i.map(t,function(t,e){t instanceof h&&(t=t.toJSON());var i=e%2?Math.ceil(l):Math.floor(l);e>=r-1&&(i=a),a-=i;var s=Math.round(n.heightForWidth(t.width,t.height,i));return(!o||s&&o>s)&&(o=s),{width:i,height:s}});return{width:e,height:o,photos:d}},g=o.extend({className:"photoset",template:c,mixins:[r,a,l],defaults:{dynamic:!1,smallImageWidth:300,smallImageMarginBreakpoint:500,width:500,height:0,padding:5},$$cacheKeys:{row:".photoset--row",cell:".photoset--cell"},$$rows:function(t){return this.$$(this.$$cacheKeys.row,t)},$$cells:function(t){return this.$$(this.$$cacheKeys.cell,t)},initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this._PhotoView=t.PhotoView||u,this.photoset=t.photoset||new d},_updateRowCache:function(){return this._rowCache=i.map(this.photoset.getRows(),function(t){return i.pluck(t,"id")}),this._rowCache},_updateLayoutCache:function(){var t=this._updateRowCache(),e=this._layoutCache={rows:[],photos:{}},s=this.get("padding"),o=this.get("width"),n=0;return i.forEach(t,function(r,a){var l=this.photoset.photos.getSubset(r),h=a>0?s:0,d=a<t.length-1?s:0,c=this.rowSize(l,o,s),u=c.height+h+d;e.rows[a]={unpaddedHeight:c.height,paddingTop:h,paddingBottom:d,height:u,cells:[]},n+=u,i.forEach(l,function(t,i){var o=i<l.length-1?s:0,n=i>0?s:0,r=c.photos[i],h=t.get("id");e.photos[h]={scaledWidth:r.width,scaledHeight:r.height,displayWidth:r.width,displayHeight:c.height},e.rows[a].cells[i]={photo:h,unpaddedWidth:r.width,paddingLeft:n,paddingRight:o,width:r.width+n+o,height:u}},this)},this),e.width=o,e.height=n,this.set("height",n),e},rowSize:function(t,e,s){return t||(t=this.photoset.photos),i.isNumber(e)||(e=this.get("width")),i.isNumber(s)||(s=this.get("padding")),m(t,e,s)},createRowElement:function(){return s('<div class="photoset--row"></div>')},createCellElement:function(t){var e=s('<div class="photoset--cell"></div>');return null!=t&&p.set(e,"data-photo-id",t),e},createPhotoSubView:function(t){var e=new this._PhotoView({photoset:this.photoset,photos:this.photoset.photos,photo:t});return t.get("id")&&(this.subViews[t.get("id")]=e),e},createSubViews:function(){this.photoset.photos.forEach(this.createPhotoSubView,this)},createSinglePhotoLayout:function(){this._layoutCache||this._updateLayoutCache();var t=this.photoset.photos.at(0),e=t.get("width"),i=t.get("height");e>=this.get("smallImageWidth")&&(i=Math.round(n.heightForWidth(e,i,this.get("width"))),e=this.get("width"));var s=t.get("id"),o=this.subViews[s];o.set({scaledWidth:e,scaledHeight:i,displayWidth:e,displayHeight:i});var r=this.js$("layout"),a=this.createRowElement().height(i),l=this.createCellElement(s);l.css({width:e,height:i,padding:0}).addClass("photoset--single-cell"),this.get("smallImageMarginBreakpoint")&&e<this.get("smallImageMarginBreakpoint")&&l.addClass("photoset--single-cell-margin"),l.append(o.$el),a.append(l),r.append(a),this.renumberRowsAndCells()},createPhotosetLayout:function(){var t=this._layoutCache||this._updateLayoutCache();i.forEach(t.rows,function(e){var s=this.createRowElement();s.height(e.height),i.forEach(e.cells,function(o){var n=o.photo,r=t.photos[n],a=this.subViews[n];a.set(r);var l=this.createCellElement(n);l.css({width:o.width,height:o.height,padding:i.map([e.paddingTop,o.paddingRight,e.paddingBottom,o.paddingLeft],function(t){return t?t+"px":0}).join(" ")}),l.append(a.$el),s.append(l)},this),this.js$("layout").append(s)},this),this.renumberRowsAndCells()},renumberRowsAndCells:function(){i.forEach(this.$$rows(!0),function(t,e){p.set(t,"data-photoset-row",e)},this),i.forEach(this.$$cells(!0),function(t,e){p.set(t,"data-photoset-position",e)},this)},serialize:function(){return i.extend(this.toJSON(),{_rowSize:i.bind(this.rowSize,this),photoTemplate:u.prototype.template,photoset:this.photoset.toJSON()})
},afterTeardown:function(){return this.stopListening(),delete this._rowCache,delete this._layoutCache,this.teardownSubViews()},render:function(){return this.get("dynamic")?(this.$el.html('<div class="photoset--layout" data-js-layout></div>'),this.createSubViews(),1===this.photoset.photos.length?this.createSinglePhotoLayout():this.createPhotosetLayout()):this.$el.html(this.template(this.serialize())),this}});e.exports=g},{"../models/photo":50,"../models/photoset":51,"../templates/photoset.tpl":53,"../utils/attrdata":54,"../utils/imagelayout":55,"./photo":59,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/logger":403,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],61:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./templates/embed-code.tpl"),n=t("prima/lib/data"),r=s.extend({name:"PostEmbedCodeGenerator",defaults:{embed_host:"//embed.tumblr.com",assets_host:"//assets.tumblr.com",tumblelog_mention_key:"",post_id:"",post_url:"",embed_key:"",embed_did:""},initialize:function(t){this.options=i.extend({},this.defaults,t);var e=n.get("Context/hosts");e&&(e.embed_host&&(this.options.embed_host=e.embed_host),e.assets_host&&(this.options.assets_host=e.assets_host)),this.template=o},getCode:function(){return this.template(this.options)}});e.exports=r},{"./templates/embed-code.tpl":62,lodash:"K2RcUv","prima/component":395,"prima/lib/data":398}],62:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",__p+="undefined"!=typeof language&&"undefined"!=typeof width?'<div class="tumblr-post" data-href="'+(null==(__t=embed_host)?"":_.escape(__t))+"/embed/post/"+(null==(__t=embed_key)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'" data-did="'+(null==(__t=embed_did)?"":_.escape(__t))+'" data-language="'+(null==(__t=language)?"":_.escape(__t))+'" data-width="'+(null==(__t=width)?"":_.escape(__t))+'"><a href="'+(null==(__t=post_url)?"":_.escape(__t))+'">'+(null==(__t=post_url)?"":_.escape(__t))+"</a></div>":"undefined"!=typeof language?'<div class="tumblr-post" data-href="'+(null==(__t=embed_host)?"":_.escape(__t))+"/embed/post/"+(null==(__t=embed_key)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'" data-did="'+(null==(__t=embed_did)?"":_.escape(__t))+'" data-language="'+(null==(__t=language)?"":_.escape(__t))+'"><a href="'+(null==(__t=post_url)?"":_.escape(__t))+'">'+(null==(__t=post_url)?"":_.escape(__t))+"</a></div>":"undefined"!=typeof width?'<div class="tumblr-post" data-href="'+(null==(__t=embed_host)?"":_.escape(__t))+"/embed/post/"+(null==(__t=embed_key)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'" data-did="'+(null==(__t=embed_did)?"":_.escape(__t))+'" data-width="'+(null==(__t=width)?"":_.escape(__t))+'"><a href="'+(null==(__t=post_url)?"":_.escape(__t))+'">'+(null==(__t=post_url)?"":_.escape(__t))+"</a></div>":'<div class="tumblr-post" data-href="'+(null==(__t=embed_host)?"":_.escape(__t))+"/embed/post/"+(null==(__t=embed_key)?"":_.escape(__t))+"/"+(null==(__t=post_id)?"":_.escape(__t))+'" data-did="'+(null==(__t=embed_did)?"":_.escape(__t))+'"><a href="'+(null==(__t=post_url)?"":_.escape(__t))+'">'+(null==(__t=post_url)?"":_.escape(__t))+"</a></div>",__p+='<script async src="'+(null==(__t=assets_host)?"":_.escape(__t))+'/post.js"></script>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],63:[function(t,e){"use strict";var i=(t("prima/utils/exposer"),t("prima/utils/haspath"),t("lodash")),s=t("jquery"),o=t("when"),n=t("prima/utils/sequence-with-context"),r=t("prima/mixins/promisifyevents"),a=t("prima/component"),l=t("prima/events"),h=t("prima/lib/domeventor"),d=(t("prima/lib/logger"),t("backbone")),c=(t("./utils/transition_speed"),t("./utils/scroll_helper")),u=t("./utils/save_hook"),p=t("./utils/post_form_container_type"),m="/dashboard",g=t("prima/lib/translate"),f=s("body"),_=t("app/components/post-form"),v=t("app/components/dialog"),b=t("app/lib/currentuser"),y=t("app/components/post-form/models/post"),w=t("app/components/post-form/services/embed_data"),x=t("./views/glass"),k=t("./views/modal"),C=t("./views/container"),S=t("./views/post_buttons"),T=a.extend({name:"PostFormBuilder",initialize:function(){var t=this.getOwnData();this.user=b(),this.user&&(this.baseRoute=t.baseRoute,this.currentChannel=t.currentChannel,this.fullWidthPosts=t.fullWidthPosts||!1,this.redirectTo=t.redirectTo||!1,this.reblogActionContext=t.reblogActionContext||!1,this._addGlobalEventListeners(),this.user.channels.reset(t.channels),this.user.set(t.limits),this.user.set(t.dashboardSettings),this.user.set("language",t.language||"en_US"),w.setEmbedRegexes(t.embedRegexes),this.glass=new x,this.modal=new k,this.modalContainer=new C({className:"post-form-modal-content",animateHeightWithContent:!0}),this.modal.setContentSubView(this.modalContainer),this.postButtons=new S({el:"#new_post"}),this.postButtonsContainer=new C({el:this.postButtons.$el.parent(),originalContent:this.postButtons,transitionBackground:!0,animateHeightWithContent:!0,useLoader:!1}),this.scrollHelper=new c,this.saveHook=new u(i.extend({$postButtonsContainer:this.postButtonsContainer.$el,$latestPostEl:this.postButtonsContainer.$el.next()},t)),this.legacyEvents(),this._updateData=i.once(this.updateData),this.render())},updateData:function(){var t=s.ajax({url:"/svc/post/get_post_form_builder_data",type:"POST",with_form_key:!0,data:{}});return t.then(i.bind(function(t){var e=t.response;return i.forEach(e.channels,function(t){var e=t.name?this.user.getChannel(t.name):!1;e&&e.set(i.omit(t,"name"))},this),this.user.set(e.limits),e},this))},legacyEvents:function(){var t={"postForms:closed":["post:form:hide","keycommands:resume"],"postForms:saved":["post:form:success"],"postForms:opened":["post:form:show","keycommands:suspend"]};i.forEach(t,function(t,e){this.listenTo(l,e,function(){var e=i.toArray(arguments);i.each(t,function(t){l.trigger.apply(l,[].concat(t,e))})})},this)},_addGlobalEventListeners:function(){this.listenTo(l,"postForms:open",this.createPostForm),this.listenTo(l,"postForms:new",this._createPostFormNew),this.listenTo(l,"postForms:edit",this._createPostFormEdit),this.listenTo(l,"postForms:reblog",this._createPostFormReblog),this.listenTo(l,"postForms:saved",this.destroyPostForm),this._registerDismissListener(),this.listenTo(l,"postForms:dismissListener:suspend",function(){this._toggleDismissListener(!1)}),this.listenTo(l,"postForms:dismissListener:resume",function(){this._toggleDismissListener(!0)})},_toggleDismissListener:function(t){this.stopListening(l,"postForms:close"),t&&this._registerDismissListener()},_registerDismissListener:function(){this.listenTo(l,"postForms:close",this.dismissPostForm)},createInlineContainer:function(t){return t?new C({el:t.parent(),originalContent:t,transitionBackground:!0}):!1},_createPostFormNew:function(t){return this.createPostForm(t)},_createPostFormEdit:function(t){return t.postEl&&(t.containerView=this.createInlineContainer(t.postEl),t.postFormType=p.inline),this.createPostForm(t)},_createPostFormReblog:function(t){return this.createPostForm(t)},createPostForm:function(t){if(this.postForm)return this.destroyPostForm(t).then(i.bind(function(){return this.createPostForm(t)},this));t=i.extend({updateURL:!0,glass:!0,postFormType:p.modal},t),i.defaults(t,{containerView:t.postFormType===p.inline?this.postButtonsContainer:null}),t.post||(t.post=this._createPostModel(t)),t.url||(t.url=this._postFormUrl(t.post)),t.containerView===this.postButtonsContainer&&this.postButtons.setPostType(t.post.get("type")),this._updateData();var e=t.postFormType===p.modal,r=this.postForm=new _({fullWidthPosts:this.fullWidthPosts,isModal:e,popoverContainer:e?this.modal.$el:f,post:t.post,redirectTo:this.redirectTo,reblogActionContext:this.reblogActionContext}),a=this.postFormContainer=t.containerView||this.modalContainer;if(!a)throw new Error("No post form container!");this.listenTo(r,"pauseScrollHelper",this.pauseScrollHelper),this.listenTo(r,"resumeScrollHelper",this.resumeScrollHelper),a.isRendered()||a.render(),a.setPostFormComponent(r);var c=i.once(i.bind(function(){return t.glass?this.glass.show():o.resolve()},this)),u=n([function(){return l.trigger("Header:hide"),o.join(a.prepare(c),r.whenRendered(!0))},function(){return r.disable(),a.attach(c)},function(){return t.updateURL&&d.history.navigate(t.url,{replace:!0}),function(){var t=h.rect(),o=t.windowScrollTop,n=t.windowHeight,d=r.getRect(),c=d.offsetHeight,u=a.$el.offset().top,p=u+c,m=20,g=s("[prima-component=header]").height()||0,f=n>c+2*m,_=this.scrollHelper.calculateScrollTop(u-m,p+m+g,n,f),v=400,b=e?this.modal.$el:void 0;a===this.postButtonsContainer&&_>o&&n>c&&(_=o),this.previousScrollPosition=e?!1:o,this.scrollHelper.scrollToPosition(_,v,b),this.listenTo(l,"Photoset:dragScroll",function(t,e){i.isNumber(e)||(e=50);var s=h.rect().windowScrollTop+t;this.scrollHelper.scrollToPosition(s,e,b)}),this.listenTo(l,"Photoset:scrollToRow",function(t,e,s){i.isNumber(s)||(s=50),t+=0,this.scrollHelper.checkScrollBounds(!1,{keepInside:!0,contentPadding:70,contentRect:{offsetTop:t,offsetHeight:e}})})}.call(this),a.showPostForm(c)},function(){return c()},function(){r.enable()}],this).then(function(){return l.trigger("postForms:opened"),r});return t.postFormType===p.inline&&u.then(i.bind(function(){this.scrollHelper.start({el:a.$el})},this)),u.catch(function(t){t instanceof Error&&i.defer(function(){throw t})}),u},_postFormStateChanged:function(){if(this.postForm){var t=this.postForm.initialPostState,e=this.postForm.post;return e.deepHasChanged(t)}return!1},dismissPostForm:function(){(!this.postForm||this.postForm.isEnabled())&&(this._postFormStateChanged()?this._buildDismissPrompt():this.destroyPostForm())},_buildDismissPrompt:function(){var t=g("Discard this post?");this.postForm&&this.postForm.post&&"edit"===this.postForm.post.get("mode")&&(t=g("Discard edits to this post?"));var e={text:t,text_ok:g("Discard"),text_cancel:g("Nevermind"),keycommand_maintain:!0};v.confirm(e,i.bind(function(){this.destroyPostForm(),l.trigger("postForms:dismissListener:resume")},this),function(){i.defer(function(){l.trigger("postForms:dismissListener:resume")})}),l.trigger("postForms:dismissListener:suspend")},destroyPostForm:function(t,e){t=i.extend({updateURL:!0,url:this.baseRoute,glass:!0},t),this.scrollHelper.stop();var s=this.postForm,r=this.postFormContainer;this.postForm=null,this.postFormContainer=null,this.stopListening(s),this.stopListening(l,"Photoset:dragScroll");var a=i.once(i.bind(function(){return t.glass?this.glass.hide():o.resolve()},this)),h=s&&!!s.postForm.get("saved"),c=n([function(){h&&this.saveHook.preExecute(e)},function(){s&&s.disable()},function(){return function(){if(this.previousScrollPosition!==!1){var t=this.previousScrollPosition,e=400;this.scrollHelper.scrollToPosition(t,e)}}.call(this),r?r.hidePostForm(a).then(function(){r.teardown()}):void 0},function(){if(s&&s.remove(),t.updateURL){var e=d.history.root||"",i=t.url?t.url.replace(new RegExp("^"+e),""):"";d.history.navigate(i,{replace:!0})}},function(){return a()},function(){h&&e&&(this.saveHook.$inlinePostEl=r.$el,this.saveHook.execute(e))}],this).then(function(){return l.trigger("postForms:closed"),l.trigger("Header:show"),s});return c.catch(function(t){t instanceof Error&&i.defer(function(){throw t})}),c},pauseScrollHelper:function(){this.scrollHelper&&this.scrollHelper.pause()},resumeScrollHelper:function(){this.scrollHelper&&this.scrollHelper.resume()},_createPostModel:function(t){return"string"==typeof t&&(t={postType:t}),new y(t.reblogId?{lookupData:{reblog_id:t.reblogId,reblog_key:t.reblogKey},tumblelog:this.currentChannel,mode:"reblog",editorType:this.user.get("defaultEditorType"),pt:t.pt,contextData:{baseRoute:this.baseRoute},reblogSource:t.reblogSource,loggingData:t.loggingData}:t.editId?{lookupData:{post_id:t.editId,channel_id:t.channelId||this.currentChannel},tumblelog:t.channelId||this.currentChannel,editorType:this.user.get("defaultEditorType"),contextData:{baseRoute:this.baseRoute},mode:"edit",loggingData:t.loggingData}:{type:t.postType||t.type||"text",tumblelog:this.currentChannel,editorType:this.user.get("defaultEditorType"),contextData:{baseRoute:this.baseRoute},mode:"new",loggingData:t.loggingData})},_postFormUrl:function(t){if(t){if(t.has("lookupData")){var e=t.get("lookupData");return e.reblog_id?this._reblogPostUrl(e.reblog_id,e.reblog_key):e.post_id?this._editPostUrl(e.post_id):this._newPostUrl(t.get("type"))}return t.has("reblog_id")?this._reblogPostUrl(t.get("reblog_id"),t.get("reblog_key")):t.has("id")?this._editPostUrl(t.get("id")):this._newPostUrl(t.get("type"))}return this._newPostUrl("text")},_newPostUrl:function(t){var e=this.baseRoute!==m?this.baseRoute:"";return e+"/new/"+t},_editPostUrl:function(t){return"/edit/"+t},_reblogPostUrl:function(t,e){return"/reblog/"+t+"/"+e},render:function(){return this.glass.render().$el.appendTo("body"),this.modal.render().$el.appendTo("body"),this},updateBaseRoute:function(t){var e;t?this.baseRoute=t:(e=d&&d.history?d.history.location.pathname:m,this.baseRoute=e)}},{containerType:function(t){return p[t]}});r.applyTo(T.prototype),e.exports=T},{"./utils/post_form_container_type":68,"./utils/save_hook":69,"./utils/scroll_helper":70,"./utils/transition_speed":71,"./views/container":72,"./views/container_content":73,"./views/glass":74,"./views/modal":76,"./views/post_buttons":77,"app/components/dialog":20,"app/components/post-form":79,"app/components/post-form/models/post":87,"app/components/post-form/services/embed_data":94,"app/lib/currentuser":275,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396,"prima/lib/domeventor":400,"prima/lib/logger":403,"prima/lib/translate":423,"prima/mixins/promisifyevents":433,"prima/utils/exposer":449,"prima/utils/haspath":451,"prima/utils/sequence-with-context":457,when:"RG2dij"}],64:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({endpoint:"/svc/post/%s/%s/%s",parse:function(t){return{dashboardHTML:t.trim()}},sync:function(t,e,o){if("read"!==t)throw new Error("The DashboardPostFetch model may only READ from server!");if(o=i.defaults(o||{},{pageRoot:!1,direction:!1,refPostID:!1}),!1===(o.pageRoot&&o.direction))throw new Error(i.sprintf("These two fetch params must be passed: pageRoot [%s], direction [%s]",o.pageRoot,o.direction));return i.defaults(o,{dataType:"html",emulateHTTP:!0,url:i.sprintf(this.endpoint,o.pageRoot,o.direction,o.refPostID)}),s.prototype.sync.call(this,t,e,o)}});e.exports=o},{lodash:"K2RcUv","prima/model":439}],65:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+="",transitionBackground&&(__p+='<div class="post-transition-background"></div>'),__p+="",originalContent&&(__p+='<div data-subview="originalContent"></div>'),__p+='<div data-subview="loader"></div><div data-subview="postForm"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],66:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="Knight-Rider-loader ',loading&&(__p+="animate"),__p+='"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],67:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="v-center-outer"><div class="v-center-inner"><div class="v-center-content"><div data-subview="content"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],68:[function(t,e){"use strict";var i={modal:1,inline:2};e.exports=i},{}],69:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/events"),n=t("../models/dashboard_post_fetch"),r=function(){var t=["dashboard","drafts","inbox"],e={preExecute:function(){return"queue"===this.contextData.contextPage?(s(window).off("beforeunload"),void window.location.replace(this.contextData.baseRoute)):void 0},execute:function(e){if(this.saveResponse=e.responseJSON,-1!==t.indexOf(this.contextData.contextPage)){var o=!this.saveResponse.post.is_edit&&!this.saveResponse.post.is_reblog,n="post_dashboard_html"in this.saveResponse,r=!(!this.saveResponse.post||!this.saveResponse.post.is_edit)&&this.contextData.contextPage!==this.saveResponse.post_context_page&&this.$inlinePostEl.hasClass("post_container");o?this._fetchMorePosts():n&&(r?this._removeInline():this._updateInline()),this._displayNotification(this.saveResponse),this.saveResponse.context_tumblelog&&i.each(this.saveResponse.context_tumblelog.counts,function(t,e){var i=s("#dashboard_controls_open_blog .dashboard_"+e);i.find(".count").text(t);var o=(i.attr("class")||"").match(/(?:\s|^)count_\d+/gi);o&&i.removeClass(o.join("")),i.addClass("count_"+t)})}},_fetchMorePosts:function(){var t=this.contextData.baseRoute.replace(/^\/|\/$/g,""),e="drafts"===this.contextData.contextPage?"after":"before",s=this._findLatestPostId(),o=new n;o.fetch({pageRoot:t,direction:e,refPostID:s,success:i.bind(this._fetchSuccess,this),error:this._fetchFailure})},_fetchSuccess:function(t){var e=s(t.get("dashboardHTML"));e.insertAfter(this.contextData.$postButtonsContainer),s(".no_posts_found").remove(),this.contextData.$latestPostEl=e,o.trigger("posts:load")},_fetchFailure:function(){console.error("Failed loading dashboard HTML after successful post submission.")},_findLatestPostId:function(){var t=this.contextData.$latestPostEl.find(".post").data("post-id")||this.contextData.$postButtonsContainer.nextAll(".post_container").first().find(".post").data("post-id");return t},_updateInline:function(){var t=s(this.saveResponse.post_dashboard_html.trim());this.$inlinePostEl.replaceWith(t.eq(0)),o.trigger("posts:load")},_removeInline:function(){var t=this.contextData.baseRoute.split("/");t.splice(-1,1);var e=this.$inlinePostEl;return e.fadeOut(200,function(){e.remove()}),s("#posts .post").not(".new_post").length<=1?void(window.location=t.join("/")):void 0},_displayNotification:function(t){var e=this.contextData.baseRoute.split("/"),s=e[1]||"",n=t.message,r=i.parseInt(this.contextData.notificationDelay),a={url:t.post_tumblelog.post_url,tumblelog:{name:t.post_tumblelog.name_or_id,url:t.post_tumblelog.url,avatar:t.post_tumblelog.avatar}};(!t.created_post||t.post.is_reblog||t.fastCompose||"tagged"===s.toLowerCase())&&i.delay(function(){o.trigger("postForms:saveHook:toast",n,a)},r)}},r=function(t){this.contextData=i.defaults(t||{},{notificationDelay:250}),i.extend(this,e)};return r}();e.exports=r},{"../models/dashboard_post_fetch":64,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396}],70:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("velocity-animate").animate,n=t("../utils/transition_speed"),r=t("prima/class"),a=t("backbone"),l=t("prima/lib/domeventor"),h=t("prima/events"),d=(t("prima/lib/logger"),s("html")),c=r.extend({defaults:{keepInside:!1,scrollSpeedMs:250,triggerPadding:-50,contentPadding:20,debounceMs:200},start:function(t){return this._running&&this.stop(),this._running=!0,t&&!i.isPlainObject(t)&&(t={el:t}),this.options=t=i.extend({},this.defaults,t),this.$el=s(t.el),this.updateContentRect(),this.listenTo(h,"DOMEventor:flatscroll",this.checkScrollBounds),this},stop:function(){return this._running=!1,this._scrollTop=!1,this.cancelEnforceScrollBounds(),this.stopListening(),this},pause:function(){this._running&&(this._ignoreScroll=!0)},resume:function(){this._running&&this._ignoreScroll&&(this._ignoreScroll=!1,this.checkScrollBounds())},updateContentRect:function(){this.contentRect||(this.contentRect={}),this.lastContentRect&&(this.lastContentRect.offsetTop=this.contentRect.offsetTop,this.lastContentRect.offsetLeft=this.contentRect.offsetLeft,this.lastContentRect.offsetHeight=this.contentRect.offsetHeight,this.lastContentRect.offsetWidth=this.contentRect.offsetWidth);var t=this.$el.offset();return this.contentRect.offsetTop=t.top,this.contentRect.offsetLeft=t.left,this.contentRect.offsetHeight=this.$el.outerHeight(),this.contentRect.offsetWidth=this.$el.outerWidth(),this.lastContentRect||(this.lastContentRect=i.clone(this.contentRect)),this.contentRect},calculateScrollTop:function(t,e,i,s){return s?t:e-i},checkScrollBounds:function(t,e){if(!this._ignoreScroll){e=e?i.extend({},this.defaults,this.options,e):this.options,t||(t=l.rect());var s,o,n=e.contentRect||this.updateContentRect(),r=e.triggerPadding||0,a=e.contentPadding||0,h=n.offsetHeight,d=n.offsetTop,c=d+h,u=t.windowHeight,p=Math.max(0,t.windowScrollTop),m=p+u;return e.keepInside?(s=p-d,o=c-m):(s=p-c,o=d-m),o>r?(this._scrollTop=this.calculateScrollTop(d-a,c+a,u,h+2*a>u),this.enforceScrollBounds(e),!0):s>r?(this._scrollTop=this.calculateScrollTop(d-a,c+a,u,e.bottom||u>h+2*a),this.enforceScrollBounds(e),!0):(this._scrollTop=!1,this.cancelEnforceScrollBounds(),!1)}},enforceScrollBounds:function(t){var e=null!=t.scrollTop?t.scrollTop:this._scrollTop,s=t.scrollSpeedMs,o=t.debounceMs,n=t.container;o?this._enforceTimeout||(this._enforceTimeout=i.delay(i.bind(function(){null==t.scrollTop&&(e=this._scrollTop),this.scrollTop!==!1&&this.scrollToPosition(e,s,n)},this),o)):this.scrollToPosition(e,s,n)},cancelEnforceScrollBounds:function(){this._enforceTimeout,clearTimeout(this._enforceTimeout),this._enforceTimeout=!1},scrollToPosition:function(t,e,s){this._ignoreScroll=!0,o(d,"stop"),o(d,"scroll",{offset:t,container:s,duration:n(e||this.defaults.scrollSpeedMs)}).then(i.bind(function(){this._ignoreScroll=!1},this))}});i.extend(c.prototype,a.Events),e.exports=c},{"../utils/transition_speed":71,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/class":393,"prima/events":396,"prima/lib/domeventor":400,"prima/lib/logger":403,"velocity-animate":"lWl/mc"}],71:[function(t,e){"use strict";var i=1,s=function(t){return t*i};s.get=function(){return i},s.set=function(t){i=t},e.exports=s},{}],72:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("prima/utils/sequence-with-context"),r=t("../utils/transition_speed"),a=t("prima/mixins/promisifyevents"),l=t("prima/view"),h=(t("prima/lib/logger"),t("prima/mixins/subviewable")),d=t("prima/mixins/selectorcache"),c=t("prima/mixins/accessor"),u=t("./container_content"),p=t("./loader"),m=t("../templates/container.tpl"),g=l.extend({mixins:[h,d,c,a],template:m,defaultOptions:{animateDuringPrepare:!0,animateHeightWithContent:!1,startHeight:null,useLoader:!0,loaderDelay:250,transitionBackground:!1},defaults:{minHeight:!1,pretransition:!1,midtransition:!1},initialize:function(t){t instanceof l&&(t={postForm:t}),this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),t.postForm&&this.setPostForm(t.postForm),this.listenTo(this,"change:minHeight",this._onChangeMinHeight),this.listenTo(this,"change:pretransition",this._onChangePretransition),this.listenTo(this,"change:midtransition",this._onChangeMidtransition)},_onChangeMinHeight:function(t,e){o(this.$el,"stop"),e||i.isNumber(e)?o(this.$el,{"min-height":e},{duration:r(Math.min(Math.max(250,e),750))}):(e=i.parseInt(this.$el.css("min-height"),10)||0,o(this.$el,{"min-height":[0,e]},{duration:r(Math.min(Math.max(250,e),750))}).then(i.bind(function(){this.$el.css("min-height","")},this)))},_onChangePretransition:function(t,e){e?this.$el.addClass("post-form-container-pretransition"):this.$el.removeClass("post-form-container-pretransition")},_onChangeMidtransition:function(t,e){e?this.$el.addClass("post-form-container-transition"):this.$el.removeClass("post-form-container-transition")},setPostFormComponent:function(t){return this._postFormComponent!==t?(this._postFormComponent&&this.stopListening(this._postFormComponent),this._postFormComponent=t,this.postForm=t.postForm,this):void 0},prepare:function(t){return this.isRendered()||this.render(),this.trigger("prepared",this),this.loadingDelay=i.delay(i.bind(function(){this.loader&&this.options.useLoader&&this.loader.set("loading",!0)},this),this.options.loadingDelay),this.options.animateDuringPrepare&&(this._hideOriginalContent=this.hideOriginalContent(t).then(i.bind(function(){return this._hideOriginalContent=!1,this},this))),s.resolve(this)},attach:function(){return this.loader&&(clearTimeout(this.loadingDelay),this.loader.set("loading",!1)),this.set("pretransition",!0),this.postForm.forceHidden(),this.attachSubView(this.postForm,"postForm"),s.resolve(this)},hideOriginalContent:function(t){var e=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return e||this.options.originalContent||(e=i),n([function(){null!=e&&this.$el.css("height",e),this.set("midtransition",!0),this.originalContent.set("enabled",!1)},function(){return s.join(t(),this.originalContent.animateHide(r(100)))}],this)},showPostForm:function(t){var e=this.options.startHeight||this.originalContent.measureHeight(),i=this.postForm.measureHeight();return e||this.options.originalContent||(e=i),n([function(){return this.options.animateHeightWithContent||this.originalContent.get("hidden")?void 0:this._hideOriginalContent||this.hideOriginalContent(t)},function(){var n=[];return this.options.animateHeightWithContent&&!this.originalContent.get("hidden")&&n.push(this._hideOriginalContent||this.hideOriginalContent(t)),null==i||null==e||(i===e?this.$el.height(i):n.push(o(this.$el,{height:[i,e]},{duration:r(150),easing:[.4,1.3,.7,1]}))),s.all(n)},function(){return this.set("placeholder",!1),this.postForm.animateShow(r(100))},function(){this.set("pretransition",!1),this.set("midtransition",!1),this.$el.css("height","")}],this)},hidePostForm:function(t){var e=this.postForm.measureHeight(),i=this.originalContent.measureHeight();return i||this.options.originalContent||(i=e),n([function(){this.$el.css("height",e),this.set("midtransition",!0)},function(){return this.postForm.animateHide(r(100))},function(){if(this.set("pretransition",!0),null==i||null==e);else{if(i!==e)return o(this.$el,{height:[i,e]},{duration:r(100),easing:[0,0,.6,1]});this.$el.height(i)}},function(){return s.join(t(),this.originalContent.animateShow(r(50)))},function(){this.set("midtransition",!1),this.set("pretransition",!1),this.$el.css("height",""),this.originalContent.set("enabled",!0)}],this)},serialize:function(){return{originalContent:!!this.options.originalContent,transitionBackground:this.options.transitionBackground}},beforeRender:function(){this.loader||(this.loader=new p),this.originalContent||(this.originalContent=this.options.originalContent instanceof u?this.options.originalContent:new u({el:this.options.originalContent})),this.originalContent.$el.detach()},render:function(){return this.$el.html(this.template(this.serialize())),this.subViews.originalContent=this.originalContent,this.subViews.loader=this.loader,this.subViews.postForm=this.postForm,this.attachSubViews(),this},afterRender:function(){return this.$el.addClass("post-forms-above-glass"),this.renderSubViews()},beforeTeardown:function(){return this.subViews.loader=void 0,this},afterTeardown:function(){return this.$el.removeClass("post-forms-above-glass post-form-container-pretransition post-form-container-transition"),this.loader&&(this.loader.remove(),this.loader=void 0),this.$el.children(".post-transition-background").remove(),delete this.postForm,this.trigger("torndown",this),this.teardownSubViews()}});e.exports=g},{"../templates/container.tpl":65,"../utils/transition_speed":71,"./container_content":73,"./loader":75,lodash:"K2RcUv","prima/lib/logger":403,"prima/mixins/accessor":425,"prima/mixins/promisifyevents":433,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/utils/sequence-with-context":457,"prima/view":460,"velocity-animate":"lWl/mc",when:"RG2dij"}],73:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").animate,o=t("prima/view"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/accessor"),a=o.extend({defaults:{hidden:!1,enabled:!0},mixins:[n,r],initialize:function(t){this.set("hasContent",t&&t.el),this.originalCSS=this._getCSS(["opacity"]),this.listenTo(this,"change:enabled",this._onChangeEnabled),this.listenTo(this,"change:hidden",this._onChangeHidden)},_getCSS:function(t){var e={};return i.forEach(t,function(t){e[t]=this.$el.css(t)},this),e},_onChangeEnabled:function(t,e){this.$el.toggleClass("no-pointer-events",!e)},_onChangeHidden:function(t,e){this.$el.toggleClass("collapse",e)},measureHeight:function(){if(!this.get("hasContent"))return void 0;var t=this.get("hidden");this.set("hidden",!1);var e=this.$el.outerHeight();return this.set("hidden",t),e},animateShow:function(t,e){return t||(t=0),e||(e=0),s(this.$el,{opacity:1},{duration:t,delay:e,begin:i.bind(function(){this.set("hidden",!1)},this)})},animateHide:function(t,e){return t||(t=0),e||(e=0),s(this.$el,{opacity:0},{duration:t,delay:e}).then(i.bind(function(){this.set("hidden",!0)},this))},render:function(){return this},teardown:function(){return this.$el.css(this.originalCSS),this}});e.exports=a},{lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/subviewable":436,"prima/view":460,"velocity-animate":"lWl/mc"}],74:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").animate,o=t("prima/view"),n=t("../utils/transition_speed"),r=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=o.extend({className:"post-forms-glass",mixins:[r,a,l],initialize:function(t){this.options=t=i.extend({active:!1,visible:!1},t),this.set({active:!!t.active,visible:!!t.visible}),this.$el.css(this.get("visible")?{opacity:1,display:"block"}:{opacity:0,display:this.get("active")?"block":"none"}),this.listenTo(this,{"change:active":this._changeActive,"change:visible":this._changeVisible})},show:function(t){return this.set("active",!(null!=t&&!t)),this.attributes.visible&&this._showing?this._showing:(this.attributes.visible=!0,this._show())},hide:function(t){return this.set("active",!(null==t&&!t)),!this.attributes.visible&&this._hiding?this._hiding:(this.attributes.visible=!1,this._hide())},_show:function(){var t=this._showing=s(this.$el,{opacity:1},{duration:n(150),display:"block"});return t},_hide:function(){var t=this._hiding=s(this.$el,{opacity:0},{duration:n(150),display:this.get("active")?"block":"none"});return t},_changeActive:function(t,e){e?this.$el.addClass(this.className+"_active active"):(this.$el.removeClass(this.className+"_active active"),!this._changing||i.has(this.changed,"visible")||this.get("visible")||this.$el.css("display","none"))},_changeVisible:function(t,e){e?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},render:function(){return this}});e.exports=h},{"../utils/transition_speed":71,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460,"velocity-animate":"lWl/mc"}],75:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/mixins/subviewable"),o=t("prima/mixins/selectorcache"),n=t("prima/mixins/accessor"),r=t("../templates/loader.tpl"),a=i.extend({className:"post-forms-loader",mixins:[s,o,n],template:r,initialize:function(t){this.listenTo(this,"change:loading",this._onChangeLoading),this.set("loading",t&&t.loading)},_onChangeLoading:function(t,e){this.isRendered()&&(e?(this.$el.addClass("loading"),this.$$(".Knight-Rider-loader").addClass("animate")):(this.$el.removeClass("loading"),this.$$(".Knight-Rider-loader").removeClass("animate")))
},render:function(){return this.$el.html(this.template(this.attributes)),this}});e.exports=a},{"../templates/loader.tpl":66,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],76:[function(t,e){"use strict";var i=t("jquery"),s=t("velocity-animate").animate,o=t("prima/view"),n=t("../utils/transition_speed"),r=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=t("../templates/modal.tpl"),d=o.extend({className:"post-forms-modal",mixins:[r,a,l],template:h,initialize:function(t){this.set("visible",t&&t.visible),this.$el.css(this.get("visible")?{opacity:1,display:"block"}:{opacity:0,display:"none"}),this.$body=i("body"),this.listenTo(this,"change:visible",this._toggleVisible)},show:function(){return this.attributes.visible=!0,this._show()},hide:function(){return this.attributes.visible=!1,this._hide()},setContentSubView:function(t){return this.subViews.content&&(this.stopListening(this.subViews.content),this.subViews.content.remove()),this.subViews.content=t,this.listenTo(t,"prepared",this._onSubViewPrepare),this.listenTo(t,"torndown",this._onSubViewTeardown),this.isRendered()&&this.attachSubView("content"),this},_onSubViewPrepare:function(){this.show()},_onSubViewTeardown:function(){this.hide()},_show:function(){this._disableBodyScroll(),this.$el.css("display","block");var t=s(this.$el,{opacity:1},{duration:n(100),display:"block"});return t},_hide:function(){this._enableBodyScroll();var t=s(this.$el,{opacity:0},{duration:n(100),display:"none"});return t},_toggleVisible:function(t,e){e?(this.$el.addClass(this.className+"_visible visible"),this._show()):(this.$el.removeClass(this.className+"_visible visible"),this._hide())},_disableBodyScroll:function(){this.$body.css("overflow","hidden")},_enableBodyScroll:function(){this.$body.css("overflow","")},render:function(){return this.$el.html(this.template(this.attributes)),this.attachSubViews(),this}});e.exports=d},{"../templates/modal.tpl":67,"../utils/transition_speed":71,jquery:"HlZQrA","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460,"velocity-animate":"lWl/mc"}],77:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("./container_content"),r=t("prima/mixins/selectorcache"),a=t("prima/mixins/accessor"),l=t("prima/events"),h=t("../utils/post_form_container_type"),d=n.extend({mixins:[r,a],events:{"click [data-js-text]":"_onClickNewPost","click [data-js-photo]":"_onClickNewPost","click [data-js-quote]":"_onClickNewPost","click [data-js-link]":"_onClickNewPost","click [data-js-chat]":"_onClickNewPost","click [data-js-audio]":"_onClickNewPost","click [data-js-video]":"_onClickNewPost"},setPostType:function(t){this.postType=t},animateShow:function(t,e){return t||(t=0),e||(e=0),this.$el.css({display:"block",opacity:1}),function(i){var n=this.js$(i),r=n.children("i"),a=n.children(".new_post_label_text"),l=this.$$(".new_post_label").not(n),h=l.children("i"),d=l.children(".new_post_label_text"),c=[o(h,{scale:1,translateY:[0,10],opacity:1},{duration:t,delay:e}),o(d,{translateY:[0,10],opacity:1},{duration:t,delay:e})];return n.length&&r.length&&c.push(o(r,{scale:[1,1.5],translateY:[0,0],opacity:1},{duration:t,delay:e}),o(a,{translateY:[0,0],opacity:1},{duration:t,delay:e})),s.all(c)}.call(this,this.postType)},animateHide:function(t,e){t||(t=0),e||(e=0),function(i){var n=this.js$(i),r=n.children("i"),a=n.children(".new_post_label_text"),l=this.$$(".new_post_label").not(n),h=l.children("i"),d=l.children(".new_post_label_text"),c=[o(h,{scale:[1,1],translateY:[10,0],opacity:0},{duration:t,delay:e}),o(d,{translateY:[10,0],opacity:0},{duration:t,delay:e})];return n.length&&r.length&&c.push(o(r,{scale:[1.5,1],translateY:[0,0],opacity:0},{duration:t,delay:.5*t+e}),o(a,{translateY:[0,0],opacity:0},{duration:t,delay:e})),s.all(c)}.call(this,this.postType).then(i.bind(function(){this.$el.css({display:"none",opacity:0})},this))},_onClickNewPost:function(t){if(t.stopPropagation(),t.preventDefault(),this.get("enabled")){var e=t.currentTarget.getAttribute("data-post-endpoint")||t.currentTarget.getAttribute("data-post-type");l.trigger("postForms:open",{postType:e,postFormType:h.inline})}}});e.exports=d},{"../utils/post_form_container_type":68,"./container_content":73,lodash:"K2RcUv","prima/events":396,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"velocity-animate":"lWl/mc",when:"RG2dij"}],78:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("../models/photo"),n=s.extend({model:o,add:function(t){return t&&!i.isArray(t)&&(t=[t]),i.forEach(t,function(t,e){t.id||(i.isFunction(t.set)?t.set("id",this.generateId(e)):t.id=this.generateId(e))},this),s.prototype.add.apply(this,arguments)},generateId:function(t){var e=1+(t||0),s=i.map(i.range(this.length+1),function(t){return"o"+(e+t)});return i.find(s,function(t){return!this.get(t)},this)},setIdOrder:function(t,e){e||(e={}),this.models=i.map(t,function(t){return this.get(t)},this),e.silent||this.trigger("sort",this,e)}});e.exports=n},{"../models/photo":85,lodash:"K2RcUv","prima/collection":394}],79:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("prima/mixins/promisifyevents"),n=t("prima/events"),r=t("prima/utils/sequence-with-context"),a=t("prima/component"),l=(t("prima/lib/logger"),t("app/lib/avatar-size")),h=t("./models/post"),d=t("app/lib/currentuser"),c=t("app/components/upload/collections/uploads"),u=t("./views/post_form"),p=t("./utils/drag_eventor"),m=new p("body"),g=a.extend({name:"PostForm",viewOptionKeys:["fullWidthInlineMedia","isModal","popoverContainer","dragEvents","redirectTo","reblogActionContext"],initialize:function(t){t=i.extend({dragEvents:m,autoFetch:!0},t),this.user=t.user||d(),this.post=t.post||new h,this.uploads=new c,this._preloadAvatars(),this.postForm=new u(i.extend(i.pick(t,this.viewOptionKeys),{user:this.user,post:this.post,uploads:this.uploads,model:this.post})),t.autoFetch&&(this.postFetch=this.fetchPostData(this.post))},_preloadAvatars:function(t){t||(t=this.user.channels.pluck("avatar_url")),i.forEach(t,function(t){var e=new Image;e.src=l(t)(128)})},fetchPostData:function(t){if(this.postFetch)return this.postFetch;t||(t=this.post);var e=this.user;return s.promise(function(i){t.has("lookupData")?t.fetch(t.get("lookupData")).then(function(){t.unset("lookupData"),e&&"html"===e.get("defaultEditorType")&&"edit"===t.get("mode")&&"rich"===t.get("editorType")&&t.set("editorType","html"),i(t)}):i(t)})},addEventListeners:function(){this.listenTo(n,"DOMEventor:keydown:escape",function(){this.isEnabled()&&n.trigger("postForms:close")}),this.listenTo(this.postForm,"all",function(){this.trigger.apply(this,arguments)}),this.listenToOnce(this.postForm,"postForms:changePostType",this.reloadPostForm)},enable:function(){this.postForm.set("enabled",!0)},disable:function(){this.postForm.set("enabled",!1)},isEnabled:function(){return this.postForm.get("enabled")||!1},getRect:function(){return this.postForm.getRect()},isRendered:function(){return this.postForm.isRendered()},whenRendered:function(t){return null==t&&(t=!this.isRendered()),s.promise(i.bind(function(e){t?(this.listenToOnce(this,"ready",function(){e(this)}),this.render()):e(this)},this))},_render:function(){var t=this.whenEvent(this.postForm,"media:ready");return this.postForm.render(),this.initialPostState=this.postForm.post.toJSON(),this.postForm.set("initialPostState",this.initialPostState),this.addEventListeners(),this.postForm.get("useMediaReady")?t.then(i.bind(function(){this.trigger("ready")},this)):this.trigger("ready"),delete this.postFetch,this},render:function(){return this.fetchPostData(this.post).then(i.bind(this._render,this))},teardown:function(){return this.stopListening(),this},remove:function(){this.stopListening(),this.postForm.remove()},reloadPostForm:function(t){t=t||{};var e=r([function(){return this.postForm.animateHide(200)},function(){this.postForm.teardown();var e={lookupData:this.post.getLookupData(),tumblelog:this.post.get("tumblelog"),mode:this.post.get("mode"),loggingData:this.post.loggingData};i.extend(e,t.postParams||{}),this.post=this.postForm.post=this.postForm.model=new h(e),this.render()},function(){i.isFunction(t.afterReload)&&t.afterReload.call(this,this.postForm)}],this);return e}});o.applyTo(g.prototype),e.exports=g},{"./models/post":87,"./utils/drag_eventor":152,"./views/post_form":181,"app/components/upload/collections/uploads":240,"app/lib/avatar-size":273,"app/lib/currentuser":275,lodash:"K2RcUv","prima/component":395,"prima/events":396,"prima/lib/logger":403,"prima/mixins/promisifyevents":433,"prima/utils/sequence-with-context":457,when:"RG2dij"}],80:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("prima/lib/translate"),n=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={two:"caption",three:"url"},i.prototype.editorField="two",i.prototype.allowsTypeSwitch=function(){return"new"===this.get("mode")},i.prototype.typeAttributes={service:!1,preuploadUrl:"",trackTitle:"",trackArtist:"",trackAlbum:"",preuploadAlbumArt:!1,albumArt:"",caption:"",confirmTos:!1},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),n(i,e)},i.prototype.resetPreserveFields=["caption","tags"],i.prototype.resetAttributes=["service","url","preuploadUrl","trackTitle","trackArtist","trackAlbum","confirmTos","preuploadAlbumArt","albumArt","copyrightFallback"],i.prototype.parseForType=function(t,e,i){i.service&&"direct"!==i.service||(e.url=i.audio_url),delete e.audio_url,e.albumArt=i.audio_artwork,delete e.audio_artwork;var s=i.id3_tags||{};return delete e.id3_tags,e.trackTitle=s.Title||"",e.trackArtist=s.Artist||"",e.trackAlbum=s.Album||"",e},i.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments)),i={"id3_tags[title]":this.get("trackTitle")||null,"id3_tags[artist]":this.get("trackArtist")||null,"id3_tags[album]":this.get("trackAlbum")||null,preuploaded_url:this.get("preuploadUrl"),confirm_tos:this.get("confirmTos"),artwork_pre_upload:this.get("preuploadAlbumArt"),album_art:this.get("albumArt"),remove_album_art:"edit"===this.get("mode")&&s.isEmpty(this.get("albumArt")),copyright_fallback:this.get("copyrightFallback")};return s.extend(e,s.pick(i,function(t){return!s.isUndefined(t)})),s.isEmpty(e.preuploaded_url)||(e["post[three]"]=null),e},i.prototype.validate=function(t,e){var i=[];return s.isEmpty(e.url)?i.push(o("Please choose an audio source before continuing.")):e.preuploadUrl?e.confirmTos||i.push(o("You must agree that you have permission to share this file.")):s.isEmpty(e.url)&&i.push(o("Please choose an audio source before continuing.")),t.call(this,e,{errors:i})},e.exports=i},{"../utils/string_helpers":156,lodash:"K2RcUv","prima/lib/translate":423}],81:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={one:"title",two:"chat"},i.prototype.typeAttributes={title:"",chat:""},i.prototype.generateTweetText=function(t,e){var i,n=this.getHtmlStripped("title"),r=this.getHtmlStripped("chat");return i=n&&r?s.sprintf("%s - %s",n,r):n||r||"",o(i,e)},i.prototype.validate=function(t,e){var i=[];return(!e.chat||e.chat.length<1)&&i.push("No chat."),t.call(this,e,{errors:i})},i.prototype.serializeForServer=function(t){var e=this,i=t.apply(this,s.rest(arguments));return i["post[two]"]=e.get("chat").replace(/\u00A0/gm," "),i},e.exports=i},{"../utils/string_helpers":156,lodash:"K2RcUv"}],82:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("prima/utils/url"),n=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={one:"title",two:"url",three:"caption",thumbnail:"thumbnail"},i.prototype.typeAttributes={title:"",url:"",caption:""},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("title"),r=this.getHtmlStripped("url"),a=this.getHtmlStripped("caption");a=a.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var l;return l=i&&a?s.sprintf("%s - %s",i,a):i||a||o.parseUrl(r).host||"",n(l,e)},i.prototype.editorField="three",i.prototype.typeAttributes={title:"",url:""},i.prototype.resetPreserveFields=["caption","tags"],i.prototype.resetAttributes=["title","url","thumbnail"],i.prototype.softReset=function(t){t.apply(this,s.rest(arguments)),s.isEmpty(this.get("thumbnail"))||"new"===this.get("mode")||this.set("remove_thumbnail",1)},i.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments));return this.get("remove_thumbnail")&&(e.remove_thumbnail=this.get("remove_thumbnail")),e},i.prototype.validate=function(t,e){var i=[];return(!e.url||e.url.length<1)&&i.push("No url."),t.call(this,e,{errors:i})},e.exports=i},{"../utils/string_helpers":156,lodash:"K2RcUv","prima/utils/url":459}],83:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({defaults:{fetchOptions:{url:"/svc/mention",with_form_key:!0},suggestCache:{},queryHistory:[],maxCacheSize:20,maxSuggests:5,blogSuggestions:{}},fetch:function(t){"query"in t&&"success"in t&&i.isFunction(t.success)||console.error("Mention must be provided a query and a success callback.");var e=t.query;if(i.extend(t,this.get("fetchOptions")),e in this.get("suggestCache")){var o=this.get("suggestCache")[e];return this.set("blogSuggestions",o),t.success.call(this,this,o,t)}return t.data={q:e},s.prototype.fetch.call(this,t)},parse:function(t,e){var i=this._processQueryResults(t,e);return this._cacheQueryResults(i,e),i},_processQueryResults:function(t,e){var s=e.query;return i.extend(t,{queryRegex:this._escapeRegex(s)})},_cacheQueryResults:function(t,e){var s=i.clone(this.get("suggestCache")),o=i.clone(this.get("queryHistory"));s[e.query]=t,o.push(e.query),i.size(s)>this.get("maxCacheSize")&&(delete s[o[0]],o.shift()),this.set("suggestCache",s),this.set("queryHistory",o)},_escapeRegex:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\~\`\!\@\#]/g,"\\$&")}});e.exports=o},{lodash:"K2RcUv","prima/model":439}],84:[function(t,e){"use strict";function i(){}var s=(t("lodash"),t("../utils/string_helpers").truncateLongStrings);i.prototype.genericFieldMap={one:"ask",two:"answer",three:"caption"},i.prototype.editorField="three",i.prototype.typeAttributes={ask:"",answer:"",caption:""},i.prototype.generateTweetText=function(t,e){return s(this.getHtmlStripped("ask"),e)},i.prototype.validate=function(t,e){var i=[];return(!e.ask||e.ask.length<1||!e.answer||e.answer.length<1)&&i.push("Post body empty."),t.call(this,e,{errors:i})},e.exports=i},{"../utils/string_helpers":156,lodash:"K2RcUv"}],85:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/model"),n=t("prima/utils/image/loader"),r=t("prima/utils/image/filereader"),a=t("prima/utils/image/canvas"),l=1080,h=o.extend({defaults:{url:"",preuploadUrl:"",externalUrl:"",file:null,photoRaw:null,base64:null,isSelfie:!1,isSelfieGif:!1,width:null,height:null,caption:"",id:""},initialize:function(){this.on("change:externalUrl",function(t,e){e&&this.readUrl(e),this.set({preuploadUrl:null,base64:null})},this),this.get("externalUrl")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file")),this.on("change:file",function(t,e){e&&this.readFile(e),this.set({externalUrl:null,base64:null})},this),this.get("file")&&!this.get("base64")&&this.trigger("change:file",this,this.get("file"))},readUrl:function(t,e){e||(e="photo:readUrl"),n.load(t).then(i.bind(function(t){this.set({url:t.src,width:t.width,height:t.height}),this.trigger(e,!0,this)},this),i.bind(function(i){this.set({url:t,width:null,height:null}),this.trigger(e,!1,this)},this))},readFile:function(t){return r.canReadFiles()?void r.read(t).then(i.bind(function(t){if(!t.file.type.match(/image\/(jpg|jpeg|png)/i))return this.readUrl(t.objectUrl||t.base64,"photo:readFile");var e=s("<img/>");e.attr("src",t.objectUrl||t.base64),n.load(t.objectUrl||t.base64).then(i.bind(function(i){var s=a.drawScaledAndRotated(e,i.width,i.height,t.rotation,t.mirrored,l);return this.readUrl(s.toDataURL(t.file.type),"photo:readFile")},this))},this),i.bind(function(){this.trigger("photo:readFile",!1,this)},this)):void this.trigger("photo:readFile",!1,this)},getDisplayUrl:function(){return this.get(this.get("preuploadUrl")?"preuploadUrl":this.get("externalUrl")?"externalUrl":this.get("base64")?"base64":"url")},getUploadUrl:function(){return this.get("preuploadUrl")?this.get("preuploadUrl"):this.get("externalUrl")?this.get("externalUrl"):""},toJSON:function(){var t=o.prototype.toJSON.apply(this,arguments);return t.displayUrl=this.getDisplayUrl(),t.uploadUrl=this.getUploadUrl(),t}});e.exports=h},{jquery:"HlZQrA",lodash:"K2RcUv","prima/model":439,"prima/utils/image/canvas":452,"prima/utils/image/filereader":453,"prima/utils/image/loader":454}],86:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("../collections/photos"),n=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={two:"caption",three:"linkthrough"},i.prototype.editorField="two",i.prototype.typeAttributes={caption:"",layout:"",linkthrough:"",photos:[]},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),n(i,e)},i.prototype.MAX_IMAGES=10,i.prototype.resetPreserveFields=["caption","tags"],i.prototype.afterDelegate=function(t){t.apply(this,s.rest(arguments)),this.photos=new o(this.attributes.photos,{parse:!0}),this.on("change:photos",function(t,e){this.photos.reset(e,{parse:!0}),delete this.attributes.photos},this),this.trigger("change:photos",this.get("photos")),this.listenTo(this.photos,"add remove change:preuploadUrl change:externalUrl",function(){this.trigger("validate")})},i.prototype.parseForType=function(t,e,i){return e.layout=i.photoset_layout,delete e.photoset_layout,e},i.prototype.serializeForServer=function(t){var e=this,i=t.apply(this,s.rest(arguments));return s.forEach(this.photos.toJSON(),function(t){i["images["+t.id+"]"]=t.uploadUrl,i["caption["+t.id+"]"]=(t.caption||"").substr(0,200),t.photoRaw&&(i.photo_raw=t.photoRaw,i.is_selfie_gif=t.isSelfieGif,i.is_selfie=t.isSelfie)}),i["post[photoset_layout]"]=e.get("layout"),i["post[photoset_order]"]=this.photos.pluck("id").join(","),i},i.prototype.canAddPhotos=function(){return this.photos.length<this.MAX_IMAGES},i.prototype.validate=function(t,e){var i=[];0===this.photos.length&&i.push("No photos specified.");var s=this.photos.all(function(t){return t.getUploadUrl()||!t.has("upload")});return s||i.push("Uploads in progress."),t.call(this,e,{errors:i})},e.exports=i},{"../collections/photos":78,"../utils/string_helpers":156,lodash:"K2RcUv"}],87:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=t("prima/mixins/delegator"),n=t("./text_post"),r=t("./photo_post"),a=t("./quote_post"),l=t("./link_post"),h=t("./chat_post"),d=t("./audio_post"),c=t("./video_post"),u=t("./note_post"),p=t("../utils/bool_tool"),m=t("../utils/string_helpers"),g=t("prima/utils/url"),f=t("../utils/validation"),_=s.extend({mixins:[o],typeDelegateMap:{text:n,photo:r,quote:a,link:l,chat:h,audio:d,video:c,note:u},_VALID_STATES:{published:"0",draft:"1",queued:"2",scheduled:"on.2","private":"private",unapproved:"0 3",transcoding:"4"},_FORMAT_CODE_TO_EDITOR_TYPE:{0:"rich",1:"html",2:"markdown"},_STATE_CODE_TO_TEXT:{0:"published","0 3":"published",1:"draft",2:"queued",3:"unapproved",4:"transcoding","on.2":"scheduled","private":"private"},defaults:{allow_photo_replies:Boolean(),postDate:String(),customUrl:String(),sourceUrl:String(),state:"published",editorType:"rich",tags:[],publish_on:String(),tumblelog:String(),uploading:!1,mode:"new",contentStats:{}},shortUrlLength:29,typeAttributes:{},editorField:!1,resetPreserveFields:[],resetAttributes:[],_syntheticAttributes:{pseudoState:function(){var t=this.get("state"),e=this.get("publish_on");return"published"===t&&1===parseInt(this.get("is_private"),10)&&(t="private"),"queued"===t?i.isEmpty(e)?"queued":"scheduled":t},formattedSourceUrl:function(){var t,e=this.get("sourceUrl");return i.isEmpty(e)?"":(t=g.addProtocolIfMissing(e,"http:"),f.isUrl(t)?t:e)}},initialize:function(t){i.has(t,"tags")||this.set("tags",[]),this._assignPostTypeFunctionality()},_assignPostTypeFunctionality:function(){var t=this.get("type"),e=i.bind(function(t){return t in this.typeDelegateMap?this.typeDelegateMap[t].prototype:!1},this);t?(this.delegateObject(e(t)),this.afterDelegate()):this.listenToOnce(this,"change:type",function(t,i){this.delegateObject(e(i)),this.afterDelegate()})},afterDelegate:function(){i.defaults(this.attributes,this.typeAttributes)},_normalizeType:function(t,e){var s={regular:"text",conversation:"chat"};return e===!1&&(s=i.invert(s)),t in s?s[t]:t},get:function(t){return(this._syntheticAttributes[t]||s.prototype.get).apply(this,arguments)},getHtmlStripped:function(t,e,s){return"undefined"!=typeof e||(e=!0),"undefined"!=typeof s||(s=" "),i.trim(m.stripHtml(this.get(t)||"",e,s))},fetch:function(t){var e={data:t};return s.prototype.fetch.call(this,e)},parse:function(t,e){if(e.parse===!1)return this.attributes;var s=t.post,o=e.data,n={},r=s.id?"edit":"reblog";n.type=this._normalizeType(s.type,!0),n.can_reblog_as=i.map(s.can_reblog_as,i.bind(function(t){return this._normalizeType(t,!0)},this)),this.set("type",n.type),i.forEach(this.genericFieldMap,function(t,e){n[t]=s[e]});var a=["one","two","three","state","publish_on","tags","type","can_reblog_as"];return i.extend(n,i.omit(s,a),{createdPost:!!t.created_post,postTumblelog:t.post_tumblelog||{},postContextPage:t.post_context_page}),"edit"===r?(n["post-id"]=s.id,n.tags=s.tags?s.tags.split(","):[],n.tumblelog=n.postTumblelog.name_or_id||!1):"reblog"===r&&i.extend(n,i.pick(o,["reblog_id","reblog_key"])),"state"in s&&(n.state=this._extractState(s)),s.from_app&&1===i.parseInt(s.format)||(n.editorType=this._FORMAT_CODE_TO_EDITOR_TYPE[i.parseInt(s.format||0)]),n.editorType||(n.editorType=this.get("editorType")||this._FORMAT_CODE_TO_EDITOR_TYPE[0]),i.has(s,"custom_tweet")&&(n.customTweet=s.custom_tweet),i.extend(n,{sourceUrl:n.source_url||"",htmlEdited:"rich"!==n.format&&!(this.editorField&&!s[this.editorField]),postDate:n.date||"",customUrl:n.slug||""},i.mapValues(i.pick(n,["allow_answers","allow_photo_replies","html_mode"]),p)),"edit"!==r||"queued"!==n.state||i.isEmpty(s.publish_on)||(n.state="scheduled",n.publish_on=s.publish_on),this.parseForType(n,s)},parseForType:function(t){return t},sync:function(t,e,o){var n={create:"/svc/post/update",read:"/svc/post/fetch",update:"/svc/post/update"};return i.defaults(o||(o={}),{emulateHTTP:!0,forServer:!0,url:n[t]}),o.parse="read"===t,s.prototype.sync.call(this,t,e,o)},toJSON:function(t){return t=i.defaults(t||{},{forServer:!1}),t.forServer?this.serializeForServer(t):s.prototype.toJSON.call(this,t)},serializeForServer:function(){var t=this,e=t.attributes,s={channel_id:e.tumblelog,post_id:e["post-id"],"post[date]":e.postDate,"post[one]":this.getAttributeFromGeneric("one"),"post[publish_on]":e.publish_on,"post[slug]":e.customUrl,"post[tags]":e.tags.join(),"post[two]":this.getAttributeFromGeneric("two"),"post[three]":this.getAttributeFromGeneric("three"),thumbnail:this.getAttributeFromGeneric("thumbnail"),editor_type:e.editorType,send_to_twitter:e.send_to_twitter,custom_tweet:e.customTweet,send_to_fbog:e.send_to_fbog,loggingData:e.loggingData,allow_photo_replies:e.allow_photo_replies,content_stats:e.contentStats};"edit"===e.mode&&(s.edit_post_id=e["post-id"]),s["post[source_url]"]=t.get("formattedSourceUrl"),s["post[state]"]=t._VALID_STATES[e.state],s["post[type]"]=this._normalizeType(e.type,!1);var o={reblog:e.is_reblog,reblog_key:e.reblog_key,reblog_post_id:e.reblog_id,pt:e.pt,remove_reblog_tree:e.remove_reblog_tree,reblog_source:e.reblogSource};i.extend(s,i.pick(o,function(t){return!i.isUndefined(t)})),e.allow_answers&&(s.allow_answers="on"),this.getAttributeFromGeneric("thumbnail")&&(s.thumbnail_pre_upload="1");var n=this.getContextPage();return i.extend(s,{context_id:e.tumblelog,context_page:n,"is_rich_text[one]":"0","is_rich_text[two]":"0","is_rich_text[three]":"0"}),this.editorField&&(s["is_rich_text["+this.editorField+"]"]="1"),e.reblogActionContext&&(s.reblog_source=e.reblogActionContext),s},validate:function(t,e){var s="errors"in e?e.errors:[];return t.state&&(i.has(this._VALID_STATES,t.state)||s.push('Invalid "state" value')),i.each(this.defaults,function(e,i){typeof e!=typeof t[i]&&s.push('Invalid "'+i+'" type. Expected '+typeof e+", got "+typeof t[i]+".")}),s.length?s:void 0},_extractState:function(t){var e=this._STATE_CODE_TO_TEXT[t.state];return 1===parseInt(t.is_private,10)&&(e="private"),e},findBlogChannelByName:function(t){return this.attributes.tumblelog&&this.attributes.tumblelog.collection&&"findWhere"in this.attributes.tumblelog.collection?this.attributes.tumblelog.collection.findWhere({name_or_id:t}):void 0},getPreservedData:function(){return this.resetPreserveFields.some(i.bind(function(t){return this.get(t)&&this.get(t).length>0},this))},softReset:function(){i.forEach(this.resetAttributes,function(t){i.has(this.typeAttributes,t)?this.set(t,this.typeAttributes[t]):i.has(this.defaults,t)?this.set(t,this.defaults[t]):this.unset(t)},this)},getLookupData:function(){return"reblog"===this.get("mode")?{reblog_id:this.get("reblog_id"),reblog_key:this.get("reblog_key"),post_type:this.get("type")}:void 0},getContextPage:function(){var t=this.attributes,e="dashboard";return t.contextData&&"baseRoute"in t.contextData&&(e=t.contextData.baseRoute.split("/").pop()),e},getAttributeFromGeneric:function(t){return this.get(this.genericFieldMap[t])},getTweetText:function(){var t=this.get("customTweet");return i.isString(t)||(t=this.generateTweetText(140-this.shortUrlLength-1),t?t+=" [URL]":t="[URL]"),t},getTweetTextLength:function(t){i.isString(t)||(t=this.getTweetText()),t=i.trim(t).replace(/([^\s])\[URL\]/gi,"$1 [URL]").replace(/\[URL\]([^\s])/gi,"[URL] $1");var e=t.length;return e+=(this.shortUrlLength-5)*(t.match(/\[URL\]/gi)||"").length},generateTweetText:function(){return""},canEditMedia:function(){return!this.get("is_reblog")},isReblog:function(){return!!this.get("is_reblog")},allowsReblogAs:function(){var t=[this.get("type")],e=this.get("can_reblog_as")||t;return"reblog"===this.get("mode")&&i.difference(e,t).length?!0:!1},allowsTypeSwitch:function(){return!1},deepHasChanged:function(t){var e=this.toJSON(),s=this.get("mode"),o=i.keys(t),n=i.keys(e);if(i.isEqual(t,e))return!1;if("new"!==s)return!0;var r=i.difference(n,o),a=i.reduce(r,function(t,s){var o=e[s],n=i.isUndefined(o)||i.isNull(o)?0:o.length;return t+n},0);return a>0?!0:(t=i.omit(t,r),e=i.omit(e,r),!i.isEqual(t,e))}});e.exports=_},{"../utils/bool_tool":149,"../utils/string_helpers":156,"../utils/validation":157,"./audio_post":80,"./chat_post":81,"./link_post":82,"./note_post":84,"./photo_post":86,"./quote_post":88,"./text_post":90,"./video_post":91,lodash:"K2RcUv","prima/mixins/delegator":427,"prima/model":439,"prima/utils/url":459}],88:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={one:"quote",two:"source"},i.prototype.typeAttributes={quote:"",source:""},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("quote"),n=this.getHtmlStripped("source");n=n.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var r;return r=n&&i.length+(n.length>1?7:6)<=e?r=s.sprintf("“%s” - %s",i,n):i?s.sprintf("“%s”",o(i,e-2)):n,o(r,e)},i.prototype.editorField="two",i.prototype.validate=function(t,e){var i=[];return(!e.quote||e.quote.length<1)&&i.push("No quote."),t.call(this,e,{errors:i})},e.exports=i},{"../utils/string_helpers":156,lodash:"K2RcUv"}],89:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({defaults:{fetchOptions:{url:"/svc/tag_suggest",with_form_key:!0},suggestCache:{},queryHistory:[],maxCacheSize:20,maxSuggests:5,tagSuggestions:{}},initialize:function(t){if(!1==("user"in t&&"post"in t))throw new Error("Tag Suggestions must be provided user and post models.")},fetch:function(t){return"query"in t&&"success"in t&&i.isFunction(t.success)||console.error("TagSuggestion must be provided a query and a success callback."),i.extend(t,this.get("fetchOptions")),t.query in this.get("suggestCache")?(this.set("tagSuggestions",this.get("suggestCache")[t.query]),t.success.call(this,this,"suggestCache",t)):(t.data={q:t.query},s.prototype.fetch.call(this,t))},parse:function(t,e){var i=this.get("user"),s=this.get("post").get("tumblelog"),o={suggestions:"tags"in t?t.tags:[],userTags:s?i.getChannelProperty(s,"tags"):[]};return o.userTags||(o.userTags=[]),o=this._processQueryResults(o,e),this._cacheQueryResults(o,e),{tagSuggestions:o}},_processQueryResults:function(t,e){var s=new RegExp(this._escapeRegex(e.query),"i");return t.suggestions=i.compact(i.map(t.suggestions,function(t){return t.tag})).slice(0,this.get("maxSuggests")),t.userTags=i.compact(i.filter(t.userTags,function(t){return s.test(t)})).slice(0,this.get("maxSuggests")),t},_cacheQueryResults:function(t,e){var s=i.clone(this.get("suggestCache")),o=i.clone(this.get("queryHistory"));s[e.query]=t,o.push(e.query),i.size(s)>this.get("maxCacheSize")&&(delete s[o[0]],o.shift()),this.set("suggestCache",s),this.set("queryHistory",o)},_escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}});e.exports=o},{lodash:"K2RcUv","prima/model":439}],90:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={one:"title",two:"body"},i.prototype.editorField="two",i.prototype.typeAttributes={title:"",body:""},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("title"),n=this.getHtmlStripped("body");n=n.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,"");var r;return r=i&&n?s.sprintf("%s - %s",i,n):i||n||"",o(r,e)},i.prototype.validate=function(t,e){var i=[],o=!s.isUndefined(e.reblog_tree)&&e.reblog_tree!==!1&&""!==e.reblog_tree,n=o&&e.remove_reblog_tree===!0;return(!e.body||e.body.length<1)&&(!e.title||e.title.length<1)&&(!o||o&&n)&&i.push("Post body empty."),t.call(this,e,{errors:i})},e.exports=i},{"../utils/string_helpers":156,lodash:"K2RcUv"}],91:[function(t,e){"use strict";function i(){}var s=t("lodash"),o=t("prima/lib/translate"),n=t("../utils/remap_keys"),r=t("../utils/camelize_keys"),a=t("../utils/string_helpers").truncateLongStrings;i.prototype.genericFieldMap={one:"embedCode",two:"caption"},i.prototype.editorField="two",i.prototype.resetPreserveFields=["caption","tags"],i.prototype.resetAttributes=["preuploadUrl","preuploadKey","embedCode","confirmTos","copyrightFallback"],i.prototype.typeAttributes={caption:"",confirmTos:!1},i.prototype.generateTweetText=function(t,e){var i=this.getHtmlStripped("caption");return i=i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi,""),a(i,e)},i.prototype.validate=function(t,e){var i=[];return e.embedCode?0===e.embedCode.length&&i.push("No embed specified."):e.preuploadUrl?e.confirmTos||i.push(o("You must agree that you have permission to share this file.")):e.video?0===e.video.embed_code.length&&i.push("Direct embed missing."):i.push("No video specified."),t.call(this,e,{errors:i})},i.prototype.serializeForServer=function(t){var e=t.apply(this,s.rest(arguments)),i=s.omit({preuploaded_url:this.get("preuploadUrl"),preuploaded_ch:this.get("preuploadKey"),confirm_tos:this.get("confirmTos"),copyright_fallback:this.get("copyrightFallback")},s.isUndefined);return s.extend(e,i),e=n(e,"snake",["embedCode"])},i.prototype.getEmbedData=function(){var t=!1;return this.has("video")?(t=r(this.get("video")),t={isNativeVideo:!0,embedRenderContext:"inline",width:t.dimensions.width,height:t.dimensions.height,previewIframe:t.previewIframe,embedCode:t.embedCode}):this.has("video_embed")&&(t=r(this.get("video_embed"))),t},e.exports=i},{"../utils/camelize_keys":150,"../utils/remap_keys":154,"../utils/string_helpers":156,lodash:"K2RcUv","prima/lib/translate":423}],92:[function(t,e){"use strict";
var i=t("lodash"),s=t("jquery"),o=t("backbone"),n=function(){var t=4,e=["spotify","soundcloud","bandcamp"],n=["spotify","soundcloud"],r={normalizeResults:function(t,e,s){var o={service:t};switch(t){case"spotify":return i.extend(o,{tracks:i.map(i.first(e.tracks,s),function(t){return{primary:t.name,secondary:i.first(t.artists).name,info:t.album.name,href:t.href,id:t.href}})});case"soundcloud":return i.extend(o,{tracks:i.map(i.first(e,s),function(t){return{primary:t.title,secondary:t.user.username,info:null,href:t.permalink_url,id:t.id}})});case"youtube":return i.extend(o,{tracks:i.map(i.first(e.items,s),function(t){return{primary:t.snippet.title,secondary:t.snippet.channelTitle,info:null,href:"https://www.youtube.com/watch?v="+t.id.videoId,id:t.id.videoId}})});default:throw"Invalid service: "+t}},getServiceByUrl:function(t){var e={spotify:/(open\.spotify\.com|spotify)[\/|:](track|album|artist|playlist|user)[\/|:](.*)?([\d\w]{22})$/,soundcloud:/(http|https):\/\/soundcloud\.com\/[^\/]+\/(sets\/)?[^\/]+\/?$/,bandcamp:/(http|https):\/\/(?:([^\/]+\.)\.bandcamp\.com|[^\/]+\.[^\/]+)\/(track|album)\/[^\/]+$/,direct:/[.](mp3)$/i};for(var i in e)if(e[i].test(t))return i;return!1},getData:function(t,o){if(!i.contains(e,o))return!1;var n=s.ajax({url:"/svc/post/get_"+o+"_data",type:"POST",with_form_key:!0,data:{url:t,service:o}});return n.then(i.bind(function(e){e&&!e.error?this.trigger("audioEmbedData:fetched",t,o,e):this.trigger("audioEmbedData:error",t,o,e)},this),i.bind(function(e){this.trigger("audioEmbedData:error",t,o,e)},this))},search:function(e,o,n){var r=n&&n.maxResults&&i.isNumber(n.maxResults)?n.maxResults:t,a=s.ajax({url:"/search_audio",type:"POST",with_form_key:!0,data:{q:o,audio_search_provider:e}});return a.then(i.bind(function(t){this.trigger("searchResults:fetched",this.normalizeResults(e,t,r))},this),i.bind(function(){this.trigger("searchResults:fetched",{service:e,tracks:[]})},this))}};return function(){this.dataServices=e,this.searchServices=n,i.extend(this,o.Events,r)}}();e.exports=n},{backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv"}],93:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/component"),n=t("../utils/dom_stats"),r=t("./embed_data"),a=t("remarkable"),l=new a({html:!0}),h=o.extend({name:"ContentStatsSupport",initialize:function(t){t=t||{},this.model=t.model,this.editor=t.editor,this.dateInitialized=new Date,this.mentionStats={},this.editor&&i.has(this.editor,"mentionSupport")&&this.listenTo(this.editor.mentionSupport,"mention:set",this._onSetMention),this.contentStats=new n({htmlLength:function(t){return t.html().length},textLength:function(t){return t.text().length},textTools:{hr:"hr",h2:"h2",more:function(t){return t.text().match(/\[\[MORE\]\]/gi)||[]},mentions:"a.tumblelog"},embeds:{selector:"figure.tmblr-embed, figure.tmblr-embed-placeholder",attribute:function(t){var e=t.attr("data-provider");return r.isValidEmbedServiceName(e)?e:"unknown"}},images:{selector:"img",attribute:function(t){var e=t.attr("src").match(/.+[.](jpg|jpeg|png|gif)([?]|$)/i);return e&&e.length>1?e[1].toLowerCase():"unknown"}},mentions:this._getPurgedMentionStats.bind(this)})},_onSetMention:function(t,e){i.has(t,"name")&&i.has(e,"len")&&!i.has(this.mentionStats,t.name)&&(this.mentionStats[t.name]=e.len,this.mentionStats=this._getPurgedMentionStats(this.getContent()))},_getPurgedMentionStats:function(t){return i.pick(this.mentionStats,i.map(t.find("a.tumblelog"),s.text))},getContent:function(){var t,e=s("<div />");return this.model&&this.model.editorField?(t=this.model.getAttributeFromGeneric(this.model.editorField),"markdown"===this.model.get("editorType")&&(t=l.render(t)),e.html(t)):e},getStats:function(){var t=this.getContent(),e={elapsed:parseInt((new Date-this.dateInitialized)/1e3,10)};return i.extend(e,this.contentStats.parse(t)),e}});e.exports=h},{"../utils/dom_stats":151,"./embed_data":94,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,remarkable:"tJkXfs"}],94:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=2e3,r=t("prima/class"),n=2e3,a=function(t,e,i){this.name="EmbedError",this.message=t,this.input=e,this.data=i,this.stack=(new Error).stack};a.prototype=new Error;var l=r.extend({constructor:function(t){this.setEmbedRegexes(t||[])},setEmbedRegexes:function(t){this.regexes=t,this.services=i.unique(i.values(t))},isValidEmbedService:function(t){return i.any(this.regexes,function(e,i){return new RegExp(i,"mi").test(t)})},isValidEmbedServiceName:function(t){return i.contains(this.services,t)},getUrlFromEmbedCode:function(t){var e=s("<div/>").append(t),i=e.find("iframe[src], embed[src], script[src]").first(),o=e.find("object[data]").first();return i.attr("src")||o.attr("data")||!1},fetchEmbedData:function(t,e,r){var l=s.ajax({url:"/svc/post/get_video_data",type:"POST",with_form_key:!0,data:JSON.stringify({embed_url:t,embed_width:e})});return o(l).then(function(s){if(i.isEmpty(s)||"false"===s)throw new a("Invalid embed response",t,s);if(s.thumbnail||r)return s;var l=i.bind(this.fetchEmbedData,this,t,e,!0);return o.promise(function(){i.delay(function(){l().then(function(t){return t},function(){return s})},n)})}).catch(function(t){return o.reject(t)})},parseEmbedData:function(t,e){if(!i.isString(t))throw"The input is invalid. Expected a string";var s=i.trim(t);if(this.isValidEmbedService(s))return this.fetchEmbedData(s,e);var n=this.getUrlFromEmbedCode(s);return i.isEmpty(n)?o.reject(new a("Invalid embed code",t)):o.resolve({unsupported:!0,thumbnail:!1,embed_render_context:"blank",url:n,preview_iframe:"",embed_code:t})}});e.exports=new l},{jquery:"HlZQrA",lodash:"K2RcUv","prima/class":393,when:"RG2dij"}],95:[function(t,e){"use strict";var i=(t("lodash"),t("jquery")),s=function(){return{uploadImageUrl:function(t,e,s,o){var n=i.ajax({url:"/svc/post/upload_image_url",type:"POST",with_form_key:!0,data:{url:t}});return"function"==typeof e&&n.done(function(i){e.call(null,i,t)}),"function"==typeof s&&n.fail(s),"function"==typeof s&&n.always(o),n}}}();e.exports=s},{jquery:"HlZQrA",lodash:"K2RcUv"}],96:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("backbone"),n=t("../views/inline_embed_field"),r=t("../services/embed_data"),a=(t("prima/lib/logger"),t("prima/lib/translate")),l=t("../utils/camelize_keys"),h="tmblr-embed",d="tmblr-embed-placeholder",c="embed_iframe",u=function(){var t={trayOpened:function(){this.checkLimit(),this.inlineEmbedField.hide()},trayClosed:function(){this.inlineEmbedField.hide()},disable:function(){var t=this.$inlineEmbedButton.attr("data-disabled-title");this.isDisabled=!0,this.$inlineEmbedButton.addClass("disabled").attr("title",t).attr("tabindex","-1")},enable:function(){var t=this.$inlineEmbedButton.attr("data-enabled-title");this.isDisabled=!1,this.$inlineEmbedButton.removeClass("disabled").attr("title",t).attr("tabindex","0")},checkLimit:function(){this.isAtLimit()?this.disable():this.enable()},isAtLimit:function(){var t=s(this.editor.element).find("figure."+h+", figure."+d);return t.length>=this.inlineEmbedsPerPost},calculateWidth:function(){var t=s(this.editor.element),e=t.width(),i=t.offset(),o=this.editor.inlineControls.tray,n=o.offset();return e-(n.left-i.left)},returnFocus:function(){if(this.editorView.inlineControlNode){var t=document.createRange(),e=window.getSelection();t.setStart(this.editorView.inlineControlNode,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t)}this.getButton().focus()},insertEmbed:function(t){if(this.editor.inlineControls.isTrayOpen){var e={"class":d,"data-provider":encodeURIComponent(t.service),"data-orig-width":encodeURIComponent(t.widthOrig),"data-orig-height":encodeURIComponent(t.heightOrig),"data-embed-code":encodeURIComponent(t.embedCode)};i.isEmpty(t.url)||(e["data-url"]=encodeURIComponent(t.url));var s=this._buildEmbedFigure(e,t.previewIframe),o=s.get(0);this.editor.insertMedia(o,!1,this.editorView.inlineControlNode,0),this.editor.inlineControls.close(),this.checkLimit()}},submitEmbedCode:function(){var t=i.trim(this.inlineEmbedField.getCurrentValue()||"");if(""===t)return void this.inlineEmbedField._set_field_state_default();var e=this.editorView?this.editorView.get("inlineMediaWidthFull")||500:500,s=this.embedCodeParser(t,e);return s?void s.then(i.bind(function(e){return this.inlineEmbedField.set("embedCode",t),e&&e.embed_render_context&&"inline"===e.embed_render_context?(this.inlineEmbedField._set_field_state_default(),e=l(e),void this.insertEmbed(e)):void this.inlineEmbedField._set_field_state_invalid()},this),function(e){this.inlineEmbedField.set("embedCode",t),this.inlineEmbedField._set_field_state_invalid()}):(this.inlineEmbedField._set_field_state_invalid(),void this.inlineEmbedField.set("embedCode",t))},embedCodeParser:function(t,e){if(this._embedCodeParsing&&this._embedCodeParsing.abortEmbedCodeParse(),!i.isEmpty(i.trim(t))){var s=!1,o=this._parseEmbedCode=r.parseEmbedData(t,e).then(i.bind(function(t){return t},this),function(t){return!1});return o.abortEmbedCodeParse=function(){s=!0},o}},removeEmbedPlaceholders:function(t){var e=document.createElement("div");e.innerHTML=t;var o=function(t){return i.isEmpty(t)?!1:decodeURIComponent(t)};return s(e).find("figure."+d).each(i.bind(function(t,e){var i=s(e),n=o(i.attr("data-embed-code")),r=i.attr("data-url"),a={"class":h,"data-provider":i.attr("data-provider"),"data-orig-width":i.attr("data-orig-width"),"data-orig-height":i.attr("data-orig-height")};if(r&&(a["data-url"]=r),o(a["data-provider"])&&o(a["data-orig-width"])&&o(a["data-orig-height"])&&n){var l=this._buildEmbedFigure(a,n);i.replaceWith(l)}else i.remove()},this)),e.innerHTML},addEmbedPlaceholders:function(t){var e=this.editorView.hosts.safe_host+"/svc/embed/inline/",o=document.createElement("div");o.innerHTML=t;var n=function(t){return i.isEmpty(t)?!1:decodeURIComponent(t)};return s(o).find("figure."+h).each(i.bind(function(t,i){var o=s(i),r=o.parents(),a=r&&s(r).filter("blockquote").length>0;if(t<this.inlineEmbedsPerPost){var l={code:o.html(),provider:n(o.attr("data-provider")),url:n(o.attr("data-url")),width:n(o.attr("data-orig-width")),height:n(o.attr("data-orig-height"))},h=this.editorView.get(a?"inlineMediaWidthReblog":"inlineMediaWidthFull"),u=Math.ceil(l.height*h/l.width),p=e+encodeURIComponent(l.url?l.url:l.code);p+="?w="+h+"&h="+u;var m={"class":c,src:p,scrolling:"no",frameBorder:"0",allowfullscreen:!0,mozallowfullscreen:!0,webkitallowfullscreen:!0},g=s("<iframe/>",m);g.attr("width",h),g.attr("height",u);var f=document.createElement("div");f.appendChild(g.get(0).cloneNode(!0));var _=f.innerHTML,v={"class":d,"data-provider":o.attr("data-provider"),"data-orig-width":o.attr("data-orig-width"),"data-orig-height":o.attr("data-orig-height"),"data-embed-code":encodeURIComponent(l.code)};o.attr("data-url")&&(v["data-url"]=o.attr("data-url"));var b=this._buildEmbedFigure(v,_);o.replaceWith(b)}else o.remove()},this)),this.checkLimit(),o.innerHTML},_buildEmbedFigure:function(t,e){var i=s("<figure/>",t);return e&&i.html(e),i},getButton:function(){return this.$inlineEmbedButton},prompt:function(){this.checkLimit(),this.isDisabled||(this.inlineEmbedField.show(),this.trigger("prompt"))}},e=function(e){var r;e=e||{},i.extend(this,o.Events,t),this.editorView=e.editorView,this.editor=e.editor,this.inlineEmbedsPerPost=e.inlineEmbedsPerPost,this.editorView&&this.editor&&(this.$inlineEmbedButton=s("<div />",{"class":"control add-inline-embed",tabindex:"0",title:e.title,"data-enabled-title":e.title,"data-disabled-title":e.disabledTitle}),this.inlineEmbedField=this.editorView.subViews.inlineEmbedField=new n({placeholder:a("Paste a video URL"),submitEmbedCode:i.bind(this.submitEmbedCode,this),calculateWidth:i.bind(this.calculateWidth,this),returnFocus:i.bind(this.returnFocus,this)}),this.inlineEmbedsPerPost>0&&(r=s("<div/>",{"data-subview":"inlineEmbedField"}),this.editor.inlineControls.addToTray(this.$inlineEmbedButton,e.trayOptions),this.editor.inlineControls.addToTray(r.get(0))),this.$inlineEmbedButton.on("click",this.prompt.bind(this)),this.isDisabled=this.isAtLimit())};return e}();e.exports=u},{"../services/embed_data":94,"../utils/camelize_keys":150,"../views/inline_embed_field":169,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/logger":403,"prima/lib/translate":423}],97:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/events"),n=t("ligature").SelectionContext,r=t("backbone"),a=function(){var t=function(){},e={rangeDebounce:10},a={enterMention:function(e){this.currentMention=e,this.inMention=!0,this.renderGhost(e),this.dropdown.setPinnedTarget(this.editor.element),this.updatePopoverPosition(e),this.trigger("mention:enter"),t("MentionSupport:enterMention - querying server for [%s]",e.string),this.queryServer(e.string)},updateMention:function(e){if(this.inMention&&e.string!==this.currentMention.string){if(!this.isSameMention(e))return this.exitMention(e),void this.enterMention(e);this.currentMention=e,this.inMention=!0,this.renderGhost(e),this.trigger("mention:update"),t("MentionSupport:updateMention - querying server for [%s]",e.string),this.queryServer(e.string)}},exitMention:function(){this.currentMention=!1,this.inMention=!1,this.lastTypeahead="",this.teardownGhost(),this.editor.onChange(),this.trigger("mention:exit")},softConfirm:function(t){var e=h();e.caretPosition===e.offsetEnd&&this.confirmMention(t)},spaceConfirm:function(t){var e=h(),i=this.dropdown.getCurrentBlogChoice();i&&i.name===e.string&&this.confirmMention(t,i)},confirmMention:function(t,e){e=e||this.dropdown.getCurrentBlogChoice(),e&&this.setMention(e)},setMention:function(t){var e=this.lastInfo,i=t.name,s=document.createTextNode("​"),o=document.createElement("a"),n=this.lastSelection;o.setAttribute("class","tumblelog"),o.spellcheck=!1,o.innerHTML=i,e.mentionRange.deleteContents(),e.mentionRange.insertNode(s),e.mentionRange.insertNode(o),e.mentionRange.setStartAfter(s),e.mentionRange.setEndAfter(s),n.removeAllRanges(),n.addRange(e.mentionRange),this.exitMention(e),this.trigger("mention:set",t,e)},linkToMention:function(e){var i,o,r,a=n.getSelection(),l=e.range.commonAncestorContainer.parentElement||s(e.range.commonAncestorContainer).parent().get(0);return this.currentMention!==!1&&this.exitMention(e),l.classList.contains("tumblelog")?(i=document.createRange(),i.selectNode(l),i.deleteContents(),o=document.createTextNode("@"+e.string),i.insertNode(o),r=document.createRange(),a.removeAllRanges(),r.setStart(o,e.caretPosition+1),r.setEnd(o,e.caretPosition+1),a.addRange(r),this.cleanupRangeArea(a,r),t("MentionSupport:linkToMention",e.string),void this.onSelection(a)):!1},abortMention:function(){this.escapeMention=h(),this.inMention&&this.exitMention(this.escapeMention)},isSameMention:function(t){return this.currentMention&&this.currentMention.offsetStart===t.offsetStart},isMentionLink:function(t){var e,i=document.createElement("div"),o=this.adjustRange(t);return o?(i.appendChild(o.cloneContents()),e=s(i).find("a:first"),e.length?e.hasClass("tumblelog"):!1):!1},cleanupRangeArea:function(t,e){var i,o,n=document.createElement("span");n.setAttribute("id","mention_cleanup_placeholder"),n.innerHTML="",e.insertNode(n),this.normalize(t,e),i=e.commonAncestorContainer.parentElement,i||(i=s(e.commonAncestorContainer).parent().get(0)),i.normalize(),1===s(i).length&&(o=s(i).html(),o=o.replace(/[\u200B]/g,""),s(i).html(o));var r=s(document).find("#mention_cleanup_placeholder");r.length>0&&(t.removeAllRanges(),e.selectNode(r.get(0)),e.deleteContents(),t.addRange(e),i.normalize())},adjustRange:function(t){var e,s;return i.isUndefined(t)?!1:(t=t.cloneRange(),e=t.commonAncestorContainer,s=3===e.nodeType?e.parentNode:e,s.textContent===t.toString()&&t.selectNode(s),t)},normalize:function(t,e){this.editor.element.normalize(),null===t||i.isUndefined(e)||(t.removeAllRanges(),t.addRange(e))},renderGhost:function(t){if(this.$ghost=s(document).find("#ui_mention_util_ghost"),!(this.$ghost.length>0)){var e=document.createElement("q");e.setAttribute("id","ui_mention_util_ghost"),e.innerHTML="&#8203;",e.className="mention-ghost",t.suffixRange.surroundContents(e),this.$ghost=s(document).find("#ui_mention_util_ghost"),this.trigger("ghost:render",this.$ghost)}},updatePopoverPosition:function(t){if(i.has(t,"range")){var e=this.getMentionRect(t),o=s(this.editor.element).offset(),n=s(window).scrollTop();this.dropdown.setShift({x:e.left-o.left-10,y:-(e.bottom-o.top+n+10)})}},teardownGhost:function(t){if(t&&t.range||(t=this.lastInfo),this.$ghost=s(document).find("#ui_mention_util_ghost"),0!==this.$ghost.length){var e=this.$ghost.parent().get(0),i=t.caretRange.commonAncestorContainer,o=n.getSelection(0),r=o?o.getRangeAt(0):!1;o&&"ui_mention_util_ghost"===s(i).attr("id")&&(r.selectNode(i),r.deleteContents(),r.collapse(!1)),this.$ghost=s(document).find("#ui_mention_util_ghost"),1===this.$ghost.length&&(this.$ghost.remove(),this.trigger("ghost:teardown")),e&&e.normalize(),o&&r&&(o.removeAllRanges(),o.addRange(r))}},insertGhost:function(t){var e=n.getSelection(0),o=e.getRangeAt(0);this.$ghost=s(document).find("#ui_mention_util_ghost"),0!==this.$ghost.length&&(this.$ghost.html(t),null===e||i.isUndefined(o)||(e.removeAllRanges(),e.addRange(o)))},maintainTypeaheadGhost:function(e,i){var s=this.dropdown.getBlogChoice(0),o=s?s.name:this.lastTypeahead;if(t("MentionSupport:maintainGhost - topSuggestion = %s, typeahead = %s, lastChar = %s",s,o,i),i&&this.lastTypeahead.length&&i===this.$ghost.text().substr(0,1))this.$ghost.text(this.$ghost.text().substr(1));else if(e&&8===e.keyCode){var n=o.substr(this.lastTypeahead.length-this.$ghost.text().length-1);t("MentionSupport:maintainGhost BACKSPACE"),this.$ghost.text(n)}else this.updateTypeahead(o);this.updatePopoverPosition(h())},stripGhost:function(t){if(!t)return t;var e=s("<span>"+t+"</span>");return e.find("#ui_mention_util_ghost").remove(),e.html()},updateTypeahead:function(e){var i=this.currentMention;if(t("MentionSupport:updateTypeahead - typeahead = [%s]",e),this.lastTypeahead=e,!i||!this.inMention||!e)return void this.teardownGhost();var s="";i=i.string;var o=i.toUpperCase(),n=e.toUpperCase();e.length>i.length&&o===n.substr(0,o.length)&&(s=e.substr(i.length,e.length-i.length)),this.insertGhost(s)},updateForInteractive:function(t){var e=this.dropdown.getCurrentBlogChoice();t&&e&&this.updateTypeahead(e.name)},bindEditorCallbacks:function(){this.editor.config.onSelection=i.bind(this.onSelection,this);var t=this.editor.config.onClientEvent||i.noop;this.editor.config.onClientEvent=i.bind(function(e){t(e),this.onClientEvent(e)},this)},setupListeners:function(){this.dropdown.listenTo(this,"editor:cycleUp",this.dropdown.cycleUp),this.dropdown.listenTo(this,"editor:cycleDown",this.dropdown.cycleDown),this.listenTo(this,"editor:abortMention",this.abortMention),this.listenTo(this,"editor:softConfirm",this.softConfirm),this.listenTo(this,"editor:spaceConfirm",this.spaceConfirm),this.listenTo(this,"editor:confirm",this.confirmMention),this.listenTo(this.dropdown,"dropdown:confirm",this.confirmMention),this.dropdown.listenTo(this,"ghost:render",this.dropdown.setPinnedTarget),this.dropdown.listenTo(this,"mention:exit",this.dropdown.teardown),this.listenTo(this.dropdown,"dropdown:render",this.maintainTypeaheadGhost),this.listenTo(this.dropdown,"dropdown:empty",this.exitMention),this.listenTo(this.dropdown,"dropdown:menuInteraction",this.updateForInteractive)},queryServer:function(t){var e={query:t,success:i.bind(this.dropdown.updateMentionDropdown,this.dropdown)};this.mentionModel.fetch(e)},getMentionRect:function(t){if(!(t&&t.range&&"getClientRects"in t.range))return!1;var e=t.range.getClientRects();return i.isUndefined(e[0])?!1:e[0]}},l=function(e,s){i.extend(this,r.Events,a),this.editor=e,this.dropdown=s,this.mentionModel=s.model,this.inMention=!1,this.currentMention=!1,this.escapeMention=!1,this.lastInfo=!1,this.lastSelection=!1,this.$ghost=!1,this.lastTypeahead="",this.debugMode=!1,this.bindEditorCallbacks(),this.setupListeners(),t=i.bind(t,this)},h=function(t){t=t||n.getSelection();var e=function(t){return/[^\-a-z0-9]/i.test(t)},s={isMention:!1,len:0,string:"",stringBefore:"",stringAfter:"",range:!1,mentionRange:!1,suffixRange:!1,caretRange:!1,offsetStart:!1,offsetEnd:!1,caretPosition:!1,caretNode:!1};if(s.caretRange=t&&t.rangeCount>0?t.getRangeAt(0):!1,s.caretRange===!1||s.caretRange.startOffset!==s.caretRange.endOffset)return!1;var o=s.caretRange.commonAncestorContainer;o.normalize(),s.caretNode=1===o.nodeType?o.firstChild:o;var r=null==s.caretNode?"":s.caretNode.nodeValue;if(s.caretPosition=s.caretRange.startOffset,null==r||0===r.length)return!1;for(var a=0,l=0;l<s.caretPosition;l++)e(r.charAt(l))?a=0:a++;s.stringBefore=r.substr(s.caretPosition-a,a);var h=!1;if(s.caretPosition-(a+2)>=0){h=r.substr(s.caretPosition-a-1,1);var d=r.substr(s.caretPosition-a-2,1);i.contains([32,160],d.charCodeAt(0))||(h=!1)}else s.caretPosition-(a+1)>=0&&(h=r.substr(s.caretPosition-a-1,1));for(s.isMention="@"===h,a=0,l=s.caretPosition;l<r.length&&!e(r.charAt(l));l++)a++;return s.stringAfter=r.substr(s.caretPosition,a),s.string=s.stringBefore+s.stringAfter,s.len=s.string.length,s.isMention||0!==s.len&&""!==s.string?(s.range=document.createRange(),s.offsetStart=s.caretRange.startOffset-s.stringBefore.length,s.offsetEnd=s.caretRange.startOffset+s.stringAfter.length,s.range.setStart(s.caretNode,s.offsetStart),s.range.setEnd(s.caretNode,s.offsetEnd),s.isMention?(s.mentionRange=document.createRange(),s.mentionRange.setStart(s.caretNode,s.offsetStart-1),s.mentionRange.setEnd(s.caretNode,s.offsetEnd),s.suffixRange=document.createRange(),s.suffixRange.setStart(s.caretNode,s.caretRange.startOffset+s.stringAfter.length),s.suffixRange.setEnd(s.caretNode,s.caretRange.startOffset+s.stringAfter.length),s):s):!1},d={keydown:{27:"editor:abortMention",38:"editor:cycleUp",40:"editor:cycleDown",39:"editor:softConfirm",32:"editor:spaceConfirm",9:"editor:confirm",13:"editor:confirm"}};return l.prototype.onClientEvent=function(t){o.trigger("richTextEditor:onClientEvent",t,this.editor);var e,i=["keyup","keydown","keypress"];if(this.inMention&&-1!==i.indexOf(t.type)){if(t=t||window.event,e=t.which||t.keyCode,"keydown"===t.type)e in d[t.type]?(this.trigger(d[t.type][e],t),39!==e&&32!==e&&(t.preventDefault(),t.stopImmediatePropagation())):8===e&&this.maintainTypeaheadGhost(t);else if("keyup"===t.type){if(e in d.keydown)return!1}else this.maintainTypeaheadGhost(t,String.fromCharCode(e));var s=h();s&&(this.lastInfo=s)}},l.prototype.onSelection=i.debounce(function(t){var e=h(t);e?(this.escapeMention&&(this.escapeMention.string===e.string?e.isMention=!1:this.escapeMention=!1),this.lastInfo=e,this.lastSelection=t):this.escapeMention=!1,e&&e.isMention===!0?this.inMention&&this.isSameMention(e)?this.updateMention(e):this.enterMention(e):this.inMention?this.exitMention(e):e&&this.isMentionLink(e.range)&&this.linkToMention(e)},e.rangeDebounce),l}();e.exports=a},{backbone:"5kFNoY",jquery:"HlZQrA",ligature:471,lodash:"K2RcUv","prima/events":396}],98:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/class"),n=o.extend({fetchOpenGraphData:function(t){var e=s.ajax({url:"/svc/post/fetch_og",type:"POST",with_form_key:!0,data:{url:t}});return e.then(function(e){var o=s.parseJSON(e)||{};return i.extend({url:t},o.response)})}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","prima/class":393}],99:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=function(){var t=function(t){if(!i.trim(t.html||""))return i.isFunction(t.done)&&t.done(""),void(i.isFunction(t.always)&&t.always(""));var e=s.ajax({url:"/svc/filter_html_for_dash_preview",type:"POST",with_form_key:!0,data:{html:t.html||"",markdown:t.isMarkdown?1:0}});return i.isFunction(t.done)&&e.done(t.done),i.isFunction(t.fail)&&e.fail(t.fail),i.isFunction(t.always)&&e.always(t.always),e};return{filterForDash:function(e,i,s,o,n){return t({html:e,isMarkdown:i,done:s,fail:o,always:n})},filterHtmlForDash:function(e,i,s,o){return t({html:e,isMarkdown:!1,done:i,fail:s,always:o})},filterMarkdownForDash:function(e,i,s,o){return t({html:e,isMarkdown:!0,done:i,fail:s,always:o})}}};e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],100:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="album-art--container"><div data-js-albumart class="album-art" style="'+(null==(__t=url?"background-image:url("+url+");":"")?"":_.escape(__t))+'"></div><div data-js-removebutton class="album-art--remove-button"><div class="v-center-outer"><div class="v-center-inner"><span data-js-removebuttontext>'+(null==(__t=__("Remove image"))?"":_.escape(__t))+'</span></div></div></div></div><div data-js-dropzone class="media-dropzone"><div data-js-mediaupload class="media-upload-button"><div class="v-center-outer"><div class="v-center-inner"><div class="dropzone-title"><span data-js-mediauploadtext class="dropzone-text">'+(null==(__t=dropzoneText)?"":_.escape(__t))+'</span></div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],101:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<label class="binary_switch"><input type="checkbox" id="allowAnswers" type="checkbox" data-js-allowanswerscheckbox> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label class="allow-answers-label" for="allowAnswers">'+(null==(__t=__("Let people answer this"))?"":_.escape(__t))+"</label>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],102:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="note_wrapper" data-name="askField"><div class="note_item"><div class="text"><p class="asker"><span class="name">'+(null==(__t=post.asking_tumblelog.name.toLowerCase())?"":_.escape(__t))+"</span> <span>"+(null==(__t=__("asked"))?"":_.escape(__t))+':</span></p><p class="note_text">'+(null==(__t=post.ask)?"":__t)+'</p></div><div class="nipple"></div></div><div class="avatar"><img src="'+(null==(__t=post.asking_tumblelog.avatar)?"":_.escape(__t))+'" alt="" width="40" height="40"></div></div>',showAnswerField&&(__p+='<div class="note_wrapper" data-name="answerField"><div class="note_item"><div class="text"><p class="answerer"><span class="name">'+(null==(__t=post.answering_tumblelog.name.toLowerCase())?"":_.escape(__t))+"</span> <span>"+(null==(__t=__("answered"))?"":_.escape(__t))+":</span></p>"+(null==(__t=post.answer)?"":__t)+'</div><div class="nipple"></div></div><div class="avatar"><img src="'+(null==(__t=post.answering_tumblelog.avatar)?"":_.escape(__t))+'" alt="" width="40" height="40"></div></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],103:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="media-dropzone" data-js-dropzone><div class="media-upload-button" data-js-mediaupload><div class="v-center-outer"><div class="v-center-inner"><div class="dropzone-icon '+(null==(__t=uploadIcon)?"":_.escape(__t))+'"></div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],104:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="channel-avatar avatar-container"><a class="avatar-link" href="'+(null==(__t=channel.url)?"":_.escape(__t))+'" target="_blank" title="'+(null==(__t=channel.directory_safe_title||channel.title||channel.name)?"":_.escape(__t))+'" style="background-image: url(\''+(null==(__t=avatarUrl)?"":_.escape(__t))+'\')"><img class="avatar-image" src="'+(null==(__t=avatarUrl)?"":_.escape(__t))+'" alt="'+(null==(__t=channel.name)?"":_.escape(__t))+'"></a></div><div class="primary-avatar avatar-container"><a class="avatar-link" href="'+(null==(__t=primary.url)?"":_.escape(__t))+'" target="_blank" title="'+(null==(__t=primary.directory_safe_title||primary.title||primary.name)?"":_.escape(__t))+'" style="background-image: url(\''+(null==(__t=subavatarUrl)?"":_.escape(__t))+'\')"><img class="avatar-image" src="'+(null==(__t=subavatarUrl)?"":_.escape(__t))+'" alt="'+(null==(__t=primary.name)?"":_.escape(__t))+'"></a></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],105:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<label class="confirm-tos--label" data-name="confirm-tos"><div class="binary_switch"><input class="confirm-tos--checkbox" type="checkbox" name="confirm_tos" data-js-confirmtos> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></div><span class="confirm-tos--text">'+(null==(__t=__("This is my original work, or I %1$shave permission%2$s to post this.",'<a href="/terms-of-service" target="_blank">',"</a>"))?"":__t)+"</span></label>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],106:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="html-mode"><div class="tabs clearfix"><div class="tab src-button" data-js-srcbutton><span class="icon '+(null==(__t=isMarkdown?"markdown":"html")?"":_.escape(__t))+'" data-js-srcicon></span> <span class="tab-label" data-js-srclabel>'+(null==(__t=srcLabel)?"":_.escape(__t))+'</span></div><div class="tab preview-button" data-js-previewbutton><span class="icon"></span> <span class="tab-label" data-js-previewlabel>'+(null==(__t=previewLabel)?"":_.escape(__t))+'</span></div><div class="tab tooltip-container"><span class="icon" data-js-editorhelp></span></div></div><div class="views"><div class="view src-view" data-js-srcview><div data-js-ace></div></div><div class="view preview-view" data-js-previewview><div class="html-preview editor" data-js-htmlpreview></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],107:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",_.forEach(id3Fields,function(t,e){__p+='<div class="id3-editor--container '+(null==(__t=id3FieldLabel[e]?"id3-editor--"+id3FieldLabel[e].toLowerCase():"")?"":_.escape(__t))+'"><input name="'+(null==(__t=e)?"":_.escape(__t))+'" value="'+(null==(__t=t)?"":_.escape(__t))+'" class="id3-editor--input" type="text"><label class="id3-editor--label">'+(null==(__t=id3FieldLabel[e]||__(_.capitalize(e)))?"":_.escape(__t))+"</label></div>"}),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],108:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="inline-embed-field" data-name="inlineEmbedField"><div data-subview="inlineEmbedInput"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],109:[function(require,module,exports){var _=require("lodash");
module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="","spotify"===service&&(__p+='<iframe data-js-audioembed src="https://embed.spotify.com/?uri='+(null==(__t=encodeURIComponent(url))?"":_.escape(__t))+'&amp;view=coverart" width="500" height="580" frameborder="0" allowtransparency="true" scrolling="no" class="audio-embed--spotify"></iframe>'),__p+="","soundcloud"===service&&(__p+='<iframe data-js-audioembed src="https://w.soundcloud.com/player/?url='+(null==(__t=encodeURIComponent(url))?"":_.escape(__t))+'&amp;visual=true&amp;liking=false&amp;sharing=false&amp;auto_play=false&amp;show_comments=false&amp;continuous_play=false&amp;origin=tumblr" frameborder="0" allowtransparency="true" scrolling="no" width="500" height="500" class="audio-embed--soundcloud"></iframe>'),__p+="","bandcamp"===service&&(__p+='<iframe data-js-audioembed src="https://bandcamp.com/EmbeddedPlayer/size=medium/bgcol=ffffff/linkcol=0687f5/notracklist=true/transparent=true/'+(null==(__t=type)?"":_.escape(__t))+"="+(null==(__t=id)?"":_.escape(__t))+'/" frameborder="0" allowtransparency="true" scrolling="no" width="500" height="120" class="audio-embed--bandcamp"></iframe>'),__p+="","direct"===service&&(__p+='<div data-js-audioembed class="audio-embed--direct '+(null==(__t=canEditMedia?"audio-embed--direct-editable":"")?"":_.escape(__t))+'"><div data-subview="audioPlayer"></div><div data-subview="id3Editor"></div><div data-subview="albumArtUploader"></div></div>'),__p+="",canEditMedia&&(__p+='<div data-subview="removeButton"></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],110:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-sortable class="photoset--photo-dragger"></div><div data-js-mediaoverlay class="media-overlay"><div data-js-clickthroughurlbutton class="overlay-button '+(null==(__t=hasClickthroughUrl?"active":"")?"":_.escape(__t))+'"><div class="icon icon_editor_link"></div></div><div data-js-captionbutton class="overlay-button '+(null==(__t=hasCaption?"active":"")?"":_.escape(__t))+'"><div class="icon icon_editor_more"></div></div></div><div data-subview="removeButton"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],111:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="photobooth-container" data-js-photobooth></div><div class="photoset-container" data-js-photoset></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],112:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="video-container" data-js-video></div>',canEditMedia&&(__p+='<div data-subview="removeButton"></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],113:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="","inline"===embedRenderContext?__p+='<div class="video-preview">'+(null==(__t=previewIframe)?"":__t)+"</div>":(__p+='<div class="video-preview video_preview '+(null==(__t=thumbnail&&thumbnail.url?"":"no_thumbnail")?"":_.escape(__t))+'">',thumbnail&&thumbnail.url&&(__p+='<img src="'+(null==(__t=thumbnail.url)?"":_.escape(__t))+'" alt="" width="'+(null==(__t=thumbnail.width||"")?"":_.escape(__t))+'" height="'+(null==(__t=thumbnail.height||"")?"":_.escape(__t))+'">'),__p+='<div class="video_info_wrapper"><i class="icon_post_video"></i><div class="video_text"><span class="clippable">'+(null==(__t=__("Watch on %s",tumblelogHostname))?"":_.escape(__t))+'</span> <i class="icon_arrow_carrot_right"></i></div></div></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],114:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="video-error"><div class="v-center-outer"><div class="v-center-inner"><span class="icon"></span> <span class="error-message">'+(null==(__t=__("This video embed stopped working. Try another?"))?"":_.escape(__t))+"</span></div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],115:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="media-preview"><div class="v-center-outer"><div class="v-center-inner"><div class="icon '+(null==(__t=icon)?"":_.escape(__t))+'" data-js-previewicon></div><p class="media-preview-text" data-js-previewmessage>'+(null==(__t=message)?"":_.escape(__t))+"</p></div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],116:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";var dropzoneClasses=[];showInput&&dropzoneClasses.push("show-input"),splitDropzone&&dropzoneClasses.push("split-dropzone"),toggleDropzone&&dropzoneClasses.push("toggle-dropzone"),defaultBehavior&&dropzoneClasses.push("toggle-dropzone-"+defaultBehavior),__p+='<div class="media-dropzone '+(null==(__t=dropzoneClasses.join(" "))?"":_.escape(__t))+'" data-js-dropzone><div class="split-cells">',enableUpload&&(__p+='<div class="split-cell media-upload-button" data-js-mediaupload><div class="split-cell-inner"><div class="v-center-outer"><div class="v-center-inner">',uploadIcon&&(__p+='<div class="dropzone-icon '+(null==(__t=uploadIcon)?"":_.escape(__t))+'"></div>'),__p+="",uploadText&&(__p+='<div class="dropzone-title"><span class="dropzone-text" data-js-mediauploadtext>'+(null==(__t=toggleDropzone?dropzoneText:uploadText)?"":_.escape(__t))+"</span>",uploadTooltip&&(__p+='<div class="dropzone-tooltip" data-js-uploadtooltip><span class="icon icon_help" data-show-tooltip="uploadTooltip"></span></div>'),__p+="</div>"),__p+='</div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div>'),__p+="",enableUrl&&(__p+='<div class="split-cell media-url-button" data-js-mediaurl><div class="split-cell-inner"><div class="v-center-outer"><div class="v-center-inner">',urlIcon&&(__p+='<div class="dropzone-icon '+(null==(__t=urlIcon)?"":_.escape(__t))+'"></div>'),__p+="",urlText&&(__p+='<div class="dropzone-title"><span class="dropzone-text" data-js-mediaurltext>'+(null==(__t=toggleDropzone?dropzoneText:urlText)?"":_.escape(__t))+"</span>",urlTooltip&&(__p+='<div class="dropzone-tooltip" data-js-urltooltip><span class="icon icon_help" data-show-tooltip="urlTooltip"></span></div>'),__p+="</div>"),__p+='</div></div></div><div class="media-url-cropper media-dropzone-cropper"><div class="media-url"><div class="v-center-outer"><div class="v-center-inner"><div data-subview="urlInput"></div></div></div></div></div><div data-subview="removeButton"></div></div>'),__p+="</div></div>"}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],117:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner">',_.each(blogs,function(t,e){__p+="";var i=t.name.replace(queryRegex,"<u>$&</u>");__p+='<div id="mention_'+(null==(__t=e)?"":_.escape(__t))+'" class="item-option" data-tumblelog="'+(null==(__t=t.name)?"":_.escape(__t))+'"><div class="blog-info"><span class="blog-name">'+(null==(__t=i)?"":__t)+'</span> <span class="blog-title">'+(null==(__t=t.title)?"":_.escape(__t))+'</span></div><span class="blog-thumb" style="background-image:url(\''+(null==(__t=t.avatar_url)?"":_.escape(__t))+"')\"></span></div>"}),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],118:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="overlay-button-popover" data-js-popover><input data-js-input type="text" value="'+(null==(__t=value)?"":_.escape(__t))+'" placeholder="'+(null==(__t=placeholder)?"":_.escape(__t))+'" maxlength="'+(null==(__t=maxLength)?"":_.escape(__t))+'" class="input-field"><div data-js-confirm class="input-confirm">'+(null==(__t=confirmText)?"":_.escape(__t))+"</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],119:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="editor editor-plaintext" contenteditable="true" data-js-plaintexteditor></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],120:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="post-margin" data-js-margin><div data-subview="avatar"></div></div><div class="post-container" data-js-container-outer><div class="post-container-inner post" data-js-container-inner><div class="post-form--header post-header clearfix" data-js-header><div class="controls-container"><div class="control left"><div data-subview="tumblelogSelect"></div></div><div class="control right"><div data-subview="uploadingIndicator"></div>',showReblogAs&&(__p+='<div data-subview="reblogAsButton"></div>'),__p+='<div data-subview="postSettings"></div></div></div></div><div class="post-form--form post-content"><div data-subview="postTypeForm"></div></div><div class="post-form--footer post-footer" data-js-footer><div data-subview="tagEditor"></div><div data-subview="editorButtons"></div></div><div class="post-form--guard"></div><div class="post-form--bottom" data-js-bottom><div class="post-form--controls" data-js-postformcontrols><div class="controls-container"><div class="control left"><button class="flat-button post-form--close" data-js-clickableclose="">'+(null==(__t=__("Close"))?"":_.escape(__t))+'</button></div><div class="control right"><div data-subview="socialButtons"></div></div><div class="control right"><div data-subview="savePostButton"></div></div></div></div><div data-subview="errorBar"></div></div><div data-subview="allowAnswers"></div><div data-subview="richTextEditorTutorial"></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],121:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<form method="POST" target="_blank" action="'+(null==(__t=action)?"":_.escape(__t))+'">',_.each(inputs,function(t,e){__p+='<input type="hidden" name="'+(null==(__t=e)?"":_.escape(__t))+'" value="'+(null==(__t=t)?"":_.escape(__t))+'">'}),__p+="</form>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],122:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<button class="post-settings" data-js-clickablepostsettingscog><span class="dropdown icon_settings" data-js-postsettingscog></span></button>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],123:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner"><div class="form-horizontal"><div class="form-group"><div class="group-label"><label for="customUrl_input">'+(null==(__t=__("Custom URL"))?"":_.escape(__t))+'</label></div><div class="group-content"><div class="adjacent-content"><label for="customUrl_input" class="prefix" data-js-customurllabel>/post/123/</label><input name="customUrl" id="customUrl_input" class="field crystal" type="text" autocomplete="off" data-js-customurl value="'+(null==(__t=customUrl)?"":__t)+'"></div></div></div><div class="form-group"><div class="group-label"><label for="sourceUrl_input">'+(null==(__t=__("Content source"))?"":_.escape(__t))+'</label></div><div class="group-content"><input id="sourceUrl_input" name="sourceUrl" class="field crystal" type="text" placeholder="http://..." autocomplete="off" data-js-sourceurl value="'+(null==(__t=sourceUrl)?"":__t)+'"></div></div><div class="form-group"><div class="group-label"><label for="postDate_input">'+(null==(__t=__("Post date"))?"":_.escape(__t))+'</label></div><div class="group-content"><input id="postDate_input" name="postDate" class="field crystal" type="text" placeholder="'+(null==(__t=__("Now"))?"":_.escape(__t))+'" autocomplete="off" data-js-postdate value="'+(null==(__t=postDate)?"":__t)+'"></div></div><div class="form-group"><div class="group-label">'+(null==(__t=__("Replies"))?"":_.escape(__t))+'</div><div class="group-content"><div class="checkbox field row"><label class="binary_switch"><input name="allow_photo_replies" type="checkbox" id="allowPhotoReplies" type="checkbox" data-js-allowphotoreplies> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label for="allowPhotoReplies">'+(null==(__t=__("Let people photo reply"))?"":_.escape(__t))+"</label></div></div></div>",showEditorSelection&&(__p+='<div class="form-group"><div class="group-label">'+(null==(__t=__("Text editor"))?"":_.escape(__t))+'</div><div class="group-content"><div class="flat_select field row"><select name="editorType" id="editorType" data-js-editortype><option value="rich">'+(null==(__t=__("Rich text"))?"":_.escape(__t))+'</option><option value="html">'+(null==(__t=__("HTML"))?"":_.escape(__t))+'</option><option value="markdown">'+(null==(__t=__("Markdown"))?"":_.escape(__t))+'</option></select><label for="editorType" class="current_selection">'+(null==(__t=__("Rich text"))?"":__t)+'</label><i class="icon"></i></div></div></div>'),__p+="</div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],124:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="clear-results icon_close '+(null==(__t=0===resultCount?"inactive":"")?"":_.escape(__t))+'"></div><div class="copyright-warning '+(null==(__t=showCopyrightWarning===!1?"inactive":"")?"":_.escape(__t))+'">'+(null==(__t=copyrightWarningMessage)?"":__t)+"</div>",_.each(serviceResults,function(t,e){__p+='<div class="audio-result-set" data-service="'+(null==(__t=e)?"":__t)+'">',_.each(t,function(t){__p+='<div class="result '+(null==(__t="youtube"===e?"video-result":"audio-result")?"":_.escape(__t))+'" data-href="'+(null==(__t=t.href)?"":__t)+'"><span class="primary">'+(null==(__t=t.primary)?"":__t)+'</span><span class="secondary">'+(null==(__t=t.secondary)?"":__t)+'</span> <span class="info">'+(null==(__t=t.info)?"":__t)+"</span></div>"}),__p+="</div>"}),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],125:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-js-mediacomposer class="audio-search-container"><div data-subview="searchField"></div><div data-subview="audioUploader"></div><div data-subview="searchResultList"></div></div></div><div class="caption-wrapper" data-js-tos><div data-subview="confirmTos"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],126:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="title"></div><div data-subview="chat"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],127:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div class="media-container link-media-container"><div class="link-editor" data-js-linkeditor><div class="link-fields"><div data-subview="title"></div><div data-subview="url"></div></div><div class="thumb" data-js-urlimage></div></div>',canEditMedia&&(__p+='<div data-subview="removeButton"></div>'),__p+='</div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],128:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="askField"></div><div data-subview="answerField"></div><div data-subview="reblogTree"></div><div data-subview="caption"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],129:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-subview="mediaComposer"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],130:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="quote"></div><div data-subview="source"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],131:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="title"></div><div data-subview="reblogTree"></div><div data-subview="body"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],132:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-subview="mediaComposer"></div></div><div class="caption-wrapper" data-js-tos><div data-subview="confirmTos"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],133:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="reblog-as-type '+(null==(__t=post.get("type"))?"":_.escape(__t))+'" data-js-reblogselectpin data-js-clickablereblogselect></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],134:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner select-center"><div class="item-option-wrapper"><div class="header-item">'+(null==(__t=__("Reblog as"))?"":_.escape(__t))+"</div>",_.forEach(postReblogAsTypes,function(t,e){__p+='<div class="item-option '+(null==(__t=postType===e?"icon_checkmark":"")?"":_.escape(__t))+'" data-reblog-as-type="'+(null==(__t=e)?"":_.escape(__t))+'">'+(null==(__t=t)?"":_.escape(__t))+"</div>"}),__p+="</div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],135:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",showReblogTree&&(__p+='<div class="control-reblog-tree post"><div class="reblog-tree post_content">'+(null==(__t=post.get("reblog_tree"))?"":__t)+'</div><div data-subview="removeButton"></div><div class="btn-show-tree btn-toggle-reblog">'+(null==(__t=__("Include reblogs"))?"":_.escape(__t))+"</div></div>"),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],136:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="editor editor-richtext" contenteditable="true" data-js-richtexteditor></div><div data-subview="htmlField"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],137:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<h3 class="title">'+(null==(__t=__("Want to style your text?"))?"":_.escape(__t))+'</h3><p class="content">'+(null==(__t=__("Just select it. You'll see."))?"":_.escape(__t))+'</p><button class="blue ok_button flat-button" type="button">'+(null==(__t=__("I see"))?"":_.escape(__t))+"</button>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],138:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="split chrome blue"><div data-subview="loader"></div><button class="flat-button blue caption create_post_button" data-js-clickablesave></button><div class="flat-button blue dropdown options icon_arrow_carrot_down" data-js-clickablesavedropdown></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],139:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><ul class="inner select-left" data-js-options><li class="item-option '+(null==(__t="published"===state?"icon_checkmark":"")?"":__t)+'" data-js-publish><span class="">'+(null==(__t=__("Post now"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="queued"===state?"icon_checkmark":"")?"":__t)+" "+(null==(__t=-1===activeOptions.indexOf("queued")?"hidden":"")?"":__t)+'" data-js-queue><span class="">'+(null==(__t=__("Add to queue"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="draft"===state?"icon_checkmark":"")?"":__t)+" "+(null==(__t=-1===activeOptions.indexOf("draft")?"hidden":"")?"":__t)+'" data-js-draft><span class="">'+(null==(__t=__("Save as draft"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="private"===state?"icon_checkmark":"")?"":__t)+'" data-js-private><span class="">'+(null==(__t=__("Post privately"))?"":_.escape(__t))+'</span></li><li class="item-option '+(null==(__t="scheduled"===state?"icon_checkmark":"")?"":__t)+" "+(null==(__t=-1===activeOptions.indexOf("scheduled")?"hidden":"")?"":__t)+'" data-js-schedule><span class="">'+(null==(__t=__("Schedule"))?"":_.escape(__t))+'</span><br><input class="field square solid" type="text" autocomplete="off" placeholder="Next Tuesday, 10am" data-js-scheduletext></li>',showPreview&&(__p+='<li class="item-option full" data-js-preview><button class="button flat-button">'+(null==(__t=__("Preview on blog"))?"":_.escape(__t))+"</button></li>"),__p+="</ul></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],140:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<ul class="social-buttons"><li data-js-twitter data-service="twitter" data-js-tweetdropdownpin class="social-button twitter '+(null==(__t=twitter?"":"hidden")?"":_.escape(__t))+" "+(null==(__t=twitterOn?"checked":"")?"":_.escape(__t))+'"><label class="social-button--label social-button--twitter" data-js-shareicon data-js-twittericon></label></li><li data-js-facebook data-service="facebook" class="social-button facebook '+(null==(__t=facebook?"":"hidden")?"":_.escape(__t))+" "+(null==(__t=facebookOn?"checked":"")?"":_.escape(__t))+'"><label class="social-button--label social-button--facebook" data-js-shareicon data-js-facebookicon></label></li></ul>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],141:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="tag-input-wrapper" data-js-taginputfieldwrapper><div data-subview="tagInputField"></div><div class="ghost" data-js-taginputghost></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],142:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><div class="inner select-center"><div class="item-option-wrapper" data-js-tagsuggestwrapper>',_.each(results.userTags,function(t){__p+="";var e=_.escape(t).replace(queryRegex,"<u>$&</u>");__p+='<div class="item-option user-tags" data-tag="'+(null==(__t=_.escape(t))?"":__t)+'"><span class="tag-suggest-tag">'+(null==(__t=e)?"":__t)+"</span></div>"}),__p+='<div class="header-item">Popular</div>',_.each(results.suggestions,function(t){__p+="";var e=_.escape(t).replace(queryRegex,"<u>$&</u>");__p+='<div class="item-option suggest-tags" data-tag="'+(null==(__t=_.escape(t))?"":__t)+'"><span class="tag-suggest-tag">'+(null==(__t=e)?"":__t)+"</span></div>"}),__p+="</div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],143:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="tooltip-inner">',__p+=sanitize?""+(null==(__t=text)?"":_.escape(__t)):""+(null==(__t=text)?"":__t),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],144:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<button class="tumblelog-select '+(null==(__t="edit"===post.get("mode")?"inactive":"")?"":_.escape(__t))+'" data-js-clickabletumbleloglabel><span class="caption" data-js-tumbleloglabel></span>',"edit"!==post.get("mode")&&(__p+=' <span class="dropdown icon_arrow_carrot_down" data-js-tumblelogselectpin></span>'),__p+="","reblog"===post.get("mode")&&(__p+=' <span class="reblog_source"><i class="icon icon_reblog"></i> <span class="reblog_name">'+(null==(__t=post.get("reblog_name"))?"":_.escape(__t))+"</span></span>"),__p+="</button>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],145:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pop-menu"><ul class="inner select-right">',_.forEach(channels,function(t){__p+='<li class="item-option '+(null==(__t=t.name===tumblelog?"select":"")?"":_.escape(__t))+'" data-js-tumblelogchoice><img class="ts-avatar" src="'+(null==(__t=t.avatarUrl)?"":_.escape(__t))+'" alt="'+(null==(__t=t.name)?"":_.escape(__t))+'"><div class="ts-info"><p class="ts-name">'+(null==(__t=t.name)?"":_.escape(__t))+'</p><p class="ts-title">'+(null==(__t=t.directory_safe_title||t.title)?"":_.escape(__t))+"</p></div></li>"}),__p+="</ul></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],146:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-tweetpopover><div class="tweet-container"><textarea data-js-customtweet class="tweet-textarea">'+(null==(__t=tweetText)?"":_.escape(__t))+'</textarea><div data-js-tweetremaining class="tweet-remaining">'+(null==(__t=tweetRemaining)?"":_.escape(__t))+'</div></div><button data-js-dismisstweet type="button" class="chrome small dismiss">'+(null==(__t=__("Done"))?"":_.escape(__t))+"</button></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],147:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-subview="loader"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],148:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-webcambutton class="webcam-button"><span data-js-smiley class="icon icon_postforms_selfie"></span> <span data-js-text class="dropzone-text">'+(null==(__t=__("Take a selfie"))?"":_.escape(__t))+"</span></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],149:[function(t,e){"use strict";var i=t("lodash"),s=function(t){if(i.isString(t)){if(t=t.toLowerCase(),"true"===t||"1"===t||"on"===t)return!0;if("false"===t||""===t||"off"===t)return!1;if(t=i.parseInt(t),i.isNaN(t))return!0}return!!t};e.exports=s},{lodash:"K2RcUv"}],150:[function(t,e){"use strict";
var i=t("lodash"),s=function(t,e){return null==e?e=5:i.isNumber(e)||(e=0),i.transform(t,function(t,o,n){e&&i.isObject(o)&&(o=s(o,e-1)),t[i.camelize(n)]=o},{})};e.exports=s},{lodash:"K2RcUv"}],151:[function(t,e){"use strict";function i(t,e){return"function"==typeof e?e(t):t.find(e)}function s(t,e){return"function"==typeof e?e(t):t.attr(e)}function o(t,e){var s=i(t,e);return!a.isNumber(s)&&a.has(s,"length")?s.length:s}function n(t,e){var o=i(t,e.selector);return a.countBy(o,function(t){return s(l(t),e.attribute)})}function r(t,e){return a.isFunction(e)||a.isString(e)?o(t,e):a.has(e,"attribute")?n(t,e):null}var a=t("lodash"),l=t("jquery"),h=function(t){this.lookups=t||{}};h.prototype.parse=function(t){var e={},i=l(t),s=function(t,e){a.each(t,function(t,o){var n=r(i,t);null!==n?e[o]=n:a.isObject(t)?(e[o]={},s(t,e[o])):e[o]=t})};return s(this.lookups,e),e},e.exports=h},{jquery:"HlZQrA",lodash:"K2RcUv"}],152:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("backbone"),n=t("prima/class"),r=0,a=function(t){t=null==t||i.isPlainObject(t)?i.extend({target:"body",autostart:!1},t):{target:t,autostart:!1};var e=".drag_eventor_"+r++,a=s(t.target),l=!1,h=0,d=new n;i.extend(d,o.Events);var c=["dragenter","dragover","dragleave","dragend","drop"],u=function(t){d.trigger(t.type,t)};return d.start=function(){h++,l||(l=!0,i.forEach(c,function(t){a.on(t+e,u)}))},d.stop=function(){h--,0>=h&&(l=!1,i.forEach(c,function(t){a.off(t+e,u)}))},t.autostart&&d.start(),d};e.exports=a},{backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/class":393}],153:[function(t,e){"use strict";function i(t){var e,i=[];for(var s in t)e=t[s],i.push([new RegExp("(</?)("+s+")([>\\s])","gi"),"$1"+e+"$3"]);return i}function s(t,e){for(var i=0;i<e.length;i++)t=t.replace.apply(t,e[i]);return t}function o(t,e){for(var o,n=i(e||d),r=t.split(h),c=!1,u="",p=0;p<r.length;p++)o=r[p],u?o===u&&(u=""):c&&(">"===o?c=!1:o.match(l)&&(u=o)),!u&&o.match(a)&&(">"!==o.slice(-1)&&(c=!0),r[p]=s(o,n));return r.join("")}var n="<\\/?\\w+[\\s>]",r="['\"]",a=new RegExp(n,"g"),l=new RegExp(r,"g"),h=new RegExp("("+n+"|"+r+"|>)","g"),d={strong:"b",em:"i"};e.exports=o},{}],154:[function(t,e){"use strict";var i=t("lodash"),s={camel:i.camelize,snake:i.underscored,kebab:i.dasherize},o=function(t,e){return i.isString(e)&&(e=i.result(s,e)),i.isFunction(e)?i.map(t,e):t},n=function(t,e,s){return i.isString(e)&&(e=o(s||i.keys(t),e)),i.transform(t,function(t,s,o){t[i.result(e,o)||o]=s},{})};e.exports=n},{lodash:"K2RcUv"}],155:[function(t,e){var i=function(t,e,i){var s={};_.isPlainObject(t)&&(i=e,_.extend(s,t),t=s.width,e=s.height);var o=Math.round(e/t*i);return s.width=i,s.height=o,s};e.exports=i},{}],156:[function(t,e){"use strict";var i=t("lodash"),s={normalizeSpace:function(t){return t.trim().replace(" "," ").replace(/\s\s+/," ")},stripScripts:function(t){return t.replace(new RegExp("<script[^>]*>([\\S\\s]*?)</script\\s*>","img"),"")},stripTags:function(t){return t.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},truncateLongStrings:function(t,e,s){return i.isString(t)||(t=""),s||(s="…"),t.length<=e?t:i.truncate(t,e-s.length,s)},stripHtml:function(t,e,s){if(!t)return"";"undefined"==typeof e&&(e=!0);var o=t;"string"==typeof s&&(o=i.trim(o.replace(/(<br\s*\/?>)/gi,"$1"+s).replace(/(<\/(?:p|figure|h[1-6])\s*>)/gi,"$1"+s)));try{var n=document.implementation.createHTMLDocument("");n.body.innerHTML=this.stripScripts(o),o=n.body.textContent||n.body.innerText,o=o.trim()}catch(r){o=this.stripScripts(this.stripTags(o)).trim()}return e&&(o=this.normalizeSpace(o)),o}};e.exports=s},{lodash:"K2RcUv"}],157:[function(t,e){"use strict";var i={isUrl:function(t){var e="%[0-9a-fA-F]{2}",i="(http|https):\\/\\/",s='([a-zA-Z0-9$\\-_.+!*"(),;:&=]|'+e+")+@",o="(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])",n="("+o+"(\\."+o+"){3})",r="([a-zA-Z0-9\\-\\u00C0-\\u017F]+\\.)+([a-zA-Z]{2,})",a="[0-9]+",l="("+n+"|localhost|"+r+")(:"+a+")?",h='a-zA-Z0-9$\\-_.+!*"(),;:@&=',d="(["+h+"]|"+e+")*",c=d+"(\\/"+d+")*",u="\\?(["+h+"/?]|"+e+")*",p="\\#(["+h+"/?]|"+e+")*",m=new RegExp("^"+i+"("+s+")?"+l+"(\\/("+c+")?("+u+")?("+p+")?)?$");return m.test(t)===!0},isImageUrl:function(t){var e=i.isUrl(t),s=/.+[.](jpg|jpeg|png|gif)([?]|$)/.test(t)===!0;return e&&s}};e.exports=i},{}],158:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("../templates/album_art_uploader.tpl"),n=t("./media_dropzone"),r=n.extend({className:"media-dropzone-container album-art-uploader",defaultOptions:i.defaults({enableUrl:!1,dropzoneText:s("Select album art"),uploadText:s("Select album art"),uploadOptions:{name:"album_art",maxUploadSize:10485760,uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:"/svc/post/upload_album_art"}},n.prototype.defaultOptions),template:o,events:i.extend({"click [data-js-removeButton]":"_onClickRemoveButton"},n.prototype.events),_onClickRemoveButton:function(){this.set("url","")},_onUploadUrlChange:function(t,e){this.set("url",e)},_onUrlChange:function(t,e){this.model.set({preuploadAlbumArt:!i.isEmpty(e),albumArt:e}),this.js$("albumArt").css("background-image",e?"url("+e+")":""),this.$el.toggleClass("can-upload-album-art",i.isEmpty(e))},afterRender:function(){this.listenTo(this.upload,"change:url",this._onUploadUrlChange),this.listenTo(this,"change:url",this._onUrlChange),this.$el.toggleClass("can-upload-album-art",i.isEmpty(this.get("url"))),n.prototype.afterRender.apply(this,arguments)}});e.exports=r},{"../templates/album_art_uploader.tpl":100,"./media_dropzone":176,lodash:"K2RcUv","prima/lib/translate":423}],159:[function(t,e){"use strict";var i=t("prima/view"),s=t("lodash"),o=t("../utils/string_helpers"),n=t("prima/mixins/selectorcache"),r=t("../templates/allow_answers.tpl"),a=i.extend({mixins:[n],template:r,className:"post-form--allow-answers",events:{"click [data-js-allowAnswersCheckbox]":"updateModel"},initialize:function(t){this.model=t.model},_onModelChange:function(){var t=!1;s.each(this.model.genericFieldMap,function(e){return this.endsWithQuestionMark(this.model.get(e))?(t=!0,!1):void 0},this),t?this.$el.slideDown():(this.js$("allowAnswersCheckbox").removeAttr("checked"),this.updateModel(),this.$el.slideUp())},endsWithQuestionMark:function(t){return t=o.stripHtml(t,!1),-1!==t.indexOf("?",t.length-1)},updateModel:function(){this.model.set("allow_answers",this.js$("allowAnswersCheckbox").is(":checked"))},render:function(){return this.addStateListeners(),this.$el.html(this.template()),this},addStateListeners:function(){"new"===this.model.get("mode")&&"chat"!==this.model.get("type")&&this.listenTo(this.model,"change",this._onModelChange)},teardown:function(){return this.stopListening(),this}});e.exports=a},{"../templates/allow_answers.tpl":101,"../utils/string_helpers":156,lodash:"K2RcUv","prima/mixins/selectorcache":435,"prima/view":460}],160:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("../templates/ask_field.tpl"),a=s.extend({template:r,mixins:[o,n],serialize:function(){return i.extend({post:this.model.toJSON(),showAnswerField:this.model.isReblog()},this.toJSON())},render:function(){return this.$el.html(this.template(this.serialize())),this}});e.exports=a},{"../templates/ask_field.tpl":102,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/subviewable":436,"prima/view":460}],161:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("../templates/audio_uploader.tpl"),n=t("./media_dropzone"),r=n.extend({className:"audio-direct-upload-button",defaultOptions:i.defaults({enableUrl:!1,dropzoneText:"",uploadIcon:"dropzone-add-audio-icon",uploadText:"",uploadOptions:{name:"audio",mediaType:"audio",maxUploadSize:10485760,uploadPattern:s.browser.mozilla?/^audio\/(?:.*)$/i:/^(?:audio\/mp3|audio\/mpeg)$/i,accept:"audio/mp3",url:"/svc/post/upload_audio"}},n.prototype.defaultOptions),template:o});e.exports=r},{"../templates/audio_uploader.tpl":103,"./media_dropzone":176,jquery:"HlZQrA",lodash:"K2RcUv"}],162:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("velocity-animate").animate,n=t("prima/utils/sequence-with-context"),r=t("app/components/post-form-builder/utils/transition_speed"),a=t("prima/view"),l=t("app/lib/avatar-size"),h=t("prima/mixins/subviewable"),d=t("prima/mixins/selectorcache"),c=t("prima/mixins/accessor"),u=t("app/lib/currentuser"),p=t("../templates/avatar.tpl"),m=a.extend({className:"post-form--avatar",mixins:[h,d,c],template:p,defaultOptions:{size:128,determineViewState:!0},defaults:{flipQueued:!1,showSubavatar:!1,avatarUrl:""},initialize:function(t){if(this.options=t=i.extend({},this.defaultOptions,t),this.user=t.user||u(),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),t.post&&(this.post=t.post,this.tumblelog=t.tumblelog||this.user.getChannel(this.post.get("tumblelog")),this.listenTo(this.post,"change:tumblelog",this._onChangePostTumblelog)),!this.tumblelog)throw new Error("AvatarView requires a Tumblelog model!");this.options.determineViewState?this.updateViewState():this.get("avatarUrl")||this.set("avatarUrl",this.tumblelog.get("avatar_url")),this.listenTo(this,"change:showSubavatar",this._onChangeShowSubavatar),this.listenTo(this,"change:avatarUrl",this._onChangeAvatarUrl)},_onChangeShowSubavatar:function(t,e){e?this.showSubavatar():this.hideSubavatar()},_onChangeAvatarUrl:function(){return this.queueFlipAvatar()},updateViewState:function(){this.set({showSubavatar:this.tumblelog.get("show_author_avatar")||this.tumblelog.get("is_private_group_channel"),avatarUrl:this.tumblelog.get("avatar_url")})},_onChangePostTumblelog:function(t,e){this.tumblelog=this.user.getChannel(e),this.updateViewState()},showSubavatar:function(t,e){return null!=t||(t=r(150)),null!=e||(e=r(300)),o(this.$$(".primary-avatar"),{scale:1},{display:"block",duration:t,delay:e,easing:[.25,1.5,.75,1]})},hideSubavatar:function(t,e){return null!=t||(t=r(100)),null!=e||(e=0),o(this.$$(".primary-avatar"),{scale:0},{display:"none",duration:t,delay:e,easing:[0,0,.6,1]})},queueFlipAvatar:function(){if(this._avatarFlipping)return void this.set("flipQueued",!0);var t=this.flipAvatar();t.then(i.bind(function(){this.get("flipQueued")&&(this.set("flipQueued",!1),this.flipAvatar())},this))},flipAvatar:function(t,e){null!=t||(t=r(300)),null!=e||(e=r(50));var i=l(this.get("avatarUrl"),this.options.size),a=this.tumblelog.get("name"),h=this.$$(".channel-avatar"),d=h.clone();return this._avatarFlipping=!0,n([function(){return d.children(".avatar-link").css("background-image","url('"+i+"')"),d.children(".avatar-image").attr({src:i,alt:a}),o(d,{rotateY:[180,180]},{duration:0}).then(function(){d.insertAfter(h)})},function(){return s.join(o(h,{rotateY:[180,0]},{duration:t}),o(d,{rotateY:[360,180]},{duration:t}))},function(){return h.remove(),this.$$.remove(".channel-avatar"),o(d,{rotateY:[0,0]},{duration:0})},function(){this._avatarFlipping=!1}],this)},resetAvatar:function(){return this.set(i.defaults(i.pick(this.options,["showSubavatar","avatarUrl"]),i.pick(this.attributes,["showSubavatar","avatarUrl"]))),this},serialize:function(){return i.extend(this.toJSON(),{avatarUrl:l(this.get("avatarUrl"),this.options.size),subavatarUrl:l(this.user.getChannel().get("avatar_url"),this.options.size),primary:this.user.getChannel().toJSON(),channel:this.tumblelog.toJSON()})},render:function(){return this.$el.html(this.template(this.serialize())),this.get("showSubavatar")||(this.$$(".primary-avatar").css("display","none"),this.hideSubavatar(0)),this}});e.exports=m},{"../templates/avatar.tpl":104,"app/components/post-form-builder/utils/transition_speed":71,"app/lib/avatar-size":273,"app/lib/currentuser":275,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/utils/sequence-with-context":457,"prima/view":460,"velocity-animate":"lWl/mc",when:"RG2dij"}],163:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/lib/translate"),r=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=t("../templates/confirm_tos.tpl"),d=o.extend({className:"confirm-tos",events:{"change [data-js-confirmTos]":"_onChangeConfirmTos"},mixins:[r,a,l],template:h,initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.user=t.user,this.post=t.post},_onChangeConfirmTos:function(t){this.post.set("confirmTos",s(t.currentTarget).is(":checked"))},serialize:function(){return{__:n,confirmTos:this.post.get("confirmTos")}},render:function(){return this.$el.html(this.template(this.serialize())),this.js$("confirmTos").attr("checked",!!this.post.get("confirmTos")),this},teardown:function(){return this.$el.empty(),this}});e.exports=d},{"../templates/confirm_tos.tpl":105,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":423,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],164:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/mixins/subviewable"),o=t("prima/mixins/selectorcache"),n=i.extend({mixins:[s,o],initialize:function(){},render:function(){return this}});e.exports=n},{"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],165:[function(t,e){"use strict";var i=t("prima/view"),s=i.extend({className:"post-form--error-bar",showErrorBar:function(t){this.$el.html(t).slideDown()},hideErrorBar:function(){this.$el.hide()}});e.exports=s},{"prima/view":460}],166:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/lib/translate"),r=t("../services/preview_service"),a=t("./tooltip"),l=t("prima/mixins/subviewable"),h=t("prima/mixins/selectorcache"),d=t("prima/mixins/accessor"),c=t("../templates/html_field.tpl"),u=t("app/vendor/ace"),p=u.require("ace/mode/html").Mode,m=u.require("ace/mode/markdown").Mode,g=t("app/components/code-editor/theme/post_form"),f=o.extend({mixins:[d,l,h],className:"html-field",events:{"click [data-js-editorHelp]":"_onClickEditorHelp","click [data-js-srcButton]":"_onClickSrcButton","click [data-js-previewButton]":"_onClickPreviewButton"},template:c,defaults:{name:"",editedSincePreview:!1,currentValue:"",htmlPreviewValue:null,markdownPreviewValue:null,isResizable:!1,isMarkdown:!1,wasFocused:!1,textareaClass:""},initialize:function(t){this.set(t),this.updateValueFromModel(),this.previewService=new r,this.tooltip=new a({className:"dropzone-tooltip-popover",text:n("Note that the dashboard doesn't display all HTML elements, but you're free to put them in your posts anyway.")}),this._renderPreview=s.bind(this.renderPreview,this)},_onClickEditorHelp:function(){this.tooltip.isRendered()?this.tooltip.remove():this.tooltip.render()},_onClickSrcButton:function(){this.showSource(!0)},_onClickPreviewButton:function(){this.showPreview()},renderPreview:function(t,e){!s.isUndefined(t)||(t=this.get("currentValue")),!s.isUndefined(e)||(e=this.get("isMarkdown"));var i=this.get("htmlPreviewValue");this.get("editedSincePreview")||null==i?(this.js$("htmlPreview").html('<p style="text-align:center;"><b>'+n("Loading preview...")+"</b></p>"),this.previewService.filterForDash(t,e,s.bind(function(t){this.set(e?"markdownPreviewValue":"htmlPreviewValue",t),this.set("editedSincePreview",!1),this.js$("htmlPreview").html(t)},this),s.bind(function(){this.js$("htmlPreview").html('<p style="text-align:center;"><i>'+n("Failed to load preview :(")+"</i></p>")},this))):this.js$("htmlPreview").html(i)},teardown:function(){return this.stopListening(),this.$el.empty(),this.tooltip&&this.tooltip.remove(),this},serialize:function(){return{isMarkdown:this.get("isMarkdown"),srcLabel:n(this.get("isMarkdown")?"Markdown":"HTML"),previewLabel:n("Preview")}},beforeRender:function(){this.listenTo(this,"change:isMarkdown",function(t,e){this.js$("srcIcon").toggleClass("markdown",e).toggleClass("html",!e),this.js$("srcLabel").text(n(e?"Markdown":"HTML"));var i=e?m:p;this.editor.getSession().setMode(new i)})},render:function(){return this.$el.html(this.template(this.serialize())),this.$el.attr("data-name",this.get("name")),this.tooltip.setPinnedTarget(this.js$("editorHelp")),this._initAce(this.js$("ace").get(0)),this.showSource(),this.updateEditor(),this},hide:function(){this.$el.hide()},show:function(){this.$el.show(),this.updateEditor(),this.updatePreview()},focus:function(){this.editor&&i(this.editor.container).is(":visible")&&(this.get("wasFocused")||!function(t){s.defer(function(){t.blur(),s.defer(function(){t.focus()})}),t.blur()}(this.editor),this.editor.focus())},blur:function(){this.editor&&this.editor.blur()},updateValueFromModel:function(){this.set("currentValue",this.model.get(this.get("name"))||"")},showSource:function(t){this.js$("previewButton").removeClass("active"),this.js$("srcButton").addClass("active"),this.js$("previewView").hide(),this.js$("srcView").show(),t&&s.defer(s.bind(function(){this.focus()},this))},showPreview:function(){this.js$("srcButton").removeClass("active"),this.js$("previewButton").addClass("active"),this.updatePreview(),this.js$("srcView").hide(),this.js$("previewView").show()},updateEditor:function(){this.editor&&(this._ignoreAceChange=!0,this.editor.setValue(this.get("currentValue"),1),this._ignoreAceChange=!1)},updatePreview:function(){var t=this.get("currentValue");this._renderPreview(t)},_updateValueFromAce:function(t){var e=this.get("name"),i=this.model.get(e);this.set("editedSincePreview",!0),this.set("currentValue",t),this.model.set(e,t),this.model.set("htmlEdited",t&&i!==t)},_initAce:function(t){var e=this.editor=u.edit(t),i=e.getSession();i.setUseWorker(!1),i.setUseWrapMode(!0),i.setFoldStyle("manual"),i.on("change",s.bind(function(){this._ignoreAceChange||this._updateValueFromAce(i.getValue())},this)),i.setUseSoftTabs(!0),i.setTabSize(2);var o=this.get("isMarkdown")?m:p;i.setMode(new o),e.setTheme(g),e.setShowPrintMargin(!1),e.renderer.setShowGutter(!1),e.renderer.setPadding(20),e.renderer.setScrollMargin(20,20),e.setHighlightActiveLine(!1),e.setHighlightSelectedWord(!1),e.setBehavioursEnabled(!1),e.commands.removeCommands(["showSettingsMenu","goToNextError","goToPreviousError","centerselection","gotoline","fold","unfold","toggleFoldWidget","toggleParentFoldWidget","foldall","foldOther","unfoldall","findnext"," findprevious","selectOrFindNext","selectOrFindPrevious","find","overwrite","togglerecording","replaymacro","jumptomatching","selecttomatching","removeline","duplicateSelection","sortlines","togglecomment","toggleBlockComment","modifyNumberUp","modifyNumberDown","replace","copylinesup","movelinesup","copylinesdown","movelinesdown","cut_or_delete","blockoutdent","blockindent","splitline","transposeletters","touppercase","tolowercase","expandtoline","joinlines","inverSelection"]),e.commands.addCommand({name:"uncommand",bindKey:{win:"",mac:"Ctrl-A|Ctrl-B|Ctrl-D|Ctrl-E|Ctrl-F|Ctrl-H|Ctrl-K|Ctrl-N|Ctrl-P|Ctrl-V"},exec:function(){return!0},readOnly:!0});var n=s.bind(function(){this.set("wasFocused",!0),e.off("focus",n)},this);e.on("focus",n)}});e.exports=f},{"../services/preview_service":99,"../templates/html_field.tpl":106,"./tooltip":207,"app/components/code-editor/theme/post_form":17,"app/vendor/ace":"4e8++S",jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":423,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],167:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/lib/translate"),r=t("../templates/id3_editor.tpl"),a=o.extend({className:"id3-editor",events:{"input .id3-editor--input":"_onChangeInput","change .id3-editor--input":"_onChangeInput"},template:r,initialize:function(t){this.options=t=i.extend({},t),i.extend(this,i.pick(t,["post","user"]))},_onChangeInput:function(t){var e=s(t.currentTarget);this.post.set(e.attr("name"),e.val())},serialize:function(){var t={id3Fields:i.pick(this.post.toJSON(),"trackTitle","trackArtist","trackAlbum"),id3FieldLabel:{trackTitle:n("Track"),trackArtist:n("Artist"),trackAlbum:n("Album")}};return t},render:function(){return this.$el.html(this.template(this.serialize())),this}});e.exports=a},{"../templates/id3_editor.tpl":107,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":423,"prima/view":460}],168:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/component"),r=t("components/popover").FeatureHelpPopoverView,a=n.extend({name:"InlineControlsTutorial",initialize:function(t){this.options=t=s.extend({},t),this.editor=this.options.richTextEditor,this.popover=new r,this.animationDelay=500,this.config={name:"inline-controls",template:"standard",glass:!1,title:o("But wait, there's more"),content:o("Click the plus sign to insert photos, videos, horizontal lines, or read-more links."),position:r.POSITION.BOTTOM|r.POSITION.LEFT},this.listenTo(this.editor,"controls:show",this._onInlineControlsShow)},show:function(){this.editor.toggleInlineControlsTray(!0),this.listenToOnce(this.editor,"controls:hide controls:embed:prompt",this._onInlineControlsHide),this.listenToOnce(this.editor,"controls:close",this._onInlineControlsClose),this.popover.setHighlighted(i(".post-form .inline-controls .opener")),this.popover.show(this.config),setTimeout(function(){i("body").addClass("animate-inline-controls-tutorial")},this.animationDelay)},showWithDelay:function(){setTimeout(this.show.bind(this),this.animationDelay)},hide:function(){i("body").removeClass("animate-inline-controls-tutorial"),this.stopListening(this.editor,"controls:hide controls:close controls:embed:prompt"),this.popover.hide(),this.trigger("hide",this)},hideWithDelay:function(){setTimeout(this.hide.bind(this),this.animationDelay)},_onInlineControlsShow:function(){this.showWithDelay()},_onInlineControlsClose:function(){this.hideWithDelay()},_onInlineControlsHide:function(){this.hide()},remove:function(){this.hide(),n.prototype.remove.apply(this,arguments)}});e.exports=a},{"components/popover":327,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/lib/translate":423}],169:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/mixins/accessor"),r=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),l=t("./plaintext_editor"),h=t("../templates/inline_embed_field.tpl"),d=o.extend({className:"post-form--inline-embed-field",template:h,mixins:[n,r,a],initialize:function(t){this.options=i.extend({},this.defaults,t)},show:function(){this.inlineEmbedInput.setEditorValue(""),i.defer(i.bind(function(){this.inlineEmbedInput.focus()},this));var t=this.options.calculateWidth();this.$el.add(this.inlineEmbedInput.element).width(t),this.$el.addClass("open")},hide:function(){this.$el.removeClass("open")},getCurrentValue:function(){return this.inlineEmbedInput?this.inlineEmbedInput.getEditorValue():""},createSubViews:function(){var t=i.extend({placeholder:this.options.placeholder,name:"inlineEmbedInput",forceSingleLine:!0,syncWithModel:!1,pasteHook:i.bind(this._onInputPaste,this),onChange:i.bind(this._onInputChange,this),onClientEvent:i.bind(this._onInputClientEvent,this)});this.inlineEmbedInput=this.subViews.inlineEmbedInput=new l(t)},_set_field_state_default:function(){s(this.inlineEmbedInput.editor.element).removeClass("invalid")},_set_field_state_invalid:function(){s(this.inlineEmbedInput.editor.element).addClass("invalid")},_onInputChange:function(){this.getCurrentValue()!==this.get("embedCode")&&this._set_field_state_default()},_onInputPaste:function(){i.defer(i.bind(this.options.submitEmbedCode,this))},_onInputClientEvent:function(t){if("keydown"===t.type)switch(t.which||t.keyCode){case 27:t.preventDefault(),t.stopImmediatePropagation(),this.options.returnFocus(),this.hide();break;case 13:t.preventDefault(),t.stopImmediatePropagation(),this.options.submitEmbedCode()}},beforeRender:function(){this.$el.html(this.template()),this.createSubViews()},render:function(){return this.attachSubViews(),this}});e.exports=d},{"../templates/inline_embed_field.tpl":108,"./plaintext_editor":180,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],170:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("../id3_editor"),n=t("../album_art_uploader"),r=t("app/components/remove-button"),a=t("./audio_player_shim"),l=t("../../templates/media/audio.tpl"),h=s.extend({className:"audio-media-container media-container",defaults:i.defaults({url:"",service:"",albumArt:"",type:"",id:""},s.prototype.defaults),events:{mouseenter:"_onHoverRemoveButton",mouseleave:"_onHoverRemoveButton"},template:l,beforeTeardown:function(){return delete this.audioPlayer,this.$el.removeClass(this.post.get("service")),this.$el.empty(),this},_onHoverRemoveButton:function(t){var e="mouseover"===t.type||"mouseenter"===t.type;this.js$("removeButton").toggleClass("active",e)},beforeRender:function(){this.removeButton=this.subViews.removeButton=new r({onClick:i.bind(function(){this.trigger("media:remove",this)},this),buttonClass:"top-right"}),this.$el.addClass(this.post.get("service")),"direct"===this.post.get("service")&&(this.post.canEditMedia()&&(this.id3Editor=this.subViews.id3Editor=new o(this.options),this.albumArtUploader=this.subViews.albumArtUploader=new n(i.defaults({url:this.post.get("albumArt")||""},this.options))),this.audioPlayer=this.subViews.audioPlayer=new a({extra_classes:null,post_id:"",service:"upload",lightbox:!1,preview:this.post.canEditMedia(),cover:this.post.get("albumArt"),tracks:[{stream_url:this.post.get("url"),cover:this.post.get("albumArt"),track:this.post.get("trackTitle"),artist:this.post.get("trackArtist"),album:this.post.get("trackAlbum")}]}))},afterRender:function(){this.listenTo(this.post,"change:url change:service",function(t){this.$el.removeClass(t.previous("service")),this.teardown().render()}),this.renderSubViews(),this.trigger("media:ready",this)}});e.exports=h},{"../../templates/media/audio.tpl":109,"../album_art_uploader":158,"../id3_editor":167,"./audio_player_shim":171,"./base":172,"app/components/remove-button":231,lodash:"K2RcUv"}],171:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/utils/getpath"),r=n("window.Tumblr.AudioPlayer"),a=s.extend({mixins:[o],initialize:function(t){this.options=i.extend({},t)},teardown:function(){return this.audioPlayer.unbind_events(),this.$el.empty(),delete this.audioPlayer,this},render:function(){r||(r=n("window.Tumblr.AudioPlayer"));var t=i.defaults({replace:null,append_to:null,prepend_to:this.$el},this.options);return this.audioPlayer=new r(t),this.options.preview&&this.audioPlayer.$container.addClass("has_art"),this.$el.toggleClass("audio-player--preview-player",this.options.preview),this}});e.exports=a},{lodash:"K2RcUv","prima/mixins/subviewable":436,"prima/utils/getpath":450,"prima/view":460}],172:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=i.template(""),l=s.extend({className:"media-container",template:a,mixins:[o,n,r],defaults:{canEditMedia:!0},defaultOptions:{},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),i.extend(this,i.pick(t,["post","user","uploads","dragEvents"])),i.isFunction(this.afterInitialize)&&this.afterInitialize.apply(this,arguments)},serialize:function(){return this.toJSON()},teardown:function(){return this.stopListening(),this},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this}});e.exports=l},{lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],173:[function(t,e){"use strict";var i=t("lodash"),s=t("app/components/photoset/views/photo"),o=t("app/components/remove-button"),n=s.prototype.template,r=t("../../templates/media/edit_photo.tpl"),a=s.extend({className:"photoset--photo media-container",events:i.extend({mouseenter:"_onHoverMediaContainer",mouseleave:"_onHoverMediaContainer","click [data-js-clickthroughUrlButton]":"_onClickClickthroughUrlButton","click [data-js-captionButton]":"_onClickCaptionButton"},s.prototype.events),defaults:i.extend({enableClickthroughUrl:!1,hasClickthroughUrl:!1,enableCaption:!1,hasCaption:!1,isActive:!1},s.prototype.defaults),template:function(t){return n(t)+r(t)},_onHoverMediaContainer:function(t){clearTimeout(this._removeButtonActive);var e="mouseover"===t.type||"mouseenter"===t.type;e?(this.set("isActive",!0),this.trigger("photoset:hover",this,this.photo)):this._removeButtonActive=i.delay(i.bind(function(){this.set("isActive",!1)},this),500)},_onClickClickthroughUrlButton:function(t){this.photo.trigger("photo:editClickthroughUrl",this.photo,t.currentTarget)},_onClickCaptionButton:function(t){this.photo.trigger("photo:editCaption",this.photo,t.currentTarget)},_updateOverlayButtons:function(){this.js$("clickthroughUrlButton").css("display",this.get("enableClickthroughUrl")?"block":"none"),this.js$("captionButton").css("display",this.get("enableCaption")?"block":"none"),this.js$("clickthroughUrlButton").toggleClass("active",this.get("hasClickthroughUrl")),this.js$("captionButton").toggleClass("active",this.get("hasCaption"))},addStateListeners:function(){this.listenTo(this,"change:isActive",function(t,e){this.js$("removeButton").toggleClass("active",e),this.js$("mediaOverlay").toggleClass("active",e)}),this.listenTo(this,"photoset:unhover",function(){this.set("isActive",!1)}),this.listenTo(this,"change:enableClickthroughUrl change:enableCaption",this._updateOverlayButtons),this.listenTo(this,"change:hasClickthroughUrl change:hasCaption",this._updateOverlayButtons),this.listenTo(this.photos,"add remove",function(){this.photos.length>1?this.js$("sortable").attr("draggable",!0):this.js$("sortable").removeAttr("draggable")}),this.post&&this.listenTo(this.post,"change:linkthrough",function(t,e){this.set("hasClickthroughUrl",!!e)}),this.listenTo(this.photo,"change:caption",function(t,e){this.set("hasCaption",!!e)})},beforeRender:function(){var t=this.photos.length>1;this.set("enableClickthroughUrl",!t),this.set("enableCaption",t),this.set("hasClickthroughUrl",this.post?!!this.post.get("linkthrough"):!1),this.set("hasCaption",!!this.photo.get("caption")),this.removeButton=this.subViews.removeButton=new o({onClick:i.bind(function(){this.photoset.removePhoto(this.photo.id)},this),buttonClass:"top-right"}),this.addStateListeners()},afterRender:function(){s.prototype.afterRender.apply(this,arguments),this.photos.length>1&&this.js$("sortable").attr("draggable",!0),this._updateOverlayButtons()}});e.exports=a},{"../../templates/media/edit_photo.tpl":110,"app/components/photoset/views/photo":59,"app/components/remove-button":231,lodash:"K2RcUv"}],174:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("prima/lib/translate"),n=t("app/components/photoset"),r=t("app/components/photoset/models/photo"),a=t("app/components/photoset/views/editable_photoset"),l=t("app/components/webcam"),h=t("./edit_photo"),d=t("prima/mixins/promisifyevents"),c=t("../overlay_input"),u=t("../../templates/media/photo.tpl"),p=s.extend({className:"media-container photo-media-container",template:u,mixins:[d],defaults:i.defaults({canPreview:!0,showPhotoBooth:!1},s.prototype.defaults),afterInitialize:function(){this.addStateListeners(),this._updatePhotosetView=i.debounce(this.updatePhotosetView,50)},addStateListeners:function(){this.listenTo(this.post.photos,"add",this._onPhotosAdd),this.listenTo(this.post.photos,"remove",this._onPhotosRemove),this.listenTo(this,"change:showPhotoBooth",function(t,e){e?(this._createPhotoBooth(),this.js$("photoset").css("display","none")):(this.stopListening(this.photobooth),this.photobooth.remove(),this.js$("photoset").css("display",""))})},updatePhotosetView:function(){this.photoset.model.fixLayout(),this.photoset.indexView.trigger("update",this.photoset.model.photos,this.photoset.model.get("layout"))
},_onPhotosAdd:function(t){this.post.set("linkthrough",""),t=this._preparePhotosetPhotoModel(t),this.photoset.model.add(t),this._updatePhotosetView()},_onPhotosRemove:function(t){this.post.set("linkthrough",""),this.photoset.model.remove(t.id),this.updatePhotosetView()},_preparePhotosetPhotoModel:function(t){i.isFunction(t.toJSON)&&(t=t.toJSON()),t.url=t.displayUrl;var e=i.keys(r.prototype.defaults);return e.unshift("id"),i.pick(t,e)},_syncPostToPhotoset:function(t){t||(t=this.photoset.model);var e=this.post.photos.map(this._preparePhotosetPhotoModel,this);t.photos.reset(e),t.set("layout",this.post.get("layout"))},_createPhotoBooth:function(){var t=this.photobooth=new l;t.render(),this.listenTo(t,"webcam:image",function(t){t&&t.base64&&this.post.photos.unshift({photoRaw:t.base64.split("base64,")[1],base64:t.base64,isSelfie:!0,isSelfieGif:t.isGif||!1,height:t.height,width:t.width})}),this.listenTo(t,"webcam:error",function(t){this.trigger("webcam:error",t)}),this.listenTo(t,"webcam:reset",function(){this.post.photos.shift()}),this.listenTo(t,"webcam:close",function(){this.post.photos.shift(),this.trigger("webcam:close")}),this.js$("photobooth").append(t.getElement())},_createPhotoset:function(){var t={dynamic:!0,padding:2,width:540};this.get("canEditMedia")&&(t.PhotosetView=a,t.PhotoView=h,t.post=this.post);var e=this.photoset=new n(t);return this._syncPostToPhotoset(e.model),this.get("canEditMedia")&&(this.listenTo(this.photoset,"change:layout",function(t,e){this.post.set("layout",e)}),this.listenTo(this.photoset,"sort",function(t){this.post.photos.setIdOrder(t.pluck("id"))}),this.listenTo(this.photoset,"photo:remove",function(t,e,i){this.set("layout",i),this.post.photos.remove(e)}),this.listenTo(this.photoset.indexView,"photoset:predrag",function(){this.overlayPopover&&this.overlayPopover.teardown()}),this.listenTo(this.photoset,"photo:editClickthroughUrl",this._createClickthroughUrlPopover),this.listenTo(this.photoset,"photo:editCaption",this._createCaptionPopover),this.listenTo(this.photoset,"change:caption",function(t,e){var i=this.post.photos.get(t.id);i&&i.set("caption",e)})),this.photoset.model.fixLayout(),e.render(),this.js$("photoset").append(e.getElement()),this.get("canEditMedia")&&this.listenTo(this.dragEvents,"drop",this._onDrop),e},_createClickthroughUrlPopover:function(t,e){this.overlayPopover&&(this.overlayPopover=this.overlayPopover.remove());var s=this.overlayPopover=new c({pinnedTarget:e,pinnedTargetContainer:this.photoset.getElement(),value:this.post.get("linkthrough"),placeholder:"http://"});s.render(),this.listenTo(s,"change:value",function(t,e){e=i.trim(e||""),this.post.set("linkthrough",e)}),this.listenToOnce(s,"close",function(){this.stopListening(s),delete this.overlayPopover})},_createCaptionPopover:function(t,e){this.overlayPopover&&(this.overlayPopover=this.overlayPopover.remove());var s=this.overlayPopover=new c({pinnedTarget:e,pinnedTargetContainer:this.photoset.getElement(),maxLength:200,value:t.get("caption"),placeholder:o("Caption this photo"),updateShift:!1});s.render(),this.listenTo(s,"change:value",function(e,s){t.set("caption",i.trim(s||""))}),this.listenToOnce(s,"close",function(){this.stopListening(s),delete this.overlayPopover})},_onDrop:function(t){if(!i.isEmpty(this.$el.find(t.target))){t.preventDefault();var e=i.result(t.originalEvent.dataTransfer,"files");e&&this.trigger("media:addFiles",e)}},beforeTeardown:function(){this.photobooth&&(this.stopListening(this.photobooth),this.photobooth.remove()),delete this.photobooth,this.photoset&&(this.stopListening(this.photoset),this.photoset.remove()),delete this.photoset,this.overlayPopover&&(this.overlayPopover.remove(),this.stopListening(this.overlayPopover)),delete this.overlayPopover},afterRender:function(){this.js$("photobooth",!0),this.js$("photoset",!0),this._createPhotoset(),this.photobooth=!1,this.trigger("media:ready",this),this.renderSubViews()}});e.exports=p},{"../../templates/media/photo.tpl":111,"../overlay_input":178,"./base":172,"./edit_photo":173,"app/components/photoset":49,"app/components/photoset/models/photo":50,"app/components/photoset/views/editable_photoset":58,"app/components/webcam":244,lodash:"K2RcUv","prima/lib/translate":423,"prima/mixins/promisifyevents":433}],175:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("prima/utils/delayed"),r=t("./base"),a=t("prima/mixins/promisifyevents"),l=t("components/crt/player"),h=t("prima/lib/translate"),d=t("../../utils/scale_to_width"),c=t("app/components/remove-button"),u=t("../../templates/media/video.tpl"),p=t("../../templates/media/video_upload.tpl"),m=t("../../templates/media/video_embed.tpl"),g=t("../../templates/media/video_error.tpl"),f=r.extend({className:"media-container video-media-container",events:{mouseenter:"_onHoverRemoveButton",mouseleave:"_onHoverRemoveButton"},template:u,mixins:[a],defaults:i.defaults({canPreview:!0,file:!1,embed:!1,width:!1,height:!1},r.prototype.defaults),afterInitialize:function(){this.addStateListeners()},addStateListeners:function(){this.listenTo(this,"change",this._onChangeVideo),this.listenTo(this.post,"change:preuploadUrl",this._onChangePreuploadUrl)},_onHoverRemoveButton:function(t){var e="mouseover"===t.type||"mouseenter"===t.type;this.js$("removeButton").toggleClass("active",e)},_onChangeVideo:function(){(this.hasChanged("file")||this.hasChanged("embed")||this.hasChanged("canPreview"))&&(this.hasChanged("file")?this.attributes.embed=!1:this.hasChanged("embed")&&(this.attributes.file=!1),this.hasChanged("canPreview")||this.set("canPreview",!0),this.isRendered()&&(this.teardown(),this.render(),this.addStateListeners()))},_onChangePreuploadUrl:function(t,e){this._updateUploadPreview(e,this.get("file"))},_updateUploadPreview:function(t,e){var i=e&&e.name?'"'+e.name+'"':"";t?(this.js$("previewIcon").removeClass("video-uploading").addClass("video-check"),this.js$("previewMessage").html(h("Your video %1$s has been uploaded",i))):(this.js$("previewIcon").removeClass("video-check").addClass("video-uploading"),this.js$("previewMessage").html(h("Uploading your video %1$s",i)))},_createVideoPlayer:function(t){if(!this.get("canPreview"))return this.js$("video").html(p({icon:"",message:""})),void this._updateUploadPreview(this.post.get("preuploadUrl"),t);var e=540,s=this.get("width"),n=this.get("height"),r=s&&n?d(s,n,e):{width:e};i.extend(r,{file:t,techOrder:["html5"]});var a=this.player=new l(document.createElement("video"),{attributes:{watch:!1},vjsOptions:r}),h=!1,c=this.whenEvent(a,"ready");return c.then(function(){a.player.on("error",function(){h=!0,i.defer(function(){this.set("canPreview",!1),this.trigger("media:ready",this)}.bind(this))}.bind(this))}.bind(this)),o.join(this.whenEvent(a,"change:loaded"),c).then(function(){if(!h){this.js$("video").append(a.$el);var t={width:"auto",height:"auto"},i=a.$video.prop("videoWidth"),s=a.$video.prop("videoHeight");i&&s&&(t=d(i,s,e)),a.$el.css(t),this.trigger("media:ready",this)}}.bind(this)),a.render(),a},_createVideoEmbed:function(){var t=function(t){return s('<a href="'+t.get("blog_url")+'"></a>').prop("hostname")}(this.user.getChannel(this.post.get("tumblelog"))),e=this.get("embed"),o=i.extend({tumblelogHostname:t},e);this.js$("video").html(m(o)),"inline"===e.embedRenderContext?n(function(){this.trigger("media:ready",this)},250,this)():this.trigger("media:ready",this)},beforeTeardown:function(){this.player&&this.player.teardown(),delete this.player},beforeRender:function(){this.removeButton=this.subViews.removeButton=new c({onClick:function(){this.trigger("media:remove",this)}.bind(this),buttonClass:"top-right"})},afterRender:function(){this.js$("video",!0),this.renderSubViews(),this.player=!1,this.get("file")?this._createVideoPlayer(this.get("file")):this.get("embed")?i.isEmpty(this.get("embed"))?(this.js$("video").html(g()),this.trigger("media:ready",this)):this._createVideoEmbed(this.get("embed")):this.trigger("media:ready",this)}});e.exports=f},{"../../templates/media/video.tpl":112,"../../templates/media/video_embed.tpl":113,"../../templates/media/video_error.tpl":114,"../../templates/media/video_upload.tpl":115,"../../utils/scale_to_width":155,"./base":172,"app/components/remove-button":231,"components/crt/player":302,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":423,"prima/mixins/promisifyevents":433,"prima/utils/delayed":447,when:"RG2dij"}],176:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=(t("prima/lib/logger"),t("app/components/upload")),r=t("./plaintext_editor"),a=t("app/components/remove-button"),l=t("./tooltip"),h=t("prima/mixins/accessor"),d=t("prima/mixins/subviewable"),c=t("prima/mixins/selectorcache"),u=t("../templates/media_dropzone.tpl"),p=s(document),m=o.extend({className:"media-dropzone-container media-container",template:u,mixins:[h,d,c],defaults:{droppable:!1,showInput:!1,toggleDropzone:!1,dropzoneText:"",enableUpload:!0,enableUrl:!0,uploadIcon:"",uploadText:"",uploadTooltip:"",urlIcon:!1,urlText:"",urlTooltip:"",url:"",urlPlaceholder:"http://"},defaultOptions:{uploadOptions:{},modelKey:!1,urlParser:!1,documentDrag:!0,parseOnUpload:!1,parseOnInput:!1,parseOnEnter:!0,parseOnPaste:!0,inputDebounceTime:250},events:{mouseenter:"_onHoverMediaContainer",mouseleave:"_onHoverMediaContainer","click [data-show-tooltip]":"_onClickShowTooltip","click [data-js-mediaUrl]":"_focusUrlInput"},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.isString(t.dropzoneFineprint)&&(t.dropzoneFineprint=[t.dropzoneFineprint]),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),i.defaults(this.attributes,{defaultBehavior:this.get("enableUpload")?"upload":"url",dropzoneBehavior:this.get("enableUpload")?"upload":"url",splitDropzone:this.get("enableUpload")&&this.get("enableUrl")}),this.upload=new n(t.uploadOptions),t.modelKey&&this.listenTo(this.upload,"change:url",this._onUploadUrlChange),this.listenTo(this.upload,"add",function(t){this.trigger("upload:start",t)}),this.listenTo(this.upload,"complete",function(t,e){this.trigger("upload:complete",e)}),this.listenTo(this.upload,"error",function(t,e){this.trigger("upload:error",e)}),this.listenTo(this.upload,"invalid",function(t,e){this.trigger("upload:invalid",e)}),this.listenTo(this.upload,"allComplete",function(t){this.trigger("uploads:allComplete",t)}),this.listenTo(this,"change:droppable",function(t,e){this.js$("dropzone").toggleClass("droppable",e)}),this.listenTo(this,"change:showInput",function(t,e){e?(this.js$("dropzone").addClass("show-input"),this._onUrlInputChange()):(this.js$("dropzone").removeClass("show-input"),this.js$("dropzone").height(""),this.get("defaultBehavior")!==this.get("dropzoneBehavior")&&this.set("dropzoneBehavior",this.get("defaultBehavior")))}),this.listenTo(this,"change:toggleDropzone",function(t,e){e?(this.js$("dropzone").addClass("toggle-dropzone"),this.js$("mediaUploadText").text(this.get("dropzoneText")),this.js$("mediaUrlText").text(this.get("dropzoneText"))):(this.js$("dropzone").removeClass("toggle-dropzone"),this.js$("mediaUploadText").text(this.get("uploadText")),this.js$("mediaUrlText").text(this.get("urlText")))}),this.listenTo(this,"change:dropzoneBehavior",function(t,e){this.js$("dropzone").removeClass("toggle-dropzone-upload toggle-dropzone-url").addClass("toggle-dropzone-"+e)}),this.__updateUrlFromInput=i.debounce(this._updateUrlFromInput,this.options.inputDebounceTime),this.__onDragOver=i.bind(this._onDragOver,this),this.__onDragLeave=i.bind(this._onDragLeave,this)},urlParser:function(t,e){return i.isFunction(this.options.urlParser)?this.options.urlParser(t,this,e):void 0},addFiles:function(t){return this.upload.addFiles(t)},_addDragStartListener:function(){s(document).on("dragover.dropzone dragenter.dropzone",this.__onDragOver)},_removeDragStartListener:function(){s(document).off("dragover.dropzone dragenter.dropzone",this.__onDragOver)},_addDragEndListener:function(){s(document).on("mouseout.dropzone",this.__onDragLeave)},_removeDragEndListener:function(){s(document).off("mouseout.dropzone",this.__onDragLeave)},_onDragOver:function(){this._dragging=!0,this.set("droppable",!0),this._removeDragStartListener(),this._addDragEndListener()},_onDragLeave:function(){this._dragging=!1,this.set("droppable",!1),this._addDragStartListener(),this._removeDragEndListener()},_onClickShowTooltip:function(t){var e=this.$(t.currentTarget).data("showTooltip"),s=i.result(this,e);s&&s instanceof l&&!s.isOrWasRecentlyRendered()&&s.render()},_focusUrlInput:function(t){return this.js$("removeButton").is(t.target)||this.js$("removeButton").find(t.target).length?!0:(this.set("showInput",!0),void(this.urlInput&&this.urlInput.focus()))},_onUploadUrlChange:function(t,e){this.model&&(this.model.set(this.options.modelKey,e),this.options.parseOnUpload&&this.urlParser(e,"upload"))},_updateUrlFromInput:function(){var t=this.urlInput?i.trim(this.urlInput.getEditorValue()||""):"";this.set("url",t)},_onUrlInputChange:function(){this.urlInput&&this.get("showInput")&&(this.js$("dropzone").height(this.urlInput.$el.height()),this.__updateUrlFromInput())},_onUrlInputClientEvent:function(t){if("keydown"===t.type)switch(t.which||t.keyCode){case 27:t.preventDefault(),t.stopImmediatePropagation(),this.set("showInput",!1),this.urlInput.setEditorValue(""),this.urlInput.blur();break;case 13:this.options.parseOnEnter&&!t.shiftKey?(t.preventDefault(),t.stopImmediatePropagation(),this._updateUrlFromInput(),this.urlParser(this.get("url"),"enter")):this.options.parseOnInput&&(this.urlParser(this.get("url")),this.listenToOnce(this,"change:url",function(t,e){this.urlParser(e,"input")}));break;default:this.options.parseOnInput&&(this.urlParser(this.get("url")),this.listenToOnce(this,"change:url",function(t,e){this.urlParser(e,"input")}))}},_onUrlInputPasteEvent:function(){i.delay(i.bind(function(){this.options.parseOnPaste&&(this._updateUrlFromInput(),this.urlParser(this.get("url"),"paste"))},this),0)},_onHoverMediaContainer:function(t){clearTimeout(this._removeButtonActive);var e="mouseover"===t.type||"mouseenter"===t.type;e?this.js$("removeButton").addClass("active"):this._removeButtonActive=i.delay(i.bind(function(){this.js$("removeButton").removeClass("active")},this),500)},serialize:function(){return i.mapValues(this.toJSON(),function(t,e){return i.isFunction(t)&&e.match(/^(upload|url)(Icon|Text|Tooltip)$/)?t():t},this)},beforeTeardown:function(){this.upload.getElement().detach(),this.subViews.upload=void 0,p.off("keydown.postForm.dropzone keyup.postForm.dropzone")},afterTeardown:function(){this.uploadTooltip&&this.uploadTooltip.remove(),this.urlTooltip&&this.urlTooltip.remove(),delete this.uploadTooltip,delete this.urlTooltip,delete this.urlInput,delete this.urlInput,delete this.removeButton,this._removeDragStartListener(),this._removeDragEndListener()},beforeRender:function(){if(this.subViews.upload=this.upload.indexView,this.get("enableUrl")){var t={placeholder:this.get("urlPlaceholder"),name:"url",syncWithModel:!1,onChange:i.bind(this._onUrlInputChange,this),onClientEvent:i.bind(this._onUrlInputClientEvent,this),pasteHook:i.bind(this._onUrlInputPasteEvent,this)};i.defaults(t,i.pick(this.options,i.keys(t))),this.urlInput=this.subViews.urlInput=new r(t),this.removeButton=this.subViews.removeButton=new a({onClick:i.bind(function(){this.set("showInput",!1),this.urlInput.setEditorValue("")},this),buttonClass:"top-right"})}p.on("keydown.postForm.dropzone keyup.postForm.dropzone",i.bind(function(t){switch(t.which||t.keyCode){case 18:var e=this.get("defaultBehavior"),i="url"===e?"upload":"url";"keydown"===t.type?this.set("dropzoneBehavior",i):this.get("showInput")||this.set("dropzoneBehavior",e)}},this)),this.options.documentDrag&&this._addDragStartListener()},afterRender:function(){this.get("enableUrl")&&this.urlInput.setEditorValue(this.get("url")||""),this.get("enableUpload")&&this.get("uploadTooltip")&&(this.uploadTooltip=new l({className:"dropzone-tooltip-popover",sanitize:!1,text:i.result(this.attributes,"uploadTooltip")}),this.uploadTooltip.setPinnedTarget(this.js$("uploadTooltip"))),this.get("enableUrl")&&this.get("urlTooltip")&&(this.urlTooltip=new l({className:"dropzone-tooltip-popover",sanitize:!1,text:i.result(this.attributes,"urlTooltip")}),this.urlTooltip.setPinnedTarget(this.js$("urlTooltip"))),this.renderSubViews()},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this}});e.exports=m},{"../templates/media_dropzone.tpl":116,"./plaintext_editor":180,"./tooltip":207,"app/components/remove-button":231,"app/components/upload":241,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/logger":403,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],177:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),r=t("../models/mention"),a=t("prima/mixins/accessor"),l=t("prima/mixins/popoverbase"),h=t("prima/mixins/selectorcache"),d=t("../templates/mention_dropdown.tpl"),c=function(){},u=o.extend({className:"popover--mention-dropdown",defaults:{currentKeyedChoice:-1,currentMousedChoice:-1,interactive:!1,lastResults:{},debugMode:!1},mixins:[a,h,l],template:d,initialize:function(){this.model=new r,this.listenTo(this,"change:lastResults",this.preRender),c=i.bind(c,this)},preRender:function(t,e){var i=(e.blogs||[]).length;c("MentionDropdown - PreRender with %d results.",i),this.set({currentKeyedChoice:-1,currentMousedChoice:-1,interactive:!1}),i?(this._rendered&&this.teardown(!0),this.set("numSuggestions",i),this.render(e)):this.trigger("dropdown:empty")},render:function(t){return c("MentionDropdown - Render"),this.$el.html(this.template(t)),this.trigger("dropdown:render"),n.trigger("postForms:dismissListener:suspend"),this},afterRender:function(){s(".item-option",this.$el).on("mousedown",i.bind(this.handleMouseClick,this)),s(".item-option",this.$el).on("mouseover",i.bind(this.handleMouseOver,this)),this.$el.on("mouseout",i.bind(this.handleMouseOut,this))},teardown:function(t){return this.$el.remove(),t||this.set({interactive:!1,lastResults:{}}),n.trigger("postForms:dismissListener:resume"),this},updateMentionDropdown:function(t,e){c("MentionDropdown - fetch callback",e),this.set("lastResults",e)},cycleUp:function(){this._cycle(-1)},cycleDown:function(){this._cycle(1)},_cycle:function(t){var e=this.get("currentKeyedChoice"),s=this.get("currentMousedChoice"),o=i.isNumber(s)&&-1!==s,n=o?s:e,r=this.get("numSuggestions"),a=(n+t)%r;r&&(this.set({currentKeyedChoice:0>a?r-1:a,currentMousedChoice:-1}),this.styleMenuItems(),this.set("interactive",this.get("currentKeyedChoice")>=0),this.trigger("dropdown:menuInteraction",!0))},styleMenuItems:function(t){var e,o=t&&"mouseout"!==t.type,n=this.get("currentKeyedChoice");i.each(s(".item-option",this.$el),function(i,r){o?s(i).toggleClass("cycled",t.currentTarget===i):(s(i).toggleClass("cycled",r===n),r===n&&(e=s(i)))},this)},handleMouseOver:function(t){var e=s(t.currentTarget).index(".item-option");this.styleMenuItems(t),this.set({interactive:!0,currentMousedChoice:e}),this.trigger("dropdown:menuInteraction",!0)},handleMouseOut:function(t){var e=-1!==this.get("currentKeyedChoice");this.styleMenuItems(t),this.set({interactive:e,currentMousedChoice:-1}),this.trigger("dropdown:menuInteraction",e)},handleMouseClick:function(t){this.set("interactive",!0),s(t.currentTarget).addClass("cycled"),this.trigger("dropdown:confirm")},getCurrentBlogChoice:function(){var t=this.get("lastResults");if(!this._rendered||i.isEmpty(t)||!("blogs"in t))return!1;var e=this.get("currentMousedChoice"),s=this.get("currentKeyedChoice"),o=0;return e>=0?o=e:s>=0&&(o=s),t.blogs[o]},getBlogChoice:function(t){var e=this.get("lastResults");return!1===i.isEmpty(e)&&"blogs"in e&&e.blogs[t]?e.blogs[t]:!1}});e.exports=u},{"../models/mention":83,"../templates/mention_dropdown.tpl":117,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/mixins/accessor":425,"prima/mixins/popoverbase":432,"prima/mixins/selectorcache":435,"prima/view":460}],178:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,r=t("app/components/post-form-builder/utils/transition_speed"),a=t("prima/lib/translate"),l=t("prima/view"),h=t("prima/mixins/selectorcache"),d=t("prima/mixins/accessor"),c=t("prima/mixins/popoverbase"),u=t("../templates/overlay_input.tpl"),p=l.extend({className:"overlay-input-popover",mixins:[h,d,c],template:u,events:{"keydown [data-js-input]":"_onKeyDown","input [data-js-input]":"_onInput","keyup [data-js-input]":"_onInput","change [data-js-input]":"_onInput","click [data-js-confirm]":"_onClickConfirm"},defaultOptions:{updateValueOnInput:!1,updateValueOnClose:!0,updateShift:!0},defaults:{value:"",placeholder:"",maxLength:2048,confirmText:a("Done")},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.$pinnedContainer=s(t.pinnedTargetContainer)},_onKeyDown:function(t){switch(t.which||t.keyCode){case 13:this._onClickConfirm();break;case 27:t.stopPropagation(),this.teardown()}},_onInput:function(){this.options.updateValueOnInput&&this._updateValueFromInput()},_onClickConfirm:function(){this._updateValueFromInput(),this.teardown()},_updateValueFromInput:function(){var t=this.js$("input").val();this.set("value",t)},openAnimation:function(t){i.isNumber(t)||(t=r(100)),this._startWidth=this.$pinned.outerWidth(),this.js$("popover").width(this._startWidth);var e=this.$pinned.position().left;return this._offsetLeft=i.isEmpty(this.$pinnedContainer)?0:this.$pinnedContainer.offset().left-this.$pinned.offset().left+e||0,this.options.updateShift&&this.setShift(i.defaults({x:this._offsetLeft},this.getShift())),o.all([n(this.$pinned,{opacity:0},{display:"none",duration:t}),n(this.js$("confirm"),{opacity:1},{duration:t}),n(this.js$("popover"),{marginLeft:this._offsetLeft,width:this._targetWidth},{duration:t})])},pinnedRect:function(){var t=this.$pinned.css("display");this.$pinned.css("display","block");var e=c.properties.defaults.pinnedRect.apply(this,arguments);return this.$pinned.css("display",t),e},closeAnimation:function(t){return i.isNumber(t)||(t=r(100)),o.all([n(this.$pinned,{opacity:1},{display:"block",duration:t}),n(this.js$("confirm"),{opacity:0},{duration:t}),n(this.js$("popover"),{marginLeft:0,width:this._startWidth},{duration:t})])},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._targetWidth=i.isEmpty(this.$pinnedContainer)?520:this.$pinnedContainer.outerWidth()-20,this.setPinnedSide(!1),i.defer(i.bind(function(){this.openAnimation().then(i.bind(function(){this.js$("input").focus()},this))},this)),this},teardown:function(){return this.options.updateValueOnClose&&this._updateValueFromInput(),this.stopListening(),this.closeAnimation().then(i.bind(function(){this.remove()},this)),this}});e.exports=p},{"../templates/overlay_input.tpl":118,"app/components/post-form-builder/utils/transition_speed":71,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":423,"prima/mixins/accessor":425,"prima/mixins/popoverbase":432,"prima/mixins/selectorcache":435,"prima/view":460,"velocity-animate":"lWl/mc",when:"RG2dij"}],179:[function(t,e){"use strict";var i=t("lodash"),s=t("./media_dropzone"),o=t("./webcam_button"),n=t("app/components/webcam/utils/get_user_media"),r=s.extend({defaults:i.extend({enableSelfie:n},s.prototype.defaults),events:i.extend({"click [data-js-webcamButton]":"_onClickWebcamButton"},s.prototype.events),_onClickWebcamButton:function(){this.trigger("webcam:show")},afterRender:function(){if(s.prototype.afterRender.apply(this,arguments),this.get("enableSelfie")){var t=this.subViews.webcamButton=new o;t.render().$el.appendTo(this.js$("mediaUpload").children(".split-cell-inner")),this.listenTo(this,"change:enableSelfie",function(e,i){i||(t.teardown().remove(),this.subViews.webcamButton=null,this.stopListening(this,"change:enableSelfie"))})}}});e.exports=r},{"./media_dropzone":176,"./webcam_button":212,"app/components/webcam/utils/get_user_media":249,lodash:"K2RcUv"}],180:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),r=t("ligature").PlainTextEditor,a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("prima/mixins/accessor"),d=t("../templates/plaintext_editor.tpl"),c=o.extend({defaults:{placeholder:"",name:"",syncWithModel:!0,forceSingleLine:!1},events:{},mixins:[h,a,l],template:d,initialize:function(t){if(this.set(t),this.onChange=t.onChange||i.noop,this.onClientEvent=t.onClientEvent||i.noop,this.pasteHook=t.pasteHook||i.noop,this.get("syncWithModel")){var e=this.get("name");this.$el.attr("data-name",e),this.listenToOnce(this.model,"change:"+e,this.updateEditorFromModel)}},_initializeEditor:function(t,e){var i={placeholder:e,onChange:this._composeOnChange(),onClientEvent:this._composeOnClientEvent(),pasteHook:this.pasteHook,runIFrameSanitization:!0,forceSingleLine:this.get("forceSingleLine"),filterRules:{elements:["p","br"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}}};this.editor=new r(t,i)},_composeOnChange:function(){var t=[this.onChange],e=this;return this.get("syncWithModel")&&t.unshift(this.updateModelFromEditor),function(s){i.each(t,function(t){t.call(e,s)})}},_composeOnClientEvent:function(){var t=this.onClientEvent,e=this;return function(i){n.trigger("plainTextEditor:onClientEvent",i,e.editor),t.call(this,i)}},render:function(){this.$el.html(this.template());var t=this.js$("plainTextEditor").get(0);if(this._initializeEditor(t,this.get("placeholder")),this.get("syncWithModel")){var e=this._modelValue().length>0;e&&this.set("placeholder",!1),this.updateEditorFromModel()}return this},teardown:function(){return this.$el.empty(),delete this.editor,this},serialize:function(){return this.toJSON()},getEditorValue:function(){return this.editor?this.editor.getData(!0):null},setEditorValue:function(t){this.editor&&this.editor.setData(t)},updateModelFromEditor:function(){if(!this.editor)return!1;var t=this.get("name"),e=this.getEditorValue();""!==e?s(this.editor.element).addClass("has-text"):s(this.editor.element).removeClass("has-text"),this.model.get(t)!==e&&this.model.set(t,e)},updateEditorFromModel:function(t,e){var i=this.getEditorValue();e="undefined"!=typeof t&&"undefined"!=typeof e?e:this._modelValue(),e||(e=""),e!==i&&this.setEditorValue(e)},_modelValue:function(){return this.model.get(this.get("name"))||""},focus:function(t){this.editor&&this.editor.focus(t)},blur:function(){this.editor&&this.editor.element.blur()},setCursorToEnd:function(){this.editor&&i.isFunction(this.editor.setCursorToEnd)&&this.editor.setCursorToEnd()},enable:function(){s(this.editor.element).attr("contenteditable",!0)},disable:function(){s(this.editor.element).attr("contenteditable",!1)}});e.exports=c},{"../templates/plaintext_editor.tpl":119,jquery:"HlZQrA",ligature:471,lodash:"K2RcUv","prima/events":396,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],181:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,r=t("prima/utils/sequence-with-context"),a=t("prima/utils/bindendevent"),l=t("prima/lib/translate"),h=t("prima/view"),d=t("prima/events"),c=t("prima/mixins/subviewable"),u=t("prima/mixins/selectorcache"),p=t("prima/mixins/accessor"),m=t("./avatar"),g=t("./tumblelog_select"),f=t("./post_settings"),_=t("./tag_editor"),v=t("./editor_buttons"),b=t("./social_buttons"),y=t("./save_post_button"),w=t("./reblog_as_button"),x=t("./allow_answers"),k=t("./error_bar"),C=t("./uploading_indicator"),S=t("./richtext_editor_tutorial"),T=t("./inline-controls-tutorial"),$=t("../services/content_stats_support"),R=t("./post_type_form/_create"),E=t("../templates/post_form.tpl"),j=h.extend({className:"post-form",defaults:{useMediaReady:!1,showFooter:!0,hideControlsLine:!1,enabled:!0,locked:!1,saving:!1,hasRichTextTutorial:!1,showRichTextTutorial:!1,hasInlineControlsTutorial:!1,showInlineControlsTutorial:!1},events:{"click [data-js-clickableClose]":"_onClickClose","click [data-js-clickableSave]":"_onClickSave",keydown:"_onKeyDown"},mixins:[c,u,p],template:E,initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),i.extend(this,i.pick(t,"post","user","uploads","dragEvents")),i.extend(this.attributes,i.pick(this.post.attributes,["mode"])),this.__onBeforeUnload=i.bind(this._onBeforeUnload,this)},_targetHandlesDrag:function(t){var e=s(t);return i.isEmpty(e.closest(".editable-photoset"))&&i.isEmpty(e.closest(".media-dropzone"))&&i.isEmpty(e.closest("input"))&&i.isEmpty(e.closest('[contenteditable="true"]'))?!1:!0},_onDragOver:function(t){this._targetHandlesDrag(t.target)&&!i.isEmpty(t.originalEvent.dataTransfer.files)&&(t.originalEvent.dataTransfer.dropEffect="copy"),t.preventDefault()},_onDrop:function(t){this._targetHandlesDrag(t.target)||t.preventDefault()},_onModelChange:function(){this.subViews.errorBar.hideErrorBar()},_onChangeHideControlsLine:function(t,e){this.$el.toggleClass("no-controls-line",e)},_onChangeShowFooter:function(t,e){this.isRendered()&&this.js$("footer").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeEnabled:function(t,e){e?this.$el.removeClass("no-pointer-events"):this.$el.addClass("no-pointer-events")},_onChangeLocked:function(t,e){e?this.$$(".post-form--guard").addClass("visible"):this.$$(".post-form--guard").removeClass("visible")},_onClickClose:function(){this.options.redirectTo?(s(window).off("beforeunload",this.__onBeforeUnload),window.location=this.options.redirectTo):d.trigger("postForms:close")},_onClickSave:function(){this.save()},_onTypeSwitch:function(t,e){this.post.set("type",t),this.trigger("postForms:changePostType",e)},_getCurrentRichTextEditor:function(){return this.postTypeForm?this.postTypeForm.getRichTextEditor():void 0},_getEditorType:function(){return this.model.get("editorType")||"rich"},_setHasTutorialStates:function(){var t=i.contains(["text","photo","audio","video","link"],this.post.get("type"));this.set("hasRichTextTutorial",t&&this.user.get("hasRichTextTutorial")),this.set("hasInlineControlsTutorial",t&&this.user.get("hasInlineControlsTutorial"))},_setShowRichTextTutorialState:function(){this.set("showRichTextTutorial",this.get("hasRichTextTutorial")&&"rich"===this._getEditorType()&&this.get("showFooter"))},_setShowInlineControlsTutorialState:function(){this.set("showInlineControlsTutorial",this.get("hasInlineControlsTutorial")&&"rich"===this._getEditorType()&&!this.get("hasRichTextTutorial"))},_onChangeHasRichTextTutorial:function(t,e){this.$el.toggleClass("has-richtext-tutorial",e)},_onChangeShowRichTextTutorial:function(t,e){this.$el.toggleClass("show-richtext-tutorial",e),e&&this.user.get("hasRichTextTutorial")&&(s.ajax({url:"/svc/post/set_seen_rte",type:"POST",with_form_key:!0}),this.user.set("hasRichTextTutorial",!1))},_onRichTextTutorialRemoved:function(t){var e,s=function(){this.set("hasRichTextTutorial",!1),this.$el.removeClass("closing-richtext-tutorial")};this.stopListening(t),this.stopListening(this,"change:showFooter",this._setShowRichTextTutorialState),this.stopListening(this.model,"change:editorType",this._setShowRichTextTutorialState),this.options.isModal?i.defer(function(){a.animation(this.$el,s.bind(this)),this.$el.addClass("closing-richtext-tutorial")}.bind(this)):s.call(this),e=this._getCurrentRichTextEditor(),e&&e.focus(),this.set("showRichTextTutorial",!1)},_onInlineControlsTutorialHide:function(t){this.stopListening(t),this.stopListening(this,"change:hasRichTextTutorial",this._setShowInlineControlsTutorialState),this.stopListening(this.model,"change:editorType",this._setShowInlineControlsTutorialState),this.user.set("hasInlineControlsTutorial",!1),t.remove()},_onChangeShowInlineControlsTutorial:function(t,e){var i=this._getCurrentRichTextEditor();e&&i?(this.inlineControlsTutorial=new T({richTextEditor:i}),this.listenToOnce(this.inlineControlsTutorial,"hide",this._onInlineControlsTutorialHide)):this.inlineControlsTutorial&&(this.inlineControlsTutorial.remove(),this.inlineControlsTutorial=null)
},_createContentStatsSupport:function(){this.contentStatsSupport&&this.contentStatsSupport.remove(),this.contentStatsSupport=new $({model:this.model,editor:this._getCurrentRichTextEditor()})},getRect:function(){var t=this.$el.css("display");this.$el.css("display","block");var e=this.$el.offset(),i={};return i.offsetTop=e.top,i.offsetLeft=e.left,i.offsetHeight=this.$el.outerHeight(),i.offsetWidth=this.$el.outerWidth(),this.$el.css("display",t),i},measureHeight:function(){if(!this.isRendered())return void 0;var t=this.$el.css("display");this.$el.css("display","block");var e=this.$el.outerHeight();return this.$el.css("display",t),e},animateShow:function(t,e){t||(t=0),e||(e=0),t||this.js$("container-outer").css("opacity",1);var i=[n(this.js$("container-outer"),{opacity:[1,0]},{duration:t}),n(this.js$("container-inner"),{translateY:[0,10]},{duration:t,delay:e,complete:function(t){s(t).removeAttr("style")}})];return this.options.isModal&&i.push(n(this.js$("margin"),{opacity:[1,0]},{duration:t})),this.avatar&&this.avatar.updateViewState(),o.all(i)},animateHide:function(t,e){t||(t=0),e||(e=0),t||this.js$("container-outer").css("opacity",0),this.options.isModal||this.avatar.resetAvatar();var i=[n(this.js$("container-outer"),{opacity:[0,1]},{duration:t}),n(this.js$("container-inner"),{translateY:[10,0]},{duration:t,delay:e})];return this.options.isModal&&i.push(n(this.js$("margin"),{opacity:[0,1]},{duration:t})),o.all(i)},forceHidden:function(){return this.js$("container-outer").css("opacity",0),this.options.isModal&&this.js$("margin").css("opacity",0),n(this.js$("container-inner"),{translateY:[10,10]},{duration:0}),this},save:function(t){if(!this.get("saving")||t){var e;d.trigger("postForms:saving"),this.subViews.errorBar.hideErrorBar();var o=r([function(){!1===this.model.isValid()},function(){this.set({enabled:!1,locked:!0,saving:!0})},function(){},function(){return this.model.set("contentStats",this.contentStatsSupport.getStats()),e=this.model.save(this.options)},function(){this.set({enabled:!1,locked:!0,saving:!1,saved:!0})}],this).then(i.bind(function(t){if(t=t.filter(function(t){return t}),t.length&&(t=t[0]),i.isEmpty(t.errors)){if(this.options.redirectTo)s(window).off("beforeunload",this.__onBeforeUnload),window.location=this.options.redirectTo;else if(d.trigger("postForms:saved",{},e),"reblog"===this.model.get("mode")){var o=this.model.get("reblog_id"),n=window.Tumblr.Posts.find({id:o});n&&n.updateReblogControl()}}else{var r=[];for(var a in t.errors)r.push(t.errors[a]);this.set({enabled:!0,locked:!1,saving:!1,saved:!1});var l=r.join("<br>");this.subViews.errorBar.showErrorBar(l),d.trigger("postForms:error")}},this));return o["catch"](i.bind(function(t){this.set({enabled:!0,locked:!1,saving:!1,saved:!1}),d.trigger("postForms:error")},this)),o}},createSubViews:function(){var t=["fullWidthInlineMedia","popoverContainer","dragEvents"],e=i.extend({user:this.user,post:this.post,uploads:this.uploads,model:this.model},i.pick(this.options,t),this.attributes),s="new"===this.post.get("mode")?null:this.post.get("tumblelog");this.avatar=this.subViews.avatar=new m(i.extend(this.options.isModal?{}:{determineViewState:!1,showSubavatar:this.user.getChannel(s).get("show_author_avatar"),avatarUrl:this.user.getChannel(s).get("avatar_url")},e)),this.tumblelogSelect=this.subViews.tumblelogSelect=new g(e),this.postSettings=this.subViews.postSettings=new f(e),this.tagEditor=this.subViews.tagEditor=new _(e),this.editorButtons=this.subViews.editorButtons=new v(e),this.socialButtons=this.subViews.socialButtons=new b(e),this.savePostButton=this.subViews.savePostButton=new y(e),this.postTypeForm=this.subViews.postTypeForm=R(e),this.set("useMediaReady",this.postTypeForm.get("hasMediaView")),this.listenTo(this.postTypeForm,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.set("hideControlsLine",this.postTypeForm.get("hideControlsLine")),this.listenTo(this.postTypeForm,"change:hideControlsLine",function(t,e){this.set("hideControlsLine",e)}),this.postTypeForm.has("showCaption")&&(this.set("showFooter",this.postTypeForm.get("showCaption")),this.listenTo(this.postTypeForm,"change:showCaption",function(t,e){this.set("showFooter",e)})),this.listenTo(d,"postForms:tumblelogSelectDropdown:open",function(){this.trigger("checkScrollSize"),this.trigger("pauseScrollHelper")}),this.listenTo(d,"postForms:tumblelogSelectDropdown:close",function(){this.trigger("checkScrollSize",!0),this.trigger("resumeScrollHelper")}),this.post.allowsReblogAs()&&(this.reblogAsButton=this.subViews.reblogAsButton=new w(e),this.listenTo(this.reblogAsButton,"reblogAs:type",this._onTypeSwitch)),this.post.allowsTypeSwitch()&&this.listenTo(this.postTypeForm,"switchPostType",this._onTypeSwitch),this.subViews.allowAnswers=new x(e),this.subViews.errorBar=new k,this.subViews.uploadingIndicator=new C(e),this._setHasTutorialStates(),this._setShowRichTextTutorialState(),this._setShowInlineControlsTutorialState(),this.get("hasRichTextTutorial")&&(this.richTextEditorTutorial=this.subViews.richTextEditorTutorial=new S,this.listenToOnce(this.richTextEditorTutorial,"removed",this._onRichTextTutorialRemoved),this.listenTo(this,"change:showFooter",this._setShowRichTextTutorialState),this.listenTo(this.model,"change:editorType",this._setShowRichTextTutorialState)),this.get("hasInlineControlsTutorial")&&(this.listenTo(this,"change:hasRichTextTutorial",this._setShowInlineControlsTutorialState),this.listenTo(this.model,"change:editorType",this._setShowInlineControlsTutorialState))},addStateListeners:function(){this.listenTo(this,"change:hideControlsLine",this._onChangeHideControlsLine),this.listenTo(this,"change:showFooter",this._onChangeShowFooter),this.listenTo(this,"change:enabled",this._onChangeEnabled),this.listenTo(this,"change:locked",this._onChangeLocked),this.listenTo(this.model,"change",this._onModelChange),this.listenTo(this.dragEvents,"dragover",this._onDragOver),this.listenTo(this.dragEvents,"drop",this._onDrop),this.listenTo(this.tagEditor,"postForms:focusOnNextEditor",this.focusOnNextEditor),this.listenTo(this," change:showRichTextTutorial",this._onChangeShowRichTextTutorial),this.listenTo(this," change:hasRichTextTutorial",this._onChangeHasRichTextTutorial),this.listenTo(this," change:showInlineControlsTutorial",this._onChangeShowInlineControlsTutorial)},serialize:function(){return i.extend({showReblogAs:this.post.allowsReblogAs()},this.toJSON())},beforeRender:function(){this.dragEvents.start(),this.createSubViews(),this.addStateListeners(),s(window).on("beforeunload",this.__onBeforeUnload)},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this.post.get("type")&&this.$el.addClass("post-form--"+this.post.get("type")),this},afterRender:function(){this.$el.toggleClass("no-controls-line",this.get("hideControlsLine")),this.get("showFooter")||this.js$("footer").css({display:"none",opacity:0}),this.renderSubViews(),this._onChangeHasRichTextTutorial(this,this.get("hasRichTextTutorial")),this._onChangeShowRichTextTutorial(this,this.get("showRichTextTutorial")),this._onChangeShowInlineControlsTutorial(this,this.get("showInlineControlsTutorial")),this._createContentStatsSupport()},teardown:function(){return this.dragEvents.stop(),this.stopListening(),this.contentStatsSupport.remove(),this.inlineControlsTutorial&&this.inlineControlsTutorial.remove(),s(window).off("beforeunload",this.__onBeforeUnload),this},remove:function(){return this.teardown(),h.prototype.remove.apply(this,arguments)},_onKeyDown:function(t){this.focusOnNextEditor(t),this.keyboardSave(t)},focusOnNextEditor:function(t){if(9===t.keyCode){var e=this.$el.find(".editor[contenteditable]:visible, .post-form--close, .post-form--save-button .create_post_button:enabled"),i=s.inArray(t.target,e);if(-1!==i){t.preventDefault();var o=(i+(t.shiftKey?-1:1))%e.length;0>o&&(o+=e.length),s(e[o]).focus()}}},keyboardSave:function(t){var e=/Mac/.test(navigator.platform)?t.metaKey:t.ctrlKey;13===t.keyCode&&e&&this.post.isValid()&&(t.preventDefault(),t.stopPropagation(),this.save())},_onBeforeUnload:function(){if(this.model.deepHasChanged(this.get("initialPostState"))){var t=l("Sure you want to leave this page without saving? Your post will be discarded.");return"edit"===this.model.get("mode")&&(t=l("Sure you want to leave this page without saving? All your edits will be lost.")),t}}});e.exports=j},{"../services/content_stats_support":93,"../templates/post_form.tpl":120,"./allow_answers":159,"./avatar":162,"./editor_buttons":164,"./error_bar":165,"./inline-controls-tutorial":168,"./post_settings":183,"./post_type_form/_create":186,"./reblog_as_button":196,"./richtext_editor_tutorial":200,"./save_post_button":201,"./social_buttons":203,"./tag_editor":204,"./tumblelog_select":208,"./uploading_indicator":211,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/utils/bindendevent":442,"prima/utils/sequence-with-context":457,"prima/view":460,"velocity-animate":"lWl/mc",when:"RG2dij"}],182:[function(t,e){"use strict";var i=t("prima/view"),s=t("../templates/post_preview.tpl"),o=i.extend({template:s,initialize:function(t){this.options=t},render:function(){return this.$el.html(this.template(this.options)),this}});e.exports=o},{"../templates/post_preview.tpl":121,"prima/view":460}],183:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/mixins/selectorcache"),r=t("../templates/post_settings.tpl"),a=t("./post_settings_dropdown"),l=s.extend({className:"post-form--post-settings-button",events:{"click [data-js-clickablePostSettingsCog]":"togglePostSettingsDropdown"},mixins:[o,n],template:r,initialize:function(t){t=i.extend({},t,{shift:{x:0,y:10},identifier:"postForms:postSettingsDropdown"}),this.postSettingsDropdown=new a(t)},render:function(){return this.$el.html(this.template()),this.postSettingsDropdown.setPinnedTarget(this.js$("postSettingsCog")),this},togglePostSettingsDropdown:function(){this.postSettingsDropdown.isOrWasRecentlyRendered()||this.postSettingsDropdown.render()}});e.exports=l},{"../templates/post_settings.tpl":122,"./post_settings_dropdown":184,lodash:"K2RcUv","prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],184:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/translate"),n=t("prima/events"),r=t("app/components/dialog"),a=t("prima/mixins/accessor"),l=t("prima/mixins/selectorcache"),h=t("prima/mixins/popoverbase"),d=t("app/mixins/tumblrselect"),c=t("../templates/post_settings_dropdown.tpl"),u=s.extend({className:"popover--post-settings-dropdown",defaults:{textFields:["customUrl","sourceUrl","postDate"],checkboxFields:["allowPhotoReplies"],selectFields:["editorType"]},mixins:[a,l,h,d],template:c,initialize:function(t){this.options=t=i.extend({},t),i.extend(this,i.pick(t,["post","user","uploads"]))},render:function(){return this.$el.html(this.template(this.serialize())),this.setupTextInputFields(),this.setupCheckboxInputFields(),this.setupSelectFields(),this.delegateEvents(),n.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),n.trigger("postForms:dismissListener:resume"),this},serialize:function(){return i.extend({showEditorSelection:"chat"!==this.post.get("type")},this.model.toJSON())},setupTextInputFields:function(){i.each(this.get("textFields"),function(t){var e=this["$"+t]=this.js$(t);return"sourceUrl"===t&&this.model.isReblog()?void e.attr("readonly",!0):void e.on("keydown keyup",i.bind(function(t){var i=t.which||t.keyCode;"keyup"===t.type?this.model.set(e.attr("name"),e.val()):13===i&&this.teardown()},this))},this)},setupCheckboxInputFields:function(){i.each(this.get("checkboxFields"),function(t){var e=this["$"+t]=this.js$(t),s=e.attr("name");e.prop("checked",!!this.model.get(s)),e.on("change",i.bind(function(){var o="_onChange"+i.camelize("-"+t);i.isFunction(this[o])?this[o]():this.model.set(s,e.prop("checked"))},this))},this)},setupSelectFields:function(){i.each(this.get("selectFields"),function(t){var e=this["$"+t]=this.js$(t),s=e.attr("name");this.setUpSelector(e),e.children('[value="'+this.model.get(s)+'"]').attr("selected",!0),e.trigger("change"),e.on("change",i.bind(function(){var o="_onChange"+i.camelize("-"+t);i.isFunction(this[o])?this[o]():this.model.set(s,e.val())},this))},this)},setupInputListeners:function(){var t=this.get("checkboxFields");i.each(this.get("inputSelectorNames"),function(e){var s=this["$"+e];s.on("change",i.bind(function(){var i=-1!==t.indexOf(e)?s.prop("checked"):s.val();this.model.set(s.attr("name"),i)},this))},this)},_onChangeEditorType:function(){var t=this.model.get("editorType"),e=this.js$("editorType").val();if(!t)return void this.model.set("editorType",this.user.get("defaultEditorType")||"rich");if(t!==e)if("rich"!==t&&"rich"===e&&this.model.get("htmlEdited")){var s={text:o("%1$sGoing back to normal?%2$sYou might lose any code that doesn't get along with our text editor.%3$s","<h3>","</h3><small>","</small>"),keycommand_maintain:!0};r.confirm(s,i.bind(function(){this.js$("editorType").blur(),this.model.set({htmlEdited:!1,editorType:e}),this._delayedClose()},this))}else i.defer(i.bind(function(){this.model.set("editorType",e)},this)),this._delayedClose()},_delayedClose:function(t){i.isNumber(t)||(t=50),i.delay(i.bind(function(){this.teardown()},this),t)}});e.exports=u},{"../templates/post_settings_dropdown.tpl":123,"app/components/dialog":20,"app/mixins/tumblrselect":276,lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/mixins/accessor":425,"prima/mixins/popoverbase":432,"prima/mixins/selectorcache":435,"prima/view":460}],185:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/mixins/accessor"),r=t("prima/mixins/subviewable"),a=t("../../templates/post_type_form/_audio_search_results.tpl"),l=o.extend({defaults:{currentChoice:-1,serviceResults:{},showCopyrightWarning:!1},events:{"click .clear-results":"clearResults","click .result":"_clickedChoice","mouseover .result":"resetCurrentChoice"},mixins:[n,r],template:a,initialize:function(){this.listenTo(this,"change:serviceResults",function(t){t.trigger("searchResults:updated",t._getResultCount())}),this.listenTo(this,"change:currentChoice",this._styleResults)},updateResultsForService:function(t){var e=this.get("serviceResults"),s=i.clone(e);s[t.service]=t.tracks,this.set("serviceResults",s),!1===i.isEqual(e,t)&&(this.resetCurrentChoice(),this.teardown(),this.render())},handleMenuCommand:function(t){var e=s(".result",this.$el),i=this.get("currentChoice");if("confirm"===t){if(-1!==i){var o=s(e[this.get("currentChoice")]),n=o.attr("data-href"),r=o.hasClass("audio-result")?"searchResults:selectAudio":"searchResults:selectVideo";this.trigger(r,n)}}else{var a="cycleUp"===t?-1:1,l=(this.get("currentChoice")+a+e.length)%e.length;this.set("currentChoice",l)}},render:function(){var t=i.extend(i.pick(this.attributes,"serviceResults"),{resultCount:this._getResultCount(),copyrightWarningMessage:this.get("copyrightWarningMessage")||"",showCopyrightWarning:!!this.get("showCopyrightWarning")});return this.$el.html(this.template(t)),this},teardown:function(){return this.$el.empty(),this},reset:function(){this.set("serviceResults",{})},resetCurrentChoice:function(){this.set("currentChoice",-1)},clearResults:function(){this.trigger("searchResults:clear")},setCopyrightWarningMessage:function(t){this.set("copyrightWarningMessage",t)},_clickedChoice:function(t){var e=s(t.currentTarget).attr("data-href"),i=t.currentTarget.classList.contains("audio-result")?"searchResults:selectAudio":"searchResults:selectVideo";this.trigger(i,e)},_getResultCount:function(){return i.reduce(this.get("serviceResults"),function(t,e){return t+(i.isArray(e)?e.length:0)},0)},_styleResults:function(t,e){i.each(s(".result",t.$el),function(t,i){s(t).toggleClass("cycled",i===e)})}});e.exports=l},{"../../templates/post_type_form/_audio_search_results.tpl":124,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/subviewable":436,"prima/view":460}],186:[function(t,e){"use strict";var i=t("lodash"),s={text:t("./text"),photo:t("./photo"),link:t("./link"),quote:t("./quote"),chat:t("./chat"),audio:t("./audio"),video:t("./video"),note:t("./note")},o=t("./text"),n=function(t){var e;i.isPlainObject(t)?e=t.model:(e=t,t={model:e});var n=s[e.get("type")]||o;return new n(t)};e.exports=n},{"./audio":187,"./chat":189,"./link":190,"./note":191,"./photo":192,"./quote":193,"./text":194,"./video":195,lodash:"K2RcUv"}],187:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("prima/lib/translate"),n=(t("prima/lib/logger"),t("prima/utils/getpath")),r=t("../../templates/post_type_form/audio.tpl"),a=t("../plaintext_editor"),l=t("./_audio_search_results"),h=t("../audio_uploader"),d=t("../media/audio"),c=t("../confirm_tos"),u=t("../richtext_editor"),p=t("../reblog_tree"),m=t("../../services/audio_search_service"),g=t("app/components/dialog"),f=s.extend({defaults:i.defaults({maxSearchResults:4,showSearchField:!0,showAudioUploader:!0,showSearchResultList:!1,showCopyrightWarning:!1,hasMediaView:!0,hasMedia:!1,showTos:!1,showCaption:!1},s.prototype.defaults),template:r,afterInitialize:function(){this.searchService=new m,"new"!==this.post.get("mode")&&this.set({hasMedia:!0,showCaption:!0,showSearchField:!1,showAudioUploader:!1,showSearchResultList:!1,showCopyrightWarning:!1})},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"audio-search-field",placeholder:o("Search for a song or paste a URL"),name:"search",forceSingleLine:!0,onClientEvent:i.bind(this.handleSearchMenuKeys,this)},t),s=i.extend({},t),n={className:"audio-search-results-field"},r=i.extend({url:this.post.get("url"),service:this.post.get("service"),albumArt:this.post.get("albumArt"),canEditMedia:this.post.canEditMedia()},t);this.post.get("bandcamp")&&i.extend(r,this.post.get("bandcamp"));var m=i.extend({},t),g=i.extend({className:"caption-field",name:"caption",placeholder:o("Add a description, if you like")},t),f=i.extend({is_removable:!0},t);this.searchField=this.subViews.searchField=new a(e),this.audioUploader=this.subViews.audioUploader=new h(s),this.searchResultList=this.subViews.searchResultList=new l(n),this.mediaPreview=this.subViews.mediaPreview=new d(r),this.confirmTos=this.subViews.confirmTos=new c(m),this.caption=this.subViews.caption=new u(g),this.post.isReblog()&&(this.reblogTree=this.subViews.reblogTree=new p(f))},addStateListeners:function(){this.listenTo(this.audioUploader,"upload:start",this._onFileUploadStart),this.listenTo(this.audioUploader,"upload:complete",this._onFileUploadComplete),this.listenTo(this.audioUploader,"upload:error upload:invalid",this._onFileUploadError),this.searchResultList.listenTo(this.searchService,"searchResults:fetched",this.searchResultList.updateResultsForService),this.listenTo(this.searchService,"audioEmbedData:fetched",this._onAudioEmbedDataFetched),this.searchResultList.listenTo(this.searchField,"searchField:menuKey",this.searchResultList.handleMenuCommand),this.listenTo(this.searchResultList,"searchResults:updated",function(t){var e=i.isEmpty(this.post.get("url"))&&t>0;this.set("showSearchResultList",e)}),this.listenTo(this.searchResultList,"searchResults:selectAudio",this.setAudioContentFromUrl),this.listenTo(this.searchResultList,"searchResults:selectVideo",this.switchToVideoPost),this.listenTo(this.searchResultList,"searchResults:clear",function(){this.set("showCopyrightWarning",!1),this.post.unset("copyrightFallback")}),this.searchField.listenTo(this.searchResultList,"searchResults:clear",function(){this.setEditorValue(""),this.focus()}),this.listenTo(this.mediaPreview,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.post.canEditMedia()&&this.listenTo(this.mediaPreview,"media:remove",this.removeMedia),this.listenTo(this.post,"change:search",i.debounce(this._onChangeSearchInput,200)),this.listenTo(this,"change:showSearchField",this._onChangeShowSearchField),this.listenTo(this,"change:showAudioUploader",this._onChangeShowAudioUploader),this.listenTo(this,"change:showSearchResultList",this._onChangeShowSearchResultList),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:showTos",this._onChangeShowTos),this.listenTo(this,"change:showCaption",this._onChangeShowCaption),this.listenTo(this,"change:showCopyrightWarning",this._onChangeShowCopyrightWarning)},removeMedia:function(){"direct"===this.post.get("service")&&this.searchField.setEditorValue(""),this.post.softReset();var t=i.isEmpty(this.post.get("search"));this.set({hasMedia:!1,showSearchField:!0,showSearchResultList:!t,showAudioUploader:t,showTos:!1}),this.mediaPreview.set({url:"",service:""}),this.js$("confirmTos").attr("checked",!!this.post.get("confirmTos")),i.isEmpty(this.post.get("caption"))&&i.isEmpty(this.post.get("tags"))&&this.set("showCaption",!1),this.searchField.focus()},_onChangeShowSearchField:function(t,e){this.searchField.$el.css({display:e?"block":"none",opacity:e?1:0})},_onChangeShowAudioUploader:function(t,e){this.audioUploader.$el.css({display:e?"block":"none",opacity:e?1:0})},_onChangeShowSearchResultList:function(t,e){this.searchResultList.$el.css({display:e?"block":"none",opacity:e?1:0})},_onChangeShowCopyrightWarning:function(t,e){this.searchResultList.set("showCopyrightWarning",e)},_onChangeHasMedia:function(t,e){this.isRendered()&&this.mediaPreview.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowTos:function(t,e){this.isRendered()&&this.js$("tos").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowCaption:function(t,e){this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},setAudioContent:function(t,e,s){i.isObject(t)&&(s=t,t=""),s=i.extend({preuploadUrl:"",url:(t||"").replace(/\u200B/g,""),service:e},s),("bandcamp"!==e||s.id&&s.type)&&(this.mediaPreview.set(s),this.post.set(i.pick(s,["url","preuploadUrl","service","albumArt","preuploadAlbumArt","trackTitle","trackArtist","trackAlbum"])))},setAudioContentFromUrl:function(t,e,s){e||(e=this.searchService.getServiceByUrl(t)),s||(s={}),this.setAudioContent(t,e,s),this.set({hasMedia:!0,showCaption:!0,showSearchField:!1,showSearchResultList:!1,showAudioUploader:!1,showTos:!i.isEmpty(s.preuploadUrl)}),this.caption.focus()},_onChangeSearchInput:function(t,e){e||(e="");var s=i.isEmpty(e)?!1:this.searchService.getServiceByUrl(e);if(s)"direct"===s?this.setAudioContentFromUrl(e,s):this.searchService.getData(e,s),this.post.unset("search");else if(i.isEmpty(e))this.searchResultList.reset(),this.set("showAudioUploader",this.get("showSearchField"));else{if(this.set("showAudioUploader",!1),this.get("showCopyrightWarning")){if(e===this.post.get("copyrightFallback"))return;this.set("showCopyrightWarning",!1),this.post.unset("copyrightFallback"),this.searchResultList.reset()}this._executeAudioSearches(e)}},_executeAudioSearches:function(t,e,s){e=i.isArray(e)?e:this.searchService.searchServices,i.forEach(e,function(e){this.searchService.search(e,t,s)},this)},_onAudioEmbedDataFetched:function(t,e,s){i.isObject(t)&&(s=t,t=s.url),this.setAudioContentFromUrl(t,e,s)},handleSearchMenuKeys:function(t){var e,i=["keyup","keydown"],s={13:"confirm",38:"cycleUp",40:"cycleDown"};return t=t||window.event,-1!==i.indexOf(t.type)&&(e=t.which||t.keyCode,e in s)?("keydown"===t.type&&13===e&&t.stopImmediatePropagation(),this.searchResultList.isRendered()&&"keyup"!==t.type&&(this.searchField.trigger("searchField:menuKey",s[e]),t.preventDefault()),!1):void 0},_onFileUploadStart:function(t){this.uploads.add(t)},_onFileUploadComplete:function(t){var e={preuploadUrl:t.get("url")},s=t.get("album_art_url");s&&(e.preuploadAlbumArt=!0,e.albumArt=s);var o=t.get("id3");i.isObject(o)&&(e.trackTitle=o.Title,e.trackArtist=o.Artist,e.trackAlbum=o.Album),this.setAudioContentFromUrl(e.preuploadUrl,"direct",e)},_onFileUploadError:function(t){var e=t.get("responseJSON");if(e){var s=parseInt(n(e,"meta.status"),10),r=n(e,"response.is_copyright");if(403===s&&r)return void this.uploadFailedCopyright(n(e,"response"))}var a=t.get("error")||o("Error uploading audio");i.isArray(a)&&(a=a.join("</p><p>")),g.alert("<p>"+a+"</p>")},afterRender:function(){this.renderSubViews(),i.forEach({showSearchField:this.searchField,showAudioUploader:this.audioUploader,showSearchResultList:this.searchResultList,hasMedia:this.mediaPreview},function(t,e){this.get(e)||t.$el.css({display:"none",opacity:0})},this),this.get("showTos")||this.js$("tos").css({display:"none",opacity:0}),this.get("showCaption")?this.delayedFocus(this.caption):(this.delayedFocus(this.searchField),this.js$("caption").css({display:"none",opacity:0}))},uploadFailedCopyright:function(t){var e="new"===this.post.get("mode")?["spotify","soundcloud","youtube"]:["spotify","soundcloud"],i={maxResults:3};this.searchResultList.setCopyrightWarningMessage(t.message),this.set({showCopyrightWarning:!0,showAudioUploader:!1}),this.subViews.searchField.setEditorValue(t.search_string),this.post.set("copyrightFallback",t.search_string),this._executeAudioSearches(t.search_string,e,i),this.searchField.focus()},switchToVideoPost:function(t){var e={postParams:{type:"video",copyrightFallback:this.post.get("copyrightFallback")},afterReload:function(e){e.postTypeForm.executeUrlParser(t)}};this.trigger("switchPostType","video",e)},getRichTextEditor:function(){return this.caption}});e.exports=f},{"../../services/audio_search_service":92,"../../templates/post_type_form/audio.tpl":125,"../audio_uploader":161,"../confirm_tos":163,"../media/audio":170,"../plaintext_editor":180,"../reblog_tree":198,"../richtext_editor":199,"./_audio_search_results":185,"./base":188,"app/components/dialog":20,lodash:"K2RcUv","prima/lib/logger":403,"prima/lib/translate":423,"prima/utils/getpath":450}],188:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=t("prima/events"),l=i.template(""),h=s.extend({template:l,mixins:[o,n,r],defaults:{hasMediaView:!1,hideControlsLine:!1},defaultOptions:{fullWidthInlineMedia:!1},initialize:function(t){if(this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),!t.post)throw new Error("PostFormView requires a Post model!");if(!t.user)throw new Error("PostFormView requires a User model");i.extend(this,i.pick(t,["post","user","uploads"])),i.isFunction(this.afterInitialize)&&this.afterInitialize.apply(this,arguments)},createSubViews:function(){},subViewOptions:function(){return i.extend({},i.pick(this.options,"fullWidthInlineMedia","dragEvents"),i.pick(this,"model","uploads","user","post"))},addStateListeners:function(){},getRichTextEditor:function(){},serialize:function(){return i.extend({canEditMedia:this.post.canEditMedia()},this.post.toJSON(),this.toJSON())},teardown:function(){return this.stopListening(),this.$el.empty(),this},beforeRender:function(){this.createSubViews(),this.addStateListeners()},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this},registerTitleKeyboardShortcut:function(t){var e=/Mac/.test(navigator.platform)?"meta":"ctrl";return this.listenTo(a,"DOMEventor:keydown:"+e+"+shift+1",function(){t.focus()}),t},delayedFocus:function(t,e,s){"undefined"!=typeof s||(s=!0),"number"==typeof e||(e=200),i.delay(i.bind(function(){t.focus(s),s&&t.setCursorToEnd()},this),e||0)}});e.exports=h},{lodash:"K2RcUv","prima/events":396,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],189:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/lib/translate"),n=t("./base"),r=t("ligature").SelectionPersistence,a=t("../plaintext_editor"),l=t("../../templates/post_type_form/chat.tpl"),h=/^([^(:|\n)]+:)/,d=n.extend({template:l,placeholders:["%1$sFirefighter:%2$s That's the way the cookie crumbles.%3$s%1$sButler:%2$s It falls on me to reassemble the cookie.","%1$sStockbroker:%2$s I need a vacation.%3$s%1$sTourist:%2$s I'm already on one.%3$s%1$sStockbroker:%2$s Get out of my office.","%1$sAbbott:%2$s Who is the man on first base?%3$s%1$sCostello:%2$s That's what I'm telling you!%3$s%1$sAbbott:%2$s I'm unqualified to manage a baseball team.","%1$sRick:%2$s Our problems don't amount to a hill of beans in this crazy world.%3$s%1$sIlsa:%2$s Great, now I'm hungry for beans.","%1$sAlbert Einstein:%2$s Energy equals mass times the speed of light squared.%3$s%1$sCop:%2$s Tell it to the judge.","%1$sAxl:%2$s Welcome to the jungle.%3$s%1$sCustomer:%2$s We'd like a table for two, please.%3$s%1$sAxl:%2$s Your table is right this way.","%1$sTourist:%2$s Could you give us directions to Olive Garden?%3$s%1$sNew Yorker:%2$s No, but I could give you directions to an actual Italian restaurant.","%1$sPangloss:%2$s Could you give me directions to the Olive Garden?%3$s%1$sCandide:%2$s No, but we can cultivate our own garden.%3$s%1$sPangloss:%2$s That sounds rational to me.","%1$sCharles Dickens:%2$s It was the best of mimes, it was the worst of mimes.%3$s%1$sMime:%2$s ...","%1$sJuliet:%2$s Romeo, Romeo, wherefore art thou, Romeo?%3$s%1$sRomeo:%2$s I'm right here, Juliet.?%3$s%1$sJuliet:%2$s “Wherefore” means “why” not “where.”%3$s%1$sRomeo:%2$s Misunderstandings like these are what define our relationship.","%1$sSeal:%2$s Did you know that when it snows my eyes become larger?%3$s%1$sOptometrist:%2$s That's highly abnormal. I'm going to refer you to a specialist.%3$s%1$sSeal:%2$s BABAAAAAAAYYYY!","%1$sSeal:%2$s There's so much a man can tell you, so much he can say.%3$s%1$sMan:%2$s I've just been waiting for someone to ask!","%1$sUsher:%2$s These are my confessions.%3$s%1$sTheater-goer:%2$s These are my tickets.%3$s%1$sUsher:%2$s Right this way."],afterInitialize:function(){this.user.get("language")&&"en_US"!==this.user.get("language")?(this._placeholders=i.filter(this.placeholders,function(t){return o(t)!==t}),i.isEmpty(this._placeholders)&&(this._placeholders=this.placeholders)):this._placeholders=this.placeholders},randomPlaceholder:function(){var t=i.sample(this._placeholders||this.placeholders);return o(t,"<b>","</b>","<br>")},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"title-field",name:"title",isResizable:!0,placeholder:o("Title"),allowLinebreaks:!1},t),s=i.extend({className:"chat-field normal",name:"chat",placeholder:this.randomPlaceholder(),onChange:i.bind(function(){this.formatText()},this),convertNewlinesToLinebreaks:!0},t);this.title=this.subViews.title=new a(e),this.chat=this.subViews.chat=new a(s),this.registerTitleKeyboardShortcut(this.title)},afterRender:function(){this.renderSubViews(),this.model.get("chat")&&this.formatText(),this.delayedFocus(this.chat)},formatText:function(){this.chat.getEditorValue()&&this.formatTextNode(this.chat.editor.element)},formatTextNode:function(t){if(t){if(t.nodeType!==Node.TEXT_NODE)return void i.each(t.childNodes,i.bind(function(t){this.formatTextNode(t)},this));if(this.stripZeroWidthSpaceFromNode(t),"B"===t.parentNode.tagName)return void this.cleanBoldNode(t.parentNode);if(!(s(t).prev().length>0&&"BR"!==s(t).prev()[0].tagName)){var e=t.nodeValue.match(h);if(e){var o=r.saveSelection(this.chat.editor.element),n=t.parentNode;if(i.isObject(n)){var a=e[0];t.nodeValue=t.nodeValue.replace(h,"");var l=document.createElement("b");l.innerHTML=a,n.insertBefore(l,t)}r.restoreSelection(o)}}}},cleanBoldNode:function(t){if("B"===t.tagName)if(t.childNodes.length>1)for(;t.childNodes.length>1&&t.innerHTML.match(/<br\s*[\/]?>/);)t.parentNode.insertBefore(t.firstChild,t);else{var e=t.firstChild;if(-1===e.nodeValue.indexOf(":"))return void this.unwrapNode(t);var i=/:(.+)$/,s=e.nodeValue.match(i);if(s){var o=r.saveSelection(this.chat.editor.element),n=s[1],a=document.createTextNode(n);
e.nodeValue=e.nodeValue.replace(/:(.+)$/,":"),t.parentNode.insertBefore(a,t.nextSibling),r.restoreSelection(o)}}},unwrapNode:function(t){var e=r.saveSelection(this.chat.editor.element),i=t.parentNode,s=t.firstChild,o=s.nodeValue;o&&(i.insertBefore(s,t.nextSibling),i.normalize()),t.remove(),this.formatTextNode(i),r.restoreSelection(e)},stripZeroWidthSpaceFromNode:function(t){var e=/\u200B/g;if(t&&t.nodeType===Node.TEXT_NODE&&t.nodeValue.match(e)){var i=r.saveSelection(this.chat.editor.element);t.nodeValue=t.nodeValue.replace(e,""),Math.max(i.start,i.end)>t.nodeValue.length&&(i.start=i.end=t.nodeValue.length),r.restoreSelection(i)}}});e.exports=d},{"../../templates/post_type_form/chat.tpl":126,"../plaintext_editor":180,"./base":188,jquery:"HlZQrA",ligature:471,lodash:"K2RcUv","prima/lib/translate":423}],190:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("./base"),n=t("../../templates/post_type_form/link.tpl"),r=t("../plaintext_editor"),a=t("../richtext_editor"),l=t("../reblog_tree"),h=t("app/components/remove-button"),d=t("../../services/open_graph_service"),c=t("../../utils/validation"),u=t("prima/utils/url"),p=o.extend({className:"post-composer_link-post",events:{"mouseenter .media-container":"_onHoverRemoveButton","mouseleave .media-container":"_onHoverRemoveButton"},template:n,defaults:i.defaults({hasMediaView:!0,hasMedia:!1,showUrl:!0,showTitle:!1,showCaption:!1,ogFetchPending:!1,isUserTitle:!1,isUserCaption:!1,linkDescriptionClass:"link_og_blockquote"},o.prototype.defaults),afterInitialize:function(){this._ogService=new d,"new"!==this.model.get("mode")&&this.set({showTitle:!0,showCaption:!0}),this.set("hideControlsLine",!this.get("showCaption"))},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"link-title-field",name:"title",isResizable:!1,placeholder:s("Enter a title"),forceSingleLine:!0},t),o=i.extend({className:"url-field",name:"url",isResizable:!1,placeholder:s("Paste a link"),forceSingleLine:!0},t),n=i.extend({className:"caption-field",name:"caption",placeholder:s("Add a description, if you like")},t),d=i.extend({is_removable:!0},t);this.title=this.subViews.title=new r(e),this.url=this.subViews.url=new r(o),this.caption=this.subViews.caption=new a(n),this.removeButton=this.subViews.removeButton=new h({buttonClass:"top-right"}),this.post.isReblog()&&(this.reblogTree=this.subViews.reblogTree=new l(d))},addStateListeners:function(){this.post.canEditMedia()&&this.listenTo(this.removeButton,"remove",this.removeMedia),"reblog"!==this.model.get("mode")&&(this.listenTo(this.post,"change:url",i.debounce(this._onChangeUrl,200)),this.listenTo(this.post,"change:title",this._onChangeTitle),this.listenTo(this.post,"change:caption",this._onChangeCaption)),this.listenTo(this,"change:showTitle",this._onChangeShowTitle),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:showCaption",this._onChangeShowCaption)},_onChangeTitle:function(){this.get("ogFetchPending")||this.set("isUserTitle",!0)},_onChangeCaption:function(){this.get("ogFetchPending")||this.set("isUserCaption",!i.isEmpty(this.post.get("caption")))},_onHoverRemoveButton:function(t){var e="mouseover"===t.type||"mouseenter"===t.type;this.js$("removeButton").toggleClass("active",e)},afterRender:function(){this.renderSubViews(),this.post.canEditMedia()?this.get("showCaption")||this.delayedFocus(this.url):(this.title.disable(),this.url.disable()),this.get("showTitle")||this.title.$el.css({display:"none",opacity:0}),this.get("hasMedia")||this.removeButton.$el.css({display:"none",opacity:0}),this.get("showCaption")?this.delayedFocus(this.caption):this.js$("caption").css({display:"none",opacity:0}),"new"!==this.model.get("mode")&&this._updateWithGraphInfo({url:this.model.get("url"),image:this.model.get("thumbnail")}),this.trigger("media:ready")},_onChangeUrl:function(t,e){if(!this.get("ogFetchPending")){if(i.isEmpty(e))return void this.removeMedia();e=e.trim();var s=u.addProtocolIfMissing(e,"http:");if(c.isUrl(s)){if(this.set("ogFetchPending",!0),e!==s){var o=this.model._previousAttributes.url;this.url.setEditorValue(s),this.model._previousAttributes.url=o}this._ogService.fetchOpenGraphData(s).then(i.bind(this._updateWithGraphInfo,this),i.bind(this._onOpenGraphFail,this))}}},_updateWithGraphInfo:function(t){var e=t.url||this.post.previous("url"),s=function(t){return t.replace(/^https?:\/\/(www.)?/,"")},o=this.model.previous("url")||"",n=s(o)!==s(e);this.$el.addClass("loaded"),this.set({hasMedia:!0,showTitle:!0,showCaption:!0}),n&&((!this.get("isUserTitle")||i.isEmpty(this.post.get("title")))&&(t.title?this.title.setEditorValue(t.title,!0):this.title.setEditorValue("")),(!this.get("isUserCaption")||i.isEmpty(this.post.get("caption")))&&(t.description?this.caption.setEditorValue('<blockquote class="'+this.get("linkDescriptionClass")+'">'+t.description+"</blockquote>",!0):this.caption.setEditorValue(""))),t.image?(this.js$("linkeditor").addClass("has-image"),this.js$("urlimage").css("background-image","url("+t.image+")"),this.model.set("thumbnail",t.image)):(this.js$("linkeditor").removeClass("has-image"),this.js$("urlimage").css("background-image","")),this.set("ogFetchPending",!1)},_onOpenGraphFail:function(){this.set("ogFetchPending",!1)},removeMedia:function(){this.stopListening(),this.post.softReset(),this.get("isUserCaption")||(this.post.set("caption",""),this.caption.setEditorValue("")),i.forEach({title:this.title,url:this.url,caption:this.caption},function(t){t.updateEditorFromModel()},this),this.addStateListeners(),this.set({hasMedia:!1,showTitle:!1,isUserTitle:!1}),i.isEmpty(this.post.get("caption"))&&(this.set("isUserCaption",!1),i.isEmpty(this.post.get("tags"))&&this.set("showCaption",!1)),this.$el.removeClass("loaded"),this.url.focus()},_onChangeShowTitle:function(t,e){this.title.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeHasMedia:function(t,e){this.isRendered()&&this.removeButton.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowCaption:function(t,e){this.set("hideControlsLine",!e),this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},getRichTextEditor:function(){return this.caption}});e.exports=p},{"../../services/open_graph_service":98,"../../templates/post_type_form/link.tpl":127,"../../utils/validation":157,"../plaintext_editor":180,"../reblog_tree":198,"../richtext_editor":199,"./base":188,"app/components/remove-button":231,lodash:"K2RcUv","prima/lib/translate":423,"prima/utils/url":459}],191:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("./base"),n=t("../ask_field"),r=t("../richtext_editor"),a=t("../reblog_tree"),l=t("../../templates/post_type_form/note.tpl"),h=o.extend({template:l,className:"post-composer_note-post",createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"answer-field",name:"answer",placeholder:s("Your answer here")},t),o=i.extend({className:"caption-field",name:"caption",placeholder:s("Add your own text, if you like")},t),l=i.extend({is_removable:!0},t);this.askField=this.subViews.askField=new n(t),this.post.isReblog()?(this.reblogTree=this.subViews.reblogTree=new a(l),this.caption=this.subViews.caption=new r(o)):this.answerField=this.subViews.answerField=new r(e)},afterRender:function(){this.renderSubViews(),this.delayedFocus(this.post.isReblog()?this.caption:this.answerField)},getRichTextEditor:function(){return this.model.get("is_reblog")?this.caption:this.answerField}});e.exports=h},{"../../templates/post_type_form/note.tpl":128,"../ask_field":160,"../reblog_tree":198,"../richtext_editor":199,"./base":188,lodash:"K2RcUv","prima/lib/translate":423}],192:[function(t,e){"use strict";var i=t("lodash"),s=t("./base"),o=t("app/components/dialog"),n=(t("prima/lib/logger"),t("prima/lib/translate")),r=t("prima/utils/url"),a=t("prima/lib/data"),l="FileReader"in window&&"readAsDataURL"in FileReader.prototype,h=t("../../utils/validation"),d=t("../../models/photo"),c=t("../media/photo"),u=t("../photo_media_dropzone"),p=t("../richtext_editor"),m=t("../reblog_tree"),g=t("../../templates/post_type_form/photo.tpl"),f=2048,_=s.extend({template:g,defaults:i.defaults({hasMediaView:!0,hasMedia:!1,canAddMedia:!0,showPhotoBooth:!1,showCaption:!1},s.prototype.defaults),afterInitialize:function(){this._urlParser=i.debounce(i.bind(this._photoUrlParser,this),100),(!this.post.photos.isEmpty()||this.post.isReblog())&&this.set({hasMedia:!0,showCaption:!0}),this.set("canAddMedia",this.post.canEditMedia()&&this.post.canAddPhotos()),this.set("hideControlsLine",!this.get("showCaption"))},_photoUrlParser:function(t,e){if(t=i.trim(t),t&&t.length<f&&h.isUrl(t)){var s=new d;this.listenTo(s,"photo:readUrl",function(t,i){t&&this.post.canAddPhotos()&&(this.post.photos.push(i),e.urlInput.setEditorValue(""),e.urlInput.blur(),e.set({showInput:!1,dropzoneBehavior:"url",defaultBehavior:"url"}))}),s.set("externalUrl",t)}},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({canEditMedia:this.post.canEditMedia()},t),s=i.extend({toggleDropzone:this.get("hasMedia"),dropzoneText:n("Add another"),uploadIcon:"dropzone-add-photo-icon",uploadText:n("Upload photos"),urlIcon:"dropzone-add-url-icon",urlText:n("Add photo from web"),urlParser:this._urlParser,uploadOptions:{}},t);i.extend(s.uploadOptions,{name:"photo",maxUploadSize:10485760,uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:"/svc/post/upload_photo",fileUpload:{multiple:!0}});var o=i.extend({className:"caption-field",name:"caption",placeholder:n("Add a caption, if you like")},t),r=i.extend({is_removable:!0},t);this.mediaPreview=this.subViews.mediaPreview=new c(e),this.mediaComposer=this.subViews.mediaComposer=new u(s),this.caption=this.subViews.caption=new p(o),this.post.isReblog()&&(this.reblogTree=this.subViews.reblogTree=new m(r))},addStateListeners:function(){this.listenTo(this.mediaComposer,"upload:start",this._onFileUploadStart),this.listenTo(this.mediaComposer,"upload:complete",this._onFileUploadComplete),this.listenTo(this.mediaComposer,"upload:error upload:invalid",this._onFileUploadError),this.listenTo(this.mediaComposer,"webcam:show",function(){this.set("showPhotoBooth",!0)}),this.listenTo(this.post.photos,"add",this._onAddPhotos),this.listenTo(this.post.photos,"remove",this._onRemovePhotos),this.listenTo(this.mediaPreview,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.listenTo(this.mediaPreview,"media:addFiles",function(t){this.mediaComposer.addFiles(t)}),this.listenTo(this.mediaPreview,"webcam:close",function(){this.set("showPhotoBooth",!1)}),this.listenTo(this.mediaPreview,"webcam:error",function(t){"NO_DEVICES_FOUND"===t&&(o.alert({text_ok:n("Aw, alright"),text:"<p>"+n("Sorry, beautiful. If you wanna take a selfie, you're gonna need a webcam.")+"</p>"}),this.mediaComposer.set("enableSelfie",!1))}),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:canAddMedia",this._onChangeCanAddMedia),this.listenTo(this,"change:showPhotoBooth",this._onChangeShowPhotoBooth),this.listenTo(this,"change:showCaption",this._onChangeShowCaption)},_onAddPhotos:function(){this.set({hasMedia:!this.post.photos.isEmpty(),canAddMedia:this.post.canAddPhotos()}),i.isEmpty(this.post.get("caption"))&&i.isEmpty(this.post.get("tags"))?this.set("showCaption",this.get("hasMedia")):this.set("showCaption",!0),this.get("showCaption")&&this.caption.focus(),this.mediaComposer.set({toggleDropzone:!this.post.photos.isEmpty()})},_onRemovePhotos:function(){this.set({hasMedia:!this.post.photos.isEmpty()||this.get("showPhotoBooth"),canAddMedia:this.post.canAddPhotos()}),this.mediaComposer.set({toggleDropzone:!this.post.photos.isEmpty()})},_onChangeHasMedia:function(t,e){this.isRendered()&&this.mediaPreview.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeCanAddMedia:function(t,e){this.isRendered()&&(this.mediaPreview.$el.toggleClass("photo-media-container--can-add",e),this.mediaComposer.$el.css(e?{display:"block",opacity:1}:{display:"none",opacity:0}))},_onChangeShowPhotoBooth:function(t,e){this.isRendered()&&(this.mediaPreview.set("showPhotoBooth",e),this.mediaPreview.$el.toggleClass("photo-media-container--show-photobooth",e),e?(this.mediaPreview.$el.css({display:"block",opacity:1}),this.mediaComposer.$el.css({display:"none",opacity:0})):(this._onChangeHasMedia(this,this.get("hasMedia")),this._onChangeCanAddMedia(this,this.get("canAddMedia"))))},_onChangeShowCaption:function(t,e){this.set("hideControlsLine",!e),this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onFileUploadStart:function(t){if(!i.isEmpty(t.get("error")))return this._onFileUploadError(t);this.uploads.add(t);var e=t.get("file");this.mediaPreview.set({file:e,canEditMedia:!0});var s=new d;l?this.listenTo(s,"photo:readFile",function(t,e){t&&this.post.canAddPhotos()&&(this.post.photos.push(e),this.mediaComposer.set({dropzoneBehavior:"upload",defaultBehavior:"upload"}))}):this.listenTo(s,"change:preuploadUrl",function(t,e){e&&(this.stopListening(t,"change:preuploadUrl"),this.post.canAddPhotos()&&(this.post.photos.push(t),this.mediaComposer.set({dropzoneBehavior:"upload",defaultBehavior:"upload"})))}),t.set("postPhoto",s),s.set("upload",t),s.set("file",e)},_onFileUploadComplete:function(t){var e=t.get("postPhoto");e&&(t.get("url")?e.set("preuploadUrl",t.get("url")):(o.alert("<p>"+[t.get("original_filename"),n(t.get("error"))].join("</p><p>")+"</p>"),this.post.photos.remove(e)))},_onFileUploadError:function(t){var e=t.get("error");i.isString(e)&&(e=[e]),i.isArray(e)||(e=[n("Woops :(")]),t.get("file")&&t.get("file").name&&e.unshift(t.get("file").name),o.alert("<p>"+e.join("</p><p>")+"</p>");var s=t.get("postPhoto");this.post.photos.remove(s),this.uploads.remove(t)},afterRender:function(){this.checkUrl(),this.renderSubViews(),this.get("canAddMedia")?this.mediaPreview.$el.addClass("photo-media-container--can-add"):this.mediaComposer.$el.css({display:"none",opacity:0}),this.get("hasMedia")||this.mediaPreview.$el.css({display:"none",opacity:0}),this.get("showCaption")?this.delayedFocus(this.caption):this.js$("caption").css({display:"none",opacity:0})},checkUrl:function(){var t=r.getParameter("src"),e=r.getParameter("caption"),i=r.getParameter("tags");r.isAbsoluteUrl(t)||(t=a.get("Context.hosts.assets_host")+t),"edit"!==this.model.get("mode")&&t&&e&&i&&(this._photoUrlParser(t,this.mediaComposer),this.model.set("caption",e),this.model.set("tags",i.split(",")),window.Backbone.history.navigate("/new/photo",{replace:!0}))},getRichTextEditor:function(){return this.caption}});e.exports=_},{"../../models/photo":85,"../../templates/post_type_form/photo.tpl":129,"../../utils/validation":157,"../media/photo":174,"../photo_media_dropzone":179,"../reblog_tree":198,"../richtext_editor":199,"./base":188,"app/components/dialog":20,lodash:"K2RcUv","prima/lib/data":398,"prima/lib/logger":403,"prima/lib/translate":423,"prima/utils/url":459}],193:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("../../utils/string_helpers"),n=t("./base"),r=t("../plaintext_editor"),a=t("../richtext_editor"),l=t("../../templates/post_type_form/quote.tpl"),h=n.extend({defaults:i.defaults({fontSizes:["extra_large","large","medium","small"]},n.prototype.defaults),template:l,afterInitialize:function(){this.listenTo(this.model,"change:quote",this.updateQuoteSize),this.wrapSource()},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"quote-field",name:"quote",placeholder:"&ldquo;"+s("Quote")+"&rdquo;"},t),o=i.extend({className:"source-field",name:"source",placeholder:s("Source")},t);this.quote=this.subViews.quote=new r(e),this.source=this.subViews.source=new a(o)},afterRender:function(){return this.renderSubViews(),this.updateQuoteSize(this.model,this.model.get("quote")||""),this.delayedFocus(i.isEmpty(this.model.get("source"))?this.quote:this.source),this.quote.editor.isEmpty()&&this.quote.editor.setData(""),this.cleanQuote(),this},teardown:function(){return this.$el.empty(),this},updateQuoteSize:function(t,e){if("string"==typeof e){var i=e.length;this._setQuoteSize(20>i?"extra_large":81>i?"large":300>i?"medium":"small")}},_setQuoteSize:function(t){var e=this.quote.$el;e.hasClass(t)||(e.removeClass(this.get("fontSizes").join(" ")),e.addClass(t))},cleanQuote:function(){var t=this.model.get("quote");t&&this.model.set("quote",o.stripHtml(t,!1))},getRichTextEditor:function(){return this.source},wrapSource:function(){var t=this.model.get("source");!t||t.indexOf("<p>")>-1||this.model.set("source","<p>"+t+"</p>")}});e.exports=h},{"../../templates/post_type_form/quote.tpl":130,"../../utils/string_helpers":156,"../plaintext_editor":180,"../richtext_editor":199,"./base":188,lodash:"K2RcUv","prima/lib/translate":423}],194:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("./base"),n=t("../plaintext_editor"),r=t("../reblog_tree"),a=t("../richtext_editor"),l=t("../../templates/post_type_form/text.tpl"),h=o.extend({events:{},template:l,createSubViews:function(){var t=this.subViewOptions(),e=i.extend({className:"title-field",name:"title",placeholder:s("Title")},t),o=i.extend({className:"caption-field",name:"body",placeholder:s("Your text here")},t),l=i.extend({is_removable:!0},t);this.title=this.subViews.title=new n(e),this.body=this.subViews.body=new a(o),this.post.isReblog()&&(this.reblogTree=this.subViews.reblogTree=new r(l)),this.registerTitleKeyboardShortcut(this.title)},afterRender:function(){this.renderSubViews(),this.delayedFocus(this.body)},getRichTextEditor:function(){return this.body}});e.exports=h},{"../../templates/post_type_form/text.tpl":131,"../plaintext_editor":180,"../reblog_tree":198,"../richtext_editor":199,"./base":188,lodash:"K2RcUv","prima/lib/translate":423}],195:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("moment"),n=t("./base"),r=t("app/components/dialog"),a=(t("prima/lib/logger"),t("prima/lib/flags")),l=t("prima/lib/translate"),h=t("../../services/embed_data"),d=t("../../utils/camelize_keys"),c=function(){return s.browser.chrome?".mp4,.mov,.wmv,video/*":s.browser.mozilla?"video/*":""}(),u=t("../media/video"),p=t("../media_dropzone"),m=t("../confirm_tos"),g=t("../richtext_editor"),f=t("../reblog_tree"),_=t("../../templates/post_type_form/video.tpl"),v=n.extend({template:_,defaults:i.defaults({hasMediaView:!0,hasMedia:!1,showTos:!1,showCaption:!1},n.prototype.defaults),afterInitialize:function(){this._urlParser=i.debounce(i.bind(this._embedCodeParser,this),100),this.post.getEmbedData()&&this.set({hasMedia:!0,showCaption:!0}),this.post.get("copyrightFallback")&&this.set({hasMedia:!0}),this.set("hideControlsLine",!this.get("showCaption"))},createSubViews:function(){var t=this.subViewOptions(),e=i.extend({embed:this.post.getEmbedData(),canEditMedia:this.post.canEditMedia()},t),s=i.extend({url:this.post.get("embedCode"),showInput:!i.isEmpty(this.post.get("embedCode")),embed:this.post.getEmbedData(),uploadIcon:"dropzone-add-video-icon",uploadText:l("Upload a video"),uploadTooltip:function(){var e=1e3*t.user.get("videoSecondsRemaining");return"<p>"+["<strong>"+l("Upload a video")+"</strong>",l("%1$s minutes of video remaining today.",o.utc(e).format("m:ss")),l("%1$s max per file.","100MB")].join("</p><p>")+"</p>"},urlIcon:"dropzone-add-url-icon",urlText:l("Add video from web"),urlParser:this._urlParser,uploadOptions:{}},t);i.extend(s.uploadOptions,{name:"video",maxUploadSize:a.bool("ignore_video_upload_limits")?!1:104857600,uploadPattern:/^video\/(?:.*)$/i,accept:c,url:"/svc/post/upload_video"});var n=i.extend({},t),r=i.extend({className:"caption-field",name:"caption",placeholder:l("Add a caption, if you like")},t),h=i.extend({is_removable:!0},t);this.mediaPreview=this.subViews.mediaPreview=new u(e),this.mediaComposer=this.subViews.mediaComposer=new p(s),this.confirmTos=this.subViews.confirmTos=new m(n),this.caption=this.subViews.caption=new g(r),this.post.isReblog()&&(this.reblogTree=this.subViews.reblogTree=new f(h))},addStateListeners:function(){this.listenTo(this.mediaComposer,"upload:start",this._onFileUploadStart),this.listenTo(this.mediaComposer,"upload:complete",this._onFileUploadComplete),this.listenTo(this.mediaComposer,"upload:error upload:invalid",this._onFileUploadError),this.listenTo(this.mediaPreview,"media:ready",function(){var t=i.toArray(arguments);t.unshift("media:ready"),this.trigger.apply(this,t)}),this.post.canEditMedia()&&this.listenTo(this.mediaPreview,"media:remove",this.removeMedia),this.listenTo(this,"change:hasMedia",this._onChangeHasMedia),this.listenTo(this,"change:showTos",this._onChangeShowTos),this.listenTo(this,"change:showCaption",this._onChangeShowCaption)},removeMedia:function(){this.post.softReset(),this.set({hasMedia:!1,showTos:!1}),this.mediaPreview.set({file:!1,embed:!1}),this.js$("confirmTos").attr("checked",!!this.post.get("confirmTos")),i.isEmpty(this.post.get("caption"))&&i.isEmpty(this.post.get("tags"))&&this.set("showCaption",!1)},_onChangeHasMedia:function(t,e){this.isRendered()&&(e?(this.mediaComposer.$el.css({display:"none",opacity:0}),this.mediaPreview.$el.css({display:"block",opacity:1})):(this.mediaPreview.$el.css({display:"none",opacity:0}),this.mediaComposer.$el.css({display:"block",opacity:1})))},_onChangeShowTos:function(t,e){this.isRendered()&&this.js$("tos").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onChangeShowCaption:function(t,e){this.set("hideControlsLine",!e),this.isRendered()&&this.js$("caption").css(e?{display:"block",opacity:1}:{display:"none",opacity:0})},_onFileUploadStart:function(t){this.uploads.add(t);var e=t.get("file");this.mediaPreview.set({file:e,canEditMedia:!0}),this.listenToOnce(this.mediaPreview,"media:ready",function(){this.set({hasMedia:!0,showTos:!0,showCaption:!0}),this.caption.focus()})},_onFileUploadComplete:function(t){var e=t.get("file"),i="portrait"===t.get("orientation");this.mediaPreview.set({file:e,canEditMedia:!0,width:t.get(i?"height":"width"),height:t.get(i?"width":"height")}),this.post.set({preuploadUrl:t.get("key"),preuploadKey:t.get("ch")})},_onFileUploadError:function(t){var e=t.get("error")||l("Error uploading video");i.isArray(e)&&(e=e.join("</p><p>")),r.alert("<p>"+e+"</p>"),this.removeMedia()},_embedCodeParser:function(t){if(this._embedCodeParsing&&this._embedCodeParsing.abortEmbedCodeParse(),!i.isEmpty(i.trim(t))){var e=!1,s=this._parseEmbedCode=h.parseEmbedData(t,540).then(i.bind(function(s){e||(this._embedCodeParsing=!1),this.listenToOnce(this.mediaPreview,"media:ready",function(){this.set({hasMedia:!0,showCaption:!0}),this.caption.focus()}),this.mediaPreview.set(i.extend({embed:d(s),canEditMedia:!0},i.pick(s,["width","height"]))),this.post.set({embedCode:t})},this),function(t){});return s.abortEmbedCodeParse=function(){e=!0},s}},afterRender:function(){this.renderSubViews(),this.get("hasMedia")?this.mediaComposer.$el.css({display:"none",opacity:0}):this.mediaPreview.$el.css({display:"none",opacity:0}),this.get("showTos")||this.js$("tos").css({display:"none",opacity:0}),this.get("showCaption")?this.delayedFocus(this.caption):this.js$("caption").css({display:"none",opacity:0})},executeUrlParser:function(t){this.subViews.mediaComposer.urlParser(t)},getRichTextEditor:function(){return this.caption}});e.exports=v},{"../../services/embed_data":94,"../../templates/post_type_form/video.tpl":132,"../../utils/camelize_keys":150,"../confirm_tos":163,"../media/video":175,"../media_dropzone":176,"../reblog_tree":198,"../richtext_editor":199,"./base":188,"app/components/dialog":20,jquery:"HlZQrA",lodash:"K2RcUv",moment:"iROhDJ","prima/lib/flags":"f/LVtH","prima/lib/logger":403,"prima/lib/translate":423}],196:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=t("../templates/reblog_as_button.tpl"),l=t("./reblog_as_dropdown"),h=s.extend({className:"post-form--reblog-as-button",events:{"click [data-js-clickableReblogSelect]":"toggleReblogAsDropdown"},mixins:[o,n,r],template:a,initialize:function(t){t=i.extend(t||{},{shift:{x:-5,y:10},identifier:"reblogAsDropdown"}),this.post=t.post,this.reblogAsDropdown=new l(t);var e="reblogAs:type";this.listenToOnce(this.reblogAsDropdown,e,function(){this.trigger.apply(this,i.union([e],arguments))})},render:function(){return"reblog"===this.post.get("mode")&&(this.$el.html(this.template({post:this.post})),this.reblogAsDropdown.setPinnedTarget(this.js$("clickableReblogSelect")),this.attachSubViews()),this},toggleReblogAsDropdown:function(t){var e=i.isBoolean(t)?t:!this.reblogAsDropdown.isOrWasRecentlyRendered();e&&this.reblogAsDropdown.render()}});e.exports=h},{"../templates/reblog_as_button.tpl":133,"./reblog_as_dropdown":197,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],197:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("prima/lib/translate"),a=t("prima/mixins/accessor"),l=t("prima/mixins/popoverbase"),h=t("../templates/reblog_as_dropdown.tpl"),d=o.extend({className:"popover--reblog-as-dropdown",events:{"click .item-option":"setReblogType"},mixins:[a,l],template:h,initialize:function(t){this.post=t.post},reblogAsTypes:function(){return s.transform(this.post.get("can_reblog_as"),function(t,e){t[e]=r(s.capitalize(e))},{})},render:function(){return this.delegateEvents(),this.$el.html(this.template(this.serialize())),n.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),n.trigger("postForms:dismissListener:resume"),this},serialize:function(){return{postType:this.post.get("type"),postReblogAsTypes:this.reblogAsTypes()}},setReblogType:function(t){var e=i(t.currentTarget).data("reblogAsType");e!==this.post.get("type")&&this.trigger("reblogAs:type",e),this.teardown()}});e.exports=d},{"../templates/reblog_as_dropdown.tpl":134,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/mixins/accessor":425,"prima/mixins/popoverbase":432,"prima/view":460}],198:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/translate"),n=t("prima/lib/flags"),r=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),l=t("prima/mixins/accessor"),h=t("../templates/reblog_tree.tpl"),d=t("app/components/remove-button"),c=s.extend({className:"post-reblog-tree",events:{"click .btn-toggle-reblog":"toggleRemoveReblogTree"},mixins:[r,a,l],template:h,render:function(){return this.removeButton=this.subViews.removeButton=new d({tooltip:o("Remove reblogs"),buttonClass:"btn-remove-tree btn-toggle-reblog"}),this.$el.html(this.template(this.serialize())),this.attachSubViews(),this},teardown:function(){return this.$el.empty(),this},serialize:function(){return{showReblogTree:!i.isUndefined(this.model.get("reblog_tree"))&&this.model.get("reblog_tree"),post:this.model}},toggleRemoveReblogTree:function(t){var e=this.$(t.currentTarget),i=e.closest(".control-reblog-tree"),s=this.model.has("remove_reblog_tree")&&this.model.get("remove_reblog_tree")===!0;this.model.set("remove_reblog_tree",!s),i.toggleClass("removed",!s)}});e.exports=n.bool("reblog_ui_refresh")?t("app/components/reblog-trail/views/reblog_trail"):c},{"../templates/reblog_tree.tpl":135,"app/components/reblog-trail/views/reblog_trail":219,"app/components/remove-button":231,lodash:"K2RcUv","prima/lib/flags":"f/LVtH","prima/lib/translate":423,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],199:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("velocity-animate").animate,r=t("velocity-animate").hook,a=t("prima/utils/exposer"),l=t("app/components/dialog"),h=(t("prima/lib/logger"),t("prima/lib/translate")),d=(window.File,t("remarkable")),c=new d({html:!0}),u=t("to-markdown").toMarkdown,p=t("app/components/upload/collections/uploads"),m=t("ligature").RichTextEditor,g=t("ligature").HumanKeys,f=t("../services/mention_support"),_=t("../services/inline_embed_support"),v=t("./mention_dropdown"),b=t("./html_field"),y=t("app/components/upload"),w=t("prima/mixins/subviewable"),x=t("prima/mixins/selectorcache"),k=t("prima/mixins/accessor"),C=t("prima/mixins/tablimiter"),S=t("../templates/richtext_editor.tpl"),T=t("prima/lib/data"),$=t("../utils/validation"),R=t("prima/utils/image/loader"),E=t("prima/utils/image/filereader"),j=t("prima/utils/image/canvas"),P=t("../services/image_url_upload"),F=t("../utils/remap-html-tags"),A=1080,U=o.extend({defaults:{placeholder:"",name:"",syncWithModel:!0,supportImages:!0,supportInlineEmbeds:!0,supportMentions:!0,inlineMediaWidthReblog:250,inlineEmbedsPerPost:10,animateInlineControls:!0},events:{},mixins:[k,w,x,C],template:S,pendingMedia:{},initialize:function(t){t||(t=i.extend({},t)),i.extend(this.attributes,{inlineMediaWidthFull:t.fullWidthInlineMedia?540:500},i.pick(t,i.keys(this.defaults))),this.hosts=T.get("Context/hosts"),this.uploads=t.uploads||new p,this.editor=null,this.humanKeys=new g,this.keyCommands=U.KEYCOMMANDS,i.forEach(["onChange","onClientEvent","onImageAdded","pasteHook"],function(e){var s=t[e]||this[e];this[e]=i.isFunction(s)?i.bind(s,this):i.noop},this);var e=this.get("name");e&&this.get("syncWithModel")&&(this.$el.attr("data-name",e),this.listenTo(this.model,"change:editorType",this._onChangeEditorType),this.listenToOnce(this.model,"change:"+e,i.bind(function(){"rich"===this.getEditorType()&&this.updateEditorFromModel()},this))),i.has(t,"user")&&t.user.has("inlineEmbedsPerPost")&&this.set("inlineEmbedsPerPost",t.user.get("inlineEmbedsPerPost"))},_onChangeEditorType:function(t,e){var i=t.previous("editorType");"rich"===i?this.updateModelFromEditor("markdown"!==e,"markdown"===e):"markdown"===i&&this.convertModelFromMarkdown(),"markdown"===e&&this.convertModelToMarkdown(),this.updateEditorType(e,!0),this.focus()},_initializeEditor:function(t,e){var o=i.bind(this.humanKeys.pretty,this.humanKeys),a={placeholder:e,flattenBlocks:!0,onChange:this._composeOnChange(),onAsyncImageAdded:i.bind(this.onAsyncImageAdded,this),onFileAdded:i.bind(this.insertImageFromFile,this),inlineControlsConfig:{openTray:i.bind(this.openInlineControlsTray,this),closeTray:i.bind(this.closeInlineControlsTray,this),onTrayOpened:i.bind(this.onInlineControlsTrayOpened,this),onTrayClosed:i.bind(this.onInlineControlsTrayClosed,this),onShow:i.bind(this.onInlineControlsShow,this),onHide:i.bind(this.onInlineControlsHide,this),customOffset:{x:0,y:0}},formattingControlsConfig:{controls:{bold:{el:"b",className:"bold",command:"bold",type:"inline",title:h("Bold (%1$s)",o(this.keyCommands.BOLD)),keyboard:this.keyCommands.BOLD},italic:{el:"i",className:"italic",command:"italic",type:"inline",title:h("Italic (%1$s)",o(this.keyCommands.ITALIC)),keyboard:this.keyCommands.ITALIC},headline:{el:"h2",className:"headline",command:"formatBlock",type:"block",title:h("Headline (%1$s)",o(this.keyCommands.HEADLINE)),keyboard:this.keyCommands.HEADLINE},link:{el:"a",className:"link",command:"createLink",type:"inline",title:h("Link (%1$s)",o(this.keyCommands.LINK)),keyboard:this.keyCommands.LINK},strikethrough:{el:"strike",className:"strikethrough",command:"strikethrough",type:"inline",title:h("Strikethrough (%1$s)",o(this.keyCommands.STRIKETHROUGH)),keyboard:this.keyCommands.STRIKETHROUGH},orderedList:{el:"ol",className:"ordered-list",command:"insertOrderedList",type:"list",title:h("Ordered list (%1$s)",o(this.keyCommands.ORDEREDLIST)),keyboard:this.keyCommands.ORDEREDLIST},unorderedList:{el:"ul",className:"unordered-list",command:"insertUnorderedList",type:"list",title:h("Unordered list (%1$s)",o(this.keyCommands.UNORDEREDLIST)),keyboard:this.keyCommands.UNORDEREDLIST},blockquote:{el:"blockquote",className:"quote",command:"formatBlock",type:"block",title:h("Blockquote (%1$s)",o(this.keyCommands.BLOCKQUOTE)),keyboard:this.keyCommands.BLOCKQUOTE},clear:{el:"",command:"removeFormat",type:"inline",keyboard:this.keyCommands.REMOVEFORMAT},pre:{el:"pre",command:"formatBlock",type:"block",keyboard:this.keyCommands.PRE},superscript:{el:"sup",command:"superscript",type:"inline",keyboard:this.keyCommands.SUPERSCRIPT},subscript:{el:"sub",command:"subscript",type:"inline",keyboard:this.keyCommands.SUBSCRIPT},small:{el:"small",command:"insertHTML",type:"inline",keyboard:this.keyCommands.SMALL,keyboardInverse:this.keyCommands.SMALLINVERSE}},controlsOrder:["bold","italic","headline","link","strikethrough","orderedList","unorderedList","blockquote"]},pasteHook:this.pasteHook,runIFrameSanitization:!1,mediaHolderSubclasses:{img:"media-holder-draggable",hr:"media-holder-draggable media-holder-hr",figure:"media-holder-draggable media-holder-figure"},filterRules:{elements:["a","b","i","strike","h2","blockquote","p","ul","ol","li","iframe","figure","img","br","hr","pre","code","small","sup","sub"],attributes:{a:["href","title"],img:["src","alt","data-img-key"],iframe:["src","width","height"],figure:["data-provider","data-url","data-orig-width","data-orig-height","data-embed-code"],hr:["data-label"]},classnames:{a:["tumblr_blog"],hr:["tmblr-truncated"],blockquote:["link_og_blockquote"],figure:["tmblr-embed","tmblr-embed-placeholder"]},remove_contents:["style","noscript","script","meta"],protocols:{a:!1}},animateShowControls:function(t){t.element.show();
var e=60,o=8;i.forEach(t.buttons,function(t,i){var a=s(t);n(a,"stop"),r(a,"translateY",o),a.css("opacity",0),n(a,{translateY:[0,o],opacity:[1,0]},{delay:.25*i*e,duration:e,complete:function(){a.attr("style","")}})},this)},animateHideControls:function(t){var e=100,o=8;i.forEach(t.buttons,function(i,r){var a=s(i);n(a,"stop");var l=n(a,{translateY:o,opacity:0},{duration:e});r===t.buttons.length-1&&l.then(function(){t.element.hide()})},this)},mediaKillerMarkup:'<div class="media-button icon_close"></div>',mediaMoverMarkup:'<div class="media-button icon_drag"></div>',showStaticControls:!1};this._setupEditorFilters(),this.editor=new m(t,a),this.inlineControlNode=!1,this.get("supportImages")&&this._initializeImageSupport(),this.inlineEmbedSupport=!1,this.get("supportInlineEmbeds")&&this._initializeInlineEmbedSupport(),this.mentionSupport=!1,this.get("supportMentions")&&this._initializeMentionSupport(),this._initializeReadMoreSupport(),this.editor.config.filterForSetData=i.compose.apply(this,this.editorFilters.preSet),this.editor.config.filterForGetData=i.compose.apply(this,this.editorFilters.preGet),this.updateEditorType(),"markdown"===this.getEditorType()&&(this.model.set(this.get("name"),this._modelValue().replace(/^\s*<p>([\S\s]*)<\/p>\s*$/i,"$1")),this.htmlField.updateValueFromModel(),this.htmlField.updateEditor())},_setupEditorFilters:function(){this.editorFilters={preSet:[],preGet:[]},this.editorFilters.preSet.push(this._tagTranslator)},_tagTranslator:function(t,e){return e||(e={h1:"h2",h3:"b",h4:"b",h5:"b",h6:"b",strong:"b",em:"i"}),F(t,e)},_composeOnChange:function(){var t=[this.onChange],e=this;return this.get("syncWithModel")&&t.unshift(this.updateModelFromEditor),function(){i.each(t,function(t){t.call(e)})}},pasteHook:function(t,e){var i=t.getData("text/plain"),s=i.trim();return $.isImageUrl(s)&&!e?(this.insertImageFromUrl(s,i),!0):$.isUrl(s)&&!e?(this.editor.insertData('<a href="'+s+'">'+s+"</a>"),!0):void 0},_initializeImageSupport:function(){this.imageUploader=new y({name:"image",maxUploadSize:10485760,uploadPattern:/^image\/(?:.*)$/i,accept:"image/*",url:"/svc/post/upload_text_image"});var t=s("<div />",{"class":"control add-image",tabindex:"0",title:h("Insert photo (%1$s)",this.humanKeys.pretty(this.keyCommands.PHOTO))});t.on("click",i.bind(function(){this.editor.staticControls.hide()},this)),t.append('<input type="file" accept="image/*" tabindex="-1">'),t.on('change input[type="file"]',i.bind(function(e){var o=s(e.target),n=i.toArray(o.prop("files"));i.forEach(n,function(t){this.insertImageFromFile(t)},this),o.remove(),t.append('<input type="file" accept="image/*">'),this.editor.inlineControls.close()},this)),this.editor.inlineControls.addToTray(t,{keyboard:{shortcut:this.keyCommands.PHOTO,callback:i.bind(function(){this._inlineControlKeyboardFocus(t)},this)}}),this.listenTo(this.imageUploader,"add",this._onFileUploadAdd),this.listenTo(this.imageUploader,"error",this._onFileUploadError)},_onFileUploadAdd:function(t){this.uploads.add(t)},_onFileUploadError:function(t,e){var i=e.get("error")||h("Error uploading photo");l.alert("<p>"+i+"</p>")},insertImageFromUrl:function(t,e){e||(e=t),R.load(t).then(i.bind(function(t){this.editor.insertAsyncImage(t.src)},this),i.bind(function(){this.editor.insertData(e)},this))},insertImageFromFile:function(t,e,s){t.type.match(/image\/(jpg|jpeg|png)/i)?E.read(t).then(i.bind(function(o){R.load(o.objectUrl||o.base64).then(i.bind(function(i){var n=new Image;n.src=i.src;var r=j.drawScaledAndRotated(n,i.width,i.height,o.rotation,o.mirrored,A);this.editor.insertAsyncImage(r.toDataURL(o.file.type),t,e,s)},this))},this)):t.type.match(/image\/*/i)&&this.editor.insertAsyncImage(null,t,e,s)},onAsyncImageAdded:function(t,e,i){if(i instanceof Blob)this.uploadInlineImage(t,i),this.pendingMedia[t]=e;else{if(!e||0!==e.lastIndexOf("http",0))return;this.uploadInlineImageUrl(t,e),this.pendingMedia[t]=e}},updateImageSource:function(t,e){var o=this.model.get("editorType"),n=i.bind(function(){var i=document.createElement("div");i.innerHTML=this._modelValue();var o=s(i).find("["+this.editor.config.imgKeyAttr+"="+t+"]").get(0);s(o).attr("src",e),s(o).removeAttr("data-uploading-key"),s(o).removeAttr(this.editor.config.imgKeyAttr),this.model.set(this.get("name"),i.innerHTML)},this);"rich"===o?(this.editor.updateAsyncImage(t,e),s(this.editor.getAsyncImage(t)).removeAttr(this.editor.config.imgKeyAttr),this.updateModelFromEditor()):"markdown"===o?(this.convertModelFromMarkdown(),n(),this.convertModelToMarkdown(),this.htmlField.updateValueFromModel(),this.htmlField.updateEditor()):"html"===o&&(n(),this.htmlField.updateValueFromModel(),this.htmlField.updateEditor()),delete this.pendingMedia[t]},uploadInlineImageUrl:function(t,e){P.uploadImageUrl(e,i.bind(function(e){this.updateImageSource(t,e.response.url)},this),i.bind(function(){this.updateImageSource(t,e)},this))},uploadInlineImage:function(t,e){var o=i.bind(function(t,e){this.listenTo(e,"change:complete change:error",i.bind(function(e){var s=e.get("url");i.has(e.changed,"error"),R.load(s).then(i.bind(function(){this.updateImageSource(t,s)},this)),this.stopListening(e,"change:complete change:error")},this))},this),n=function(i){i.get("file")===e&&(o.call(this,t,i),this.stopListening(this.imageUploader,"add",n))},r=function(o,n){if(n.get("file")===e){var r=s(this.editor.getAsyncImage(t)),d=r.closest(".media-holder");d.length?d.remove():r.remove(),this.updateModelFromEditor();var c;c=n.get("error")||h("Error uploading photo"),i.isArray(c)&&(c=c.join("</p><p>")),l.alert("<p>"+c+"</p>",i.bind(this.editor.focus,this.editor)),a.call(this,o,n)}},a=function(t,i){var s=i.files?i.files[0]:i.file;s=s||i.get("file"),s===e&&(this.stopListening(this.imageUploader,"add",n),this.stopListening(this.imageUploader,"invalid",r),this.stopListening(this.imageUploader,"send",a))};this.listenTo(this.imageUploader,"add",n),this.listenTo(this.imageUploader,"invalid",r),this.listenTo(this.imageUploader,"send",a),this.imageUploader.addFiles([e])},toggleInlineControlsTray:function(t){i.has(this.editor,"inlineControls")&&(t=t||!1,this.editor.inlineControls.toggleTrayWithIntent(t))},openInlineControlsTray:function(t){t=t||s(),n(t,"stop",!0),t.css({opacity:"",left:""}),this.editor.setPlaceholder(!1),this.editor.blur(!0),this.$el.addClass("tray-open"),this.catchTabs(t),t.attr("tabindex",0).get(0).focus(),this.catchEsc(t,this.toggleInlineControlsTray),this.get("animateInlineControls")&&i.forEach(t.find(".control"),function(t,e){var i=s(t);n(t,"stop",!0),i.css({opacity:0,left:"-25px"}),n(t,{opacity:1,left:0},{delay:30*e,duration:300,easing:[.175,.885,.32,1.275]})})},closeInlineControlsTray:function(t){t=t||s(),this.releaseTabs(),this.releaseEsc(t);var e=function(){t.css({opacity:"",left:""}),t.length&&t.is(":visible")&&this.editor.focus(!0),this.editor.setPlaceholder(this.get("placeholder")),this.$el.removeClass("tray-open")};n(t,{opacity:0,left:"-=20px"},{duration:150,complete:i.bind(e,this)})},onInlineControlsTrayOpened:function(t){this.inlineEmbedSupport&&(this.inlineControlNode=this.editor.getCurrentElement(),this.inlineEmbedSupport.trayClosed(t),this.trigger("controls:open",t))},onInlineControlsTrayClosed:function(t){this.inlineControlNode=!1,this.inlineEmbedSupport&&(this.inlineEmbedSupport.trayOpened(t),this.trigger("controls:close",t))},onInlineControlsShow:function(t){t.element.show(),this.trigger("controls:show")},onInlineControlsHide:function(t){t.element.hide(),this.trigger("controls:hide")},_initializeMentionSupport:function(){var t=["tumblelog"];i.isArray(this.editor.config.linkConfig.bypassClasses||!1)&&(t=i.union(this.editor.config.linkConfig.bypassClasses,t)),this.editor.linkControl.bypassClasses=t,this.mentionPopover=new v({pinnedSide:"none",teardownOnEscape:!1,identifier:"postForms:mentionDropdown"}),this.mentionSupport=new f(this.editor,this.mentionPopover),this.getEditorValue=i.compose(this.mentionSupport.stripGhost,this.getEditorValue)},_getReadMoreMarkup:function(){return'<hr class="tmblr-truncated" data-label="'+h("Keep reading")+'">'},convertReadMoreMagicKey:function(t){var e=t.replace(/\[\[MORE\]\]/g,this._getReadMoreMarkup());return e},convertReadMoreHtml:function(t){var e=document.createElement("div");e.innerHTML=t,s(e).find(".tmblr-truncated").replaceWith("[[MORE]]");var i=s(e).html();return i},_createEmptyParagraph:function(){return this.editor.isCursorAtStart()?this.editor.insertNewParagraphBefore():this.editor.insertNewParagraphAfter()},_inlineControlKeyboardFocus:function(t,e,o){var n;this.editor.hasSelection()||(n=function(){var i=this.get("animateInlineControls");this.set("animateInlineControls",!1),this.toggleInlineControlsTray(!0),t&&s(t).focus(),"function"==typeof e&&e.call(o||this,t),this.set("animateInlineControls",i)},this.editor.isEmptyElement()?n.call(this):(this.listenToOnce(this,"controls:show",function(){setTimeout(i.bind(n,this),50)}),this._createEmptyParagraph()))},_initializeReadMoreSupport:function(){var t=function(t){return t.stopPropagation(),t.preventDefault(),!1},e=i.bind(function(){this.editor.hasSelection()||this.editor.insertMedia("<hr>")},this),o=i.bind(function(){if(!this.editor.hasSelection()){var t=this.$(".media-holder .tmblr-truncated");t.length&&t.closest(".media-holder").remove(),this.editor.insertMedia(this._getReadMoreMarkup())}},this),n=s("<div />",{"class":"control add-hr",tabindex:"0",title:h("Insert horizontal line (%1$s)",this.humanKeys.pretty(this.keyCommands.HR))});n.on("click",e),n.on("mousedown",t);var r=s("<div />",{"class":"control add-read-more",tabindex:"0",title:h("Insert read-more link (%1$s)",this.humanKeys.pretty(this.keyCommands.MORE))});r.on("click",o),r.on("mousedown",t),this.editor.inlineControls.addToTray(n,{keyboard:{shortcut:this.keyCommands.HR,callback:e}}),this.editor.inlineControls.addToTray(r,{keyboard:{shortcut:this.keyCommands.MORE,callback:o}}),this.editorFilters.preSet.push(i.bind(function(t){var e=t;return e=this.convertReadMoreMagicKey(e)},this)),this.editorFilters.preGet.push(i.bind(function(t){var e=t;return e=this.convertReadMoreHtml(e)},this))},_initializeInlineEmbedSupport:function(){var t=function(){this.inlineEmbedSupport.isDisabled||this._inlineControlKeyboardFocus(this.inlineEmbedSupport.getButton(),function(){this.inlineEmbedSupport.prompt()},this)};this.inlineEmbedSupport=new _({editorView:this,editor:this.editor,inlineEmbedsPerPost:this.get("inlineEmbedsPerPost"),title:h("Insert video (%1$s)",this.humanKeys.pretty(this.keyCommands.EMBED)),disabledTitle:h("Sorry, you can't add more than %1$s videos",this.get("inlineEmbedsPerPost")),trayOptions:{keyboard:{shortcut:this.keyCommands.EMBED,callback:t,context:this}}}),this.editorFilters.preSet.push(i.bind(function(t){return this.inlineEmbedSupport.addEmbedPlaceholders(t)},this)),this.editorFilters.preGet.push(i.bind(function(t){return this.inlineEmbedSupport.removeEmbedPlaceholders(t)},this)),this.listenTo(this.inlineEmbedSupport,"prompt",function(){this.trigger("controls:embed:prompt")})},beforeRender:function(){this.htmlField=this.subViews.htmlField=new b({model:this.model,name:this.get("name")})},render:function(){var t=this._modelValue().length>0;t&&this.set("placeholder",!1),this.$el.html(this.template());var e=this.js$("richTextEditor").get(0);return this._initializeEditor(e,this.get("placeholder")),t&&"rich"===this.getEditorType()&&this.updateEditorFromModel(),this.attachSubViews(),this},teardown:function(){return this.$el.empty(),this.editor.teardown(),this.imageUploader&&(this.stopListening(this.imageUploader),this.imageUploader.teardown(),delete this.imageUploader),delete this.mentionSupport,delete this.inlineEmbedSupport,this.editorFilters&&delete this.editorFilters,this},serialize:function(){return this.toJSON()},getEditorType:function(){return this.model.get("editorType")},getEditorValue:function(){return this.editor?this.editor.getData(!0,!0):null},setEditorValue:function(t,e,i){this.editor&&this.editor.setData(t,e,i)},convertModelFromMarkdown:function(){var t=c.render(this._modelValue());return this.model.set(this.get("name"),t),t},convertModelToMarkdown:function(){var t=u(this._modelValue());return t=t.replace(new RegExp(/<figure\b([^>]*)>([\s\S]*?)<\/figure>/gi),"$2"),this.model.set(this.get("name"),t),t},updateModelFromEditor:function(t,e){if(!this.editor)return!1;var o=this.getEditorValue();if((t||e)&&!i.isEmpty(this.pendingMedia)){var n=document.createElement("div");n.innerHTML=o;for(var r in this.pendingMedia){var a=s(n).find("["+this.editor.config.imgKeyAttr+"="+r+"]");t?(s(a).removeAttr("src"),s(a).attr("data-uploading-key",r)):e&&s(a).remove()}o=n.innerHTML}var l=this.get("name");this.model.get(l)!==o&&this.model.set(l,o)},updateEditorFromModel:function(t,e){var i=this.getEditorValue();e="undefined"!=typeof t?e:this._modelValue(),e||(e=""),e!==i&&e.trim()&&this.setEditorValue(e,!0)},updateEditorType:function(t,e){t||(t=this.model.get("editorType"));var o=s(this.editor.wrapper),n=!!this.model.get("hasSeenHtml");if("rich"===t){this.htmlField.hide();var r=this._modelValue(!0);if(!i.isEmpty(this.pendingMedia)){var a=document.createElement("div");a.innerHTML=r;for(var l in this.pendingMedia){var h=s(a).find("["+this.editor.config.imgKeyAttr+"="+l+"]");s(h).attr("src",this.pendingMedia[l])}r=a.innerHTML}this.setEditorValue(r,!0,n),o.show()}else o.hide(),this.htmlField.updateValueFromModel(),this.htmlField.set("isMarkdown","markdown"===t),e&&this.htmlField.set("editedSincePreview",!0),this.htmlField.show(),this.htmlField.showSource(n),this.model.set("hasSeenHtml",!0)},_modelValue:function(t){var e=this.model.get(this.get("name"))||"";return e=e.replace(/<!-- +more +-->/gi,"[[MORE]]"),t&&i.result(this.model,"isReblog")&&(e=e.replace(/<p>\s*<br\s*\/?>\s<\/p>$/i,"")+"<p><br></p>"),e},focus:function(t){this.editor&&"rich"===this.getEditorType()?this.editor.focus(t):this.htmlField&&this.htmlField.focus()},blur:function(t){this.editor&&"rich"===this.getEditorType()?this.editor.blur(t):this.htmlField&&this.htmlField.blur()},catchEsc:function(t,e){s(t).on("keydown.rteCatchEsc",i.bind(function(t){27===t.keyCode&&(e.call(this),t.stopPropagation())},this))},releaseEsc:function(t){s(t).off("keydown.rteCatchEsc")},setCursorToEnd:function(){this.editor&&i.isFunction(this.editor.setCursorToEnd)&&this.editor.setCursorToEnd()}},{KEYCOMMANDS:{BOLD:"meta+b",ITALIC:"meta+i",HEADLINE:"meta+shift+2",LINK:"meta+k",STRIKETHROUGH:"meta+shift+6",ORDEREDLIST:"meta+shift+7",UNORDEREDLIST:"meta+shift+8",BLOCKQUOTE:"meta+shift+9",REMOVEFORMAT:"meta+shift+0",PRE:"meta+shift+p",SUPERSCRIPT:"meta+dot",SUBSCRIPT:"meta+comma",SMALL:"meta+shift+minus",SMALLINVERSE:"meta+shift+plus",PHOTO:"meta+alt+1",EMBED:"meta+alt+2",HR:"meta+alt+3",MORE:"meta+alt+4"}});a({"Tumblr.Prima.RichTextEditorView":U}),e.exports=U},{"../services/image_url_upload":95,"../services/inline_embed_support":96,"../services/mention_support":97,"../templates/richtext_editor.tpl":136,"../utils/remap-html-tags":153,"../utils/validation":157,"./html_field":166,"./mention_dropdown":177,"app/components/dialog":20,"app/components/upload":241,"app/components/upload/collections/uploads":240,jquery:"HlZQrA",ligature:471,lodash:"K2RcUv","prima/lib/data":398,"prima/lib/logger":403,"prima/lib/translate":423,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/mixins/tablimiter":437,"prima/utils/exposer":449,"prima/utils/image/canvas":452,"prima/utils/image/filereader":453,"prima/utils/image/loader":454,"prima/view":460,remarkable:"tJkXfs","to-markdown":"ArhiFs","velocity-animate":"lWl/mc"}],200:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/utils/bindendevent").animation,o=t("../templates/richtext_editor_tutorial.tpl"),n=i.extend({className:"post-form--richtext-editor-tutorial popover tutorial",template:o,events:{"click > button":"close"},remove:function(){return this.trigger("removed",this),i.prototype.remove.apply(this,arguments)},close:function(){s(this.$el,this.remove.bind(this)),this.trigger("closing",this),this.$el.addClass("closing")},render:function(){return this.$el.html(this.template(this.attributes)),this}});e.exports=n},{"../templates/richtext_editor_tutorial.tpl":137,"prima/utils/bindendevent":442,"prima/view":460}],201:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/translate"),n=t("prima/events"),r=t("prima/mixins/accessor"),a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("../templates/save_post_button.tpl"),d=t("./save_post_dropdown"),c=t("components/knight-rider-loader"),u=s.extend({className:"post-form--save-button",events:{"click [data-js-clickableSaveDropdown]":"toggleSavePostDropdown"},mixins:[r,a,l],template:h,initialize:function(t){this.options=t=i.extend({shift:{x:0,y:10},identifier:"postForms:savePostDropdown"},t),i.extend(this,i.pick(t,"post","user","uploads")),this.savePostDropdown=new d(t),this.set("initialPostPseudoState",this.post.get("pseudoState"))},render:function(){return this.$el.html(this.template()),this.loader=this.subViews.loader=new c({variation:"centered small"}),this.savePostDropdown.setPinnedTarget(this.js$("clickableSaveDropdown")),this.attachSubViews(),this.adjustLabelForContext(),this.loader.render(),this},afterRender:function(){this.listenTo(this.post,"change validate",this.adjustLabel),this.listenTo(this.uploads,"change:uploading",this.updateButtonState),this.listenTo(this.savePostDropdown,"open close",this.adjustLabel),this.listenTo(n,"postForms:saving",this.showLoader),this.listenTo(n,"postForms:error",this.hideLoader)},showLoader:function(){this.toggleLoader(!0)},hideLoader:function(){this.toggleLoader(!1)},toggleLoader:function(t){var e=!!t;this.$el.css({width:e?this.$el.width():"",height:e?this.$el.height():""}),this.loader.set("loading",e),this.js$("clickableSaveDropdown").toggle(!e),this.js$("clickableSave").toggle(!e)},toggleSavePostDropdown:function(t){i.isBoolean(t)||(t=!this.savePostDropdown.isOrWasRecentlyRendered()),t?this.savePostDropdown.render():this.savePostDropdown.remove()},updateButtonState:function(){var t=this.post.isValid()&&!this.uploads.anyUploading()&&!this.savePostDropdown.isRendered(),e=this.js$("clickableSave");e.toggleClass("disabled",!t),e.prop("disabled",!t)},adjustLabel:function(){var t=function(t,e){return o("reblog"===t?"Reblog":"edit"===t&&"published"===e?"Save":"Post")},e=function(t,e){return o("edit"===t&&"private"===e?"Save":"Post privately")},i=this.post.get("mode"),s=this.post.get("pseudoState"),n=this.get("initialPostPseudoState"),r="published"===s?t(i,n):"queued"===s?o("Queue"):"scheduled"===s?o("Schedule"):"draft"===s?o("Save draft"):"private"===s?e(i,n):o("Post");this.updateButtonState(),this.js$("clickableSave").text(r)},adjustLabelForContext:function(){var t=this.post.get("mode");if("new"===t){var e=this.post.getContextPage();"drafts"===e?this.savePostDropdown.setOptionDraft():"queue"===e&&this.savePostDropdown.setOptionQueue()}this.adjustLabel()}});e.exports=u},{"../templates/save_post_button.tpl":138,"./save_post_dropdown":202,"components/knight-rider-loader":324,lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],202:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/lib/translate"),r=t("prima/events"),a=t("prima/mixins/accessor"),l=t("prima/mixins/subviewable"),h=t("prima/mixins/selectorcache"),d=t("prima/mixins/popoverbase"),c=t("./post_preview"),u=t("../templates/save_post_dropdown.tpl"),p=o.extend({className:"popover--save-post-dropdown",events:{"click [data-js-preview]":"triggerPostPreview","click [data-js-publish]":"setOptionPublish","click [data-js-draft]":"setOptionDraft","click [data-js-private]":"setOptionPrivate","click [data-js-queue]":"setOptionQueue","click [data-js-schedule]":"setOptionSchedule","input [data-js-scheduleText]":"scheduleInputUpdated","keypress [data-js-scheduleText]":"checkScheduleComplete"},mixins:[a,l,h,d],postStateOptions:["published","queued","scheduled","draft","private"],template:u,initialize:function(t){this.user=t.user},render:function(){return this.delegateEvents(),this._updateViewAttributes(),this.$el.html(this.template(this.serialize())),this._updateViewElements(),r.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),r.trigger("postForms:dismissListener:resume"),this},serialize:function(){var t=s.extend({__:n},this.attributes);return t},_updateViewAttributes:function(){this.set({showPreview:!0,state:this.model.get("pseudoState"),activeOptions:"edit"===this.model.get("mode")&&this.model.get("createdPost")?["published","private"]:this.postStateOptions})},_updateViewElements:function(){"scheduled"===this.model.get("state")?this.js$("scheduleText").val(this.model.get("publish_on")):i("[data-js-scheduleText]",this.$el).hide(),this.js$("preview").toggleClass("disabled",!this.model.isValid())},triggerPostPreview:function(){this.model.isValid()&&(this._previewPost(),this.teardown())},setOptionPublish:function(){this._unSchedule(),this.model.set({state:"published",is_private:!1}),this.teardown()},setOptionDraft:function(){this._unSchedule(),this.model.set("state","draft"),this.teardown()},setOptionPrivate:function(){this._unSchedule(),this.model.set({state:"private",is_private:!0}),this.teardown()},setOptionQueue:function(){this._unSchedule(),this.model.set("state","queued"),this.teardown()},setOptionSchedule:function(){if(!this.scheduling){this.scheduling=!0,this._selectOption(this.js$("schedule")),this.model.set("state","scheduled");var t=this.js$("scheduleText");if(!t.value){var e=t.attr("placeholder");t.val(e),this.model.set("publish_on",e)}this.js$("scheduleText").show()}},scheduleInputUpdated:function(t){this.model.set("publish_on",t.target.value)},checkScheduleComplete:function(t){13===t.which&&this.teardown()},_selectOption:function(t){this.js$("options").children().removeClass("icon_checkmark"),t.addClass("icon_checkmark")},_unSchedule:function(){this.scheduling=!1,this.model.set("publish_on","")},_previewPost:function(){var t=this.model.get("tumblelog"),e=new c({action:this.user.getChannel(t).get("blog_url")+"post/preview",inputs:this.model.toJSON({url:"/svc/post/update",forServer:!0})}),i=e.render().$el.find("form");i.css({"pointer-events":"none",overflow:"hidden",position:"absolute",bottom:0,right:0,width:1,height:1,opacity:0}).appendTo("body").submit().remove()}});e.exports=p},{"../templates/save_post_dropdown.tpl":139,"./post_preview":182,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/mixins/accessor":425,"prima/mixins/popoverbase":432,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],203:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/mixins/selectorcache"),r=t("prima/mixins/accessor"),a=t("../templates/social_buttons.tpl"),l=t("./tweet_dropdown"),h=s.extend({className:"post-forms--social-buttons",events:{"click [data-js-shareIcon]":"_onClickShareIcon","mouseenter [data-js-twitterIcon]":"_onMouseEnterTwitterIcon"},mixins:[o,n,r],services:["facebook","twitter"],template:a,defaults:{facebook:!1,twitter:!1,facebookOn:!1,twitterOn:!1},initialize:function(t){this.options=t=i.extend({},t,{shift:{x:90,y:10},identifier:"postForms:tweetDropdown"}),i.extend(this,i.pick(t,"post","user","uploads","dragEvents")),this.updateStateFromPost(),this.shouldShowSocialIcons()||this.set({twitter:!1,facebook:!1}),this.updatePostFromState()},_onClickShareIcon:function(t){t.preventDefault();var e=this.$(t.currentTarget),i=e.parent(),s=i.data("service");switch(s){case"twitter":this.post.set("send_to_twitter",!this.get("twitterOn")),this.toggleTweetDropdown(this.post.get("send_to_twitter"));break;case"facebook":this.post.set("send_to_fbog",!this.get("facebookOn"))}},_onMouseEnterTwitterIcon:function(t){this.get("twitterOn")&&(t.preventDefault(),this.toggleTweetDropdown(!0))},_onChangeTumblelog:function(){this.teardown(),this.updateStateFromPost(),this.updatePostFromState(),this.render()},_onChangePostState:function(){"private"===this.post.get("pseudoState")&&this.post.changed.is_private?(this.lastSettings=i.clone(this.attributes),this.set({twitter:!1,facebook:!1})):this.set(this.lastSettings)},shouldShowSocialIcons:function(){return"new"===this.post.get("mode")||"reblog"===this.post.get("mode")||"published"!==this.post.get("state")&&"private"!==this.post.get("state")},updateStateFromPost:function(){var t=this.post.get("tumblelog"),e=this.user.getChannel(t),s=e.get("can_send_to_twitter"),o=e.get("can_send_to_facebook");this.shouldShowSocialIcons()||(s=o=!1);var n=this.post.get("send_to_twitter"),r=this.post.get("send_to_fbog");"edit"!==this.post.get("mode")&&(n=e.get("twitter_send_posts"),r=e.get("facebook_opengraph_send_posts")),this.set({twitter:s,facebook:o,twitterOn:!!n,facebookOn:!!r}),this.lastSettings=i.clone(this.attributes)},updatePostFromState:function(){this.post.set({send_to_twitter:this.get("twitterOn"),send_to_fbog:this.get("facebookOn")})},toggleTweetDropdown:function(t){t?!1===this.tweetDropdown.isRendered()&&this.tweetDropdown.render():this.tweetDropdown.teardown()},serialize:function(){return this.toJSON()},beforeRender:function(){this.tweetDropdown=new l(this.options),this.listenTo(this.post,"change:send_to_fbog",function(t,e){this.set("facebookOn",!!e)}),this.listenTo(this.post,"change:send_to_twitter",function(t,e){this.set("twitterOn",!!e)}),this.listenTo(this,"change:twitterOn",function(t,e){this.js$("twitter").toggleClass("hidden",!this.get("twitter")).toggleClass("checked",e)}),this.listenTo(this,"change:facebookOn",function(t,e){this.js$("facebook").toggleClass("hidden",!this.get("facebook")).toggleClass("checked",e)})},render:function(){return this.$el.html(this.template(this.toJSON())),this.tweetDropdown.setPinnedTarget(this.js$("tweetDropdownPin")),this},afterRender:function(){this.listenTo(this.post,"change:state",this._onChangePostState),this.listenTo(this.post,"change:tumblelog",this._onChangeTumblelog),this.listenTo(this.post,"change:send_to_twitter",function(t,e){e||this.post.unset("customTweet")})},teardown:function(){return this.stopListening(),this.tweetDropdown.teardown(),this}});e.exports=h},{"../templates/social_buttons.tpl":140,"./tweet_dropdown":210,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],204:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/lib/translate"),r=t("prima/mixins/accessor"),a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("./plaintext_editor"),d=t("./tag_suggest"),c=t("../templates/tag_editor.tpl"),u=t("./tag_label"),p=o.extend({className:"post-form--tag-editor",defaults:{maxTagLength:140,suggestMinLength:2,showSuggestPopover:!1,editorHistory:[]},mixins:[r,a,l],template:c,events:{click:"onClick"},initialize:function(t){this.options=t=i.pick(t,"post","user","model"),i.extend(this,i.pick(t,"post","user")),this.placeholder=n("#tags")},createSubViews:function(){var t=i.extend({placeholder:this.model.get("tags").length>0?!1:this.placeholder,name:"tagInput",forceSingleLine:!0,onClientEvent:i.bind(this.handleInputKeys,this)},this.options),e={post:this.post,user:this.user,shift:{x:0,y:15},identifier:"postForms:tagSuggest"};this.tagInput=this.subViews.tagInputField=new h(t),this.tagSuggest=new d(e),this.tagLabelViews=[],i.forEach(this.post.get("tags"),function(t){var e=new u({label:t});this.subViews["tagLabel_"+t]=e,this.tagLabelViews.push(e),this.listenToOnce(e,"tagLabel:delete",this.removeTag)},this)},attachSubViews:function(){return this.attachSubView(this.tagInput,"tagInputField"),i.forEach(this.tagLabelViews,function(t){this.js$("tagInputFieldWrapper").before(t.$el)},this),this},beforeRender:function(){this.createSubViews(),this.addTagEditorListeners()},render:function(){return this.$el.html(this.template()),this.attachSubViews(),this},afterRender:function(){this.renderSubViews(),this.tagSuggest.setPinnedTarget(this.js$("tagInputGhost")),s(this.tagInput.editor.element).on("blur",i.bind(this.submitTag,this))},teardown:function(){return this.stopListening(),this.tagLabelViews=[],this},addTagEditorListeners:function(){this.listenTo(this.model,"change:tagInput",this.handleTagInput),this.listenTo(this.tagInput,"tagInput:submitTag",this.submitTag),this.listenTo(this.tagSuggest,"tagSuggest:submitTag",this.submitTag),this.listenTo(this.tagInput,"tagInput:backspace",this.handleBackspace),this.tagSuggest.listenTo(this,"tagEditor:fetchSuggestions",this.tagSuggest.fetchSuggestions),this.tagSuggest.listenTo(this.tagInput,"tagInput:cycleUp",this.tagSuggest.cycleUp),this.tagSuggest.listenTo(this.tagInput,"tagInput:cycleDown",this.tagSuggest.cycleDown),this.tagSuggest.listenTo(this.tagInput,"tagInput:dismissSuggestions",this.tagSuggest.dismiss)},handleInputKeys:function(t){var e,i=["keyup","keydown","keypress"],s={keydown:{38:"tagInput:cycleUp",40:"tagInput:cycleDown",8:"tagInput:backspace",9:"tagInput:submitTag",13:"tagInput:submitTag"},keypress:{44:"tagInput:submitTag"}};if(-1!==i.indexOf(t.type))if(t=t||window.event,e=t.which||t.keyCode,"keydown"===t.type||"keypress"===t.type)if(e in s[t.type]){this.tagInput.trigger(s[t.type][e],t);var o=/Mac/.test(navigator.platform)?t.metaKey:t.ctrlKey;8===e||13===e&&o||(t.preventDefault(),t.stopImmediatePropagation())}else this.tagInput.getEditorValue().length>=this.get("maxTagLength")&&(t.preventDefault(),t.stopImmediatePropagation());else if(e in s.keypress||e in s.keydown&&8!==e)return!1},handleTagInput:function(t,e){var i=e&&e.length>=this.get("suggestMinLength");i?this.trigger("tagEditor:fetchSuggestions",e,this._postTags()):this.tagInput.trigger("tagInput:dismissSuggestions"),this.js$("tagInputGhost").text(e)},handleBackspace:function(){0===this.tagInput.getEditorValue().length&&this._postTags().length&&this.removeTag()},submitTag:function(t){if(t&&"blur"===t.type){if(this._postTags().length||this.tagInput.editor.setPlaceholder(this.placeholder),this.tagSuggest.get("interactive"))return}else this.tagInput.editor.setPlaceholder(!1);var e=this.tagSuggest.get("interactive")?this.tagSuggest.getCycledTag():this.tagInput.getEditorValue();if(""===e)return void this.trigger("postForms:focusOnNextEditor",t);e=e.toString().replace(/[,#]/g,""),e.match(/<.*>/)&&(e=e.replace(/[<>]/g,function(t){return i.escape(t)}));var s=e.match(/"/g),o=s?s.length:0;if(o%2===1){var n=e.lastIndexOf('"');e=e.replace(/"/g,function(t,e){return e===n?'"':""})}else o>0&&(e=e.replace(/"/g,""));e=e.trim().substr(0,this.get("maxTagLength")),this.clearInput();var r=this.addTag(e);if(r){var a=t?t.which||t.keyCode:!1;if(a===!1||"focusout"!==t.type&&(9!==a||!t.shiftKey))return this.tagInput.focus(),!1}},addTag:function(t){if(!t||i.contains(this._postTags(!0),t.toLowerCase()))return!1;this.post.get("tags").push(t);var e=new u({label:t});return this.subViews["tagLabel_"+t]=e,this.tagLabelViews.push(e),this.js$("tagInputFieldWrapper").before(e.render().$el),this.listenToOnce(e,"tagLabel:delete",this.removeTag),!0},removeTag:function(t){if(t||(t=i.last(this.post.get("tags"))),!t)return!1;var e=i.without(this._postTags(),t);i.isEmpty(e)&&this.tagInput.editor.setPlaceholder(this.placeholder),this.model.set("tags",e);var s=this.subViews["tagLabel_"+t];return s&&(s.remove(),this.subViews["tagLabel_"+t]=null,i.remove(this.tagLabelViews,function(t){return s===t})),!0},clearInput:function(){this.tagInput.trigger("tagInput:dismissSuggestions"),this.tagInput.setEditorValue("")},_postTags:function(t){return t?i.map(this.model.get("tags"),function(t){return t.toLowerCase()}):i.clone(this.model.get("tags"))},onClick:function(t){s(t.target).hasClass(this.className)&&(t.preventDefault(),this.subViews.tagInputField.focus())}});e.exports=p},{"../templates/tag_editor.tpl":141,"./plaintext_editor":180,"./tag_label":205,"./tag_suggest":206,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":423,"prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],205:[function(t,e){"use strict";
var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=s.extend({className:"tag-label",defaults:{label:""},mixins:[o,n,r],events:{click:"triggerDelete"},tagName:"span",initialize:function(t){t=i.extend({},t),this.set(i.pick(t,i.keys(this.defaults)))},render:function(){return this.$el.text(this.get("label")),this},triggerDelete:function(){this.trigger("tagLabel:delete",this.get("label"))}});e.exports=a},{lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],206:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),r=t("../models/tag_suggestion"),a=t("prima/mixins/accessor"),l=t("prima/mixins/popoverbase"),h=t("prima/mixins/selectorcache"),d=t("../templates/tag_suggest.tpl"),c=o.extend({className:"popover--tag-suggest",defaults:{currentKeyedChoice:-1,currentMousedChoice:-1,interactive:!1,numSuggestions:0,suggestPending:!1,lastResults:{}},mixins:[a,h,l],template:d,initialize:function(t){this.model=new r(t),this.post=t.post,this.listenTo(this.model,"error",this._fetchSuggestionsError),this.listenTo(this,"change:lastResults",this.preRender)},preRender:function(t,e){var s=i.reduce(e.results,function(t,e){return t+(i.isArray(e)?e.length:0)},0);this.set({currentKeyedChoice:-1,interactive:!1});var o=this.get("suggestPending");s>0&&o!==!1&&-1===this.post.get("tags").indexOf(o)&&this.render()},render:function(){return this.$el.html(this.template(this.get("lastResults"))),n.trigger("postForms:dismissListener:suspend"),this},afterRender:function(){this.$tagSuggestWrapper=this.js$("tagSuggestWrapper"),s(".item-option",this.$el).on("click",i.bind(this.selectCurrentCycledChoice,this)),s(".item-option",this.$el).on("mouseover",i.bind(this.handleMouseOver,this)),this.$el.on("mouseout",i.bind(this.handleMouseOut,this))},teardown:function(){return this.$el.remove(),n.trigger("postForms:dismissListener:resume"),this},cycleUp:function(){this._cycle(-1)},cycleDown:function(){this._cycle(1)},_cycle:function(t){var e=this.get("currentKeyedChoice"),s=this.get("currentMousedChoice"),o=i.isNumber(s)&&-1!==s,n=o?s:e,r=(n+t)%this.get("numSuggestions");this.get("numSuggestions")&&(this.set({currentKeyedChoice:r>=0?r:-1,currentMousedChoice:-1}),this.styleMenuItems(),this.set("interactive",this.get("currentKeyedChoice")>=0))},getCycledTag:function(){return s(".item-option.cycled",this.$el).data("tag")},selectCurrentCycledChoice:function(t){this.set("interactive",!0),s(t.currentTarget).addClass("cycled"),this.trigger("tagSuggest:submitTag")},styleMenuItems:function(t){var e,o=t&&"mouseout"!==t.type,n=this.get("currentKeyedChoice");i.each(s(".item-option",this.$el),function(i,r){o?s(i).toggleClass("cycled",t.currentTarget===i):(s(i).toggleClass("cycled",r===n),r===n&&(e=s(i)))},this),o||-1===n||this.cycleScroll(e)},cycleScroll:function(t){var e=parseInt(t.position().top,10),i=e+parseInt(t.height(),10),s=parseInt(t.outerHeight(),10),o=parseInt(this.$tagSuggestWrapper.height(),10),n=parseInt(this.$tagSuggestWrapper.scrollTop(),10);i>o?this.$tagSuggestWrapper.scrollTop(n+s):0>e&&this.$tagSuggestWrapper.scrollTop(e+n)},handleMouseOver:function(t){this.styleMenuItems(t),this.set({interactive:!0,currentMousedChoice:s(t.currentTarget).index(".item-option")})},handleMouseOut:function(t){this.styleMenuItems(t),this.set({interactive:-1!==this.get("currentKeyedChoice"),currentMousedChoice:-1})},fetchSuggestions:i.debounce(function(t,e){var s={query:t,success:i.bind(this.renderQueryResults,this),existing:e};this.set("suggestPending",t),this.model.fetch(s)},100),_fetchSuggestionsError:i.noop,renderQueryResults:function(t,e,i){var s=this.finalResultsFilter(t.attributes.tagSuggestions,i.existing);this.set("numSuggestions",s.userTags.length+s.suggestions.length),this._rendered&&this.teardown(),this.set("lastResults",{results:s,queryRegex:new RegExp(this.model._escapeRegex(i.query),"i")})},finalResultsFilter:function(t,e){return i.mapValues(t,function(t){return i.difference(t,e)})},dismiss:function(){this.teardown(),this.set({interactive:!1,suggestPending:!1,lastResults:{}})}});e.exports=c},{"../models/tag_suggestion":89,"../templates/tag_suggest.tpl":142,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/mixins/accessor":425,"prima/mixins/popoverbase":432,"prima/mixins/selectorcache":435,"prima/view":460}],207:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=t("prima/mixins/popoverbase"),l=t("../templates/tooltip.tpl"),h=s.extend({className:"tooltip-popover",mixins:[o,n,r,a],template:l,defaults:{sanitize:!0,text:""},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._popoverBase.pinnedSide="none",this._popoverBase.shift.x=4+this.$pinned.width(),this._popoverBase.shift.y=8,this},teardown:function(){return this.$el.remove(),this}});e.exports=h},{"../templates/tooltip.tpl":143,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/popoverbase":432,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],208:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=t("../templates/tumblelog_select.tpl"),l=t("./tumblelog_select_dropdown"),h=s.extend({defaults:{modeRequiresDropdown:!0},events:{"click [data-js-clickableTumblelogLabel]":"toggleTumblelogSelectDropdown"},mixins:[o,n,r],template:a,initialize:function(t){this.options=t||{},this.listenTo(this.model,"change:tumblelog",this.adjustLabel),this.set("modeRequiresDropdown","edit"!==this.model.get("mode"))},render:function(){return this.$el.html(this.template({post:this.model})),this.adjustLabel(),this.createDropdown(),this},createDropdown:function(){var t=i.extend(this.options,{shift:{x:0,y:10},identifier:"postForms:tumblelogSelectDropdown"});this.get("modeRequiresDropdown")&&(this.tumblelogSelectDropdown=new l(t),this.tumblelogSelectDropdown.setPinnedTarget(this.js$("tumblelogSelectPin")))},toggleTumblelogSelectDropdown:function(){this.get("modeRequiresDropdown")&&(this.tumblelogSelectDropdown.isOrWasRecentlyRendered()||this.tumblelogSelectDropdown.render())},adjustLabel:function(){this.js$("tumblelogLabel").text(this.model.get("tumblelog"))}});e.exports=h},{"../templates/tumblelog_select.tpl":144,"./tumblelog_select_dropdown":209,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],209:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/events"),n=t("app/lib/avatar-size"),r=t("prima/mixins/accessor"),a=t("prima/mixins/selectorcache"),l=t("prima/mixins/popoverbase"),h=t("app/lib/currentuser"),d=t("../templates/tumblelog_select_dropdown.tpl"),c=s.extend({className:"popover--tumblelog-select-dropdown",events:{"click [data-js-tumblelogChoice]":"selectBlog"},mixins:[r,a,l],template:d,defaultOptions:{size:128},defaults:{tumblelog:!1},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),this.user=t.user||h(),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.get("tumblelog")||this.set("tumblelog",this.user.getChannel().get("name"))},render:function(){return this.delegateEvents(),this.$el.html(this.template(this.serialize())),o.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return this.$el.remove(),o.trigger("postForms:dismissListener:resume"),this},serialize:function(){var t=this.toJSON();return t.channels=this.user.channels.map(function(t){return i.extend({avatarUrl:n(t.get("avatar_url"),this.options.size)},t.toJSON())},this),t},selectBlog:function(t){var e=this.$(t.currentTarget).index();this.model.set("tumblelog",this.user.channels.at(e).get("name")),this.teardown()}});e.exports=c},{"../templates/tumblelog_select_dropdown.tpl":145,"app/lib/avatar-size":273,"app/lib/currentuser":275,lodash:"K2RcUv","prima/events":396,"prima/mixins/accessor":425,"prima/mixins/popoverbase":432,"prima/mixins/selectorcache":435,"prima/view":460}],210:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/events"),n=t("prima/mixins/accessor"),r=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),l=t("prima/mixins/popoverbase"),h=t("../templates/tweet_dropdown.tpl"),d=t("../utils/string_helpers").truncateLongStrings,c=s.extend({className:"popover--tweet-dropdown",defaults:{focused:!1},events:{"input [data-js-customTweet]":"_onCustomTweetInput","keyup [data-js-customTweet]":"_onCustomTweetInput","change [data-js-customTweet]":"_onCustomTweetInput","click [data-js-dismissTweet]":"_onClickDismissTweet",keydown:"_onKeyDown"},mixins:[n,r,a,l],template:h,_onCustomTweetInput:function(){var t=i.trim(this.js$("customTweet").val());this.model.set("customTweet",t),this.truncateTweet()},_onClickDismissTweet:function(){this.teardown()},_onKeyDown:function(t){27===t.keyCode&&(t.stopPropagation(),this.teardown())},_onChangePost:function(){i.isString(this.model.get("customTweet"))||this.js$("customTweet").val(this.model.getTweetText()),this.updateTweetLengthCount()},updateTweetLengthCount:function(){var t=this.model.getTweetTextLength();this.js$("tweetRemaining").text(140-t)},truncateTweet:function(){var t=this.js$("customTweet"),e=t.get(0),i=t.val(),s=i;if(!(this.model.getTweetTextLength(i)<=140)){var o=this.model.shortUrlLength,n=i.match(/\[URL\]/gi),r=!0;if(n&&1===n.length){var a=i.toLowerCase().indexOf("[url]");140-o-1>a?(i=d(i,140-o+5),r=!1):a&&(i=d(i.split(/\[URL\]/i).join(""),140-o-1)+" [URL]")}else i=d(i,140);if(this.model.set("customTweet",i),s!==i){var l=e.selectionEnd||0,h=t.scrollTop();if(r){var c=i.toLowerCase().lastIndexOf("… [url]");0>c&&(c=i.toLowerCase().lastIndexOf("…[url]")),0>c&&(c=i.toLowerCase().lastIndexOf(" [url]")),0>c&&(c=i.toLowerCase().lastIndexOf("[url]")),c>=0&&l>c&&(l=c)}if(l=Math.max(0,Math.min(l,i.length)),t.val(i).focus(),e.setSelectionRange)e.setSelectionRange(l,l);else if(e.createRange){var u=e.createRange();u.setStart("character",l),u.setEnd("character",l),u.select()}t.scrollTop(h)}}},setCaret:function(t){var e=this.js$("customTweet"),i=e.get(0),s=e.val(),o=s.toLowerCase().lastIndexOf(" [url]");if(0>o&&(o=s.toLowerCase().lastIndexOf("[url]"),t&&o>=0&&(s=s.slice(0,o)+" "+s.slice(o),this.js$("customTweet").val(s))),0>o&&(o=s.length),e.focus(),i.setSelectionRange)i.setSelectionRange(o,o);else if(i.createRange){var n=i.createRange();n.setStart("character",o),n.setEnd("character",o),n.select()}},serialize:function(){return i.extend({tweetText:this.model.getTweetText(),tweetRemaining:140-this.model.getTweetTextLength()},this.toJSON())},afterRender:function(){this.listenTo(this.model,"change",this._onChangePost),i.defer(i.bind(function(){this.setCaret(!0)},this))},render:function(){return this.delegateEvents(),this.$el.html(this.template(this.serialize())),this.model.get("customTweet")&&this.js$("customTweet").val(this.model.get("customTweet")),o.trigger("postForms:dismissListener:suspend"),this},teardown:function(){return""===this.model.get("customTweet")&&this.model.set("send_to_twitter",!1),this.remove(),o.trigger("postForms:dismissListener:resume"),this}});e.exports=c},{"../templates/tweet_dropdown.tpl":146,"../utils/string_helpers":156,lodash:"K2RcUv","prima/events":396,"prima/mixins/accessor":425,"prima/mixins/popoverbase":432,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],211:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=t("../templates/uploading_indicator.tpl"),l=t("components/knight-rider-loader"),h=s.extend({className:"post-form--uploading-indicator",mixins:[o,n,r],template:a,defaults:{isUploading:!0,isVisible:!0,delay:200},initialize:function(t){this.options=t=i.extend({},t),i.extend(this,i.pick(t,"post","user","uploads")),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.updateIsUploading(),this.set("isVisible",this.get("isUploading"))},_onChangeIsUploading:function(t,e){e?(clearTimeout(this._changeIsVisibleTimeout),this._changeIsVisibleTimeout=!1,this.set("isVisible",e)):this._changeIsVisibleTimeout||(this._changeIsVisibleTimeout=i.delay(i.bind(function(){this._changeIsVisibleTimeout=!1,this.set("isVisible",e)},this),this.get("delay")))},_onChangeIsVisible:function(t,e){this.loader.set("loading",e)},updateIsUploading:function(){this.set("isUploading",this.uploads.anyUploading())},serialize:function(){return this.toJSON()},beforeRender:function(){this.loader=this.subViews.loader=new l({variation:"small"}),this.listenTo(this.uploads,"change:uploading",this.updateIsUploading),this.listenTo(this,"change:isUploading",this._onChangeIsUploading),this.listenTo(this,"change:isVisible",this._onChangeIsVisible)},render:function(){return this.$el.html(this.template(this.serialize())),this.updateIsUploading(),this.loader.set("loading",this.get("isVisible")),this.attachSubViews(),this}});e.exports=h},{"../templates/uploading_indicator.tpl":147,"components/knight-rider-loader":324,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],212:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").animate,o=t("prima/view"),n=t("prima/mixins/accessor"),r=t("prima/mixins/subviewable"),a=t("prima/mixins/selectorcache"),l=t("../templates/webcam_button.tpl"),h=o.extend({className:"webcam-button-container",template:l,events:{mouseenter:"_onMouseEnter",mouseleave:"_onMouseLeave"},mixins:[n,r,a],wink:function(t){!i.isUndefined(t)||(t=!this.js$("smiley").hasClass("icon_postforms_selfie_wink")),this.js$("smiley").toggleClass("icon_postforms_selfie_wink",t),this.js$("smiley").toggleClass("icon_postforms_selfie",!t)},_onMouseEnter:function(){var t=100;s(this.js$("text"),"stop"),s(this.js$("text"),{opacity:1},{duration:t});var e=this.js$("smiley").outerWidth()+this.js$("text").outerWidth();s(this.$el,"stop"),s(this.$el,{marginLeft:-Math.round(.5*e),width:e},{duration:t}).then(i.bind(function(){this._winkTimeout=i.delay(i.bind(function(){this.wink(!0),this._winkTimeout=i.delay(i.bind(function(){this.wink(!1)},this),100)},this),400)},this))},_onMouseLeave:function(){var t=100;clearTimeout(this._winkTimeout),this.wink(!1),s(this.js$("text"),"stop"),s(this.js$("text"),{opacity:0},{duration:t});var e=this.js$("smiley").outerWidth();s(this.$el,"stop"),s(this.$el,{marginLeft:-Math.round(.5*e),width:e},{duration:t}).then(i.bind(function(){}))},render:function(){return this.$el.html(this.template()),this},teardown:function(){return clearTimeout(this._winkTimeout),this}});e.exports=h},{"../templates/webcam_button.tpl":148,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460,"velocity-animate":"lWl/mc"}],213:[function(t,e){var i=t("prima/collection"),s=t("../models/reblog_entry"),o=i.extend({model:s});e.exports=o},{"../models/reblog_entry":214,"prima/collection":394}],214:[function(t,e){var i=t("prima/model"),s=i.extend({defaults:{pid:null,name:null,permalink:null,content:null}});e.exports=s},{"prima/model":439}],215:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="reblog-trail-entry-content-original">'+(null==(__t=content)?"":__t)+'</div><a class="reblog-trail-entry-avatar"><div class="reblog-trail-entry-avatar-image"></div></a><div class="reblog-trail-entry-name"><a class="reblog-trail-tumblelog-link" href="'+(null==(__t=permalink)?"":__t)+'">'+(null==(__t=name)?"":__t)+"</a></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],216:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<a class="reblog-trail-entry-avatar"><div class="reblog-trail-entry-avatar-image"></div></a><div class="reblog-trail-entry-body"><div class="reblog-trail-entry-name"><a class="reblog-trail-tumblelog-link" href="'+(null==(__t=permalink)?"":__t)+'">'+(null==(__t=name)?"":__t)+'</a></div><div class="reblog-trail-entry-content">'+(null==(__t=content)?"":__t)+"</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],217:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="control-reblog-trail post"><div class="reblog-trail-post-content"><div data-subview="reblogEntries" class="reblog-trail-post-content"></div></div>',isRemovable&&(__p+='<div data-subview="removeButton"></div><div class="btn-show-trail btn-toggle-reblog">'+(null==(__t=__("Include reblogs"))?"":_.escape(__t))+"</div>"),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],218:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="reblog-unconverted">'+(null==(__t=unconvertedReblog)?"":__t)+"</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],219:[function(t,e){"use strict";var i=(t("jquery"),t("lodash")),s=t("prima/lib/translate"),o=t("prima/views/base"),n=t("app/components/remove-button"),r={ReblogTrailEntriesView:t("./reblog_trail_entries"),ReblogUnconvertedView:t("./reblog_unconverted")},a=t("../templates/reblog-trail.tpl"),l=o.extend({template:a,defaults:{is_removable:!1},subviews:{},events:{"click .btn-toggle-reblog":"toggleRemoveReblogTree"},initialize:function(t){this.options=i.merge({},this.defaults,t)},serialize:function(){return{isRemovable:this.options.is_removable}},render:function(){var t=this.model.get("reblog_tree_ui_data"),e=r.ReblogTrailEntriesView;return this.reblogEntries=this.subviews.reblogEntries=new e({model:t}),this.options.is_removable&&(this.removeButton=this.subviews.removeButton=new n({tooltip:s("Remove reblogs"),buttonClass:"btn-remove-trail btn-toggle-reblog"})),this.$el.html(this.template(this.serialize())),this},toggleRemoveReblogTree:function(t){var e=this.$(t.currentTarget),i=e.closest(".control-reblog-trail"),s=this.model.has("remove_reblog_tree")&&this.model.get("remove_reblog_tree")===!0;this.model.set("remove_reblog_tree",!s),i.toggleClass("removed",!s)},teardown:function(){return this.reblogEntries.teardown(),this.removeButton.remove(),this.$el.remove(),this}});e.exports=l},{"../templates/reblog-trail.tpl":217,"./reblog_trail_entries":220,"./reblog_unconverted":222,"app/components/remove-button":231,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/translate":423,"prima/views/base":461}],220:[function(t,e){"use strict";var i=(t("jquery"),t("lodash")),s=t("prima/views/base"),o=t("../collections/reblog_entries"),n=t("../models/reblog_entry"),r=t("./reblog_trail_entry"),a=s.extend({className:"reblog-trail",subviews:{},initialize:function(t){this.options=i.merge({},this.defaults,t);var e=this.model,s=i.collect(e,function(t,e){var i=new n(t);return 0==e&&i.set({is_original:!0}),this.subviews[e]=new r({model:i}),i},this);this.collection=new o(s)},render:function(){return i.each(this.subviews,i.bind(function(t){this.$el.append(t.render().$el)},this)),this},teardown:function(){return i.each(this.subviews,function(t){t.remove()}),this}});e.exports=a},{"../collections/reblog_entries":213,"../models/reblog_entry":214,"./reblog_trail_entry":221,jquery:"HlZQrA",lodash:"K2RcUv","prima/views/base":461}],221:[function(t,e){"use strict";var i=(t("jquery"),t("lodash"),t("prima/views/base")),s={original:t("../templates/reblog-trail-entry-original.tpl"),generic:t("../templates/reblog-trail-entry.tpl")},o=i.extend({className:"reblog-trail-entry",initialize:function(){var t=this.model.get("is_original");t?(this.template=s.original,this.$el.attr("class","reblog-trail-entry--original")):this.template=s.generic},serialize:function(){return this.model.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this}});e.exports=o},{"../templates/reblog-trail-entry-original.tpl":215,"../templates/reblog-trail-entry.tpl":216,jquery:"HlZQrA",lodash:"K2RcUv","prima/views/base":461}],222:[function(t,e){"use strict";var i=(t("jquery"),t("prima/views/base")),s=t("../templates/reblog-unconverted.tpl"),o=i.extend({className:"reblog-trail-entry",template:s,initialize:function(){},serialize:function(){return{unconvertedReblog:this.model}},render:function(){return this.$el.html(this.template(this.serialize())),this},teardown:function(){return this.remove(),this}});e.exports=o},{"../templates/reblog-unconverted.tpl":218,jquery:"HlZQrA","prima/views/base":461}],223:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("app/models/tumblelog"),n=s.extend({url:"/svc/search/get_recommended_tumblelogs",model:o,defaults:{limit:6},initialize:function(t){this.options=i.defaults(t,this.defaults),this.on("remove",this.onTumblelogRemoved)},onTumblelogRemoved:function(){var t={limit:1,remove:!1,page:this.getPageUrl()};this.fetch(t)},getPageUrl:function(){return window.location.pathname.split("/")[1]},parse:function(t){return t.response.blogs}});e.exports=n},{"app/models/tumblelog":278,lodash:"K2RcUv","prima/collection":394}],224:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("app/models/tumblelog"),n=s.extend({url:"/svc/search/get_recommended_tumblelogs",model:o,defaults:{limit:1},initialize:function(t){this.options=i.defaults(t,this.defaults),this.on("remove",this.onSponsoredTumblelogRemoved)},onSponsoredTumblelogRemoved:function(){var t={limit:1,remove:!1};this.fetch(t)},parse:function(t){return t.response.blogs}});e.exports=n},{"app/models/tumblelog":278,lodash:"K2RcUv","prima/collection":394}],225:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("./views/header-view"),n=t("./views/list-view"),r=t("./collections/recommended-blogs-collection"),a=t("./collections/sponsored-blogs-collection"),l=s.extend({defaults:{header:!0,tumblelogs:[],sponsoredTumblelogs:[],dismissable:!0,refresh:!0,numShow:4,primaTumblelogPopover:!1},initialize:function(t){this.options=i.defaults(t,this.defaults),this.pageUrl=this.getPageUrl(),this.options.header&&(this.headerView=new o({$el:this.$(".section_header")})),this.collection=new r(this.options.tumblelogs),this.adsCollection=new a(this.options.sponsoredTumblelogs),this.listView=new n({el:this.el,collection:this.collection,adsCollection:this.adsCollection,dismissable:this.options.dismissable,refresh:this.options.refresh,numShow:this.options.numShow,primaTumblelogPopover:this.options.primaTumblelogPopover,pageUrl:this.getPageUrl()})},getPageUrl:function(){return window.location.pathname.split("/")[1]},render:function(){this.headerView&&this.$el.append(this.headerView.render().el),this.listView.render()},updateTumblelogs:function(t){this.collection.reset(t)}});e.exports=l},{"./collections/recommended-blogs-collection":223,"./collections/sponsored-blogs-collection":224,"./views/header-view":228,"./views/list-view":230,lodash:"K2RcUv","prima/view":460}],226:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<li class="section_header no_push">'+(null==(__t=headline)?"":_.escape(__t))+"</li>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],227:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<a href="'+(null==(__t=url)?"":_.escape(__t))+'" class="follow_list_item_blog blog'+(null==(__t=following?"":" has_follow_button")?"":_.escape(__t))+(null==(__t=pt?" pt":"")?"":_.escape(__t))+'" data-pt="'+(null==(__t=pt)?"":_.escape(__t))+'" target="blank"><div class="hide_overflow '+(null==(__t=following?"":" has_follow_button")?"":_.escape(__t))+'"><span class="tumblelog_title">'+(null==(__t=name)?"":_.escape(__t))+'<span><br><small class="tumblelog_name">'+(null==(__t=sponsored?"Sponsored":title)?"":_.escape(__t))+'</small></span></span></div><div class="avatar" style="background-image:url(\''+(null==(__t=avatar_url)?"":_.escape(__t))+'\')"><img src="'+(null==(__t=avatar_url)?"":_.escape(__t))+'" class="avatar_img" alt=""></div>',sponsored&&(__p+='<div class="sponsored_badge mini light"><div class="sponsored_badge_icon"><span class="dollar_sign">$</span> <span class="ring"></span></div></div>'),__p+="</a>",following||(__p+=' <a class="follow plus-follow-button" href="/follow/'+(null==(__t=name)?"":_.escape(__t))+'" data-tumblelog-name="'+(null==(__t=name)?"":_.escape(__t))+'" data-follow-source="'+(null==(__t=followSource)?"":_.escape(__t))+'" title="Follow"><span class="icon_plus follow_icon"></span></a>'),__p+="",dismissable&&(__p+='<div class="dismiss"><i class="icon_close"></i></div>'),__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],228:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("../templates/list-header.tpl"),n=t("prima/lib/translate"),r=s.extend({template:o,defaults:{headline:n("Recommended Blogs")},initialize:function(t){this.options=i.defaults(t,this.defaults)},render:function(){return this.$el.html(this.template({headline:this.options.headline})),this}});e.exports=r},{"../templates/list-header.tpl":226,lodash:"K2RcUv","prima/lib/translate":423,"prima/view":460}],229:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("../templates/list-item.tpl"),n=t("prima/mixins/loggedouthelper"),r=t("prima/mixins/generate-logging-data"),a=t("components/popover/views/blog_card_popover"),l=t("prima/events"),h=s.extend({tagName:"li",className:"item",template:o,mixins:[n,r],defaults:{followSource:"FOLLOW_SOURCE_RECOMMENDED_BLOG"},events:function(){return{"click .follow":this.isLoggedIn()?"followClicked":this.redirect("/register?redirect_to=/"+this.options.pageUrl),"click .follow_list_item_blog":"onPeeprOpen","click .icon_close":"dismissClicked"}},initialize:function(t){this.options=i.defaults(t,this.defaults),this.options.primaTumblelogPopover&&this.isLoggedIn()&&this.$el.hoverIntent({over:i.bind(this.showBlogCardPopover,this),out:i.noop,sensitivity:3}),this.bindEvents()},bindEvents:function(){this.listenTo(this.model,"change:following",this.onFollow)},render:function(){var t=i.extend(this.model.toJSON(),this.options);return this.$el.html(this.template(t)),this.cacheSelectors(),this},cacheSelectors:function(){this.$followButton=this.$el.find(".follow"),this.$dismissButton=this.$el.find(".dismiss")},onFollow:function(t,e){this.$followButton.removeClass("hide"),this.$followButton.toggleClass("follow_poof",e),this.$dismissButton.toggle(!e)},onPeeprOpen:function(){l.trigger("useraction:click:peepr",{model:this.model,loggingData:this.loggingData({userAction:"posts"})})},logRow:function(t){"explore"===this.options.pageUrl&&l.trigger(t,{loggingData:{tumblelog:this.model.get("name"),position:this.$el.index()}})},followClicked:function(t){t.preventDefault(),this.logRow("tumblelog:log_follow"),this.model.follow({source:this.options.followSource,pt:this.model.get("pt")})},dismissClicked:function(){this.model.trigger("dismiss",this.model),l.trigger("useraction:dismiss:recommended_tumblelog",{model:this.model,loggingData:this.loggingData({userAction:"blog_dismissal"})})},showBlogCardPopover:function(){return this.popover&&this.popover.isRendered()?this:(this.logRow("TumblelogPopover:log_follow_open"),this.popover=new a({model:this.model,pinnedTarget:this.$el,shift:{x:-120,y:0}}),void this.popover.openPopover())}});e.exports=h},{"../templates/list-item.tpl":227,"components/popover/views/blog_card_popover":333,lodash:"K2RcUv","prima/events":396,"prima/mixins/generate-logging-data":428,"prima/mixins/loggedouthelper":431,"prima/view":460}],230:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("./list-item-view"),a=o.extend({captureIsReady:!1,impressionLogQueue:[],initialize:function(t){this.options=s.defaults(t,this.defaults),this.adsCollection=this.options.adsCollection,this.subviews=[],this.viewed=[],this.pageUrl=this.options.pageUrl,this.bindEvents()},bindEvents:function(){this.listenTo(this.collection,"add",this.onTumblelogAdded),this.listenTo(this.collection,"remove",this.onTumblelogRemoved),this.listenTo(this.collection,"dismiss",this.onDismiss),this.listenTo(this.collection,"reset",this.onTumblelogsReset),this.listenTo(this.collection,"change:following",this.onFollow),this.listenTo(this.adsCollection,"change:following",this.onFollow),this.listenTo(n,"TumblelogPopover:show",this.onPopoverShow),this.listenTo(n,"TumblelogPopover:hide",this.onPopoverHide),this.listenToOnce(n,"capture:init",this.flushQueue)},onTumblelogAdded:function(t){var e=s.isUndefined(t.get("pt"))?!1:t.get("pt"),i=!!t.get("premium");if(!this.adsCollection.length||(this.removeOrganicPremiumPartners(),this.collection.get(t)||this.adsCollection.get(t))){var o=new r({model:t,dismissable:this.options.dismissable&&!i,primaTumblelogPopover:this.options.primaTumblelogPopover,pageUrl:this.pageUrl,pt:e,sponsored:i});this.subviews.push(o),this.$el.append(o.render().el),"explore"!==this.pageUrl&&this.logImpression()}},onTumblelogRemoved:function(t){this.subviews=s.filter(this.subviews,function(e){return e.model!==t}),"explore"!==this.pageUrl&&this.logImpression()},onTumblelogsReset:function(){s.each(this.subviews,function(t){t.remove()}),this.subviews=[],this.render()},onFollow:function(t,e){if(e&&this.options.refresh&&this.collection.length>this.options.numShow){var i=this.getView(t);this.popoverShown?this.queuedView=i:(this.collection.remove(t),this.slideUp(i))}},onDismiss:function(t){if(this.options.refresh){var e=this.getView(t);this.slideLeft(e),this.collection.remove(t)}"explore"!==this.pageUrl&&i.ajax({method:"POST",url:"/svc/search/log_dismissal",data:{tumblelog_name:t.get("name"),page:this.pageUrl},with_form_key:!0})},onPopoverShow:function(){this.popoverShown=!0},onPopoverHide:function(){this.popoverShown=!1,this.queuedView&&this.options.refresh&&(this.slideUp(this.queuedView),this.collection.remove(this.queuedView.model),this.queuedView=null)},logImpression:function(){s.forEach(this.collection.slice(0,this.options.numShow),function(t){var e=this.getView(t);return s.isEmpty(e)||-1!==s.indexOf(this.viewed,t)?this:(this.viewed.push(t),void this.impressionLogQueue.push(s.bind(function(){n.trigger("Capture:push","recommended_blog_impressions","impressions",{tumblelog_name:t.get("name"),algorithm_id:t.get("algorithm_id")||"",page:this.pageUrl,ts:Math.floor(s.now()/1e3),position:e.$el.offset(),format:"RECOMMEND_FORMAT_DASH_SIDEBAR"})},this)))},this),this.captureIsReady&&this.flushQueue()},flushQueue:function(){for(var t=0;t<this.impressionLogQueue.length;t++)this.impressionLogQueue[t]();this.impressionLogQueue=[],this.captureIsReady=!0},getView:function(t){return s.find(this.subviews,{model:t})},removeOrganicPremiumPartners:function(){var t=this.collection.filter(function(t){return this.adsCollection.find({id:t.id})},this);this.collection.remove(t)},render:function(){this.adsCollection.length&&this.removeOrganicPremiumPartners(),this.adsCollection&&this.adsCollection.length&&this.onTumblelogAdded(this.adsCollection.first()),this.collection.each(s.bind(this.onTumblelogAdded,this))
},slideLeft:function(t){t.$el.animate({left:-245},250).slideUp(300,t.$el.remove)},slideUp:function(t){t.$el.animate({opacity:0},100).slideUp(300,t.$el.remove)}});e.exports=a},{"./list-item-view":229,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/view":460}],231:[function(t,e){"use strict";var i=t("./views/remove-button.js");e.exports=i},{"./views/remove-button.js":233}],232:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="remove-button '+(null==(__t=buttonClass)?"":_.escape(__t))+'"><span class="icon"></span></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],233:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/accessor"),n=t("prima/mixins/subviewable"),r=t("prima/mixins/selectorcache"),a=t("../templates/remove-button.tpl"),l=s.extend({events:{click:"_onClick"},template:a,mixins:[o,n,r],defaults:{dataJsName:"removeButton",buttonClass:""},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.onClick=t.onClick},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this.get("dataJsName")&&this.$$(".remove-button").attr("data-js-"+this.get("dataJsName"),""),this},_onClick:function(){i.isFunction(this.onClick)?this.onClick(this):this.trigger("remove")}});e.exports=l},{"../templates/remove-button.tpl":232,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],234:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/component"),n=t("prima/events"),r=t("prima/mixins/keycommands"),a=t("./views/fast_compose"),l=o.extend({name:"switcher",mixins:[r],keycommands:{"keydown:alt+c":"macFastCompose","keydown:z+c":"winFastCompose"},loggingData:{},initialize:function(){this.$body=i("body"),this.$glass=null,this.suspended=!1,this.bindEvents()},bindEvents:function(){this.listenTo(n,"keycommands:suspend",this.suspend),this.listenTo(n,"keycommands:resume",this.resume),this.listenTo(n,"fastCompose:close:complete",this.dismissFastCompose),this.listenTo(n,"fastCompose:dismiss",this.dismissFastCompose),this.listenTo(n,"fastCompose:init",this.initFastCompose)},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},macFastCompose:function(t){"MacIntel"===navigator.platform&&this.initFastCompose(t)},winFastCompose:function(t){"Win32"===navigator.platform&&this.initFastCompose(t)},initFastCompose:function(t){this.suspended||this.fastCompose||(this.determineSource(t),this.fastCompose=new a({loggingData:this.loggingData}),this.$body.append(this.fastCompose.render().el),this.showPlexi(),this.fastCompose.open(),n.trigger("fastCompose:init:complete"))},dismissFastCompose:function(){this.fastCompose&&(this.hidePlexi(),this.fastCompose.teardown(),this.fastCompose=null),n.trigger("fastCompose:dismiss:complete")},showPlexi:function(){this.$glass=i("<div>",{"class":"glass show"}).appendTo(this.$body),s.defer(s.bind(function(){this.$glass.addClass("blue")},this)),n.trigger("drawer:suspend")},hidePlexi:function(){this.$glass.remove(),this.$glass=null,n.trigger("drawer:resume")},determineSource:function(t){this.loggingData.source="fast-compose",t&&(t.originalEvent instanceof KeyboardEvent?this.loggingData.source="keycommand":t.loggingData&&t.loggingData.source&&(this.loggingData.source=t.loggingData.source))}});e.exports=l},{"./views/fast_compose":236,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396,"prima/mixins/keycommands":429}],235:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="post-tab-switching"><div class="tab-post-types count-'+(null==(__t=Object.keys(fastComposeIcons).length)?"":_.escape(__t))+'">',_.each(fastComposeIcons,function(t,e){__p+='<div class="tab-post-type item" data-index="'+(null==(__t=e)?"":__t)+'" data-post-type="'+(null==(__t=t.name)?"":__t)+'"><div class="post-type-icon icon-'+(null==(__t=t.name)?"":__t)+'"><i class="post-type-icon-overlay"></i></div><div class="post-type-name"><span class="post-type-name-span">'+(null==(__t=t.label)?"":__t)+"</span></div></div>"}),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],236:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("velocity-animate"),n=t("prima/lib/data"),r=t("prima/view"),a=t("prima/events"),l=t("prima/lib/flags"),h=t("prima/mixins/keycommands"),d=t("app/components/post-form-builder"),c=t("../templates/fast_compose.tpl"),u=r.extend({template:c,className:"fast-compose",fastComposeIcons:{1:{name:"text",label:"Text"},2:{name:"photo",label:"Photo"},3:{name:"quote",label:"Quote"},4:{name:"link",label:"Link"},5:{name:"chat",label:"Chat"},6:{name:"audio",label:"Audio"},7:{name:"video",label:"Video"}},events:{"click .post-tab-switching .tab-post-type":"clickCreate","mouseover .post-tab-switching .tab-post-type":"mouseoverIcon","click .post-tab-switching":"close"},mixins:[h],keycommands:{"keydown:c":"nextIcon","keydown:shift+c":"previousIcon","keydown:tab":"nextIcon","keydown:shift+tab":"previousIcon","keydown:right":"nextIcon","keydown:left":"previousIcon","keydown:enter":"enterCreate","keydown:escape":"close"},initialize:function(t){this.attributes=s.extend({fastComposeIcons:this.fastComposeIcons},t),this.$body=i("body"),this.$glass=null,this.postTabIndex=null,this.$plexiInstance=i('.plexi[data-token="body-plexi"]'),this.resumeKeycommandsOnClose=!0,this.tabSwitching=i(),this.postTypes=i(),this.currentPostType=i(),this.bindEvents()},bindEvents:function(){this.listenTo(a,"DOMEventor:keydown:tab",this.disableKey),this.listenTo(a,"DOMEventor:keydown:shift+tab",this.disableKey)},render:function(){return this.$el.append(this.template(this.attributes)),r.prototype.render.apply(this,arguments)},open:function(){s.defer(s.bind(function(){this.show()},this))},show:function(){a.trigger("keycommands:suspend"),this.tabSwitching=i(".post-tab-switching"),this.postTypes=this.$el.find(".tab-post-type");for(var t=50,e=0;7>e;e++){var s=this.postTypes.eq(e),n=s.find(".post-type-icon"),r=s.find(".post-type-name");o.animate(n,{opacity:["1","0"],translateY:["0px","15px"]},{duration:150,delay:e*t}),o.animate(r,{opacity:["1","0"],translateY:["0px","-15px"]},{duration:150,delay:e*t})}this.tabSwitching.addClass("finish-animating")},enterCreate:function(){var t=this.$el.find(".selected");if(t.length){var e=t.attr("data-post-type");this.createNew(e),this.close()}},clickCreate:function(t){var e=t.currentTarget.attributes["data-post-type"].value;this.createNew(e)},disableKey:function(t){t.preventDefault()},mouseoverIcon:function(t){this.currentPostType.removeClass("selected"),this.postTabIndex=t.currentTarget.attributes["data-index"].value},nextIcon:function(){null==this.postTabIndex||this.postTabIndex>=7?this.postTabIndex=1:this.postTabIndex++,this.currentPostType.removeClass("selected"),this.currentPostType=this.postTypes.eq(this.postTabIndex-1),this.currentPostType.addClass("selected")},previousIcon:function(){null==this.postTabIndex||this.postTabIndex<=1?this.postTabIndex=7:this.postTabIndex--,this.currentPostType.removeClass("selected"),this.currentPostType=this.postTypes.eq(this.postTabIndex-1),this.currentPostType.addClass("selected")},createNew:function(t){this.resumeKeycommandsOnClose=!1,n.has("Components/PostFormBuilder")?a.trigger("postForms:open",{updateURL:!1,postFormType:d.containerType("modal"),postType:t,loggingData:this.attributes.loggingData}):a.trigger("fastCompose:create",{type:t,loggingData:this.attributes.loggingData})},close:function(){for(var t=50,e=0;7>e;e++){var i=Math.floor((e+1)/2);e%2===0&&(i=-i),i+=3;var s=this.postTypes.eq(i),n=o.animate(s,{opacity:["0","1"],translateY:["-500px","0px"]},{duration:150,delay:e*t});e>=6&&n.then(function(){a.trigger("fastCompose:close:complete")})}},teardown:function(){this.resumeKeycommandsOnClose&&a.trigger("keycommands:resume"),this.remove()}});e.exports=l.bool("is_logged_in")?u:s.noop},{"../templates/fast_compose.tpl":235,"app/components/post-form-builder":63,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/data":398,"prima/lib/flags":"f/LVtH","prima/mixins/keycommands":429,"prima/view":460,"velocity-animate":"lWl/mc"}],237:[function(t,e){"use strict";var i=(t("jquery"),t("prima/component")),s=t("./views/tooltip"),o=i.extend({name:"ToolTip",class_name:"tumblr_tooltip",initialize:function(t){this.toolTipView=new s(t)}});e.exports=o},{"./views/tooltip":239,jquery:"HlZQrA","prima/component":395}],238:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="dot_tooltip_wrapper '+(null==(__t=placement)?"":_.escape(__t))+" "+(null==(__t=class_name)?"":_.escape(__t))+'" style="left:'+(null==(__t=left_css)?"":_.escape(__t))+'"><div class="dot_tooltip"><div class="tooltip_top">'+(null==(__t=text)?"":__t)+"</div>",premium?(__p+='<div class="tooltip_bottom"><ul class="tumblelog_list"><li class="item"><a href="http://'+(null==(__t=url)?"":__t)+'" class="call_to_action follow_list_item_blog blog'+(null==(__t=following?"":" has_follow_button")?"":__t)+'" target="blank"><div class="hide_overflow '+(null==(__t=following?"":" has_follow_button")?"":__t)+'"><span class="tumblelog_title"><? // todo: fix stupid mismatch between class and content ?>'+(null==(__t=name)?"":__t)+'<span><br><small class="tumblelog_name">'+(null==(__t=title)?"":__t)+'</small></span></span></div><div class="avatar" style="background-image:url(\''+(null==(__t=avatar_url)?"":__t)+'\')"><img src="'+(null==(__t=avatar_url)?"":__t)+'" class="avatar_img" alt=""></div></a>',following||(__p+=' <a class="follow" href="/follow/'+(null==(__t=name)?"":__t)+'" data-tumblelog-name="'+(null==(__t=name)?"":__t)+'" data-follow-source="FOLLOW_SOURCE_DOT_POPOVER" title="Follow"><span class="icon_plus follow_icon"></span></a>'),__p+="</li></ul></div>"):searchLink&&searchText&&(__p+='<div class="tooltip_bottom"><a class="call_to_action" href="'+(null==(__t=searchLink)?"":_.escape(__t))+'"><span class="icon_search tooltip_left"></span>'+(null==(__t=searchText)?"":_.escape(__t))+' <span class="icon_arrow_carrot_right tooltip_right"></span></a></div>'),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],239:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("../templates/dot-tooltip.tpl"),a=t("app/models/tumblelog"),l=t("app/components/dialog"),h=o.extend({class_name:"tumblr_tooltip",template:r,events:{"click .follow":"follow","click .item":"posts_click"},defaults:{selector:"",class_name:"",offset:"50%",placement:"up"},initialize:function(t){this.options=t||{},this.options.selector=i.trim((t.selector||this.defaults.selector)+" "),this.options.class_name=t.class_name||this.defaults.class_name,this.options.offset=t.offset||this.defaults.offset,this.options.placement=t.placement||this.defaults.placement,this.tooltips=i(this.options.selector+"[data-tooltip]"),this.tooltips.on("mouseenter.tumblr-dot-link",s.bind(this.show,this)),this.tooltips.on("mouseleave.tumblr-dot-link",s.bind(this.hide,this)),this.tooltips.on("click.blog",s.bind(this.click_thru,this)),this.tooltips.on("click.tooltip",".new_tooltip_bottom",s.bind(this.click_tooltip_search,this)),this.tooltips.on("remove",i.proxy(this.remove,this))},show:function(t){var e=i(t.currentTarget);this.$dot=e,this.tooltip_template_data={tooltip:e.data("tooltip"),tooltip_search_text:e.data("tooltip-search-text"),tooltip_link:e.find(".tumblr-dot-link").attr("href"),premium:e.data("tooltip-premium")||"",premium_url:e.data("tooltip-premium-url")||"",premium_name:e.data("tooltip-premium-name")||"",premium_title:e.data("tooltip-premium-title")||"",premium_avatar_url:e.data("tooltip-premium-avatar")||"",premium_following:e.data("tooltip-premium-is_following")||""},this.is_premium=this.tooltip_template_data.premium,this.is_premium&&(this.model=this.model||new a({name:this.tooltip_template_data.premium_name,pt:e.data("pt")}));var s=i(this.tooltip(this.tooltip_template_data));e.append(s),this.setElement(s),this.delegateEvents(),s.removeClass("is_closed").addClass("is_open"),n.trigger("useraction:hover:dot",this.ads_generate_payload("hover"))},hide:function(t){var e=i(t.currentTarget),o=e.find("."+this.class_name);o.removeClass("is_open").addClass("is_closed"),o.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",s.bind(function(t){this.remove(t)},this))},remove:function(t){i(t.currentTarget).remove()},posts_click:function(t){n.trigger("useraction:click:dot_blog",this.ads_generate_payload("posts")),t.preventDefault()},click_thru:function(){n.trigger("useraction:click:dot",this.ads_generate_payload("click_thru"))},ads_generate_payload:function(t){return{loggingData:{postData:{"serve-id":this.$dot.data("serve-id"),pt:this.is_premium?this.model.get("pt"):""},userAction:t}}},follow:function(t){t.preventDefault();var e=this.$el.find(".follow");this.model.save_following({following:!0},{source:e.data("follow-source"),pt:this.model.get("pt")}).fail(function(){l.alert("Sorry, we seem to be having technical trouble. Please try again later.")}),e.addClass("follow_poof"),this.tooltip_template_data.premium_following=!0},tooltip:function(t){return this.class_name="dot_tooltip_wrapper",this.attributes={text:t.tooltip,placement:this.options.placement,class_name:this.options.class_name,left_css:this.options.offset,searchText:t.tooltip_search_text,searchLink:t.tooltip_link,premium:t.premium,url:t.premium_url,name:t.premium_name,title:t.premium_title,avatar_url:t.premium_avatar_url,following:t.premium_following},this.template(this.attributes)},click_tooltip_search:function(){n.trigger("Capture:push","tumblr_dot_usage","click",{click_location:"tooltip_search"})}});e.exports=h},{"../templates/dot-tooltip.tpl":238,"app/components/dialog":20,"app/models/tumblelog":278,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/view":460}],240:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/collection"),o=t("../models/upload"),n=t("when"),r=s.extend({model:o,_listenToUploadModel:function(t){this.listenTo(t,"change",this._onUploadModelChange)},_stopListeningToUploadModel:function(t){this.stopListening(t)},_onUploadModelChange:function(t){i.has(t.changed,"complete")&&this.trigger("complete",this,t),i.has(t.changed,"error")&&t.get("error")&&this.trigger("error",this,t),i.has(t.changed,"complete")&&this.allComplete()&&this.trigger("allComplete",this)},add:function(t){return i.isArray(t)?i.forEach(t,this._listenToUploadModel,this):this._listenToUploadModel(t),s.prototype.add.apply(this,arguments)},remove:function(t){return i.isArray(t)?i.forEach(t,this._stopListeningToUploadModel,this):this._stopListeningToUploadModel(t),s.prototype.remove.apply(this,arguments)},removeIncomplete:function(t){var e=this.where({uploading:!1,complete:!1});return this.remove(e,t)},removeFailed:function(t){var e=this.filter(function(t){return t.get("error")});return this.remove(e,t)},allComplete:function(){return this.length?this.every(function(t){return t.get("complete")}):!1},anyUploading:function(){return this.length>0&&this.any(function(t){return t.get("uploading")})},getProgress:function(){var t=0,e=0;return this.forEach(function(i){i.get("error")&&(t+=i.get("bytesLoaded")||0,e+=i.get("bytesTotal")||0)}),e?t/e:0},promise:function(){if(this.allComplete())return n.resolve(this);var t=n.promise(i.bind(function(t,e){var s,o;s=i.bind(function(){this.stopListening(this,"uploads:allComplete",s),this.stopListening(this,"uploads:error",o),t.apply(this,arguments)},this),o=i.bind(function(){this.stopListening(this,"uploads:allComplete",s),this.stopListening(this,"uploads:error",o),e.apply(this,arguments)},this),this.listenToOnce(this,"uploads:allComplete",s),this.listenToOnce(this,"uploads:error",o)},this));return t}});e.exports=r},{"../models/upload":242,lodash:"K2RcUv","prima/collection":394,when:"RG2dij"}],241:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/fileupload"),n=t("./collections/uploads"),r=(t("./models/upload"),s.extend({name:"Upload",initialize:function(t){t=i.extend({},t),this.collection=t.collection||(t.collection=new n),this.indexView=new o(t),this.listenTo(this.collection,"all",this._relayCollectionEvent)},_relayCollectionEvent:function(){this.trigger.apply(this,arguments)},addFiles:function(t){return this.indexView.add({files:t})},promise:function(){return this.indexView.promise()},teardown:function(){return this.remove()},remove:function(){return this.indexView.remove(),this.stopListening(),this},render:function(){return this.indexView.render(),this},getElement:function(){return this.indexView.$el}}));e.exports=r},{"./collections/uploads":240,"./models/upload":242,"./views/fileupload":243,lodash:"K2RcUv","prima/component":395}],242:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({defaults:{url:"",file:null,error:!1,uploading:!1,complete:!1,bytesLoaded:0,bytesTotal:0},initialize:function(t,e){this.options=i.extend({},e),this.options.jqXHR&&this.setUploadRequest(this.options.jqXHR)},setUploadRequest:function(t){return this.jqXHR=t,t.then(function(){}),t},_uploadDone:function(){this.set({error:!1,uploading:!1,complete:!0})},_uploadFail:function(){this.set({error:!0,uploading:!1,complete:!1})},cancelUpload:function(){var t;return this.jqXHR&&(t=this.jqXHR.abort(),this.jqXHR=null),t},getProgress:function(){return this.get("bytesTotal")?this.get("bytesLoaded")/this.get("bytesTotal"):0}});e.exports=o},{lodash:"K2RcUv","prima/model":439}],243:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/lib/mixin"),n=t("when"),r=t("prima/lib/translate"),a=t("../collections/uploads"),l=t("../models/upload"),h=t("prima/utils/recontextify"),d=t("prima/utils/getpath"),c=["add","submit","send","done","fail","always","progress","progressall","start","stop","change","paste","drop","dragover","chunksend","chunkdone","chunkfail","chunkalways"],u=["add","send","progress","active","enable","disable"],p=s.extend({tagName:"input",attributes:{type:"file"},defaults:{name:"photo",maxUploadSize:!1,uploadPattern:!1,mediaType:"image",message:{cancel:"Canceled upload",error:"Upload error",filesize:"The file is too big. Squish it down, and try again!",filetype:"This is not valid %1$s file."},fileUpload:{singleFileUploads:!0,limitConcurrentUploads:1,sequentialUploads:!1,autoUpload:!0,formData:[],dataType:"json",dropZone:null,pasteZone:null}},_createUploadModel:function(t,e){var i=new l(t);return this.collection.add(i,e||{}),i},_createUploadModelForFile:function(t,e,s){e=i.extend({file:t},e);var o=this._createUploadModel(e,s);return t._uploadModel=o,o},initialize:function(t){if(this.options=i.merge({},this.defaults,t),this.options.url&&(this.options.fileUpload.url=this.options.url),this.collection=this.options.collection?this.options.collection:new a,!this.options.fileUpload.url)throw new Error("Upload requires an endpoint URL");this.$el.prop("tabindex",-1),this.options.fileUpload.multiple&&this.$el.prop("multiple",!0),this.options.accept&&this.$el.prop("accept",this.options.accept);var e=i.merge({},this._fileUploadWrap);i.forEach(c,function(t){i.isFunction(e.defaults[t])||(e.defaults[t]=i.noop)},this);var s=new o(e);s.applyTo(this.options.fileUpload),i.forEach(c,function(t){this.options.fileUpload[t]=h(this.options.fileUpload[t],this)},this),this.$el.attr("name",this.options.name).fileupload(this.options.fileUpload),this._fileUpload=this.$el.data("blueimp-fileupload"),i.forEach(u,function(t){this[t]=function(){var e=i.toArray(arguments);e.unshift(t),this._fileUploadInvoke.apply(this,e)}},this)},_fileUploadInvoke:function(t){return this._fileUpload[t].apply(this._fileUpload,i.rest(arguments))},validateFile:function(t,e){e||(e=this.options);var s=[];return e.maxUploadSize&&t.size>e.maxUploadSize&&s.push({type:"filesize",message:i.sprintf(e.message.filesize,e.maxUploadSize)}),e.uploadPattern&&t.type&&!e.uploadPattern.test(t.type)&&s.push({type:"filetype",message:i.sprintf(e.message.filetype,e.mediaType)}),s},upload:function(t){this.add({files:[t]})},cancel:function(){var t;return this.jqXHR?(t=this.jqXHR.abort(),this.jqXHR=null):t=n.reject(this.options.message.cancel),t},_forMatchingFiles:function(t,e){var s=i.rest(arguments);this.collection.forEach(function(o){if(i.contains(t,o.get("file"))){var n=i.clone(s);n[0]=o,e.apply(this,n)}},this)},promise:function(){return this.collection.promise()},_fileUploadWrap:{defaults:{change:function(t){this._fileUpload.options.replaceFileInput&&this.setElement(t)},add:function(t,e,s){var o=s.files[0],n=this.validateFile(o),r={},a={};if(!i.isEmpty(n)){r.error=i.pluck(n,"message"),r.file=o;var l={errorType:"validation",messages:n,file:o};this.collection.trigger("invalid",this.collection,new this.collection.model(r)),this.trigger("error",l),a.silent=!0}return this._createUploadModelForFile(o,r,a),i.isEmpty(n)},send:function(){return!0}},before:{},after:{done:function(t,e,s){var o,n=d(s,"result.meta.status"),a=d(s,"result.response"),l=d(s,"result.errors");if(200!==n||i.isEmpty(a)){var h=function(){return a&&a.msg?a.msg:i.isArray(l)?i.isEmpty(l)?r("Woops :("):l:l.join(" ")}();o={error:h,uploading:!1}}else i.isArray(a)&&(a=a[0]),o=i.extend({complete:!0,uploading:!1},a);this._forMatchingFiles(s.files,function(t,e){t.set(e)},o)},fail:function(t,e,i){var s;s="abort"===i.errorThrown?{uploading:!1}:{error:this.options.message.error,uploading:!1},s.responseJSON=d(i,"jqXHR.responseJSON"),this._forMatchingFiles(i.files,function(t,e){t.set(e)},s)},progress:function(t,e,i){this._forMatchingFiles(i.files,function(t,e){t.set(e)},{bytesLoaded:i.loaded,bytesTotal:i.total})}},around:{add:function(t,e,s,o){var n=t.apply(this,i.rest(arguments));return n===!1||s.isDefaultPrevented()?!1:((o.autoUpload||o.autoUpload!==!1&&this._fileUpload.options.autoUpload)&&o.process().done(i.bind(function(){this.jqXHR=o.submit()},this)),n)},send:function(t,e,s,o){o.with_form_key=!0;var n=t.apply(this,i.rest(arguments));if(n){this._forMatchingFiles(o.files,function(t,e){t.set(e)},{uploading:!0});var r={files:o.files};this.collection.trigger("send",this.collection,r),this.trigger("send",r)}return n}}}});e.exports=p},{"../collections/uploads":240,"../models/upload":242,lodash:"K2RcUv","prima/lib/mixin":420,"prima/lib/translate":423,"prima/utils/getpath":450,"prima/utils/recontextify":456,"prima/view":460,when:"RG2dij"}],244:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/component"),o=t("./views/webcam"),n=t("./utils/get_user_media"),r=s.extend({name:"Webcam",initialize:function(t){this.options=t=i.extend({},t),this.indexView=new o(t),this.listenTo(this.indexView,"all",this._relayViewEvent);var e=["teardown","render","remove"].concat(r.prototype.commands||[]);i.forEach(e,function(t){var e=this.indexView;this[t]=function(){return e[t].apply(e,arguments),this}},this)},_relayViewEvent:function(){this.trigger.apply(this,arguments)},getElement:function(){return this.indexView.$el},getHeightForWidth:function(t){return this.indexView.get("width")?t*this.indexView.get("height")/this.indexView.get("width"):0}},{hasUserMediaSupport:function(){return!!n}});e.exports=r},{"./utils/get_user_media":249,"./views/video_stream":251,"./views/webcam":252,lodash:"K2RcUv","prima/component":395}],245:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div data-js-inner class="countdown-timer--inner"><div data-js-ticks class="countdown-timer--ticks"></div><div data-js-inner class="countdown-timer--fill"><div class="mask-static-half"><div class="fill"></div></div><div class="mask-rotating-half"><div data-js-rotator class="fill"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],246:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<video class="video-stream--video" width="'+(null==(__t=retina?2*width:width)?"":_.escape(__t))+'" height="'+(null==(__t=retina?2*height:height)?"":_.escape(__t))+'"></video><div data-js-novideo class="video-stream--no-video"><div data-subview="loader"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],247:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-sizer class="webcam--sizer" style="padding-top:'+(null==(__t=ratio)?"":_.escape(__t))+'"><div class="webcam--container"><div data-js-videostreamcontainer class="webcam--container-layer"><div data-subview="videoStream"></div></div><div data-js-previewcontainer class="webcam--container-layer" style="display:'+(null==(__t=showPreviewContainer?"block":"none")?"":_.escape(__t))+'"><canvas data-js-canvas width="'+(null==(__t=retina?2*width:width)?"":_.escape(__t))+'" height="'+(null==(__t=retina?2*height:height)?"":_.escape(__t))+'" class="webcam--canvas"></canvas></div><div data-js-controlcontainer class="webcam--container-layer"><div data-subview="webcamControls"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],248:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div data-js-overlaybuttons class="media-overlay">',enableFlash&&(__p+='<div data-js-flashbutton class="button webcam--flash-button '+(null==(__t=flash?"active":"")?"":_.escape(__t))+'"><div class="icon"></div></div>'),__p+="",enableRemove&&(__p+='<div data-subview="removeButton"></div>'),__p+='</div><div data-js-primarybutton class="big-button webcam--primary-button"><div data-js-snapbuttongroup="countdownTimer" class="big-button-group"><div data-subview="countdownTimer"></div></div><div data-js-snapbuttongroup="snapButton" class="big-button-group"><div data-js-snapbutton class="button webcam--snap-button"><div class="icon"></div></div>',enableGifMode&&(__p+='<div data-js-gifbutton class="button webcam--gif-button"><div class="icon"></div></div>'),__p+='</div><div data-js-snapbuttongroup="processing" class="big-button-group"><div data-js-processingbutton class="button webcam--processing-button"><div class="icon"></div></div></div><div data-js-snapbuttongroup="retakeButton" class="big-button-group"><div data-js-retakebutton class="button webcam--retake-button"><div class="icon"></div></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],249:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery").browser,o=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;s.mozilla&&Math.floor(s.version)>=20&&(o=navigator.mozGetUserMedia),o&&(o=i.bind(o,navigator)),e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],250:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").hook,r=t("velocity-animate").animate,a=t("prima/view"),l=t("prima/mixins/accessor"),h=t("prima/mixins/subviewable"),d=t("prima/mixins/selectorcache"),c=t("../templates/countdown_timer.tpl"),u=a.extend({className:"countdown-timer",template:c,mixins:[l,h,d],defaults:{duration:3e3,ticks:1},initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},start:function(t,e){i.isNumber(t)||(t=this.get("duration")),i.isNumber(e)||(e=this.get("ticks")),this.set({duration:t,ticks:e}),this._generateTickMarks(e),this.stop(),this.trigger("countdown:start"),this.js$("inner").removeClass("half-past"),this._halfPastTimeout=i.delay(i.bind(function(){this.js$("inner").addClass("half-past")},this),Math.floor(t/2));var s=0;return o.join(o.promise(i.bind(function(o){clearInterval(this._tickerInterval),this._tickerInterval=setInterval(i.bind(function(){this.trigger("countdown:tick",s++,e),s>=e&&(clearInterval(this._tickerInterval),o())},this),t/e)},this)),r(this.js$("rotator"),{rotateZ:["360deg","0deg"]},{easing:"linear",duration:t})).then(i.bind(function(){this.trigger("countdown:complete")},this))},stop:function(){clearTimeout(this._halfPastTimeout),clearInterval(this._tickerInterval),r(this.js$("rotator"),"stop")},teardown:function(){return clearTimeout(this._halfPastTimeout),clearInterval(this._tickerInterval),this.stopListening(),this},remove:function(){return this.teardown(),a.prototype.remove.apply(this,arguments)},_generateTickMarks:function(t){i.isNumber(t)||(t=this.get("ticks")),this.js$("ticks").empty(),t>1&&i.forEach(i.range(t),function(e){var i=s('<div class="countdown-timer--tick"></div>');n(i,"rotateZ",360*e/t+"deg"),n(i,"translateY","-50%"),this.js$("ticks").append(i)},this)},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._generateTickMarks(),this.attachSubViews(),this}});e.exports=u},{"../templates/countdown_timer.tpl":245,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460,"velocity-animate":"lWl/mc",when:"RG2dij"}],251:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("velocity-animate").animate,n=t("prima/view"),r=t("app/lib/create-object-url"),a=t("../utils/get_user_media"),l=t("prima/mixins/accessor"),h=t("prima/mixins/subviewable"),d=t("prima/mixins/selectorcache"),c=t("../templates/video_stream.tpl"),u=t("components/knight-rider-loader"),p=n.extend({className:"video-stream",template:c,mixins:[l,h,d],defaultOptions:{video:!0,audio:!1},defaults:{width:500,height:375,retina:!0,mirrored:!0,needsPermission:!0,running:!1},initialize:function(t){this.options=t=i.extend({},this.defaultOptions,t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},_onChangeRetina:function(t,e){this.$video.attr(e?{width:2*this.get("width"),height:2*this.get("height")}:{width:this.get("width"),height:this.get("height")})},_onChangeMirrored:function(t,e){this.$el.toggleClass("mirrored",e)},_onChangeRunning:function(t,e){this.loader&&this.loader.set("animate",!e),o(this.js$("noVideo"),"stop"),o(this.js$("noVideo"),{opacity:e?0:1},{display:e?"none":"block",delay:e?50:0,duration:100})},startStream:function(){if(!a)throw new Error("VideoStream: Cannot initialize without getUserMedia support");return a(i.pick(this.options,["audio","video"]),i.bind(this._onStreamReady,this),i.bind(this._onStreamError,this))},stopStream:function(){this.set("running",!1),this.streamURL=null,this.stream&&(this.stream.stop(),this.stream=null)},_onStreamReady:function(t){this.set("needsPermission",!1),this.stream=t,this.streamURL=r(this.stream),this._playVideoSteam()},_onStreamError:function(t){this.stopStream(),this.trigger("error",t)},_playVideoSteam:function(){this.video&&this.streamURL&&(this.video.src=this.streamURL,this.$video.one("loadeddata",i.bind(function(){this.set("running",!0)},this)),this.video.play())},remove:function(){s(this.video).remove(),n.prototype.apply(this,arguments)},teardown:function(){return this.stopStream(),this.stopListening(),this},beforeRender:function(){this.loader=this.subViews.loader=new u({variation:"centered",loading:!this.get("running")}),this.listenTo(this,"change:retina",this._onChangeRetina),this.listenTo(this,"change:mirrored",this._onChangeMirrored),this.listenTo(this,"change:running",this._onChangeRunning)
},render:function(){return this._onChangeMirrored(this,this.get("mirrored")),this.$el.html(this.template(this.toJSON())),this.attachSubViews(),this.$video=this.$(".video-stream--video"),this.video=this.$video.get(0),this._playVideoSteam(),this}});e.exports=p},{"../templates/video_stream.tpl":246,"../utils/get_user_media":249,"app/lib/create-object-url":274,"components/knight-rider-loader":324,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460,"velocity-animate":"lWl/mc"}],252:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("when"),n=t("velocity-animate").animate,r=t("prima/view"),a=t("app/vendor/gif.js"),l=t("prima/utils/image/loader"),h=t("prima/utils/image/filereader"),d=t("prima/utils/image/canvas"),c=t("prima/mixins/accessor"),u=t("prima/mixins/subviewable"),p=t("prima/mixins/selectorcache"),m=t("../templates/webcam.tpl"),g=t("./video_stream"),f=t("./webcam_controls"),_=250,v=300,b=s(document),y=r.extend({className:"webcam",template:m,mixins:[c,u,p],defaults:{width:500,height:375,retina:!0,mirrored:!0,enabled:!0,needsPermission:!0,showControls:!1,flash:!0,showPreviewContainer:!1,defaultTimer:3e3,timePerFrame:1e3,gifFrameCount:4,gifSpeed:200,enableFlash:!0,enableGifMode:!0,enableRemove:!0},commands:["toggleFlash","toggleMirrored","snap","gif","flash","gifStart","gifSnap","gifComplete","retake","close"],initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this._WebcamControlsView=t.WebcamControlsView||f},_onChangeEnabled:function(t,e){e?this.videoStream.startStream():this.videoStream.stopStream()},_onChangeNeedsPermission:function(t,e){var i=200;e||clearTimeout(this._delayedPermissionCheck),n(this.$arrow,"stop"),n(this.$arrow,{opacity:e?1:0},{display:e?"block":"none",duration:i})},_onChangeShowControls:function(t,e){var i=200;n(this.js$("controlContainer"),"stop"),n(this.js$("controlContainer"),{opacity:e?1:0},{display:e?"block":"none",duration:i})},_onChangeShowPreviewContainer:function(t,e){e?this.js$("previewContainer").css("display","block"):(this.js$("previewContainer").children("img").remove(),this.js$("previewContainer").css("display","none"))},startStream:function(){this.set("enabled",!0)},stopStream:function(){this.set("enabled",!1)},snap:function(t){this._snapFrame(t).then(i.bind(function(t){this.set("showPreviewContainer",!0),this.trigger("webcam:image",t),this.webcamControls.trigger("webcam:snapped")},this))},gif:function(t,e){i.isNumber(t)||(t=this.get("gifFrameCount")),i.isNumber(e)||(e=this.get("timePerFrame")),this.gifStart();var s=0;clearInterval(this._gifInterval),this._gifInterval=setInterval(i.bind(function(){s++,this.gifSnap(s>=t),s>=t&&clearInterval(this._gifInterval)},this),e)},gifStart:function(){this._frameBuffer=[]},gifSnap:function(t,e){this._snapFrame(e).then(i.bind(function(){var e=this.js$("canvas"),i=e.get(0),s=document.createElement("canvas");s.width=.5*(i.width||e.width()),s.height=.5*(i.height||e.height()),d.drawElToCanvas(this.js$("canvas"),s),this._frameBuffer.push(s),t&&this.gifComplete()},this))},gifComplete:function(t){i.isNumber(t)||(t=this.get("gifSpeed"));var e=new a({workers:3,quality:1});i.forEach(this._frameBuffer,function(i){e.addFrame(i,{delay:t})},this),e.on("finished",i.bind(function(t){h.read(t).then(i.bind(function(t){l.load(t.base64).then(i.bind(function(t){var e=s('<img data-js-gif class="webcam--preview-image"/>');e.attr("src",t.src),this.js$("previewContainer").append(e),i.extend(t,{base64:t.src,isGif:!0}),this.trigger("webcam:image",t),this.webcamControls.showSnapButtonGroup("retakeButton"),this.set("showPreviewContainer",!0)},this))},this))},this)),e.render(),delete this._frameBuffer},retake:function(){this.set("showPreviewContainer",!1),this.trigger("webcam:reset")},close:function(){this.trigger("webcam:close")},_snapFrame:function(t){!i.isUndefined(t)||(t=this.get("flash"));var e=i.bind(this.flash,this),s=i.bind(this.grabVideoFrame,this);return o.promise(function(o){t?(e(),i.delay(function(){o(s())},.5*v)):o(s())})},grabVideoFrame:function(){d.drawElToCanvas(this.videoStream.video,this.js$("canvas"),this.get("mirrored"));var t=this.js$("canvas").get(0);return t?{width:t.width,height:t.height,base64:t.toDataURL("image/jpeg")}:{width:0,height:0,base64:null}},toggleFlash:function(t){!i.isUndefined(t)||(t=!this.get("flash")),this.set("flash",t)},toggleMirrored:function(t){!i.isUndefined(t)||(t=!this.get("mirrored")),this.set("mirrored",t)},flash:function(){return n(this.$flash,"stop"),this.$flash.css({display:"block",opacity:1}),n(this.$flash,{opacity:[0,1]},{display:"block",delay:v,duration:_}).then(i.bind(function(){this.$flash.css("display","none")},this))},_checkVideoStreamPermissions:function(){this._delayedPermissionCheck=i.delay(i.bind(function(){this.get("needsPermission")&&this._onChangeNeedsPermission(this,!0)},this),1e3),this.get("needsPermission")?(this.js$("controlContainer").css({display:"none",opacity:0}),this.listenToOnce(this.videoStream,"change:needsPermission",function(t,e){this.set("needsPermission",e)}),this.listenToOnce(this.videoStream,"change:running",function(t,e){clearTimeout(this._delayedPermissionCheck),e&&(this.set("needsPermission",!1),this.set("showControls",!0))})):this.set("showControls",!0)},serialize:function(){var t=this.toJSON();return t.ratio=(t.width?t.height/t.width*100:0)+"%",t},teardown:function(){return clearInterval(this._gifInterval),clearTimeout(this._delayedPermissionCheck),b.off("keydown.webcam keyup.webcam"),this.stopListening(),this.$flash&&this.$flash.remove(),delete this.$flash,this.$arrow&&this.$arrow.remove(),delete this.$arrow,this},remove:function(){return this.teardown(),r.prototype.remove.apply(this,arguments)},beforeRender:function(){var t=i.pick(this.attributes,i.keys(g.prototype.defaults)),e=i.pick(this.attributes,i.keys(this._WebcamControlsView.prototype.defaults));this.videoStream=this.subViews.videoStream=new g(t),this.webcamControls=this.subViews.webcamControls=new this._WebcamControlsView(e),this.$flash=s('<div class="webcam--flash"></div>').appendTo("body"),this.$arrow=s('<div class="webcam--permission-arrow"></div>').appendTo("body"),s.browser.mozilla&&this.$arrow.addClass("firefox"),this.set("needsPermission",!this.videoStream.get("running")),this.listenTo(this,"change:enabled",this._onChangeEnabled),this.listenTo(this,"change:needsPermission",this._onChangeNeedsPermission),this.listenTo(this,"change:showControls",this._onChangeShowControls),this.listenTo(this,"change:showPreviewContainer",this._onChangeShowPreviewContainer),this.listenTo(this.videoStream,"error",function(t){this.trigger("webcam:error",t),this.close()}),this.listenTo(this,"change:flash",function(t,e){this.webcamControls.set("flash",e)}),this.listenTo(this,"change:mirrored",function(t,e){this.videoStream.set("mirrored",e),this.webcamControls.set("mirrored",e)}),this.listenTo(this.webcamControls,"webcam",function(t){if(i.contains(this.commands,t)){var e=this[t];i.isFunction(e)&&e.apply(this,i.rest(arguments))}}),b.on("keydown.webcam keyup.webcam",i.bind(function(t){switch(t.which||t.keyCode){case 16:this.set("flash","keyup"===t.type);break;case 18:"keydown"===t.type&&t.metaKey&&this.toggle("mirrored");break;case 91:case 92:case 93:"keydown"===t.type&&t.altKey&&this.toggle("mirrored")}},this))},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this._checkVideoStreamPermissions(),this.get("enabled")&&this.videoStream.startStream(),this}});e.exports=y},{"../templates/webcam.tpl":247,"./video_stream":251,"./webcam_controls":253,"app/vendor/gif.js":281,jquery:"HlZQrA",lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/utils/image/canvas":452,"prima/utils/image/filereader":453,"prima/utils/image/loader":454,"prima/view":460,"velocity-animate":"lWl/mc",when:"RG2dij"}],253:[function(t,e){"use strict";var i=t("lodash"),s=t("velocity-animate").hook,o=t("velocity-animate").animate,n=t("prima/view"),r=t("prima/mixins/accessor"),a=t("prima/mixins/subviewable"),l=t("prima/mixins/selectorcache"),h=t("./countdown_timer"),d=t("app/components/remove-button"),c=t("../templates/webcam_controls.tpl"),u=n.extend({className:"webcam-controls",template:c,events:{mouseenter:"_onHoverControls",mouseleave:"_onHoverControls","click [data-js-flashButton]":"_onClickFlashButton","click [data-js-snapButton]":"_onClickSnapButton","click [data-js-gifButton]":"_onClickGifButton","click [data-js-retakeButton]":"_onClickRetakeButton"},mixins:[r,a,l],defaults:{isActive:!1,flash:!0,mirrored:!0,defaultTimer:3e3,timePerFrame:1e3,gifFrameCount:4,enableFlash:!0,enableGifMode:!0,enableRemove:!0},initialize:function(t){this.options=t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults)))},_onHoverControls:function(t){clearTimeout(this._removeIsActive);var e="mouseover"===t.type||"mouseenter"===t.type;e?this.set("isActive",!0):this._removeIsActive=i.delay(i.bind(function(){this.set("isActive",!1)},this),500)},_onClickFlashButton:function(){this.trigger("webcam","toggleFlash",!this.get("flash"))},_onClickSnapButton:function(t){var e=!t.altKey;this.countdownTimer.stop(),this.listenToOnce(this,"webcam:snapped",function(){this.showSnapButtonGroup("retakeButton")});var s=this.get("defaultTimer");e?(this.showSnapButtonGroup("countdownTimer",0),this.countdownTimer.start(s,1).then(i.bind(function(){this.trigger("webcam","snap")},this))):this.trigger("webcam","snap")},_onClickGifButton:function(){this.countdownTimer.stop(),this.trigger("webcam","gifStart"),this.listenTo(this.countdownTimer,"countdown:tick",function(t,e){this.trigger("webcam","gifSnap",t+1>=e),e>t+1&&this.pulseButton()});var t=this.get("gifFrameCount"),e=this.get("timePerFrame");this.showSnapButtonGroup("countdownTimer",0),this.countdownTimer.start(t*e,t).then(i.bind(function(){this.stopListening(this.countdownTimer,"countdown:tick"),this.showSnapButtonGroup("processing")},this))},_onClickRetakeButton:function(){this.showSnapButtonGroup("snapButton"),this.trigger("webcam","retake")},pulseButton:function(){var t=1.5;s(this.js$("primaryButton"),"translateX","-50%"),s(this.js$("primaryButton"),"scale",t),o(this.js$("primaryButton"),"stop"),o(this.js$("primaryButton"),{scale:[1,t]},{duration:200})},showSnapButtonGroup:function(t,e){i.isNumber(e)||(e=100);var s=this.js$("snapButtonGroup").filter('[data-js-snapButtonGroup="'+t+'"]');if(!i.isEmpty(s)){var n=this.js$("snapButtonGroup").not(s);o(s,"stop"),o(n,"stop"),o(this.js$("primaryButton"),"stop"),o(s,{opacity:1},{display:"block",duration:e}),o(n,{opacity:0},{display:"none",duration:e}),this.js$("primaryButton").toggleClass("invert","processing"===t);var r=60;"snapButton"===t&&this.get("enableGifMode")&&(r=150),o(this.js$("primaryButton"),{width:r},{display:"block",duration:e})}},serialize:function(){return this.toJSON()},teardown:function(){return this},beforeRender:function(){this.countdownTimer=this.subViews.countdownTimer=new h,this.listenTo(this,"change:flash",function(t,e){this.js$("flashButton").toggleClass("active",e)}),this.removeButton=this.subViews.removeButton=new d({buttonClass:"active",onClick:i.bind(function(){this.trigger("webcam","close")},this)}),this.listenTo(this,"change:isActive",function(t,e){this.js$("overlayButtons").toggleClass("active",e)})},render:function(){return this.$el.html(this.template(this.serialize())),this.attachSubViews(),this.showSnapButtonGroup("snapButton",0),this}});e.exports=u},{"../templates/webcam_controls.tpl":248,"./countdown_timer":250,"app/components/remove-button":231,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460,"velocity-animate":"lWl/mc"}],254:[function(t,e){"use strict";var i,s=t("jquery"),o=t("lodash"),n=t("prima/component"),r=t("scrollmonitor"),a=t("prima/events"),l=t("prima/utils/bindendevent").transition,h=n.extend({name:"AvatarManager",selector:"#posts",defaults:{topOffset:68,bottomOffset:132,avatarOffset:85,minWindowWidth:970,peeprDistance:100},initialize:function(){this.$posts=s(this.container),this.$postContainer=this.$posts.find(".post_container"),this.$postContainer.length&&this.bindAvatars()},bindAvatars:function(){this.stickySupport=this.detectStickySupport(),this.stickySupport===!0?this.listenTo(a,"postsView:createPost",this.bindAvatarsWithPositionSticky):(this.$fixedAvatar=this.$posts.find(".post-avatar--fixed"),this.$fixedAvatar=this.$fixedAvatar.length?this.$fixedAvatar:null,this.$mainContainer=s(".l-container"),this.leftFixedPosition=this.$postContainer.offset().left-this.get("avatarOffset"),this.windowWidth=window.innerWidth,this.listenTo(a,"postsView:createPost",this.bindAvatarsWithScrollmonitor),this.listenTo(a,"DOMEventor:flatresize",this.handleResize),this.listenTo(a,"drawer:open",this.drawOpen),this.listenTo(a,"drawer:close",this.drawClose),this.listenTo(a,"peepr:open",this.drawOpen),this.listenTo(a,"peepr:close",this.drawClose),this.handleResize())},detectStickySupport:function(){for(var t=["","-webkit-","-moz-","-ms-"],e=document.createElement("div"),i=0;i<t.length;i++)try{e.style.position=t[i]+"sticky"}catch(s){}return""!==e.style.position?!0:!1},fixAvatar:function(t){t.css({left:this.leftFixedPosition+"px"}).addClass("post-avatar--fixed").removeClass("post-avatar--absolute"),this.$fixedAvatar=t},stickAvatarToBottom:function(t){t.css({left:""}).removeClass("post-avatar--fixed").addClass("post-avatar--absolute"),t===this.$fixedAvatar&&(this.$fixedAvatar=null)},removeAvatarStyles:function(t){t.css({left:""}).removeClass("post-avatar--fixed").removeClass("post-avatar--absolute"),t===this.$fixedAvatar&&(this.$fixedAvatar=null)},bindAvatarsWithScrollmonitor:function(t){var e=t.$el.find(".post_avatar"),i=r.create(t.$el.parent(),{top:this.get("topOffset"),bottom:-this.get("bottomOffset")});i.stateChange(o.bind(function(){i.isInViewport?i.isInViewport&&i.isAboveViewport?(this.leftFixedPosition=this.$postContainer.offset().left-this.get("avatarOffset"),this.fixAvatar(e)):i.isAboveViewport?this.stickAvatarToBottom(e):this.removeAvatarStyles(e):i.isAboveViewport?this.stickAvatarToBottom(e):i.isBelowViewport&&this.removeAvatarStyles(e)},this)),i.triggerCallbacks()},drawOpen:function(){this.positionAvatarAbsolutely()},drawClose:function(){l(this.$mainContainer,o.bind(function(){this.positionAvatarFixed()},this))},positionAvatarAbsolutely:function(){if(null!==this.$fixedAvatar){var t=this.$fixedAvatar.closest(".post"),e=document.body.scrollTop-t.offset().top+this.get("topOffset");this.$fixedAvatar.css({left:-this.get("avatarOffset")+"px",position:"absolute",top:e+"px"})}},positionAvatarFixed:function(){null!==this.$fixedAvatar&&(this.$fixedAvatar.css({position:"",top:""}),setTimeout(o.bind(function(){this.handleResize()},this),0))},bindAvatarsWithPositionSticky:function(t){t.$el.find(".post_avatar").addClass("post-avatar--sticky")},handleResize:function(){this.leftFixedPosition=this.$postContainer.offset().left-this.get("avatarOffset"),this.windowWidth=window.innerWidth,null!==this.$fixedAvatar&&this.$fixedAvatar.css({left:this.leftFixedPosition+"px"}),this.windowWidth<this.get("minWindowWidth")?this.$posts.addClass("post-avatar--static"):this.$posts.removeClass("post-avatar--static")}});e.exports=function(){return i||(i=new h),i}},{jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396,"prima/utils/bindendevent":442,scrollmonitor:"y33VHk"}],255:[function(t,e){"use strict";var i,s=t("jquery"),o=t("lodash"),n=t("prima/events"),r=t("prima/component"),a=t("prima/lib/data"),l=t("./views/rapid-recs-view"),h=r.extend({name:"RapidPostRecommendations",viewsLeft:0,defaults:{viewLimit:3},initialize:function(t){this.options=o.defaults(t||{},this.defaults),this.viewsLeft=this.options.viewLimit,this.postsWithRecs=a.get("Components/RapidRecommendations"),s("body").addClass("flag--rapid-rec"),this.bindEvents()},bindEvents:function(){this.listenTo(n,"post:like:set",this.__handlePostLike),this.listenTo(n,"component:RapidRecommendations",this.onDashboardAjax)},__handlePostLike:function(t,e,i){var s=this.getRecommendationData(e),o="keyboard"===i||"mouse"===i,n=this.viewsLeft<=0;if(s&&o&&!n){if(this.subview){if(this.subview.model.id===e.get("root_id"))return;this.subview.remove()}this.addSubview(new l({likePostModel:e,recData:s}))}},getRecommendationData:function(t){var e=t.get("root_id");return this.postsWithRecs[e]},onDashboardAjax:function(t){this.viewsLeft=this.options.viewLimit,this.postsWithRecs=o.merge(this.postsWithRecs,t)},addSubview:function(t){t.dockable&&(this.subview=t,this.viewsLeft--,this.listenToOnce(this.subview,"remove",this.removeSubview))},removeSubview:function(){this.subview=null}});e.exports=function(){return i||(i=new h),i}},{"./views/rapid-recs-view":258,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396,"prima/lib/data":398}],256:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=s.extend({urlRoot:"/svc/related/posts/",initialize:function(t,e){this.sourcePostModel=e.sourcePostModel,this.id=this.sourcePostModel.get("root_id"),this.recData=e.recData},url:function(){return this.urlRoot+this.getRootblogName()+"/"+this.id},getRootblogName:function(){return this.sourcePostModel.rootTumblelog?this.sourcePostModel.rootTumblelog.id:this.sourcePostModel.tumblelog.id},parse:function(t){return this.recData.ignore_list.length&&(t.response.posts=i.reject(t.response.posts,function(t){return this.recData.ignore_list.indexOf(t.post_id)>-1},this)),t.response}});e.exports=o},{lodash:"K2RcUv","prima/model":439}],257:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+='<div class="rapid-recs"><p class="rapid-rec-title">'+(null==(__t=title)?"":_.escape(__t))+':</p><ul class="micro-post-list">';for(var i=0;postCount>i;i++)__p+='<li class="micro-post-item">'+(null==(__t=model.posts[i].html)?"":__t)+"</li>";__p+="</ul></div>"}return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],258:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/lib/translate"),n=t("prima/view"),r=t("prima/events"),a=t("prima/mixins/selectorcache"),l=t("app/components/gutter-media-manager"),h=t("../templates/rapid-recs.tpl"),d=t("../models/recommended-posts-model"),c=n.extend({className:"rapid-recs-container",mixins:[a],defaults:{scrollDistance:400,postCount:4,timeout:900},$$cacheKeys:{"rapid-recs":".rapid-recs"},dockable:!0,template:h,events:{"click .post_micro":"onPostClick"},titles:["You might like these, too","More you might like","Here! Some other good stuff","These are good, too","Try these, maybe","For your consideration","Also worth your time","Since you liked that"],initialize:function(t){var e=l.putViewInGutter(this,{alwaysEvict:!0,removeOnGutterClick:!0,onUndock:this.destroy});return e?(this.options=i.defaults(t,this.defaults),this.windowStartPosition=s(window).scrollTop(),this.appendTo(),this.model=new d({},{sourcePostModel:this.options.likePostModel,recData:this.options.recData}),this.bindEvents(),void this.model.fetch({timeout:this.options.timeout})):(this.dockable=!1,void this.destroy())},render:function(){if(this.model.get("posts").length<this.options.postCount)return this.remove(),this;var t=i.sample(this.titles),e={model:this.model.toJSON(),postCount:this.options.postCount,title:o(t)};return this.$el.html(this.template(e)),this._visible=!0,this.logPostsServed(),this},bindEvents:function(){this.listenTo(r,"DOMEventor:flatscroll",i.throttle(this.onWindowScroll,1e3,{leading:!1})),this.listenTo(this.model,"sync",this.render),this.listenTo(this.model,"error",this.onModelError)},appendTo:function(){this.$el.prependTo("body")},toggleVisibility:function(t){t!==this._visible&&(this.$$(".rapid-recs").toggleClass("fade-out",!t),l.toggleBackground(t),this._visible=t)},remove:function(){l.removeGutteredView()},destroy:function(){this.toggleVisibility(!1),this.trigger("remove"),i.delay(i.bind(n.prototype.remove,this),300)},onPostClick:function(t){var e=s(t.currentTarget),i={loggingData:{root_post_id:this.model.id,root_blogname:this.model.getRootblogName(),post_id:e.data("id"),blogname:e.data("tumblelog")}};r.trigger("rapid-recommendations:post-click",i)},isHovered:function(){return this.$(".rapid-recs:hover").length>0},onWindowScroll:function(){var t=Math.abs(this.windowStartPosition-s(window).scrollTop()),e=t>this.options.scrollDistance&&!this.isHovered();this.toggleVisibility(!e)},onModelError:function(t,e){var i={loggingData:{root_post_id:t.id,root_blogname:t.getRootblogName(),xhr_status:e.statusText}};r.trigger("rapid-recommendations:ajax-error",i),this.remove()},logPostsServed:function(){var t=this.model.get("posts").slice(0,this.options.postCount),e={loggingData:{root_post_id:this.model.id,root_blogname:this.model.getRootblogName(),served_post_ids:i.pluck(t,"post_id")}};r.trigger("rapid-recommendations:posts-served",e)}});e.exports=c},{"../models/recommended-posts-model":256,"../templates/rapid-recs.tpl":257,"app/components/gutter-media-manager":36,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/mixins/selectorcache":435,"prima/view":460}],259:[function(t,e){"use strict";var i=t("prima/component"),s=t("app/models/tumblelog"),o=t("prima/events"),n=t("jquery"),r=t("lodash"),a=t("./views/recommended-blog-view"),l=t("./views/recommended-blogs-view"),h=i.extend({name:"RecommendedBlog",initialize:function(){var t=this.getOwnData();t&&this.inject(t),this.listenTo(o,"component:RecommendedBlog",this.inject)},$placeholderFor:function(t){return n("#recommended-blog-placeholder-"+t)},inject:function(t){t||(t={});var e=r.map(t.blogs,function(t){return new s(t)}),i={el:this.$placeholderFor(t.uuid).closest(".recommended-unit-container"),blogs:e,blog_card_type:t.blog_card_type,tooltip_text:t.tooltip_text};"compact"===t.blog_card_type?new l(i):new a(i)}});e.exports=h},{"./views/recommended-blog-view":261,"./views/recommended-blogs-view":262,"app/models/tumblelog":278,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396}],260:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<header class="recommended-post-header"><p class="header-text">'+(null==(__t=__("Some more blogs:"))?"":_.escape(__t))+'</p><div class="post_dismiss"><button class="dismiss_icon"><span class="post_dismiss_tooltip">'+(null==(__t=message)?"":__t)+'</span> <i class="icon_close"></i></button></div></header>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],261:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/events"),o=t("jquery"),n=i.extend({initialize:function(t){o(function(){s.trigger("component:DashboardBlogCard:attach_to_el",{$el:t.el,blogs:t.blogs})})}});e.exports=n},{jquery:"HlZQrA","prima/events":396,"prima/view":460}],262:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/events"),o=t("../templates/multiple-blogs.tpl"),n=t("jquery"),r=t("lodash"),a=i.extend({template:o,events:{"click .post_dismiss":"remove"},initialize:function(t){var e=t.tooltip_text[Math.floor(Math.random()*t.tooltip_text.length)],i={message:e};this.$el.append(this.template(i)),n(function(){s.trigger("component:DashboardBlogCard:attach_to_el",{$el:t.el,blogs:t.blogs,blog_card_type:t.blog_card_type})})},remove:function(){this.$el.velocity({height:0,opacity:0},{duration:600,easing:"ease-out",complete:r.bind(i.prototype.remove,this)})}});e.exports=a},{"../templates/multiple-blogs.tpl":260,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/view":460}],263:[function(t,e){"use strict";var i=t("prima/component"),s=t("prima/events"),o=t("jquery"),n=t("./views/remnant-view"),r=t("./views/remnants-view"),a=i.extend({name:"RemnantAd",initialize:function(){var t=this.getOwnData();t&&this.inject(t),this.listenTo(s,"component:RemnantAd",this.inject)},$placeholderFor:function(t){return o("#remnant-units-"+t)},inject:function(t){t||(t={});var e=this.$placeholderFor(t.uuid).closest(".remnant-units");2===t.quantity&&e&&(this.units_view=new r({el:e}),this.unit_left_view=new n({el:o(".post_brick:eq(0)",e)}),this.unit_right_view=new n({el:o(".post_brick:eq(1)",e)}))}});e.exports=a},{"./views/remnant-view":264,"./views/remnants-view":265,jquery:"HlZQrA","prima/component":395,"prima/events":396}],264:[function(t,e){"use strict";var i=t("prima/view"),s=t("prima/events"),o=t("jquery"),n=i.extend({events:{"click [data-remnant]":"_click"},_click:function(t){s.trigger("useraction:dashboard_click:remnant",{loggingData:{pt:o(t.currentTarget).closest(".remnant_ad").data("pt"),userAction:"click_thru"}})}});e.exports=n},{jquery:"HlZQrA","prima/events":396,"prima/view":460}],265:[function(t,e){"use strict";var i=t("prima/view"),s=t("jquery"),o=i.extend({defaults:{minHeight:136},initialize:function(){this.$unit_left=s(".post_brick:eq(0)",this.$el),this.$unit_right=s(".post_brick:eq(1)",this.$el),this._balanceMediaHeights(s(".ad_media",this.$unit_left),s(".ad_media",this.$unit_right)),this._balanceContentHeights(s(".content",this.$unit_left),s(".content",this.$unit_right))},_balanceContentHeights:function(t,e){t.outerHeight()<e.outerHeight()?t.add(e).outerHeight(parseInt(e.outerHeight(),10)):t.outerHeight()>e.outerHeight()&&e.add(t).outerHeight(parseInt(t.outerHeight(),10))},_balanceMediaHeights:function(t,e){if(t.height()!==e.height()){var i=this._shortestHeight(t,e),s=i>this.defaults.minHeight?i:this.defaults.minHeight,o=t.add(e);o.addClass("resized"),o.height(s)}},_shortestHeight:function(t,e){return t.height()<=e.height()?t.height():e.height()}});e.exports=o},{jquery:"HlZQrA","prima/view":460}],266:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/component"),n=t("prima/lib/data"),r=t("./models/tour_guide_model"),a=t("prima/events"),l=t("prima/lib/domeventor"),h=t("components/popover").FeatureHelpPopoverView,d=t("./views/tour_guide_cache"),c=o.extend({name:"TourGuide",defaults:{reactiveStepTimeout:4e3,stepTimeout:2e4,tumblelogName:""},initialize:function(t){this.options=s.extend({},this.defaults,t||{});var e=n.get("Context/user")||{};this.model=new r,this.$body=i("body"),this.$posts=i("#posts"),this.$searchQuery=i("#search_query"),this.$highlighted=i(),this.tumblelogName=e.primary,this.isOpen=!1,this.isQueued=!1,this.isScrolling=!1,this.isSuspended=!1,this.stepTimeout=null,this.stepRenderTimeout=null,this.hoverTimeout=null,this.scrollTimeout=null,this.currentStep=null,this.scrollPosition=l.rect(),this.popover=new h(this.options),this._bindEvents(),this.options.wait&&this.options.waitEvent?a.once(this.options.waitEvent,this.start,this):this.start(),a.trigger("TourGuideView:initialized")},_onTargetMouseover:function(t,e,i){i=i?i:"automatic",this.showInlineStep(e,i,t.currentTarget),this.model.move_to_hover(this.currentStep)},_onTargetMouseout:function(t,e){this.rebindHoverStep(t.currentTarget,s.bind(function(){this._onTargetMouseover(t,e,"hoverable")},this),e),this.hideInlineStep()},_onScroll:function(t){this.scrollPosition=t,this.isScrolling=!0,this.scrollTimeout&&(clearTimeout(this.scrollTimeout),this.scrollTimeout=null),this.scrollTimeout=setTimeout(s.bind(function(){this.isScrolling=!1,this.isQueued&&this.renderIfVisibleElement()},this),200)},_onPostLikeSuccess:function(t){if(this.model.get("reactive")&&this.model.get("reactive").like){var e=this.$posts.find('[data-post-id="'+t+'"] .post_control.like').get(0);this.model.unset_attribute("like","hoverable"),this.showInlineStep("like","reactive",e)}},_onPostFormSuccess:function(t){t&&t.reblog&&(this.resume(),this.showInlineStep("reblog","reactive"))},_onPostFollowSuccess:function(){this.model.get("reactive")&&this.model.get("reactive").follow&&this.showInlineStep("follow","reactive")},_onSearchFocus:function(){this.isOpen&&"search"===this.currentStep.name||this.suspend()},_onSearchBlur:function(){this.isOpen&&"search"===this.currentStep.name||this.resume()},_onModelChange:function(){this.$body.off(".tour_guide_hover"),s.each(this.model.get("automatic"),function(t){t.hover===!0&&(this.$body.one("mouseover.tour_guide_hover",t.target,s.bind(function(e){this._onTargetMouseover(e,t.name)},this)),this.$body.one("mouseout.tour_guide_hover",t.target,s.bind(function(e){s.has(this.model.get("hoverable"),t.name)&&this._onTargetMouseout(e,t.name)},this)))},this),this.options.tumblelogName&&d.set_cache(this.options.tumblelogName,this.model.toJSON()),this.updateStep()},_bindEvents:function(){this.listenTo(this.model,"change:automatic",this._onModelChange),this.listenTo(a,"DOMEventor:flatscroll",this._onScroll),this.listenTo(a,"post:form:show",this.suspend),this.listenTo(a,"post:form:hide",this.resume),this.listenTo(a,"peepr:open",this.suspend),this.listenTo(a,"peepr:close",this.resume),this.listenTo(a,"drawer:open",this.suspend),this.listenTo(a,"drawer:close",this.resume),this.listenToOnce(a,"post:like:set",this._onPostLikeSuccess),this.listenToOnce(a,"post:form:success",this._onPostFormSuccess),this.listenToOnce(a,"post:follow:success",this._onPostFollowSuccess),this.listenTo(this.popover,"hide",this._onPopoverHide),this.$searchQuery.on("focus.tour_guide",s.bind(this._onSearchFocus,this)),this.$searchQuery.on("blur.tour_guide",s.bind(this._onSearchBlur,this))},_onPopoverHide:function(){this.hide()},_stepTimeout:function(){var t=this.model.get("automatic");this.currentStep&&s.size(t)>1&&(this.model.move_to_last(this.currentStep),this.updateStep())},start:function(){if(this.options.tumblelogName){var t=d.get_cache(this.options.tumblelogName);t?this.model.set(t):this.model.fetch()}else this.model.fetch();a.trigger("TourGuideView:started")},updateStep:function(){var t=s.first(s.toArray(this.model.get("automatic")));t&&!s.isEmpty(t)&&(this.remove(),this.currentStep=t,this.stepRenderTimeout=setTimeout(s.bind(this.preRender,this),t.delay||0))},showInlineStep:function(t,e,o){if(t){var n,r,a="reactive"===e?!0:!1;switch(this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=null),this.remove(),e){case"reactive":n=this.model.get("reactive");break;case"hoverable":n=this.model.get("hoverable");break;default:n=this.model.get("automatic")}this.currentStep=s.result(n,t),this.currentStep&&("search"===this.currentStep.name&&(r="search_form_active"),this.setHighlighted(i(o),r),a&&this.currentStep.name&&(this.$body.off(".tour_guide_hover"),this.$body.find("[data-tour-guide-"+this.currentStep.name+"]").off(".tour_guide_hover")),this.preRender(!0,a))}},setHighlighted:function(t,e){this.$highlighted=t,this.popover&&this.popover.setHighlighted(t,e)},preRender:function(t,e){if(!this.isSuspended){if(this.stepRenderTimeout&&(clearTimeout(this.stepRenderTimeout),this.stepRenderTimeout=null),e&&this.hideInlineStep(this.options.reactiveStepTimeout),this.isScrolling)return void(this.isQueued=!0);this.stepTimeout&&(clearTimeout(this.stepTimeout),this.stepTimeout=null),this.stepTimeout=setTimeout(s.bind(this._stepTimeout,this),this.options.stepTimeout),t||!this.currentStep.target||this.$highlighted.length?this.render(t):this.renderIfVisibleElement()}},render:function(t){if(!this.currentStep)return this;var e,i;return this.isOpen=!0,this.isQueued=!1,this.stepTimeout&&(clearTimeout(this.stepTimeout),this.stepTimeout=null),this.$highlighted&&this.$highlighted.length&&(e=this.$highlighted.closest(".post").data("json")),a.trigger("TourGuideView:render:step",{post_data:e,step:this.currentStep.name}),this.$body.attr("data-tour-guide-step",this.currentStep.name),i=s.extend({},this.currentStep,{glass:!t}),t&&delete i.ok_text,this.popover.show(i),this},suspend:function(){this.isSuspended||(this.isSuspended=!0,clearTimeout(this.stepRenderTimeout),this.popover.hide(),this.hide())},resume:function(){this.isSuspended&&(this.isSuspended=!1,this.updateStep())
},renderIfVisibleElement:function(){this.currentStep.target&&(this.setHighlighted(this.getVisibleHighlightedElement()),this.$highlighted.length?this.preRender():this.isQueued=!0)},hide:function(t){var e=this.currentStep?this.currentStep.name:void 0;this.$body.removeAttr("data-tour-guide-step"),!t&&this.currentStep&&(this.model.unset_attribute(this.currentStep.name,"automatic"),this.model.log({step:e,action:"hide"})),a.trigger("TourGuideView:hide",{step:e})},remove:function(){this.popover.remove(),this.isQueued=!1,this.$highlighted=i()},hideInlineStep:function(t){t=t||this.options.hoverTimeout,this.hoverTimeout=setTimeout(s.bind(function(){this.popover.hide(),this.hide(!0),this.updateStep()},this),t)},rebindHoverStep:function(t,e,o){if(t&&e){var n=i(t);n.attr("data-tour-guide-"+o,!0),n.on("mouseover.tour_guide_hover",s.bind(e,this)),n.on("mouseout.tour_guide_hover",s.bind(this.hideInlineStep,this))}},getVisibleHighlightedElement:function(){if(this.currentStep){var t=i(),e=this.scrollPosition.windowScrollTop,s=this.scrollPosition.windowScrollTop+this.scrollPosition.windowHeight;return i(this.currentStep.target).each(function(){var o=i(this),n=o.offset();return n.top>e&&n.top+o.height()<s?(t=o,!1):void 0}),t}}});e.exports=c},{"./models/tour_guide_model":267,"./views/tour_guide_cache":268,"components/popover":327,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396,"prima/lib/data":398,"prima/lib/domeventor":400}],267:[function(t,e){"use strict";var i=t("prima/model"),s=t("lodash"),o=t("jquery"),n=i.extend({url:"/svc/guidedtour/dashboard/itinerary",initialize:function(){},parse:function(t){return t.response},unset_attribute:function(t,e,i){t&&e&&this.set(e,s.omit(this.get(e),t),{silent:i||!1})},move_to_hover:function(t){if(t&&t.name){var e=s.clone(this.get("hoverable"))||{};e[t.name]=t,this.set("hoverable",e),this.unset_attribute(t.name,"automatic",!0)}},move_to_last:function(t){if(t&&t.name){var e=s.clone(this.get("automatic"))||{},i=s.keys(e),o=s.toArray(e);o.length>1&&(o=s.without(o,t),o.push(t),i=s.without(i,t.name),i.push(t.name),e=s.zipObject(i,o),this.set("automatic",e,{silent:!0}))}},log:function(t){o.ajax({url:this.url,with_form_key:!0,type:"POST",data:t})}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","prima/model":439}],268:[function(t,e){"use strict";var i={cache:{},cache_key:"tumblr_tour_guide",cache_timeout:864e5,get_cache:function(t){if(!window.sessionStorage||!window.sessionStorage.length)return!1;var e=window.sessionStorage.getItem(this.cache_key);if(e)try{var i=JSON.parse(e),s=(new Date).getTime();return i.tumblelog&&i.tumblelog===t?!i.timestamp||s-i.timestamp>=this.cache_timeout?!1:i.steps||!1:!1}catch(o){return!1}return!1},set_cache:function(t,e){if(!window.sessionStorage)return!1;var i={timestamp:(new Date).getTime(),tumblelog:t,steps:e};try{sessionStorage.setItem(this.cache_key,JSON.stringify(i))}catch(s){}}};e.exports=i},{}],context:[function(t,e){e.exports=t("NOGuuH")},{}],NOGuuH:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/flags"),n=t("prima/lib/data"),r=t("app/router"),a=t("prima/events"),l=t("app/lib/currentuser"),h=t("components/crt"),d=t("components/abuse-form"),c=t("app/components/post-form-builder"),u=t("app/components/keycommand-guide"),p=t("app/components/media-embed-harness/manager"),m=(t("app/components/header"),t("app/components/footer"),t("app/components/elevator")),g=t("app/components/recommended-blogs-unit"),f=t("./components/tour_guide"),_=t("./components/remnant_ad"),v=t("./components/recommended_blog"),b=t("./components/avatar_manager"),y=t("./components/rapid-post-recommendations"),w=r.extend({routes:{"dashboard(/)":"dashboard","dashboard/:page(/:hash)(/)":"dashboard","(blog/:channel_id/)new/:type(/)":"newPost","new/:type(/)":"newPost","edit/:id(/)":"editPost","reblog/:id/:key(/)":"reblogPost",inbox:"inbox","blog/:tumblelog(/:subsection)":"blogTumblelog",likes:"likes","liked/by/:user":"likedBy","tagged/:tag(/*subpage)":"tagged",following:"following","spotlight/:category":"spotlight"},initialize:function(){this.crtControl=h,this.mediaEmbedManager=p,this.user=l(),o.bool("abuse_forms")&&(this.abuseForm=new d),n.has("Components/PostFormBuilder")&&(this.postFormBuilder=new c)},setup:function(){this.keycommandGuide=new u,this.elevator=new m},dashboard:function(){if(this.setup(),this.avatarManager=new b,o.bool("onboarding_tour_guide")){var t=o.bool("onboarding_tag_bingo"),e="onboarding:tag_bingo_interstitial:completed";this.tour_guide=new f({wait:t,waitEvent:e})}this.remnant_ad=new _,this.recommended_blog=new v,this.listenTo(a,"Dashboard:should_hide_posts_on_unfollow",s.bind(function(){a.trigger("Dashboard:hide_posts_on_unfollow")},this)),o.bool("rapid_like_recommendation")&&(this.rapidRecommendations=y()),this.initializeRecommendedBlogs()},newPost:function(t,e){this.setup(),this.avatarManager=new b,this.postFormBuilder&&a.trigger("postForms:open",{updateURL:!1,postFormType:c.containerType("inline"),postType:e})},editPost:function(t){this.setup(),this.avatarManager=new b,this.postFormBuilder&&a.trigger("postForms:open",{updateURL:!1,postFormType:c.containerType("modal"),detached:!0,editId:t})},reblogPost:function(t,e){this.setup(),this.avatarManager=new b,this.postFormBuilder&&a.trigger("postForms:open",{updateURL:!1,postFormType:c.containerType("modal"),reblogId:t,reblogKey:e})},inbox:function(){this.setup(),this.avatarManager=new b},blogTumblelog:function(t,e){this.setup(),"queue"!=e&&(this.avatarManager=new b)},likes:function(){this.setup(),this.avatarManager=new b,this.initializeRecommendedBlogs()},likedBy:function(){this.setup(),this.avatarManager=new b,this.initializeRecommendedBlogs()},tagged:function(){this.setup(),this.avatarManager=new b,i("#tagged_actions_display").hasClass("is_featured_tag")||this.initializeRecommendedBlogs()},following:function(){this.setup(),this.avatarManager=new b},spotlight:function(){this.setup()},initializeRecommendedBlogs:function(){if(o.bool("prima_recommended_blogs_list")){var t=i(".controls_section.follow_list"),e=t.data("json");t.removeData("json");var s=[],n=[];e&&(e.tumblelogs&&(s=e.tumblelogs),e.sponsored_tumblelogs&&(n=e.sponsored_tumblelogs)),this.recommendedBlogsUnit=new g({el:".controls_section.follow_list",tumblelogs:s,sponsoredTumblelogs:n}),this.recommendedBlogsUnit.render()}}});e.exports=w,t("./legacy")},{"./components/avatar_manager":254,"./components/rapid-post-recommendations":255,"./components/recommended_blog":259,"./components/remnant_ad":263,"./components/tour_guide":266,"./legacy":271,"app/components/elevator":28,"app/components/footer":33,"app/components/header":37,"app/components/keycommand-guide":42,"app/components/media-embed-harness/manager":46,"app/components/post-form-builder":63,"app/components/recommended-blogs-unit":225,"app/lib/currentuser":275,"app/router":280,"components/abuse-form":284,"components/crt":301,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/data":398,"prima/lib/flags":"f/LVtH"}],271:[function(t){var e=t("prima/utils/exposer");e({"Tumblr.Prima.embedHarness":t("app/components/media-embed-harness/manager")})},{"app/components/media-embed-harness/manager":46,"prima/utils/exposer":449}],272:[function(t,e){"use strict";var i=t("prima/utils/exposer");i({"Tumblr.Prima.PostViewBuilder":t("components/post"),"Tumblr.Prima.Upload":t("app/components/upload"),"Tumblr.Prima.Ligature":t("ligature"),"Tumblr.Events":t("prima/events"),"Tumblr.Prima.Events":t("prima/events"),"Tumblr.Prima.Dialog":t("app/components/dialog"),"Tumblr.Dialog":t("app/components/dialog"),"Tumblr.PostMessageChannel":t("components/post-message-channel"),"Tumblr.Prima.DOMEventor":t("prima/lib/domeventor"),"Tumblr.Prima.gutterMediaManager":t("app/components/gutter-media-manager"),"Tumblr.Prima.Vendor.when":t("when"),"Tumblr.Prima.Vendor.sequence":t("when/sequence"),"Tumblr.log_lady":t("prima/lib/loglady"),"Tumblr.Prima.logLady":t("prima/lib/loglady"),"Tumblr.Prima.Models.Post":t("app/models/post"),"Tumblr.Prima.Models.Tumblelog":t("app/models/tumblelog"),"Tumblr.Prima.CrtPlayer":t("components/crt/player"),"Tumblr.Prima.BlogCard":t("app/components/blog-card"),"Tumblr.Prima.Url":t("prima/utils/url"),ace:t("app/vendor/ace"),"Tumblr.Prima.ToolTip":t("app/components/tooltip"),"Tumblr.Prima.SharePopover":t("components/popover/views/share-popover"),"Tumblr.Prima.utils.caniuse":t("prima/utils/caniuse"),"Tumblr.Prima.PostModerationPopover":t("components/popover/views/post_moderation_popover"),"Tumblr.Prima.ConfettiView":t("app/components/confetti/views/confetti-view"),"Tumblr.Prima.FlatSelect":t("app/components/flat-select"),"Tumblr.Prima.Mixins.loggingData":t("prima/mixins/generate-logging-data")}),e.exports=i},{"app/components/blog-card":10,"app/components/confetti/views/confetti-view":19,"app/components/dialog":20,"app/components/flat-select":31,"app/components/gutter-media-manager":36,"app/components/tooltip":237,"app/components/upload":241,"app/models/post":277,"app/models/tumblelog":278,"app/vendor/ace":"4e8++S","components/crt/player":302,"components/popover/views/post_moderation_popover":335,"components/popover/views/share-popover":336,"components/post":340,"components/post-message-channel":337,ligature:471,"prima/events":396,"prima/lib/domeventor":400,"prima/lib/loglady":414,"prima/mixins/generate-logging-data":428,"prima/utils/caniuse":443,"prima/utils/exposer":449,"prima/utils/url":459,when:"RG2dij","when/sequence":482}],273:[function(t,e){"use strict";var i=t("lodash"),s=[16,24,30,40,48,64,96,128,512],o=i.last(s),n=128,r=function(t){return t>=o?o:i.find(s,function(e){return e>=t})},a=function(t,e){var i=function(e){return e=null==e?n:r(e),t.replace(/^(.*_)?(\d+)(\D.*)?$/,"$1"+e+"$3")};return i.toString=function(){return this()},null!=e?i(e):i};e.exports=a},{lodash:"K2RcUv"}],274:[function(t,e){"use strict";var i=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL;e.exports=i},{}],275:[function(t,e){"use strict";var i,s=t("app/models/user"),o=t("prima/lib/data"),n=function(){if(null==i){var t=o.get("Context/userinfo");i=t&&t.name?new s(t):!1}return i};e.exports=n},{"app/models/user":279,"prima/lib/data":398}],276:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/mixin"),n=new o({setUpSelector:function(t){t.on("change",s.bind(this.__select_change,this))},__select_change:function(t){var e=i(t.currentTarget);this.__update_select(e)},__update_select:function(t){var e=t.siblings("label");e.text(t.find(":selected").text())}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/mixin":420}],277:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/model"),n=t("prima/events"),r=t("app/models/tumblelog"),a=t("app/components/dialog"),l=t("app/components/post-embed-code"),h=t("prima/lib/translate"),d=o.extend({defaults:{},endpoints:{like:"/svc/like",unlike:"/svc/unlike",reblog:"/fast_reblog",reply:"/svc/reply",publish:"/publish",queue:"/publish",destroy:"/svc/post/delete",promote:"/svc/promote",unpromote:"/svc/unpromote",answer:"/answer",deny:"/deny_submission",approve:"/approve_submission",remove_source:"remove_app_attribution"},initialize:function(){this._createPostTumblelogModel("tumblelog",this.get("tumblelog-data")),this._createPostTumblelogModel("parentTumblelog",this.get("tumblelog-parent-data")),this._createPostTumblelogModel("rootTumblelog",this.get("tumblelog-root-data"))},_createPostTumblelogModel:function(t,e){t=t||"tumblelog",e=e||!1;var s=!1;e&&e.name&&(s=new r(i(e).omit(i.isUndefined).omit(i.isNull).value())),this[t]=s},_setTumblelog:function(){this.tumblelog=new r(i({name:this.get("tumblelog"),ignoring:!1,sponsor:this.get("sponsored"),following:this.get("following"),mention_key:this.get("tumblelog_mention_key")}).omit(i.isUndefined).omit(i.isNull).value())},_setReblogTumblelog:function(){var t=this.get("reblog_source");t&&t.name&&(this.reblogTumblelog=new r(i({name:t.name,ignoring:!1,following:t.following}).omit(i.isUndefined).omit(i.isNull).value()))},_xhrRequest:function(t,e,o){o.init&&o.init();var n=s.ajax({data:e,type:"POST",url:t,with_form_key:!0});return n.done(i.bind(function(t){o[200]&&o[200].call(this,t)},this)),n.fail(i.bind(function(t){o[t.status]&&o[t.status].call(this,t.status)},this)),n.always(i.bind(function(){o.always&&o.always()},this)),n},_xhrSuccess:function(t){this.trigger(t+":success")},_xhrFailure:function(t){a.alert(h("Sorry, we seem to be having technical trouble.  Please try again later.")),this.trigger(t+":failure")},save:function(t,e,s){if(s||(s={}),this.endpoints[t]){var o={200:i.bind(this._xhrSuccess,this,t),401:i.bind(this._xhrFailure,this,t),404:i.bind(this._xhrFailure,this,t),403:i.bind(this._xhrFailure,this,t),500:i.bind(this._xhrFailure,this,t)};return this._xhrRequest(this.endpoints[t],e,i.defaults(s,o))}throw new Error("Missing endpoint url for "+t)},like:function(t){if(!this.get("is_mine")){if(this.get("liked")===!1){this.set("liked",!0);var e=this.likePayload(t,this.getLikeSource("like"));this.save("like",{data:e})}this.trigger("like:set",this),n.trigger("post:like:set",this.get("id"),this,t)}},unlike:function(){if(this.get("liked")===!0){this.set("liked",!1);var t=this.likePayload("mouse",this.getLikeSource("unlike"));this.save("unlike",{data:t})}this.trigger("unlike:set",this),n.trigger("post:unlike:set",this.get("id"))},toggleLike:function(){this.get("liked")?this.unlike():this.like()},getLikeSource:function(t){t=t||"like";var e="LIKE_";switch(t){case"unlike":e="UNLIKE_";break;case"reply":e="REPLY_";break;case"ignore":e="IGNORE_"}var i=location.pathname;return i.match(/^\/dashboard/)?e+"SOURCE_DASHBOARD":i.match(/^\/tagged/)?e+"SOURCE_TAG_PAGE":i.match(/^\/likes/)?e+"SOURCE_LIKES_PAGE":i.match(/^\/inbox/)?e+"SOURCE_INBOX":i.match(/^\/search/)?e+"SOURCE_SEARCH_RESULTS_PAGE":i.match(/^\/explore/)?e+"SOURCE_DISCOVER":i.match(/^\/indash_blog\/peepr/)?e+this.getPeeprSource():e+"SOURCE_UNKNOWN"},getPeeprSource:function(){if(window.parent&&window.parent.location){var t=window.parent.location.pathname;if(t.match(/search/))return"SOURCE_SEARCH_PEEPR"}return"SOURCE_PEEPR"},getEmbedCode:function(t,e){var i={embed_key:this.get("embed_key"),embed_did:this.get("embed_did"),post_id:this.get("id"),post_url:this.get("post_url")};t&&(i.language=t),e&&(i.width=e);var s=new l(i);return s.getCode()},likePayload:function(t,e){return t=t||"mouse",e=e||"LIKE_SOURCE_UNKNOWN",{id:this.get("id"),root_id:this.get("root_id"),key:this.get("reblog_key"),method:t,source:e,placement_id:this.get("placement_id")||!1,is_recommended:this.get("is_recommended")||"",pt:this.get("pt")}},reblog:function(t){t||(t={}),t=i.extend({oldPostFormData:{pt:this.get("pt"),type:this.get("type"),reblog_id:this.get("id"),detached:!0,reblog:!0,reblog_key:this.get("reblog_key")}},t,{reblogId:this.get("id"),reblogKey:this.get("reblog_key"),pt:this.get("pt")}),n.trigger("postForms:reblog",t)},fastReblog:function(t){t||(t=!1),this.trigger("fastreblog:success",t);var e={reblog_key:this.get("reblog_key"),reblog_post_id:this.get("id"),queue:t,pt:this.get("pt")},s={200:i.bind(function(t){this.set("reblogged",!0),this.trigger("fastreblog:ajax:success",t.response)},this)};this.save("reblog",e,s)},reply:function(t){var e={reply_text:t,post_id:this.get("id"),tumblelog:this.get("tumblelog"),tumblelog_key:this.get("tumblelog_key"),source:this.getLikeSource("reply")},s={200:i.bind(function(){this.trigger("replied")},this)};return this.save("reply",{data:e},s)},destroy:function(){var t={post_id:this.get("id"),channel_id:this.get("tumblelog")};this.save("destroy",t)},publish:function(){var t=this.save("publish",{id:this.get("id")});t.fail(i.bind(function(t){this.trigger("publish:failure",s.parseJSON(t.responseText))},this))},promote:function(t){var e={tag:t,post_id:this.get("id"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")};return this.save("promote",e)},unpromote:function(t){var e={tag_id:t,post_id:this.get("id"),reblog_key:this.get("reblog_key"),tumblelog_name:this.get("tumblelog")};return this.save("unpromote",e)},queue:function(){var t={id:this.get("id"),queue:"queue"};this.save("queue",t)},removeSource:function(){var t={post_id:this.get("id"),tumblelog_id:this.get("tumblelog")};return this.save("remove_source",t)},approve:function(t){var e={id:this.get("id"),queue:t};return this.save("approve",e)},deny:function(){return this.save("deny",{pid:this.get("id")})},answer:function(t){var e={post_id:this.get("id"),tumblelog:this.get("tumblelog"),key:this.get("tumblelog_key"),answer_text:t};return this.save("answer",e)},embedFocus:function(){this.trigger("embed:focus",this)},updateReblogControl:function(t){this.trigger("reblog:success",t)},dismiss:function(){this.trigger("dismiss",this)}});e.exports=d},{"app/components/dialog":20,"app/components/post-embed-code":61,"app/models/tumblelog":278,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/model":439}],278:[function(t,e){"use strict";function i(t,e,i){var s=r.Deferred(),o={data:{tumblelog:t.get("name")}};i.placement_id&&(o.data.placement_id=i.placement_id),i.pt&&(o.data.pt=i.pt),i.source&&(o.data.source=i.source),i.context&&(o.data.context=i.context),i.tlt&&(o.data.tlt=i.tlt);var n=function(){i.wait||t.set({following:e.following},i)},a=function(o,n){i.wait||t.set({following:!e.following},i),s.reject(n)},l=function(){i.wait&&t.set({following:e.following},i),s.resolve()},h=e.following?"/svc/follow":"/svc/unfollow";return r.ajax({beforeSend:n,cache:!i.force,data:o,error:a,type:"POST",success:l,url:h,with_form_key:!0}),s.promise()}function s(t,e){var i=r.Deferred(),s={};a.has(e,"is_tumblelog_popover")&&(s.is_tumblelog_popover=e.is_tumblelog_popover),a.has(e,"is_user_mention")&&(s.is_user_mention=e.is_user_mention);var o=function(t,e){i.reject(e)},n=function(e){a.has(e,"highlighted_posts")||(e={highlighted_posts:e}),t.set(e),i.resolve()};return r.ajax({cache:!e.force,data:s,error:o,type:"GET",success:n,url:c(t),with_form_key:!0}),i.promise()}function o(t,e){return l.promise(function(i,s){var o={tumblelog:t.get("name")};a.has(e,"include_member_data")&&(o.include_member_data=e.include_member_data),a.has(e,"include_activity_data")&&a.has(e,"include_member_data")&&(o.include_activity_data=e.include_activity_data);var n=function(t,e){s(e)},l=function(e){t.set(e.response),i()};r.ajax({data:o,type:"GET",error:n,success:l,url:"/svc/data/tumblelog",with_form_key:!0})})}function n(t,e){return r.ajax({cache:!e.force,data:e.data,type:"GET",url:"/svc/tumblelog_popover/"+t,with_form_key:!0})}var r=t("jquery"),a=t("lodash"),l=t("when"),h=t("prima/events"),d=t("prima/singletonmodel"),c=function(){function t(t){return t.has("avatar_url")&&t.has("global_theme_params")}return function(e){return t(e)?"/svc/"+e.get("name")+"/posts/highlighted":"/svc/tumblelog_popover/"+e.get("name")}}(),u=d.extend({save_following:function(t,e){e||(e={}),t||(t={}),t.following=!!t.following;var s=this;return e.force||s.get("following")!==t.following?i(s,t,e).then(a.bindKey(s,"save_following",t)):r.when(s.get("following"))},fetch_popover_data:function(t){t||(t={}),t.is_user_mention=!!t.is_user_mention,t.is_tumblelog_popover=!!t.is_tumblelog_popover;var e=this;return!t.force&&e.has("highlighted_posts")?r.when(e.get("highlighted_posts")):s(e,t).then(a.bindKey(e,"fetch_popover_data",void 0))},fetch_analytics_data:function(){return o(this,{include_member_data:!0,include_activity_data:!0})},toggle_spam:function(){return r.ajax({url:"/spam/toggle",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},toggle_nsfw:function(){return r.ajax({url:"/nsfw/toggle",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},toggle_suspended:function(){return r.ajax({url:"/suspended/toggle",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},follow:function(t){this.save_following({following:!0},t)},_unfollow:function(t){this.save_following({following:!1},t)},requestUnfollow:function(t){var e=l.defer();return e.promise.then(a.bind(this._unfollow,this,t)).catch(a.noop),e},ignore:function(){return r.ajax({url:"/svc/ignore/add",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},unignore:function(){return r.ajax({url:"/svc/ignore/remove",type:"POST",data:{tumblelog:this.id},with_form_key:!0})},defaults:null,idAttribute:"name",initialize:function(){this.bindEvents()},bindEvents:function(){var t=this.get("name");this.on("change:following",function(){if(void 0!==this.previous("following")){var e=this.get("following")?"tumblelog:follow":"tumblelog:unfollow";h.trigger(e,{name:t,loggingData:t})}},this)},parse:function(t){return t},validate:function(){return!1},destroy:function(){return this},fetch:function(){return this},save:function(){return this},url:function(){},urlRoot:function(){}},{collection:null,modelFromToken:function(t){var e,i=u.getCollection(),s=r.Deferred(),o=i.findWhere({token:t});return o?s.resolve(o):(e={data:{is_user_mention:!0}},n(t,e).then(function(e){var i=new u(e);i.set({token:t}),s.resolve(i)},function(){s.reject()})),s.promise()}});u.collection=u.getCollection(),e.exports=u},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/singletonmodel":441,when:"RG2dij"}],279:[function(t,e){"use strict";var i=t("prima/singletonmodel"),s=t("prima/model"),o=t("../collections/tumblelogs"),n=i.extend({idAttribute:"name",initialize:function(t){this.channels=new o(t.channels)},getChannel:function(t){return null==t&&(t=this.get("primary")),this.channels.findWhere({name:t})},toJSON:function(){var t=s.prototype.toJSON.apply(this,arguments);return t.channels=this.channels.toJSON(),t},getChannelProperty:function(t,e){var i=this.getChannel(t);if(!(i&&"get"in i))return null;var s=i.get(e);return"undefined"==typeof s?null:s}});e.exports=n},{"../collections/tumblelogs":2,"prima/model":439,"prima/singletonmodel":441}],280:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("prima/router"),n=t("prima/lib/data"),r=t("./bootloader"),a=o.extend({logs:function(){return i.union([t("logs/instruments/embed"),t("logs/instruments/help-form"),t("logs/instruments/keycommands"),t("logs/instruments/login-register"),t("logs/instruments/video-player"),t("logs/instruments/vendor-button"),t("logs/instruments/dashboard-sharing"),t("logs/instruments/related-recommendations")],o.prototype.logs.apply(this))},constructor:function(){o.apply(this,arguments),this.startHistory(),this.initializeApp()},getName:function(){return this.name=n.get("Context/name"),i.sprintf("Context/%s",this.name)},initializeApp:function(){{var e=t("app/components/header"),i=(new e,t("app/components/footer"));new i}},startHistory:function(t){s.History.started||i.isEmpty(this.routes)||(this.routeFound=s.history.start({pushState:"pushState"in window.history,hashChange:t?!("pushState"in window.history):!1,root:this.root}))}},{Bootloader:r});e.exports=a},{"./bootloader":1,"app/components/footer":33,"app/components/header":37,backbone:"5kFNoY",lodash:"K2RcUv","logs/instruments/dashboard-sharing":383,"logs/instruments/embed":384,"logs/instruments/help-form":385,"logs/instruments/keycommands":386,"logs/instruments/login-register":387,"logs/instruments/related-recommendations":388,"logs/instruments/vendor-button":389,"logs/instruments/video-player":390,"prima/lib/data":398,"prima/router":440}],281:[function(t,e){"use strict";var i=t("gif.js/dist/gif").GIF,s=t("./inline-worker"),o=function(t){var e=s;return t||(t={}),t.workerScript||(t.workerScript=e),new i(t)};e.exports=o},{"./inline-worker":282,"gif.js/dist/gif":464}],282:[function(t,e){var i=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL;i&&(e.exports=i(new Blob(["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n(function(b){function a(b,d){if({}.hasOwnProperty.call(a.cache,b))return a.cache[b];var e=a.resolve(b);if(!e)throw new Error('Failed to resolve module '+b);var c={id:b,require:a,filename:b,exports:{},loaded:!1,parent:d,children:[]};d&&d.children.push(c);var f=b.slice(0,b.lastIndexOf('/')+1);return a.cache[b]=c.exports,e.call(c.exports,c,c.exports,f,b),c.loaded=!0,a.cache[b]=c.exports}a.modules={},a.cache={},a.resolve=function(b){return{}.hasOwnProperty.call(a.modules,b)?a.modules[b]:void 0},a.define=function(b,c){a.modules[b]=c},a.define('/gif.worker.coffee',function(d,e,f,g){var b,c;b=a('/GIFEncoder.js',d),c=function(a){var c,e,d,f;return c=new b(a.width,a.height),a.index===0?c.writeHeader():c.firstFrame=!1,c.setTransparent(a.transparent),c.setRepeat(a.repeat),c.setDelay(a.delay),c.setQuality(a.quality),c.addFrame(a.data),a.last&&c.finish(),d=c.stream(),a.data=d.pages,a.cursor=d.cursor,a.pageSize=d.constructor.pageSize,a.canTransfer?(f=function(c){for(var b=0,d=a.data.length;b<d;++b)e=a.data[b],c.push(e.buffer);return c}.call(this,[]),self.postMessage(a,f)):self.postMessage(a)},self.onmessage=function(a){return c(a.data)}}),a.define('/GIFEncoder.js',function(e,h,i,j){function c(){this.page=-1,this.pages=[],this.newPage()}function b(a,b){this.width=~~a,this.height=~~b,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.out=new c}var f=a('/TypedNeuQuant.js',e),g=a('/LZWEncoder.js',e);c.pageSize=4096,c.charMap={};for(var d=0;d<256;d++)c.charMap[d]=String.fromCharCode(d);c.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(c.pageSize),this.cursor=0},c.prototype.getData=function(){var d='';for(var a=0;a<this.pages.length;a++)for(var b=0;b<c.pageSize;b++)d+=c.charMap[this.pages[a][b]];return d},c.prototype.writeByte=function(a){this.cursor>=c.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=a},c.prototype.writeUTFBytes=function(b){for(var c=b.length,a=0;a<c;a++)this.writeByte(b.charCodeAt(a))},c.prototype.writeBytes=function(b,d,e){for(var c=e||b.length,a=d||0;a<c;a++)this.writeByte(b[a])},b.prototype.setDelay=function(a){this.delay=Math.round(a/10)},b.prototype.setFrameRate=function(a){this.delay=Math.round(100/a)},b.prototype.setDispose=function(a){a>=0&&(this.dispose=a)},b.prototype.setRepeat=function(a){this.repeat=a},b.prototype.setTransparent=function(a){this.transparent=a},b.prototype.addFrame=function(a){this.image=a,this.getImagePixels(),this.analyzePixels(),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.writePixels(),this.firstFrame=!1},b.prototype.finish=function(){this.out.writeByte(59)},b.prototype.setQuality=function(a){a<1&&(a=1),this.sample=a},b.prototype.writeHeader=function(){this.out.writeUTFBytes('GIF89a')},b.prototype.analyzePixels=function(){var g=this.pixels.length,d=g/3;this.indexedPixels=new Uint8Array(d);var a=new f(this.pixels,this.sample);a.buildColormap(),this.colorTab=a.getColormap();var b=0;for(var c=0;c<d;c++){var e=a.lookupRGB(this.pixels[b++]&255,this.pixels[b++]&255,this.pixels[b++]&255);this.usedEntry[e]=!0,this.indexedPixels[c]=e}this.pixels=null,this.colorDepth=8,this.palSize=7,this.transparent!==null&&(this.transIndex=this.findClosest(this.transparent))},b.prototype.findClosest=function(e){if(this.colorTab===null)return-1;var k=(e&16711680)>>16,l=(e&65280)>>8,m=e&255,c=0,d=16777216,j=this.colorTab.length;for(var a=0;a<j;){var f=k-(this.colorTab[a++]&255),g=l-(this.colorTab[a++]&255),h=m-(this.colorTab[a]&255),i=f*f+g*g+h*h,b=parseInt(a/3);this.usedEntry[b]&&i<d&&(d=i,c=b),a++}return c},b.prototype.getImagePixels=function(){var a=this.width,g=this.height;this.pixels=new Uint8Array(a*g*3);var b=this.image,c=0;for(var d=0;d<g;d++)for(var e=0;e<a;e++){var f=d*a*4+e*4;this.pixels[c++]=b[f],this.pixels[c++]=b[f+1],this.pixels[c++]=b[f+2]}},b.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var b,a;this.transparent===null?(b=0,a=0):(b=1,a=2),this.dispose>=0&&(a=dispose&7),a<<=2,this.out.writeByte(0|a|0|b),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},b.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},b.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},b.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes('NETSCAPE2.0'),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},b.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var b=768-this.colorTab.length;for(var a=0;a<b;a++)this.out.writeByte(0)},b.prototype.writeShort=function(a){this.out.writeByte(a&255),this.out.writeByte(a>>8&255)},b.prototype.writePixels=function(){var a=new g(this.width,this.height,this.indexedPixels,this.colorDepth);a.encode(this.out)},b.prototype.stream=function(){return this.out},e.exports=b}),a.define('/LZWEncoder.js',function(e,g,h,i){function f(y,D,C,B){function w(a,b){r[f++]=a,f>=254&&t(b)}function x(b){u(a),k=i+2,j=!0,l(i,b)}function u(b){for(var a=0;a<b;++a)h[a]=-1}function A(z,r){var g,t,d,e,y,w,s;for(q=z,j=!1,n_bits=q,m=p(n_bits),i=1<<z-1,o=i+1,k=i+2,f=0,e=v(),s=0,g=a;g<65536;g*=2)++s;s=8-s,w=a,u(w),l(i,r);a:while((t=v())!=c){if(g=(t<<b)+e,d=t<<s^e,h[d]===g){e=n[d];continue}if(h[d]>=0){y=w-d,d===0&&(y=1);do if((d-=y)<0&&(d+=w),h[d]===g){e=n[d];continue a}while(h[d]>=0)}l(e,r),e=t,k<1<<b?(n[d]=k++,h[d]=g):x(r)}l(e,r),l(o,r)}function z(a){a.writeByte(s),remaining=y*D,curPixel=0,A(s+1,a),a.writeByte(0)}function t(a){f>0&&(a.writeByte(f),a.writeBytes(r,0,f),f=0)}function p(a){return(1<<a)-1}function v(){if(remaining===0)return c;--remaining;var a=C[curPixel++];return a&255}function l(a,c){g&=d[e],e>0?g|=a<<e:g=a,e+=n_bits;while(e>=8)w(g&255,c),g>>=8,e-=8;if((k>m||j)&&(j?(m=p(n_bits=q),j=!1):(++n_bits,n_bits==b?m=1<<b:m=p(n_bits))),a==o){while(e>0)w(g&255,c),g>>=8,e-=8;t(c)}}var s=Math.max(2,B),r=new Uint8Array(256),h=new Int32Array(a),n=new Int32Array(a),g,e=0,f,k=0,m,j=!1,q,i,o;this.encode=z}var c=-1,b=12,a=5003,d=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];e.exports=f}),a.define('/TypedNeuQuant.js',function(A,F,E,D){function C(A,B){function I(){o=[],q=new Int32Array(256),t=new Int32Array(a),y=new Int32Array(a),z=new Int32Array(a>>3);var c,d;for(c=0;c<a;c++)d=(c<<b+8)/a,o[c]=new Float64Array([d,d,d,0]),y[c]=e/a,t[c]=0}function J(){for(var c=0;c<a;c++)o[c][0]>>=b,o[c][1]>>=b,o[c][2]>>=b,o[c][3]=c}function K(b,a,c,e,f){o[a][0]-=b*(o[a][0]-c)/d,o[a][1]-=b*(o[a][1]-e)/d,o[a][2]-=b*(o[a][2]-f)/d}function L(j,e,n,l,k){var h=Math.abs(e-j),i=Math.min(e+j,a),g=e+1,f=e-1,m=1,b,d;while(g<i||f>h)d=z[m++],g<i&&(b=o[g++],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c),f>h&&(b=o[f--],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c)}function C(p,s,q){var h=2147483647,k=h,d=-1,m=d,c,j,e,n,l;for(c=0;c<a;c++)j=o[c],e=Math.abs(j[0]-p)+Math.abs(j[1]-s)+Math.abs(j[2]-q),e<h&&(h=e,d=c),n=e-(t[c]>>i-b),n<k&&(k=n,m=c),l=y[c]>>g,y[c]-=l,t[c]+=l<<f;return y[d]+=x,t[d]-=r,m}function D(){var d,b,e,c,h,g,f=0,i=0;for(d=0;d<a;d++){for(e=o[d],h=d,g=e[1],b=d+1;b<a;b++)c=o[b],c[1]<g&&(h=b,g=c[1]);if(c=o[h],d!=h&&(b=c[0],c[0]=e[0],e[0]=b,b=c[1],c[1]=e[1],e[1]=b,b=c[2],c[2]=e[2],e[2]=b,b=c[3],c[3]=e[3],e[3]=b),g!=f){for(q[f]=i+d>>1,b=f+1;b<g;b++)q[b]=d;f=g,i=d}}for(q[f]=i+n>>1,b=f+1;b<256;b++)q[b]=n}function E(j,i,k){var b,d,c,e=1e3,h=-1,f=q[i],g=f-1;while(f<a||g>=0)f<a&&(d=o[f],c=d[1]-i,c>=e?f=a:(f++,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3])))),g>=0&&(d=o[g],c=i-d[1],c>=e?g=-1:(g--,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3]))));return h}function F(){var c,f=A.length,D=30+(B-1)/3,y=f/(3*B),q=~~(y/w),n=d,o=u,a=o>>h;for(a<=1&&(a=0),c=0;c<a;c++)z[c]=n*((a*a-c*c)*m/(a*a));var i;f<s?(B=1,i=3):f%l!==0?i=3*l:f%k!==0?i=3*k:f%p!==0?i=3*p:i=3*j;var r,t,x,e,g=0;c=0;while(c<y)if(r=(A[g]&255)<<b,t=(A[g+1]&255)<<b,x=(A[g+2]&255)<<b,e=C(r,t,x),K(n,e,r,t,x),a!==0&&L(a,e,r,t,x),g+=i,g>=f&&(g-=f),c++,q===0&&(q=1),c%q===0)for(n-=n/D,o-=o/v,a=o>>h,a<=1&&(a=0),e=0;e<a;e++)z[e]=n*((a*a-e*e)*m/(a*a))}function G(){I(),F(),J(),D()}function H(){var b=[],g=[];for(var c=0;c<a;c++)g[o[c][3]]=c;var d=0;for(var e=0;e<a;e++){var f=g[e];b[d++]=o[f][0],b[d++]=o[f][1],b[d++]=o[f][2]}return b}var o,q,t,y,z;this.buildColormap=G,this.getColormap=H,this.lookupRGB=E}var w=100,a=256,n=a-1,b=4,i=16,e=1<<i,f=10,B=1<<f,g=10,x=e>>g,r=e<<f-g,z=a>>3,h=6,t=1<<h,u=z*t,v=30,o=10,d=1<<o,q=8,m=1<<q,y=o+q,c=1<<y,l=499,k=491,p=487,j=503,s=3*j;A.exports=C}),a('/gif.worker.coffee')}.call(this,this))\n//# sourceMappingURL=gif.worker.js.map\n// gif.worker.js 0.1.6 - https://github.com/jnordberg/gif.js\n\n},{}]},{},[1])"],{type:"text/javascript"})))
},{}],283:[function(t,e){"use strict";var i=function(){},s=e.exports={};s.stringIsClean=function(t){for(var e=0;e<t.length;e++)if(t.charCodeAt(e)<32)return!1;return!0},s.parseNum=function(t,e,i,s){var o,n,r=">"===t;for(void 0===i&&(i=0),void 0===s&&(s=e.length-i),o=r?i:i+s-1;r?i+s>o:o>=i;r?o++:o--)n<<=8,n+=e.charCodeAt(o);return n},s.parseSnum=function(t,e,i,s){var o,n,r,a=">"===t;for(void 0===i&&(i=0),void 0===s&&(s=e.length-i),o=a?i:i+s-1;a?i+s>o:o>=i;a?o++:o--)void 0===r&&(r=128===(128&e.charCodeAt(o))),n<<=8,n+=r?255&~e.charCodeAt(o):e.charCodeAt(o);return r&&(n+=1,n*=-1),n},s.Rational=function(t,e){return this.num=t,this.den=e||1,this},s.Rational.prototype.toString=function(){return 0===this.num?""+this.num:1===this.den?""+this.num:1===this.num?this.num+" / "+this.den:this.num/this.den},s.Rational.prototype.asFloat=function(){return this.num/this.den},s.MetaGroup=function(t,e){return this.fieldName=t,this.description=e,this.metaProps={},this},s.MetaGroup.prototype._addProperty=function(t,e,i){var o=new s.MetaProp(t,e,i);this[o.fieldName]=o,this.metaProps[o.fieldName]=o},s.MetaGroup.prototype.toString=function(){return"[MetaGroup "+this.description+"]"},s.MetaProp=function(t,e,i){return this.fieldName=t,this.description=e,this.value=i,this},s.MetaProp.prototype.toString=function(){return""+this.value},s.JpegFile=function(t,e){var i=this._SOS;this.metaGroups={},this._binary_data=t,this.filename=e;var o,n,r,a,l,h,d,c=0,u=0;if(this._binary_data.slice(0,2)!==this._SOI_MARKER)throw new Error("Doesn't look like a JPEG file. First two bytes are "+this._binary_data.charCodeAt(0)+","+this._binary_data.charCodeAt(1)+".");for(c+=2;c<this._binary_data.length&&(o=this._binary_data.charCodeAt(c++),n=this._binary_data.charCodeAt(c++),u=c,o==this._DELIM)&&n!==i;){for(l=s.parseNum(">",this._binary_data,c,2),c+=l;c<this._binary_data.length;)if(o=this._binary_data.charCodeAt(c++),o==this._DELIM&&(r=this._binary_data.charCodeAt(c++),0!==r)){c-=2;break}a=c-u,this._markers[n]?(h=this._markers[n][0],d=this._markers[n][1]):(h="UNKN",d=void 0),d&&this[d](n,u+2)}if(void 0===this.general)throw Error("Invalid JPEG file.");return this},s.JpegFile.prototype.toString=function(){return"[JpegFile "+this.filename+" "+this.general.type+" "+this.general.pixelWidth+"x"+this.general.pixelHeight+" Depth: "+this.general.depth+"]"},s.JpegFile.prototype._SOI_MARKER="ÿØ",s.JpegFile.prototype._DELIM=255,s.JpegFile.prototype._EOI=217,s.JpegFile.prototype._SOS=218,s.JpegFile.prototype._sofHandler=function(t,e){if(void 0!==this.general)throw Error("Unexpected multiple-frame image");this._addMetaGroup("general","General"),this.general._addProperty("depth","Depth",s.parseNum(">",this._binary_data,e,1)),this.general._addProperty("pixelHeight","Pixel Height",s.parseNum(">",this._binary_data,e+1,2)),this.general._addProperty("pixelWidth","Pixel Width",s.parseNum(">",this._binary_data,e+3,2)),this.general._addProperty("type","Type",this._markers[t][2])},s.JpegFile.prototype._JFIF_IDENT="JFIF\x00",s.JpegFile.prototype._JFXX_IDENT="JFXX\x00",s.JpegFile.prototype._EXIF_IDENT="Exif\x00",s.JpegFile.prototype._types={1:["BYTE",1],2:["ASCII",1],3:["SHORT",2],4:["LONG",4],5:["RATIONAL",8],6:["SBYTE",1],7:["UNDEFINED",1],8:["SSHORT",2],9:["SLONG",4],10:["SRATIONAL",8],11:["FLOAT",4],12:["DOUBLE",8]},s.JpegFile.prototype._tifftags={256:["Image width","ImageWidth"],257:["Image height","ImageLength"],258:["Number of bits per component","BitsPerSample"],259:["Compression scheme","Compression",{1:"uncompressed",6:"JPEG compression"}],262:["Pixel composition","PhotmetricInerpretation",{2:"RGB",6:"YCbCr"}],274:["Orientation of image","Orientation",{1:"Normal",2:"Reverse?",3:"Upside-down",4:"Upside-down Reverse",5:"90 degree CW",6:"90 degree CW reverse",7:"90 degree CCW",8:"90 degree CCW reverse"}],277:["Number of components","SamplesPerPixel"],284:["Image data arrangement","PlanarConfiguration",{1:"chunky format",2:"planar format"}],530:["Subsampling ratio of Y to C","YCbCrSubSampling"],531:["Y and C positioning","YCbCrPositioning",{1:"centered",2:"co-sited"}],282:["X Resolution","XResolution"],283:["Y Resolution","YResolution"],296:["Resolution Unit","ResolutionUnit",{2:"inches",3:"centimeters"}],273:["Image data location","StripOffsets"],278:["Number of rows per strip","RowsPerStrip"],279:["Bytes per compressed strip","StripByteCounts"],513:["Offset to JPEG SOI","JPEGInterchangeFormat"],514:["Bytes of JPEG Data","JPEGInterchangeFormatLength"],301:["Transfer function","TransferFunction"],318:["White point chromaticity","WhitePoint"],319:["Chromaticities of primaries","PrimaryChromaticities"],529:["Color space transformation matrix coefficients","YCbCrCoefficients"],532:["Pair of black and white reference values","ReferenceBlackWhite"],306:["Date and time","DateTime"],270:["Image title","ImageDescription"],271:["Make","Make"],272:["Model","Model"],305:["Software","Software"],315:["Person who created the image","Artist"],316:["Host Computer","HostComputer"],33432:["Copyright holder","Copyright"],34665:["Exif tag","ExifIfdPointer"],34853:["GPS tag","GPSInfoIfdPointer"]},s.JpegFile.prototype._exiftags={36864:["Exif Version","ExifVersion"],40960:["FlashPix Version","FlashpixVersion"],40961:["Color Space","ColorSpace"],37121:["Meaning of each component","ComponentsConfiguration"],37122:["Compressed Bits Per Pixel","CompressedBitsPerPixel"],40962:["Pixel X Dimension","PixelXDimension"],40963:["Pixel Y Dimension","PixelYDimension"],37500:["Manufacturer notes","MakerNote"],37510:["User comments","UserComment"],40964:["Related audio file","RelatedSoundFile"],36867:["Date Time Original","DateTimeOriginal"],36868:["Date Time Digitized","DateTimeDigitized"],37520:["DateTime subseconds","SubSecTime"],37521:["DateTimeOriginal subseconds","SubSecTimeOriginal"],37522:["DateTimeDigitized subseconds","SubSecTimeDigitized"],33434:["Exposure time","ExposureTime"],33437:["FNumber","FNumber"],34850:["Exposure program","ExposureProgram"],34852:["Spectral sensitivity","SpectralSensitivity"],34855:["ISO Speed Ratings","ISOSpeedRatings"],34856:["Optoelectric coefficient","OECF"],37377:["Shutter Speed","ShutterSpeedValue"],37378:["Aperture Value","ApertureValue"],37379:["Brightness","BrightnessValue"],37380:["Exposure Bias Value","ExposureBiasValue"],37381:["Max Aperture Value","MaxApertureValue"],37382:["Subject Distance","SubjectDistance"],37383:["Metering Mode","MeteringMode"],37384:["Light Source","LightSource"],37385:["Flash","Flash"],37386:["Focal Length","FocalLength"],37396:["Subject Area","SubjectArea"],41483:["Flash Energy","FlashEnergy"],41484:["Spatial Frequency Response","SpatialFrequencyResponse"],41486:["Focal Plane X Resolution","FocalPlaneXResolution"],41487:["Focal Plane Y Resolution","FocalPlaneYResolution"],41488:["Focal Plane Resolution Unit","FocalPlaneResolutionUnit"],41492:["Subject Location","SubjectLocation"],41493:["Exposure Index","ExposureIndex"],41495:["Sensing Method","SensingMethod"],41728:["File Source","FileSource"],41729:["Scene Type","SceneType"],41730:["CFA Pattern","CFAPattern"],41985:["Custom Rendered","CustomRendered"],41986:["Exposure Mode","Exposure Mode"],41987:["White Balance","WhiteBalance"],41988:["Digital Zoom Ratio","DigitalZoomRatio"],41989:["Focal length in 35 mm film","FocalLengthIn35mmFilm"],41990:["Scene Capture Type","SceneCaptureType"],41991:["Gain Control","GainControl"],41992:["Contrast","Contrast"],41993:["Saturation","Saturation"],41994:["Sharpness","Sharpness"],41995:["Device settings description","DeviceSettingDescription"],41996:["Subject distance range","SubjectDistanceRange"],42016:["Unique image ID","ImageUniqueID"],40965:["Interoperability tag","InteroperabilityIFDPointer"]},s.JpegFile.prototype._gpstags={0:["GPS tag version","GPSVersionID"],1:["North or South Latitude","GPSLatitudeRef"],2:["Latitude","GPSLatitude"],3:["East or West Longitude","GPSLongitudeRef"],4:["Longitude","GPSLongitude"],5:["Altitude reference","GPSAltitudeRef"],6:["Altitude","GPSAltitude"],7:["GPS time (atomic clock)","GPSTimeStamp"],8:["GPS satellites usedd for measurement","GPSSatellites"],9:["GPS receiver status","GPSStatus"],10:["GPS mesaurement mode","GPSMeasureMode"],11:["Measurement precision","GPSDOP"],12:["Speed unit","GPSSpeedRef"],13:["Speed of GPS receiver","GPSSpeed"],14:["Reference for direction of movement","GPSTrackRef"],15:["Direction of movement","GPSTrack"],16:["Reference for direction of image","GPSImgDirectionRef"],17:["Direction of image","GPSImgDirection"],18:["Geodetic survey data used","GPSMapDatum"],19:["Reference for latitude of destination","GPSDestLatitudeRef"],20:["Latitude of destination","GPSDestLatitude"],21:["Reference for longitude of destination","GPSDestLongitudeRef"],22:["Longitude of destination","GPSDestLongitude"],23:["Reference for bearing of destination","GPSDestBearingRef"],24:["Bearing of destination","GPSDestBearing"],25:["Reference for distance to destination","GPSDestDistanceRef"],26:["Distance to destination","GPSDestDistance"],27:["Name of GPS processing method","GPSProcessingMethod"],28:["Name of GPS area","GPSAreaInformation"],29:["GPS Date","GPSDateStamp"],30:["GPS differential correction","GPSDifferential"]},s.JpegFile.prototype._markers={192:["SOF0","_sofHandler","Baseline DCT"],193:["SOF1","_sofHandler","Extended sequential DCT"],194:["SOF2","_sofHandler","Progressive DCT"],195:["SOF3","_sofHandler","Lossless (sequential)"],197:["SOF5","_sofHandler","Differential sequential DCT"],198:["SOF6","_sofHandler","Differential progressive DCT"],199:["SOF7","_sofHandler","Differential lossless (sequential)"],200:["JPG",null,"Reserved for JPEG extensions"],201:["SOF9","_sofHandler","Extended sequential DCT"],202:["SOF10","_sofHandler","Progressive DCT"],203:["SOF11","_sofHandler","Lossless (sequential)"],205:["SOF13","_sofHandler","Differential sequential DCT"],206:["SOF14","_sofHandler","Differential progressive DCT"],207:["SOF15","_sofHandler","Differential lossless (sequential)"],196:["DHT",null,"Define Huffman table(s)"],204:["DAC",null,"Define arithmetic coding conditioning(s)"],208:["RST0",null,"Restart with modulo 8 count “0”"],209:["RST1",null,"Restart with modulo 8 count “1”"],210:["RST2",null,"Restart with modulo 8 count “2”"],211:["RST3",null,"Restart with modulo 8 count “3”"],212:["RST4",null,"Restart with modulo 8 count “4”"],213:["RST5",null,"Restart with modulo 8 count “5”"],214:["RST6",null,"Restart with modulo 8 count “6”"],215:["RST7",null,"Restart with modulo 8 count “7”"],216:["SOI",null,"Start of image"],217:["EOI",null,"End of image"],218:["SOS",null,"Start of scan"],219:["DQT",null,"Define quantization table(s)"],220:["DNL",null,"Define number of lines"],221:["DRI",null,"Define restart interval"],222:["DHP",null,"Define hierarchical progression"],223:["EXP",null,"Expand reference component(s)"],224:["APP0","_app0Handler","Reserved for application segments"],225:["APP1","_app1Handler"],226:["APP2",null],227:["APP3",null],228:["APP4",null],229:["APP5",null],230:["APP6",null],231:["APP7",null],232:["APP8",null],233:["APP9",null],234:["APP10",null],235:["APP11",null],236:["APP12",null],237:["APP13",null],238:["APP14",null],239:["APP15",null],240:["JPG0",null],241:["JPG1",null],242:["JPG2",null],243:["JPG3",null],244:["JPG4",null],245:["JPG5",null],246:["JPG6",null],247:["JPG7",null],248:["JPG8",null],249:["JPG9",null],250:["JPG10",null],251:["JPG11",null],252:["JPG12",null],253:["JPG13",null],254:["COM",null],1:["JPG13",null]},s.JpegFile.prototype._addMetaGroup=function(t,e){var i=new s.MetaGroup(t,e);return this[i.fieldName]=i,this.metaGroups[i.fieldName]=i,i},s.JpegFile.prototype._parseIfd=function(t,e,o,n,r,a,l){var h,d,c,u,p,m,g,f,_,v,b,y=s.parseNum(t,e,o+n,2);b=this._addMetaGroup(a,l);for(var w=0;y>w;w++)if(h=o+n+2+12*w,d=s.parseNum(t,e,h,2),u=s.parseNum(t,e,h+2,2),m=s.parseNum(t,e,h+4,4),g=s.parseNum(t,e,h+8,4),void 0!==this._types[u]){if(c=this._types[u][0],p=this._types[u][1],g=4>=p*m?h+8:o+g,"UNDEFINED"==c)f=void 0;else if("ASCII"==c)f=e.slice(g,g+m),f=f.split("\x00")[0],s.stringIsClean(f)||(f="");else{f=[];for(var x=0;m>x;x++,g+=p)("BYTE"==c||"SHORT"==c||"LONG"==c)&&f.push(s.parseNum(t,e,g,p)),("SBYTE"==c||"SSHORT"==c||"SLONG"==c)&&f.push(s.parseSnum(t,e,g,p)),"RATIONAL"==c&&(_=s.parseNum(t,e,g,4),v=s.parseNum(t,e,g+4,4),f.push(new s.Rational(_,v))),"SRATIONAL"==c&&(_=s.parseSnum(t,e,g,4),v=s.parseSnum(t,e,g+4,4),f.push(new s.Rational(_,v))),f.push();1===m&&(f=f[0])}r.hasOwnProperty(d)?b._addProperty(r[d][1],r[d][0],f):i("WARNING(jpegmeta.js): Unknown tag: ",d)}},s.JpegFile.prototype._jfifHandler=function(t,e){if(void 0!==this.jfif)throw Error("Multiple JFIF segments found");this._addMetaGroup("jfif","JFIF"),this.jfif._addProperty("version_major","Version Major",this._binary_data.charCodeAt(e+5)),this.jfif._addProperty("version_minor","Version Minor",this._binary_data.charCodeAt(e+6)),this.jfif._addProperty("version","JFIF Version",this.jfif.version_major.value+"."+this.jfif.version_minor.value),this.jfif._addProperty("units","Density Unit",this._binary_data.charCodeAt(e+7)),this.jfif._addProperty("Xdensity","X density",s.parseNum(">",this._binary_data,e+8,2)),this.jfif._addProperty("Ydensity","Y Density",s.parseNum(">",this._binary_data,e+10,2)),this.jfif._addProperty("Xthumbnail","X Thumbnail",s.parseNum(">",this._binary_data,e+12,1)),this.jfif._addProperty("Ythumbnail","Y Thumbnail",s.parseNum(">",this._binary_data,e+13,1))},s.JpegFile.prototype._app0Handler=function(t,e){var i=this._binary_data.slice(e,e+5);i==this._JFIF_IDENT?this._jfifHandler(t,e):i==this._JFXX_IDENT},s.JpegFile.prototype._app1Handler=function(t,e){var i=this._binary_data.slice(e,e+5);i==this._EXIF_IDENT&&this._exifHandler(t,e+6)},s.JpegFile.prototype._exifHandler=function(t,e){if(void 0!==this.exif)throw new Error("Multiple JFIF segments found");var i,o,n,r=this._binary_data.slice(e,e+2);if("II"===r)i="<";else{if("MM"!==r)throw new Error("Malformed TIFF meta-data. Unknown endianess: "+r);i=">"}if(o=s.parseNum(i,this._binary_data,e+2,2),42!==o)throw new Error("Malformed TIFF meta-data. Bad magic: "+o);if(n=s.parseNum(i,this._binary_data,e+4,4),this._parseIfd(i,this._binary_data,e,n,this._tifftags,"tiff","TIFF"),this.tiff.ExifIfdPointer&&this._parseIfd(i,this._binary_data,e,this.tiff.ExifIfdPointer.value,this._exiftags,"exif","Exif"),this.tiff.GPSInfoIfdPointer){if(this._parseIfd(i,this._binary_data,e,this.tiff.GPSInfoIfdPointer.value,this._gpstags,"gps","GPS"),this.gps.GPSLatitude){var a;a=this.gps.GPSLatitude.value[0].asFloat()+1/60*this.gps.GPSLatitude.value[1].asFloat()+1/3600*this.gps.GPSLatitude.value[2].asFloat(),"S"===this.gps.GPSLatitudeRef.value&&(a=-a),this.gps._addProperty("latitude","Dec. Latitude",a)}if(this.gps.GPSLongitude){var l;l=this.gps.GPSLongitude.value[0].asFloat()+1/60*this.gps.GPSLongitude.value[1].asFloat()+1/3600*this.gps.GPSLongitude.value[2].asFloat(),"W"===this.gps.GPSLongitudeRef.value&&(l=-l),this.gps._addProperty("longitude","Dec. Longitude",l)}}}},{}],284:[function(t,e){"use strict";var i=(t("jquery"),t("lodash"),t("prima/component")),s=t("prima/events"),o=t("app/components/drawer"),n=t("./views/abuseformview.js"),r=i.extend({name:"AbuseForm",initialize:function(){this.drawerManager=o(),this.bindEvents()},bindEvents:function(){this.listenTo(s,"abuseform:open",this.open),this.listenTo(s,"abuseform:close",this.close)},close:function(){this.drawerManager.close()},open:function(t){this.drawerManager.canOpen()?this.drawerManager.open(n,t):this.drawerManager.close()}});e.exports=r},{"./views/abuseformview.js":294,"app/components/drawer":25,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396}],285:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="form-container form"><div class="survey"><div class="survey-step"></div></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],286:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="content-preview-toggle toggle-preview"><span class="hide-preview">'+(null==(__t=__("Hide Post"))?"":__t)+'</span> <span class="show-preview">'+(null==(__t=__("Show Post"))?"":__t)+'</span></div><div class="content-preview-container"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],287:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",errors?(__p+="",_.each(errors,function(t){__p+='<div class="error-message"><div class="error-text">'+(null==(__t=t.error)?"":__t)+"</div></div>"}),__p+=""):__p+='<div class="error-message"><div class="error-text">'+(null==(__t=__("Oops. There was an error. Try again."))?"":__t)+"</div></div>",__p+="";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],288:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="form-container success"><div class="success-message"><h1 class="message-title">'+(null==(__t=__("Got it"))?"":__t)+'</h1><p class="message-text">'+(null==(__t=__("It may take us a day or two, but we’re on the case and we'll get back to you as quickly as we can."))?"":__t)+'</p><p class="message-text">'+(null==(__t=__("Also: We know it's tempting to submit the same thing a few times in hopes that it'll get addressed sooner, but really it just clogs up our system and makes it harder for us respond quickly. We're kind of like an elevator button."))?"":__t)+"</p></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],289:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<form class="survey-result" data-abuse-form><input type="hidden" name="form_key" value="'+(null==(__t=formKey)?"":__t)+'"> <input type="hidden" name="abuse_type" value="'+(null==(__t=formName)?"":__t)+'">',_.each(form,function(t){__p+='<div class="form-row"><div class="row-label">'+(null==(__t=__(t.groupLabel))?"":__t)+'</div><div class="row-content">',_.each(t.fields,function(t){__p+='<div class="row-field">',"text"===t.type?(__p+="",__p+="undefined"!=typeof t.link?"<p>"+(null==(__t=__(t.text,'<a target="_blank" href="/policy/'+lang+"/community/form/"+t.link+'">',"</a>"))?"":__t)+"</p>":"<p>"+(null==(__t=__(t.text))?"":__t)+"</p>",__p+=""):"input"===t.type?(__p+="",__p+=t.optional===!0?'<input class="text_field" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__(t.placeholder))?"":__t)+'"><div class="optional-tag">'+(null==(__t=__("Optional"))?"":__t)+"</div>":'<input class="text_field" data-validate-input="text" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__(t.placeholder))?"":__t)+'">',__p+=""):"input-link"===t.type?(__p+="","urlreporting"===t.name&&"undefined"!=typeof postUrl?__p+=' <input class="text_field input-link" name="'+(null==(__t=t.name)?"":__t)+'[]" value="'+(null==(__t=postUrl)?"":__t)+'">':(__p+="",__p+=t.optional===!0?' <input class="text_field input-link" name="'+(null==(__t=t.name)?"":__t)+'[]" placeholder="'+(null==(__t=__(t.placeholder?t.placeholder:"URL"))?"":__t)+'"><div class="optional-tag">'+(null==(__t=__("Optional"))?"":__t)+"</div>":'<input class="text_field input-link" data-validate-input="text" name="'+(null==(__t=t.name)?"":__t)+'[]" placeholder="'+(null==(__t=__(t.placeholder?t.placeholder:"URL"))?"":__t)+'">',__p+='<div class="url-manipulator" data-original-field-name="'+(null==(__t=t.name)?"":__t)+'[]"><div class="remove-url hidden" data-remove-url-field>'+(null==(__t=__("- Remove"))?"":__t)+'</div><div class="add-url" data-add-url-field>'+(null==(__t=__("+ Add More"))?"":__t)+"</div></div>"),__p+=""):"input-name"===t.type?(__p+="",__p+=t.optional===!0?'<input class="text_field" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__("Name"))?"":__t)+'"><div class="optional-tag">'+(null==(__t=__("Optional"))?"":__t)+"</div>":'<input class="text_field" data-validate-input="text" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__("Name"))?"":__t)+'">',__p+=""):"input-email"===t.type?(__p+="",__p+=email?' <input class="text_field" value="'+(null==(__t=email)?"":__t)+'" data-validate-input="email" data-error-text="email" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__("Email address"))?"":__t)+'">':' <input class="text_field" data-validate-input="email" data-error-text="email" name="'+(null==(__t=t.name)?"":__t)+'" placeholder="'+(null==(__t=__("Email address"))?"":__t)+'">',__p+=""):"textarea"===t.type?__p+='<textarea name="'+(null==(__t=t.name)?"":__t)+'" data-validate-input="text" cols="30" rows="5" placeholder="'+(null==(__t=__(t.placeholder))?"":__t)+'"></textarea>':"file"===t.type?__p+='<div class="image-upload-input"><label class="image-upload" for="image-upload"></label><input id="image-upload" class="image-upload" data-validate-input="file" type="file" name="attachments[]" accept="image/*"></div><div class="image-upload-preview"><img src=""><div class="btn_remove btn-remove-uploaded" data-tooltip="'+(null==(__t=__("Remove image"))?"":__t)+'"></div></div>':"checkbox"===t.type&&(__p+='<div class="checkbox"><input type="checkbox" name="'+(null==(__t=t.name)?"":__t)+'" data-validate-input="checkbox" id="'+(null==(__t=t.name)?"":__t)+'"><label for="'+(null==(__t=t.name)?"":__t)+'">'+(null==(__t=__(t.text))?"":__t)+"</label></div>"),__p+="</div>"}),__p+="</div></div>"}),__p+="</form>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],290:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="survey-result">',_.each(message,function(t){__p+='<div class="form-row">',"text"===t.type?(__p+="",__p+="undefined"!=typeof t.link?"<p>"+(null==(__t=__(t.text,'<a target="_blank" href="/policy/'+lang+"/community/form/"+t.link+'">',"</a>"))?"":__t)+"</p>":"<p>"+(null==(__t=__(t.text))?"":__t)+"</p>",__p+=""):__p+="","link"===t.type?__p+='<a href="'+(null==(__t=t.href)?"":__t)+'" target="_blank">'+(null==(__t=__(t.text))?"":__t)+"</a>":"highlight"===t.type&&(__p+='<p class="highlight">'+(null==(__t=__(t.text))?"":__t)+"</p>"),__p+="</div>"}),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],291:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="options">',_.each(options,function(t){__p+="",__p+=flaggingMode&&"undefined"!=typeof t.flaggingTo?'<div class="option" data-survey-nav-to="'+(null==(__t=t.flaggingTo)?"":__t)+'">'+(null==(__t=__(t.name))?"":__t)+"</div>":'<div class="option" data-survey-nav-to="'+(null==(__t=t.to)?"":__t)+'">'+(null==(__t=__(t.name))?"":__t)+"</div>",__p+=""}),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],292:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="form-row"><h3 class="form-subheading">'+(null==(__t=__("What's going on?"))?"":__t)+'</h3></div><form><input type="hidden" name="tumblelog_name" value="'+(null==(__t=tumblelog)?"":__t)+'"> <input type="hidden" name="post_id" value="'+(null==(__t=postId)?"":__t)+'"> <input type="hidden" name="root_id" value="'+(null==(__t=rootId)?"":__t)+'"><div class="form-row"><div class="option-radio"><input type="radio" name="flag" id="flag-nsfw" data-flag-action="nsfw" value="nsfw"></div><label class="option-label" for="flag-nsfw">'+(null==(__t=__("This should be filtered"))?"":__t),safesearch&&(__p+='<div class="sub-label">'+(null==(__t=__("Adult-oriented content is currently being hidden ( %1$s ) but this post still showed up.",'<i class="icon_lock_thick_12"></i>'))?"":__t)+"</div>"),__p+='</label></div><div class="form-row"><div class="option-radio"><input type="radio" name="flag" id="flag-spam" data-flag-action="spam" value="spam"></div><label class="option-label" for="flag-spam">'+(null==(__t=__("This is spam"))?"":__t)+'</label></div><div class="form-row"><div class="option-radio"><input type="radio" name="flag" id="flag-cg" data-flag-action="cg" value="cg"></div><label class="option-label" for="flag-cg">'+(null==(__t=__("This violates Tumblr's %1$sCommunity Guidelines%2$s",'<a class="community_guidelines_link" href="https://www.tumblr.com/policy/community" target="_blank">',"</a>"))?"":__t)+'</label></div><div class="form-row ignore"><div class="option-radio"><label class="binary_switch"><input type="checkbox" name="flag_ignore" id="flag_ignore" checked="checked"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label></div><label class="option-label" for="flag_ignore">'+(null==(__t=__("Ignore %1$s",tumblelog))?"":__t)+'</label></div><div class="form-row"><button class="chrome big red right flag" type="button" data-submit-flag-form><span class="label">'+(null==(__t=__("Flag"))?"":__t)+'</span> <span class="Knight-Rider-loader animate"><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span></span></button> <button class="chrome big blue right continue" type="button" data-survey-nav-to="abuse"><span class="label">'+(null==(__t=__("Continue"))?"":__t)+"</span></button></div></form>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],293:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="form-row">',hideTitles||(__p+='<h3 class="form-subheading">'+(null==(__t=__(title))?"":__t)+"</h3>"),__p+="","undefined"!=typeof tagline&&(__p+='<p class="form-subheading-tagline '+(null==(__t=hideTitles?"bold":"")?"":__t)+'">'+(null==(__t=__(tagline))?"":__t)+"</p>"),__p+='</div><div class="step-content">'+(null==(__t=stepContent)?"":__t)+'</div><div class="form-row">',displayBackButton&&(__p+='<button class="survey-back-button" data-survey-nav-back>'+(null==(__t=__("Go back"))?"":__t)+"</button>"),__p+="","undefined"!=typeof button&&(__p+="","submit"===button.type?__p+=' <button class="chrome big right blue" data-survey-submit disabled="disabled"><span class="label">'+(null==(__t=__("Submit"))?"":__t)+'</span> <span class="Knight-Rider-loader animate"><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span></span></button>':"dismiss"===button.type&&(__p+=' <button class="chrome big right red" data-survey-dismiss><span class="label">'+(null==(__t=__("Got it"))?"":__t)+"</span></button>"),__p+=""),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],294:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/data"),n=t("prima/events"),r=(t("velocity-animate"),t("components/drawer-form")),a=t("components/drawer-form/views/formheader.js"),l=t("./contentpreview.js"),h=t("./surveyview.js"),d=t("./subviews/form.js"),c=t("./../templates/abuseform.tpl"),u=t("./../templates/success.tpl"),p=t("./../templates/error_message.tpl"),m=t("./survey"),g=r.extend({templates:{layout:c,success:u,error:p},className:"abuse-form",survey:m,initialize:function(t){t=t||{},r.prototype.initialize.call(this,t),this.listenTo(n,"drawer:close",this.teardown),t.formType&&"undefined"!=typeof this.survey[t.formType]&&"start"!==t.formType?this.set("surveyStep",t.formType):t.post?(this.set("surveyStep","start"),this.post=t.post):this.set("surveyStep","abuse"),this.fillTemplateAttributes()},teardown:function(){this.selfDestroyTimer&&(clearTimeout(this.selfDestroyTimer),this.selfDestroyTimer=null)},fillTemplateAttributes:function(){var t=o.get("Components/AbuseForm")||{};this.templateAttributes.email=t.email,this.templateAttributes.lang=t.lang,this.templateAttributes.safesearch=i(".nsfw_filter_enabled").length,this.post&&(this.templateAttributes.tumblelog=this.post.get("tumblelog_name"),this.templateAttributes.postId=this.post.get("post_id"),this.templateAttributes.rootId=this.post.get("root_id"),this.templateAttributes.postUrl=this.post.get("post_url")),this.templateAttributes.flaggingMode=this.post?!0:!1,this.templateAttributes.hideTitles="start"!==this.get("surveyStep")},displaySuccessMessage:function(){this.$el.html(this.templates.success(this.templateAttributes)),n.trigger("drawer:disableCloseConfirmation"),this.selfDestroyTimer&&clearTimeout(this.selfDestroyTimer),this.selfDestroyTimer=setTimeout(function(){n.trigger("abuseform:close")},15e3)},displayErrorMessage:function(t){this.removeErrorMessage(),this.errorMessage=i(this.templates.error(s.extend(this.templateAttributes,{errors:t}))),this.errorMessage.appendTo(this.$surveyStep)},removeErrorMessage:function(){this.errorMessage&&(this.errorMessage.remove(),this.errorMessage=null)},render:function(){return this.$el.append(this.templates.layout(this.templateAttributes)),this.$surveyContainer=this.$(".survey"),this.$surveyStep=this.$(".survey-step"),this.header=new a({title:this.survey[this.get("surveyStep")].title,description:this.survey[this.get("surveyStep")].description}),this.header.render().$el.insertBefore(this.$surveyContainer),this.post&&(this.contentPreview=new l({postId:this.post.get("post_id")}),this.contentPreview.render().$el.insertAfter(this.$surveyContainer)),this.formView=new d({el:this.$surveyStep,abuseform:this}),this.surveyView=new h({el:this.$surveyContainer,abuseform:this}),this.surveyView.displaySurveyStep(this.get("surveyStep")),this}});e.exports=g},{"./../templates/abuseform.tpl":285,"./../templates/error_message.tpl":287,"./../templates/success.tpl":288,"./contentpreview.js":295,"./subviews/form.js":298,"./survey":299,"./surveyview.js":300,"components/drawer-form":317,"components/drawer-form/views/formheader.js":322,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/data":398,"velocity-animate":"lWl/mc"}],295:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/events"),r=t("prima/view"),a=t("velocity-animate"),l=t("../templates/contentpreview.tpl"),h=r.extend({className:"content-preview",template:l,templateAttributes:{__:o},animation:{collapseDuration:300,expandDuration:350,easing:[.545,.42,.435,1.065]},events:{"click .toggle-preview":"togglePreview"},initialize:function(t){this.postId=t.postId,this.listenTo(n,"abuseform:contentpreview:close",this.hidePreview),this.isExpanded=!0},togglePreview:function(){this.isExpanded?this.hidePreview():this.showPreview()},hidePreview:function(){this.isExpanded&&(this.animateContentPreview(!0),this.animatePostContainer(!0),this.isExpanded=!1)},showPreview:function(){this.isExpanded||(this.animateContentPreview(!1,s.bind(this.scrollToPost,this)),this.animatePostContainer(!1),this.isExpanded=!0)},animateContentPreview:function(t,e){var o;if(t)o=i(".form-container").height()-this.$el.position().top+50;else{var n=i(".survey");o=n.outerHeight(!0)+n.position().top-this.$el.position().top}a.animate(this.$el,{translateY:[o,0]},{duration:t?this.animation.collapseDuration:this.animation.expandDuration,easing:this.animation.easing,complete:s.bind(function(){this.$el.toggleClass("is-hidden"),t?a.animate(this.$el,{translateY:[0,50]},{delay:50,duration:this.animation.collapseDuration,complete:s.bind(function(){this.$el.attr("style","")
},this)}):this.$el.attr("style",""),"function"==typeof e&&e()},this)})},animatePostContainer:function(t){a.animate(this.$contentPreviewContainer,{translateY:t?[0,0]:[0,200],opacity:t?[0,1]:[1,0],"max-height":t?[0,99999]:[99999,99999]},{delay:.3*(t?this.animation.collapseDuration:this.animation.expandDuration),duration:t?this.animation.collapseDuration:this.animation.expandDuration,easing:this.animation.easing})},scrollToPost:function(){this.$el.velocity("scroll",{container:i(".drawer")})},render:function(){var t=i('.post[data-post-id="'+this.postId+'"]');t.hasClass("is_video")&&t.find(".dockable_video_embed").hasClass("docked")&&(t=t.find(".dockable_video_embed"));var e=t.clone();return e.hasClass("post_full")&&e.find(".post_avatar").remove(),e.find(".dock_video_button")&&e.find(".dock_video_button").remove(),this.$el.append(this.template(this.templateAttributes)),this.$(".content-preview-container").append(e),this.$contentPreviewContainer=this.$(".content-preview-container"),this.$previewPostHeight=this.$(".content-preview-container .post"),this}});e.exports=h},{"../templates/contentpreview.tpl":286,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/view":460,"velocity-animate":"lWl/mc"}],296:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/view"),o=10,n=s.extend({events:{"click [data-add-url-field]":"addUrlField","click [data-remove-url-field]":"removeUrlField"},addUrlField:function(t){var e=i(t.target).parent().data("original-field-name"),s=i('[name="'+e+'"]'),n=s.length;s.eq(0).clone(!0).val("").removeClass("error").removeAttr("data-validate-input").insertAfter(s.eq(n-1)),n++,n>1&&i(t.target).prev().removeClass("hidden"),n===o&&i(t.target).addClass("hidden")},removeUrlField:function(t){var e=i(t.target).parent().data("original-field-name"),s=i('[name="'+e+'"]'),n=s.length;s.eq(n-1).remove(),n--,1===n&&i(t.target).addClass("hidden"),o>n&&i(t.target).next().removeClass("hidden")}});e.exports=n},{jquery:"HlZQrA","prima/view":460}],297:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("prima/mixins/accessor"),a=t("./../templates/survey/start.tpl"),l=o.extend({mixins:[r],events:{"change [data-flag-action]":"onFlagClick","click [data-submit-flag-form]":"onFlagFormSubmit",'change input[type="radio"]':"onInputChange",'change input[type="checkbox"]':"onInputChange","submit form":"onSubmit","click [data-survey-nav-to]":"onFormContinue"},initialize:function(t){t=t||{},this.templateAttributes=t.templateAttributes,this.post=t.post,this.abuseform=t.abuseform,this.postId=this.post.get("post_id"),this.rootId=this.post.get("root_id"),this.tumblelog=this.post.get("tumblelog_name"),this.set("loading",!1),this.on("change:loading",this.updateLoadingIndicator)},onFormContinue:function(){var t=this.$("form").find("[name=flag_ignore]:checked").length>0;this.abuseform.set("ignoreFlagSet",t)},onInputChange:function(){var t=!1;s.each(this.$radiosAndCheckboxes,function(e){t=i(e).is(":checked")||t}),this.$submitButton.attr("disabled",!t)},onFlagFormSubmit:function(t){t.preventDefault();var e=this.$("form"),o=e.serializeArray(),n={};s.each(o,function(t){n[t.name]=t.value}),this.set("loading",!0);var r=i.ajax({url:"/svc/flag",type:"POST",data:n,with_form_key:!0});r.done(s.bind(this.onSubmitSuccess,this)).fail(s.bind(this.onSubmitError,this)).always(s.bind(this.onCallComplete,this))},onSubmitSuccess:function(){i('[data-post-id="'+this.postId+'"]').addClass("is_flagged");var t=this.$("form").find("input[type=radio]:checked"),e=t.length?t.val():null,s=this.$("form").find("[name=flag_ignore]:checked").length>0;n.trigger("abuseform:submitted",{loggingData:{reason:e,ignored:s}}),this.abuseform.displaySuccessMessage()},onSubmitError:function(){this.abuseform.displayErrorMessage()},onCallComplete:function(){this.set("loading",!1)},onSubmit:function(t){t.preventDefault()},updateLoadingIndicator:function(){this.$submitButton.toggleClass("loading",this.get("loading"))},onFlagClick:function(t){var e=i(t.target).data("flag-action"),s=i(".chrome.flag"),o=i(".chrome.continue");"cg"===e?(s.hide(),o.show()):(s.show(),o.hide())},render:function(){return this.$el.html(a(this.templateAttributes)),this.$submitButton=this.$("[data-submit-flag-form]"),this.$radiosAndCheckboxes=this.$('input[type="radio"], input[type="checkbox"]'),this}});e.exports=l},{"./../templates/survey/start.tpl":292,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/mixins/accessor":425,"prima/view":460}],298:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("when"),n=t("prima/view"),r=t("prima/events"),a=n.extend({events:{"click [data-survey-submit]":"onSubmitClick","click [data-survey-dismiss]":"onDismissClick"},initialize:function(t){this.abuseform=t.abuseform,this.savedFormState={},this.listenTo(r,"abuseforms:formview:savestate",this.saveFormState),this.listenTo(r,"abuseforms:formview:restorestate",this.restoreFormState)},onSubmitClick:function(t){t.preventDefault(),this.abuseform.set("loading",!0);var e=[];e.push(i.ajax({url:"/abuse/ticket/new",type:"POST",contentType:!1,processData:!1,data:this.prepareData(),with_form_key:!0})),this.abuseform.get("ignoreFlagSet")&&e.push(i.ajax({url:"/svc/flag",type:"POST",data:{tumblelog_name:this.abuseform.post.get("tumblelog_name"),post_id:this.abuseform.post.get("post_id"),root_id:this.abuseform.post.get("root_id"),flag_ignore:"on"},with_form_key:!0})),o.all(e).done(s.bind(this.onSubmitSuccess,this),s.bind(this.onSubmitError,this))},prepareData:function(){var t=this.$("[data-abuse-form]");return new FormData(t[0]||{})},saveFormState:function(t){this.$("[data-abuse-form]").length&&(this.savedFormState[t]=this.$("[data-abuse-form]").serializeArray())},restoreFormState:function(t){if(this.savedFormState[t]){var e=this.savedFormState[t];s.each(e,function(t){if(t.value&&!s.isEmpty(t.value)){var e=this.$(this.$('input[name="'+t.name+'"]').length?'input[name="'+t.name+'"]':'textarea[name="'+t.name+'"]');e.val(t.value).trigger("blur")}},this),r.trigger("drawerform:validation:trigger")}},onSubmitSuccess:function(){this.abuseform.set("loading",!1),this.abuseform.post&&i('[data-post-id="'+this.abuseform.post.get("post_id")+'"]').addClass("is_flagged"),r.trigger("abuseform:submitted",{loggingData:{reason:this.abuseform.get("surveyStep")}}),this.abuseform.displaySuccessMessage()},onSubmitError:function(t){this.abuseform.set("loading",!1);var e=i.parseJSON(t.responseText||{}),s=e.response&&e.response.errors&&e.response.errors.errors||"";this.abuseform.displayErrorMessage(s)},onDismissClick:function(){r.trigger("abuseform:close")}});e.exports=a},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/view":460,when:"RG2dij"}],299:[function(t,e){"use strict";var i={start:{title:"",description:"",template:"start"},abuse:{title:"What kind of violation is it?",options:[{name:"Someone is at risk of harm",to:"harm"},{name:"Misuse of your identity or work",to:"misuse"},{name:"This content is gross or hateful",to:"hateful"},{name:"Some other reason",to:"other"}],prev:"start"},harm:{title:"Someone is at risk of harm",options:[{name:"Harassment",to:"harassment"},{name:"Privacy violation",to:"privacy"},{name:"Harm to minors",to:"minors"},{name:"Promotion or glorification of self-harm",to:"selfharm"}],prev:"abuse"},misuse:{title:"Misuse of your identity or work",options:[{name:"Misattribution or non-attribution",to:"misattrib"},{name:"Copyright infringement",to:"copyright"},{name:"Trademark infringement",to:"trademark"},{name:"Confusion or impersonation",to:"confusion"}],prev:"abuse"},hateful:{title:"This content is gross or hateful",options:[{name:"Gore, mutilation, bestiality, or necrophilia",to:"gore"},{name:"Malicious speech",to:"maliciousspeech"}],prev:"abuse"},harassment:{title:"Harassment",tagline:"Are you the person being harassed?",description:"Being a jerk. Circumventing the ignore feature in order to send someone mean and hateful messages.",options:[{name:"Yes",to:"harassment-self",flaggingTo:"harassment-self-blog"},{name:"No",to:"harassment-someoneelse"}],prev:"harm"},"harassment-someoneelse":{title:"Harassment",tagline:"Are you the person being harassed?",message:[{type:"highlight",text:"No"},{type:"text",text:"Thanks for bringing this to our attention, but we need to hear directly from the person being harassed. Get in contact with them if you can, and refer them to our %1$sabuse form%2$s.",link:"harassment"}],button:{type:"dismiss"},prev:"harassment"},"harassment-self":{title:"Harassment",tagline:"Where on Tumblr is the harassment taking place?",options:[{name:"Somewhere on a blog or in a post (including tags)",to:"harassment-self-blog"},{name:"In an inbox message (an Ask or Fan Mail)",to:"harassment-self-message"}],prev:"harassment"},"harassment-self-blog":{title:"Harassment",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"harassment-self"},"harassment-self-message":{title:"Harassment",form:[{groupLabel:"Screenshot of the message you're reporting",fields:[{type:"file",name:"screenshot"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"harassment-self"},privacy:{title:"Privacy Violation",description:"Posting content that violates anyone's privacy, especially personally identifying or confidential information like credit card numbers, social security numbers, unlisted contact information, or private photos.",tagline:"Is it your privacy that's being violated?",options:[{name:"Yes",to:"privacy-self"},{name:"No",to:"privacy-someoneelse"}],prev:"harm"},"privacy-someoneelse":{title:"Privacy Violation",tagline:"Is it your privacy that's being violated?",message:[{type:"highlight",text:"No"},{type:"text",text:"Thanks for bringing this to our attention, but we need to hear directly from the person who's privacy is being violated. Get in contact with them if you can, and refer them to our %1$sabuse form%2$s.",link:"privacy"}],button:{type:"dismiss"},prev:"privacy"},"privacy-self":{title:"Privacy Violation",tagline:"What, specifically, was posted?",options:[{name:"My name ",to:"privacy-self-name"},{name:"My IP address ",to:"privacy-self-ip"},{name:"My private home address",to:"privacy-self-form"},{name:"My private email address",to:"privacy-self-form"},{name:"My private telephone number was posted",to:"privacy-self-form"},{name:"Private images of me have been posted ",to:"privacy-self-image"},{name:"Something else private was posted ",to:"privacy-self-form"}],prev:"privacy"},"privacy-self-name":{title:"Privacy Violation",tagline:"What, specifically, was posted?",message:[{type:"highlight",text:"Name"},{type:"text",text:"Unfortunately, your name isn't considered private information, and posting it isn't a violation of either the law or of our Community Guidelines. If you're uncomfortable with the post, try to communicate with the person who posted it and make your feelings on it known."}],button:{type:"dismiss"},prev:"privacy-self"},"privacy-self-ip":{title:"Privacy Violation",tagline:"What, specifically, was posted?",message:[{type:"highlight",text:"IP address"},{type:"text",text:"Unfortunately, your IP address isn't considered private information, and posting it isn't a violation of either the law or of our Community Guidelines. If you're uncomfortable with the post, try to communicate with the person who posted it and make your feelings on it known."}],button:{type:"dismiss"},prev:"privacy-self"},"privacy-self-form":{title:"Privacy Violation",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Source of the private information, if known",fields:[{type:"input-link",optional:!0,name:"source-link",placeholder:"URL of information source"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"privacy-self"},"privacy-self-image":{title:"Privacy Violation",form:[{groupLabel:"Proof of identity",fields:[{type:"text",text:"We'll need some proof of your identity to pursue this. A picture of your photo ID would be perfect, but if you don't have one handy then you can take a picture of yourself holding up a sign that reads “Tumblr, this is me.” Don't worry, these photos are kept private."},{type:"file",name:"userphoto"}]},{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Source of the private information, if known",fields:[{type:"input-link",optional:!0,name:"source-link",placeholder:"URL of information source"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"privacy-self"},minors:{title:"Harm to minors",description:"Sexually suggestive or violent depictions of minors; or bullying, even by another minor.",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Some explanation",fields:[{type:"textarea",name:"description",placeholder:"Describe, as best you can, how it violates Tumblr's Community Guidelines"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"harm"},selfharm:{title:"Promotion or glorification of self-harm",description:"Encouraging others to injure themselves in ways large or small, or celebrating such injuries in any fashion. Glamorizing anorexia, bulimia, or other eating disorders.",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"harm"},misattrib:{title:"Misattribution or non-attribution",description:"Stealing something that someone else made and trying to pass it off as your own (probably by downloading it and reposting it, instead of reblogging it like a decent human being). This also includes reblogging something and gratuitously injecting a link back to your blog.",tagline:"Is it your work that's being misattributed, or that's missing an attribution?",options:[{name:"Yes",to:"misattrib-self"},{name:"No",to:"misattrib-someoneelse"}],prev:"misuse"},"misattrib-someoneelse":{title:"Misattribution or non-attribution",tagline:"Is it your work that's being misattributed, or that's missing an attribution?",message:[{type:"highlight",text:"No"},{type:"text",text:"Thanks for letting us know. Unfortunately, in situations like this, we need to hear directly from the user whose work has been misattributed, or is missing attribution. Get in contact with them if you can, and refer them to our [abuse form link for attribution]."}],button:{type:"dismiss"},prev:"misattrib"},"misattrib-self":{title:"Misattribution or non-attribution",tagline:"Did you originally post this work on Tumblr, or somewhere else?",options:[{name:"I posted it to Tumblr",to:"misattrib-self-tumblr"},{name:"I posted it somewhere else",to:"misattrib-self-somewhereelse"}],prev:"misattrib"},"misattrib-self-somewhereelse":{title:"Misattribution or non-attribution",tagline:"Did you originally post this work on Tumblr, or somewhere else?",message:[{type:"highlight",text:"I posted it somewhere else"},{type:"text",text:"You'll need to file a request under the Digital Millenium Copyright Act (DMCA). Don't worry, we've got a form for that."},{type:"link",text:"File a DMCA request",href:"/dmca"}],button:{type:"dismiss"},prev:"misattrib-self"},"misattrib-self-tumblr":{title:"Misattribution or non-attribution",tagline:"Which of the following best describes your issue?",options:[{name:"Someone reposted it instead of reblogging it",to:"misattrib-self-tumblr-repost"},{name:"Someone reblogged it and injected a link back to their own blog",to:"misattrib-self-tumblr-link"}],prev:"misattrib-self"},"misattrib-self-tumblr-repost":{title:"Misattribution or non-attribution",form:[{groupLabel:"Original content",fields:[{type:"input-link",name:"urloriginal",placeholder:"URL of the original content"}]},{groupLabel:"Repost",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the repost"}]}],button:{type:"submit"},prev:"misattrib-self-tumblr"},"misattrib-self-tumblr-link":{title:"Misattribution or non-attribution",form:[{groupLabel:"Original content",fields:[{type:"input-link",name:"urloriginal",placeholder:"URL of the original content"}]},{groupLabel:"Reblog",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the reblog"}]}],button:{type:"submit"},prev:"misattrib-self-tumblr"},copyright:{title:"Copyright infringement",description:"Posting someone else's copyrighted work without their permission, or without a legal exemption like fair use.",tagline:"Did you originally post this work on Tumblr, or somewhere else?",options:[{name:"I posted it to Tumblr",to:"misattrib"},{name:"I posted it somewhere else",to:"copyright-dmca"}],button:{type:"submit"},prev:"misuse"},"copyright-dmca":{title:"Copyright infringement",tagline:"Are you making a copyright claim or reporting an attribution issue?",message:[{type:"highlight",text:"Copyright"},{type:"text",text:"You'll need to file a request under the Digital Millenium Copyright Act (DMCA). Don't worry, we've got a form for that."},{type:"link",text:"File a DMCA request",href:"/dmca"}],button:{type:"dismiss"},prev:"copyright"},trademark:{title:"Trademark infringement",description:"Using someone else's trademark without their permission.",tagline:"Are you the trademark holder or an authorized representative?",options:[{name:"Yes",to:"trademark-holder"},{name:"No",to:"trademark-notholder"}],prev:"misuse"},"trademark-notholder":{title:"Trademark infringement",tagline:"Are you the trademark holder or an authorized representative?",message:[{type:"highlight",text:"No"},{type:"text",text:"Thanks for bringing this to our attention, but we need to hear directly from the trademark holder or their authorized representative. Get in contact with them if you can, and refer them to our %1$sabuse form%2$s.",link:"trademark"}],button:{type:"dismiss"},prev:"trademark"},"trademark-holder":{title:"Trademark infringement",form:[{groupLabel:"Your information",fields:[{type:"input-name",name:"name"},{type:"input",name:"company",optional:!0,placeholder:"Your company, if applicable"},{type:"input-email",name:"email"},{type:"input",name:"contactinfo",optional:!0,placeholder:"Other contact info, like your address"}]},{groupLabel:"Trademark information",fields:[{type:"input",name:"trademark",placeholder:"Trademark"},{type:"input",name:"trademark-type",placeholder:"Type of trademark (e.g., word, design, etc)"},{type:"input",name:"trademark-jurisdiction",placeholder:"Jurisdiction"},{type:"input",name:"trademark-regnumber",optional:!0,placeholder:"Registration number (if not granted)"},{type:"input",name:"trademark-serialnumber",optional:!0,placeholder:"Serial number "}]},{groupLabel:"Registration documentation",fields:[{type:"file",name:"trademark-regdocument"},{type:"input-link",name:"urlreporting",placeholder:"URL of the content you're reporting"}]},{groupLabel:"How is this content infringing your trademark(s)?",fields:[{type:"textarea",name:"description",placeholder:"Short explanation"}]},{groupLabel:"",fields:[{type:"checkbox",name:"consent",text:"I understand that Tumblr may provide third parties, for example the reported blogger(s), with details of this report, such as the reported blog or post. Your contact information, like your email address, will not be disclosed."}]}],button:{type:"submit"},prev:"trademark"},confusion:{title:"Confusion or impersonation",description:"A deliberate attempt to appear to be someone or something else, like a teacher, classmate, celebrity, or corporation. Someone trying to be a better version of him or herself is all cool though.",tagline:"Whose identity is being impersonated or confused?",options:[{name:"My own",to:"confusion-own"},{name:"My company, brand, or organization",to:"trademark"},{name:"Someone else's",to:"confusion-else"}],prev:"misuse"},"confusion-own":{title:"Confusion or impersonation",form:[{groupLabel:"Some information about you",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]},{groupLabel:"Where confusion or impersonation takes place",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL with an example of the impersonation"}]},{groupLabel:"Explain how you're being impersonated",fields:[{type:"textarea",name:"explanation",placeholder:"Short explanation"}]}],button:{type:"submit"},prev:"confusion"},"confusion-else":{title:"Confusion or impersonation",tagline:"Whose identity is being impersonated or confused?",message:[{type:"highlight",text:"Someone else's"},{type:"text",text:"We appreciate your bringing this to our attention. In these cases, we need to hear directly from the person being impersonated by this blog. Get in contact with them if you can, and refer them to our %1$sabuse form%2$s.",link:"confusion"}],button:{type:"dismiss"},prev:"confusion"},"confusion-company-notauthorized":{title:"Confusion or impersonation",tagline:"Are you an authorized representative for the company, brand, or organization being impersonated?",message:[{type:"highlight",text:"No"},{type:"text",text:"We appreciate your bringing this to our attention. In these cases, we need to hear directly from an authorized representative for the company, brand or organization being impersonated by this blog. Get in contact with them if you can, and refer them to our %1$sabuse form%2$s.",link:"confusion"}],button:{type:"dismiss"},prev:"confusion-company"},"confusion-company-authorized":{title:"Confusion or impersonation",tagline:"Are you reporting an impersonation/confusion issue or a trademark violation?",options:[{name:"Impersonation/confusion",to:"confusion-company-authorized-impersonation"},{name:"Trademark violation",to:"trademark"}],prev:"confusion-company"},"confusion-company-authorized-impersonation":{title:"Confusion or impersonation",form:[{groupLabel:"Some information about you",fields:[{type:"input-name",name:"name"},{type:"input-email",name:"email"}]},{groupLabel:"Information about company",fields:[{type:"input",name:"impersonated-company",placeholder:"Company/brand/organization"},{type:"input",name:"affiliation",placeholder:"Your affiliation"}]},{groupLabel:"Examples of the impersonation or confusion",fields:[{type:"input-link",name:"urlreporting"},{type:"textarea",name:"explanation",placeholder:"Explain how these examples are impersonating or causing confusion with your brand"}]}],button:{type:"submit"},prev:"confusion-company-authorized"},gore:{title:"Gore, mutilation, bestiality, or necrophilia",description:"Showcasing the mutilation or torture of human beings, animals, or their remains. Doing so just to be a dick.",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Which of these things does it contain",fields:[{type:"checkbox",name:"gore",text:"Gore/mutilation"},{type:"checkbox",name:"bestiality",text:"Bestiality"},{type:"checkbox",name:"necrophilia",text:"Necrophilia"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"hateful"},maliciousspeech:{title:"Malicious speech",description:"Encouraging violence or hatred on the basis of things like race, ethnic origin, religion, disability, gender, age, veteran status, or sexual orientation.",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Describe, as best you can, how it violates Tumblr's Community Guidelines",fields:[{type:"textarea",name:"description",placeholder:"Short explanation"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"hateful"},other:{title:"Some other reason",description:"Pretty sure you found a post that doesn't belong on Tumblr, but don't see the violation you're looking for? Let us know about it.",form:[{groupLabel:"Content you're reporting",fields:[{type:"input-link",name:"urlreporting",placeholder:"URL of the post"}]},{groupLabel:"Describe, as best you can, how it violates Tumblr's Community Guidelines",fields:[{type:"textarea",name:"description",placeholder:"Short explanation"}]},{groupLabel:"A little about yourself",fields:[{type:"input-name",optional:!0,name:"name"},{type:"input-email",name:"email"}]}],button:{type:"submit"},prev:"abuse"}};e.exports=i},{}],300:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("velocity-animate"),n=t("prima/view"),r=t("prima/events"),a=t("./dynamicfields.js"),l=t("./flaggingform.js"),h=t("../templates/survey/step.tpl"),d=t("../templates/survey/partials/options.tpl"),c=t("../templates/survey/partials/message.tpl"),u=t("../templates/survey/partials/form.tpl"),p=t("./survey"),m=n.extend({survey:p,templates:{surveyStep:h,surveyOptions:d,surveyMessage:c,surveyForm:u},duration:200,events:{"click [data-survey-nav-to]":"surveyLinkHandler","click [data-survey-nav-back]":"surveyBackHandler"},initialize:function(t){t=t||{},this.abuseform=t.abuseform,this.templateAttributes=this.abuseform.templateAttributes,this.abuseform.on("change:complete",s.bind(this.updateSubmitButton,this)),this.abuseform.on("change:loading",s.bind(this.updateLoadingIndicator,this)),this.history=[],this.$surveyContainer=this.abuseform.$surveyContainer,this.$surveyStep=this.abuseform.$surveyStep,this.dynamicfields=new a({el:this.$el})},updateSubmitButton:function(){this.abuseform.get("complete")===!0?this.submitButton.removeAttr("disabled"):this.submitButton.attr("disabled","disabled")},updateLoadingIndicator:function(){this.submitButton.toggleClass("loading",this.abuseform.get("loading"))},surveyLinkHandler:function(t){this.history.push(this.abuseform.get("surveyStep"));var e=i(t.currentTarget).data("survey-nav-to");this.displaySurveyStep(e)},surveyBackHandler:function(){var t=this.history.pop();this.displaySurveyStep(t,!0)},displaySurveyStep:function(t,e){var n,a,h=this.survey[t];r.trigger("abuseforms:formview:savestate",this.abuseform.get("surveyStep")),this.abuseform.set("surveyStep",t),r.trigger("abuseform:stepviewed",{loggingData:{step:t}}),h.displayBackButton=!!this.history.length,r.trigger("drawerform:errortag:removeall");var d=this.$surveyStep.clone().addClass("dummy-step");"start"===t?(this.flaggingForm=new l({templateAttributes:this.templateAttributes,post:this.abuseform.post,abuseform:this.abuseform}),this.$surveyStep.html(this.flaggingForm.render().$el)):(h.options&&(n=this.templates.surveyOptions(s.extend(h,this.templateAttributes))),h.message&&(n=this.templates.surveyMessage(s.extend(h,this.templateAttributes))),h.form&&(h.formName=t,n=this.templates.surveyForm(s.extend(h,this.templateAttributes))),h.stepContent=n,this.$surveyStep.html(this.templates.surveyStep(s.extend(h,this.templateAttributes))),this.abuseform.get("wasPreviewAutoclosed")||(r.trigger("abuseform:contentpreview:close"),this.abuseform.set("wasPreviewAutoclosed",!0))),d.appendTo(this.$surveyContainer),o.animate(d,{translateX:[e?"290px":"-290px","0"],opacity:[0,1]},{duration:this.duration,easing:"easeOut",complete:function(t){i(t).remove()}}),h.options&&(a=this.$surveyStep.find(".option"),a.css("opacity",0),s.each(a,function(t,i){o.animate(t,{translateX:[0,e?"-70px":"70px"],opacity:[1,0]},{delay:this.duration/4*(i+1),duration:this.duration,easing:"easeOut"})},this)),o.animate(this.$surveyStep,{translateX:["0",e?"-290px":"290px"],opacity:[1,0]},{duration:this.duration,easing:"easeOut"}),this.submitButton=this.$("[data-survey-submit]"),r.trigger("drawerform:validation:trigger"),h.form&&(r.trigger("abuseforms:formview:restorestate",t),r.trigger("drawer:enableCloseConfirmation"))}});e.exports=m},{"../templates/survey/partials/form.tpl":289,"../templates/survey/partials/message.tpl":290,"../templates/survey/partials/options.tpl":291,"../templates/survey/step.tpl":293,"./dynamicfields.js":296,"./flaggingform.js":297,"./survey":299,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/view":460,"velocity-animate":"lWl/mc"}],301:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/component"),n=t("prima/events"),r=t("./player"),a=[],l=o.extend({name:"CrtControl",maxLoopTime:10,playerSelector:"[data-crt-video]",initialize:function(t){t=t||{},this.listenTo(n,"CrtControl:newPlayer",this.playerFactory,this),this.listenTo(n,"DOMEventor:flatscroll",i.throttle(this.onScroll,500),this)},findPlayers:function(t){var e=s(this.playerSelector);e.length&&this.playerFactory(e,t)},playerFactory:function(t,e){i.defer(i.bind(function(){i.each(t,function(t){if(!t.player){var i=new r(t,e);a.push(i),i.render(),this.bindPlayerEvents(i),n.trigger("CrtControl:playerCreated",i)}},this)},this))},bindPlayerEvents:function(t){this.listenTo(t,"ready",this.onPlayerReady),this.listenTo(t,"teardown",this.onPlayerTeardown)},onPlayerReady:function(){this.playInViewport()},onPlayerTeardown:function(t){if(t=i.where(a,{_id:t._id}),t.length){var e=i.indexOf(a,t[0]);e>-1&&(t=a.splice(e,1))}},onScroll:function(){this.playInViewport()},pauseAutoplaying:function(){i.each(a,function(t){t.get("autoplay")&&t.get("loaded")&&t.pause()})},getInViewport:function(){return i.filter(a,function(t){return t.watcher?t.watcher.isFullyInViewport:!1})},playInViewport:function(){var t=this.getInViewport();if(t.length){var e=t[0];e.get("paused")&&e.get("autoplay")&&(this.pauseAutoplaying(),e.play())}}});e.exports=new l},{"./player":302,jquery:"HlZQrA",lodash:"K2RcUv","prima/component":395,"prima/events":396}],302:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("scrollmonitor"),n=t("fastdom"),r=t("prima/class"),a=t("prima/mixins/accessor"),l=t("prima/lib/flags"),h=t("prima/events"),d=t("prima/utils/caniuse"),c=t("./plugins/videojs-crt"),u=r.extend({mixins:[a],defaults:{loaded:!1,paused:!0,muted:!1,autoplay:!1,_preload:!1,_preloadThreshold:10,loop:!0,autoheight:!1,watch:!0,duration:0,hideFullscreen:!1,_elapsed:0,_position:0,_startSeekJumpTime:null,minLoopDuration:1},classNames:{base:"crt-video crt-skin-default",autoplay:"crt-state-autoplaying",autoheight:"crt-autoheight",hideFullscreen:"crt-hide-fullscreen-toggle"},constructor:function(t,e){this._id=i.uniqueId("crtplayer"),this.initialize(t,e)},initialize:function(t,e){e||(e={}),i.isObject(e.attributes)&&this.set(e.attributes),this.video=t,this.$video=s(this.video);var o=this.$video.data("crt-options");this.$video.removeAttr("data-crt-options"),this.vjsOptions=i.defaults({crt:this,crtOptions:o},e.vjsOptions||{}),o&&o.duration&&this.set("duration",o.duration),n.write(function(){this.$video.addClass(this.classNames.base)},this)},render:function(){return n.write(function(){c(this.video,this.vjsOptions).then(i.bind(this.ready,this))},this),this},ready:function(t){this.player=t,this.el=t.player_.el(),this.$el=s(this.el),this.$post=this.$el.closest(".post"),this.playerID=this.player.id_,this.hasLooped=!1,this._bindEvents(),this.setAutoplayState(this.shouldAutoplay()),this.setMutedState(this.shouldAutoplay()),this.setLoopState(!0),this.setAutoheightState(),this.setFullscreenControl(!d.prop("requestFullscreen")),this.get("watch")&&this.setupWatcher(),h.trigger("CrtPlayer:ready",this),this.trigger("ready",this)},_bindEvents:function(){this.listenTo(h,"peepr:open",this.pause),this.listenTo(h,"post:form:show",this.pause),this.listenTo(h,"post:docked:afterRender",this.onDockedAfterRender),this.on("change:autoplay",this.onChangeAutoplay,this),this.on("change:autoheight",this.onChangeAutoheight,this),this.on("change:duration",this.onChangeDuration,this),this.on("change:loop",this.onChangeLoop,this),this.on("change:muted",this.onChangeMuted,this),this.player.on("loadedmetadata",i.bind(this.onLoadedMetadata,this)),this.player.on("durationchange",i.bind(this.onUpdateDuration,this)),this.player.on("play",i.bind(this.onPlay,this)),this.player.on("pause",i.bind(this.onPause,this)),this.player.on("ended",i.bind(this.onEnded,this)),this.player.on("fullscreenchange",i.bind(this.onFullscreenChange,this)),this.player.on("error",i.bind(this.onError,this))
},setupWatcher:function(){this.watcher=o.create(this.el,-100),this.watcher.fullyEnterViewport(i.bind(function(){this.trigger("fullyEnterViewport")},this)),this.watcher.partiallyExitViewport(i.bind(function(){this.trigger("partiallyExitViewport")},this)),this.watcher.exitViewport(i.bind(function(){this.trigger("exitViewport"),this.shouldAutoplay()&&this.pause()},this)),this.shouldAutoplay()&&this.$el.on("click.crtAutoPlay touchend.crtAutoPlay",i.bind(this.onClickPlayer,this))},onClickPlayer:function(t){s(t.target).closest(".vjs-mute-control").length||s(t.target).closest(".vjs-fullscreen-control").length?this.restart():this.pause(),this.set("autoplay",!1),this.set("muted",!1),this.$el.off("click.crtAutoPlay touchend.crtAutoPlay")},restart:function(){this.get("autoplay")&&(this.set("autoplay",!1),this.set("muted",!1),this.onTimeUpdate(),this.player.trigger({type:"restart",start:this.player.currentTime(),end:0}),this.player.currentTime(0))},pollTimeUpdate:function(){this.get("paused")||(this.onTimeUpdate(),setTimeout(i.bind(this.pollTimeUpdate,this),150))},shouldAutoplay:function(){return this.get("autoplay")&&!l.bool("is_mobile")&&this.get("duration")>this.get("minLoopDuration")&&this.$el.is(":visible")},play:function(t){t||(t={}),this.player.paused()&&(this.player.play(),t.skipLog||(t.type="userPlay",this.player.trigger(t)))},pause:function(t){t||(t={}),this.player.paused()||(this.player.pause(),t.skipLog||this.player.trigger("userPause"))},onPlay:function(){this.set("paused",!1),this.pollTimeUpdate()},onPause:function(){this.set("paused",!0)},onUpdateDuration:function(){this.get("duration")||this.set("duration",this.player.duration())},onLoadedMetadata:function(){this.set("loaded",!0)},onEnded:function(){this.get("loop")===!0?(this.play({skipLog:!0}),this.player.trigger("looped"),this.get("autoplay")||this.hasLooped||(this.hasLooped=!0)):(this.pause({skipLog:!0}),this.player.trigger("videoEnded"))},onError:function(){this.set("paused",!0),this.set("loop",!1),this.set("autoplay",!1)},onChangeAutoplay:function(t,e,i){this.setAutoplayState(e,i)},onChangeAutoheight:function(t,e){this.setAutoheightState(e)},onChangeDuration:function(){this.setLoopState(!0)},onChangeLoop:function(t,e){this.setLoopState(e)},onChangeMuted:function(t,e){this.player.muted(e)},onFullscreenChange:function(){this.$post.hasClass("docked")&&(this.player.isFullscreen()?(this.cached_top=this.$el.position().top,this.$el.css("top",0)):this.$el.css("top",this.cached_top))},onDockedAfterRender:function(t){i.isEmpty(t.embedID)||this.playerID===t.embedID&&this.player.trigger("CRTPlayer:updateDimensions")},setLoopState:function(t){i.isUndefined(t)&&(t=this.get("loop")),this.set("loop",t),"undefined"!=typeof this.get("duration")&&this.get("duration")<=this.get("minLoopDuration")&&this.set("loop",!1)},setMutedState:function(t){i.isUndefined(t)&&(t=this.get("muted")),this.set("muted",t)},setAutoplayState:function(t){i.isUndefined(t)&&(t=this.get("autoplay")),this.set("autoplay",t),this.toggleAttrClass("autoplay",t),!t&&this.get("duration")&&this.setLoopState(!0)},setAutoheightState:function(t){i.isUndefined(t)&&(t=this.get("autoheight")),this.set("autoheight",t),this.toggleAttrClass("autoheight",t)},setFullscreenControl:function(t){i.isUndefined(t)&&(t=this.get("hideFullscreen")),this.set("hideFullscreen",t),this.toggleAttrClass("hideFullscreen",t)},onTimeUpdate:function(){var t=.3,e=this.get("_position"),i=this.player.currentTime(),s=Math.abs(e-i);t>s&&this.set("_elapsed",this.get("_elapsed")+s),this.set("_position",i),this.set("_startSeekJumpTime",i)},getStartSeekJumpPosition:function(){return this.get("_startSeekJumpTime")},getPosition:function(){return Math.floor(this.get("_position"))},getElapsed:function(){return Math.floor(this.get("_elapsed"))},toggleAttrClass:function(t,e){this.classNames[t]&&n.write(function(){this.$el.toggleClass(this.classNames[t],e)},this)},teardown:function(){this.trigger("teardown",this),this.off(),this.stopListening(),this.watcher&&(this.watcher.destroy(),this.watcher=null),this.player&&(this.player.dispose(),this.player=null)}});e.exports=u},{"./plugins/videojs-crt":316,fastdom:463,jquery:"HlZQrA",lodash:"K2RcUv","prima/class":393,"prima/events":396,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":425,"prima/utils/caniuse":443,scrollmonitor:"y33VHk"}],303:[function(t,e){"use strict";var i=t("video.js"),s=t("./templates/mute_toggle.tpl"),o=i.MuteToggle.extend({init:function(t,e){i.MuteToggle.prototype.init.call(this,t,e),this.addListeners(t)},addListeners:function(){this.on("click",this.onMuteClick)},onMuteClick:function(){this.player_.trigger("muteClicked")},createEl:function(){var t="vjs-mute-control vjs-control";return this.player_.options_.muted&&(t+=" vjs-vol-0"),i.Button.prototype.createEl.call(this,"div",{className:t,innerHTML:s()})},update:function(){var t=this.player_.volume(),e=3;0===t||this.player_.muted()?e=0:.33>t?e=1:.67>t&&(e=2),this.player_.muted()?"Unmute"!==this.el_.children[1].children[0].innerHTML&&(this.el_.children[1].children[0].innerHTML="Unmute"):"Mute"!==this.el_.children[1].children[0].innerHTML&&(this.el_.children[1].children[0].innerHTML="Mute");for(var s=0;4>s;s++)i.removeClass(this.el_,"vjs-vol-"+s);i.addClass(this.el_,"vjs-vol-"+e)}});e.exports=o},{"./templates/mute_toggle.tpl":315,"video.js":"AcVSFw"}],304:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("video.js"),n=o.CoreObject.extend({init:function(t,e){this.options=e||{},this.player=t,this.$player=s(this.player.el()),this._selectorCache(),this.player.on("dispose",i.bind(this.dispose,this)),this.initialize.apply(this,arguments)},_selectorCache:function(){this.$$=i.memoize(function(t){return this.$player.find(t)},i.identity),this.$$.remove=i.bind(function(t){delete this.$$.cache[t]},this),this.$$.clear=i.bind(function(){this.$$.cache={}},this)},initialize:function(){},dispose:function(){this.$$.clear(),this.$player.off()}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],305:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("video.js"),n=t("prima/utils/bindendevent").animation,r=o.Button.extend({init:function(){o.Button.prototype.init.apply(this,arguments),this.player().usingNativeControls()&&this.player().controls(!1)},createEl:function(){return o.Button.prototype.createEl.call(this,"div",{className:"vjs-big-play-button",innerHTML:'<span class="vjs-big-play-button-icon"></span><span class="vjs-big-pause-button-icon"></span></span><span aria-hidden="true"></span>',"aria-label":"play video"})},onClick:function(){this.$el=this.$el||i(this.el()),this.player_.userActive(!0),this.player().usingNativeControls()?this.player().paused()&&(this.player().play(),this.player().controls(!0)):this.togglePlay()},togglePlay:function(){n(this.$el,s.bind(function(){this.$el.removeClass("poof-play poof-pause")},this)),this.player().paused()?(this.player().play(),this.$el.removeClass("poof-pause").addClass("poof-play")):(this.player().pause(),this.$el.removeClass("poof-play").addClass("poof-pause"))}});e.exports=r},{jquery:"HlZQrA",lodash:"K2RcUv","prima/utils/bindendevent":442,"video.js":"AcVSFw"}],306:[function(t,e){"use strict";var i=t("video.js"),s=i.SeekBar.extend({onMouseMove:function(){i.SeekBar.prototype.onMouseMove.apply(this,arguments),this.update()},update:function(){if(this.el_){var t=this.getPercent(),e=this.handle,s=this.bar;isNaN(t)&&(t=0);var o=i.round(100*t,2)+"%";e.el().style.left=o,s.el().style.width=o}}});e.exports=s},{"video.js":"AcVSFw"}],307:[function(t,e){"use strict";var i=t("lodash"),s=t("./base/base-plugin"),o=s.extend({elSelector:".vjs-progress-holder",lastPlayPosition:0,currentPlayPosition:0,lastWaitedTime:0,buffering:!1,polling:!1,interval:100,initialize:function(){this.player.on("play",i.bind(this.startPolling,this)),this.player.on("ended",i.bind(this.stopPolling,this)),this.player.on("pause",i.bind(this.stopPolling,this))},checkBuffering:function(){this.currentPlayPosition=this.player.currentTime();var t=1/this.interval;if(!this.buffering&&this.currentPlayPosition<this.lastPlayPosition+t&&!this.player.paused()&&(this.lastWaitedTime=i.now(),this.$player.trigger("waiting"),this.buffering=!0),this.buffering&&this.currentPlayPosition>this.lastPlayPosition+t&&!this.player.paused()){var e=i.now()-this.lastWaitedTime;this.$player.trigger("stopwaiting",{timeWaited:e}),this.buffering=!1}this.lastPlayPosition=this.currentPlayPosition},tick:function(){this.polling&&(this.checkBuffering(),i.delay(i.bind(this.tick,this),this.interval))},startPolling:function(){this.polling||(this.polling=!0,this.tick())},stopPolling:function(){this.polling=!1}});e.exports=o},{"./base/base-plugin":304,lodash:"K2RcUv"}],308:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/events"),n=t("prima/lib/flags"),r=t("./base/base-plugin"),a=r.extend({videoConversionLogged:!1,loggingInProgress:!1,startSeekTime:null,triggerElement:s(),initialize:function(){this.player.crt.on("ready",i.bind(function(){this.setPlayerData(),this.bindEvents(),this.cacheUnloadData()},this)),this.$doc=s(document)},setPlayerData:function(){this.playerData={id:this.player.crt.playerID,tech:this.player.techName,post_id:this.player.crt.$post.data("post-id"),duration:this.player.crt.get("duration")}},bindEvents:function(){this.$player.on("mousedown touchstart",i.bind(this.setTriggerElement,this)),this.player.on("userPlay",i.bind(this.onUserPlay,this)),this.player.on("play",i.bind(this.onVJSPlay,this)),this.player.on("userPause",i.bind(this.onUserPause,this)),this.player.on("pause",i.bind(this.onVJSPause,this)),this.player.on("looped",i.bind(this.onLooped,this)),this.player.on("videoEnded",i.bind(this.onVideoEnded,this)),this.player.on("restart",i.bind(this.onRestart,this)),this.player.on("muteClicked",i.bind(this.onMuteClicked,this)),this.player.on("fullscreenchange",i.bind(this.onFullscreenChange,this)),this.player.on("error",i.bind(this.onError,this)),this.player.on("seeking",i.bind(this.onSeeking,this)),this.player.on("resolutionchange",i.bind(this.onResolutionChange,this)),this.player.on("timeupdate",i.bind(this.onTimeUpdate,this)),this.$player.on("stopwaiting",i.bind(this.onStopWaiting,this))},triggerEvent:function(t,e){e=this._buildLoggingData(e),o.trigger("VideoPlayer:"+t,{loggingData:e})},_buildLoggingData:function(t){return t=i.extend({},this.playerData,t),t.elapsed=this.player.crt.getElapsed(),t.position=this.player.crt.getPosition(),t},setTriggerElement:function(t){this.triggerElement=s(t.target)},onLogComplete:function(){this.triggerElement=s()},cacheUnloadData:function(){this.triggerEvent("cacheUnload")},onError:function(){var t=this.player.error(),e="MEDIA_ERR_CUSTOM";if(t){switch(t.code){case 1:e="MEDIA_ERR_ABORTED";break;case 2:e="MEDIA_ERR_NETWORK";break;case 3:e="MEDIA_ERR_DECODE";break;case 4:e="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:e="MEDIA_ERR_ENCRYPTED"}this.triggerEvent("error",{code:t.code,name:e})}},onUserPlay:function(t){this.onPlay(!0,t)},onVJSPlay:function(t){this.onPlay(!1,t)},onPlay:function(t,e){if(t||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length){var i=this.player.crt.get("autoplay"),s={};e.onDock&&(s.onDock=!0),this.logConversion({name:"CONVERSION_ACTION_HTML5_VIDEO",extra:{player:this.player.techName,player_version:2}}),this.triggerEvent(i?"autoplay":"play",s),this.onLogComplete()}},onUserPause:function(){this.onPause(!0)},onVJSPause:function(){this.onPause(!1)},onPause:function(t){(t||0!==this.triggerElement.closest(".vjs-big-play-button").length||0!==this.triggerElement.closest(".vjs-play-control").length)&&(this.triggerEvent("pause",this.playerData),this.onLogComplete())},onLooped:function(){this.triggerEvent("looped")},onVideoEnded:function(){this.triggerEvent("ended")},onRestart:function(t){var e=i.pick(t,["start","end"]);this.triggerEvent("restart",e)},onFullscreenChange:function(){this.triggerEvent("fullscreen",{fullscreen:this.player.isFullscreen()}),this.onLogComplete()},onMuteClicked:function(){this.triggerEvent("muted",{muted:this.player.muted()}),this.onLogComplete()},onSeeking:function(){0!==this.triggerElement.closest(".vjs-progress-control").length&&(this.startSeekTime||(this.startSeekTime=this.player.crt.getStartSeekJumpPosition()),this.$doc.one("mouseup.crtEvents touchend.crtEvents",i.bind(this.onSeeked,this)))},onSeeked:function(){if(this.startSeekTime){var t={start:this.startSeekTime,end:this.player.currentTime()};this.triggerEvent("seek",t),this.startSeekTime=null}},onTimeUpdate:function(){this.triggerEvent("timeupdate")},onResolutionChange:function(t){var e=i.pick(t,"resolution");this.triggerEvent("resolutionchange",e)},onStopWaiting:function(t,e){!e.timeWaited||e.timeWaited<2e3||this.triggerEvent("waiting",e)},logConversion:function(t){if(!this.videoConversionLogged&&n.bool("is_logged_in")&&!this.loggingInProgress){this.loggingInProgress=!0;var e=s.ajax({url:"/svc/log/conversion",type:"POST",contentType:"application/x-www-form-urlencoded",with_form_key:!0,data:"log="+JSON.stringify(t)});e.done(i.bind(this.onConversionSuccess,this)),e.fail(i.bind(this.onConversionFail,this))}},onConversionSuccess:function(){this.videoConversionLogged=!0,this.loggingInProgress=!1},onConversionFail:function(){this.loggingInProgress=!1}});e.exports=a},{"./base/base-plugin":304,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/flags":"f/LVtH"}],309:[function(t,e){"use strict";var i=t("lodash"),s=t("video.js"),o=s.Component.extend({sdURL:null,hdURL:null,isUsingSD:!0,timeIntervalBinding:null,init:function(t,e){s.Component.prototype.init.call(this,t,e),this.addListeners(t)},addListeners:function(){this.on("click",this.toggleHDState)},createEl:function(){if(this.hdURL=this.player_.options_.crtOptions.hdUrl,!this.hdURL)return s.Component.prototype.createEl.call(this,"div",{});this.player_.addClass("vjs-has-hd-toggle");var t=s.Component.prototype.createEl.call(this,"div",{className:"vjs-hd-toggle vjs-sd vjs-menu-button vjs-control",innerHTML:"<span>HD</span>"});return t},currentSource:function(){return this.player_.currentSrc()},toggleSrc:function(){var t;this.isUsingSD?(this.sdURL=this.currentSource(),t=this.hdURL,s.removeClass(this.el_,"vjs-sd"),s.addClass(this.el_,"vjs-hd")):(t=this.sdURL,s.removeClass(this.el_,"vjs-hd"),s.addClass(this.el_,"vjs-sd")),this.isUsingSD=!this.isUsingSD,this.player_.src({src:t,type:"video/mp4"})},toggleHDState:function(){var t=this.player_.currentTime(),e=this.player_.paused(),s=this.player_.muted();this.player_.addClass("vjs-quality-toggling"),this.player_.trigger({type:"resolutionchange",resolution:this.isUsingSD?"hd":"sd"});i.delay(i.bind(function(){this.player_.pause(),this.toggleSrc(),this.player_.ready(function(){this.player_.one("loadedmetadata",i.bind(function(){this.player_.currentTime(t)},this)),this.timeIntervalBinding=i.bind(function(){this.player_.currentTime()-t>.1&&(this.player_.removeClass("vjs-quality-toggling"),this.player_.off("timeupdate",this.timeIntervalBinding),e&&(this.player_.pause(),this.player_.muted(s)))},this),this.player_.on("timeupdate",this.timeIntervalBinding),i.defer(i.bind(function(){this.player_.load(),s===!1&&e===!0&&this.player_.muted(!0),this.player_.play()},this))})},this),300)}});e.exports=o},{lodash:"K2RcUv","video.js":"AcVSFw"}],310:[function(t,e){"use strict";var i=t("jquery"),s=(t("lodash"),t("video.js")),o=t("./base/base-plugin"),n=o.extend({seeking:!1,render:function(){return this.$el=i('<div class="vjs-hover-handle vjs-slider-handle" aria-live="off"><span class="vjs-control-text"></span></div>'),this},afterRender:function(){this.$seekHandle=this.$$(".vjs-seek-handle")},update:function(t){t||(t={}),this.$time_el=this.$time_el||this.$el.find(".vjs-hover-handle-time");var e=t.hoverX||0,i=t.hoverTime||"0:00",o=s.formatTime(i);this.$time_el.html(o),this.$el.css("left",e+"px")}});e.exports=n},{"./base/base-plugin":304,jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],311:[function(t,e){"use strict";var i=t("jquery"),s=t("video.js"),o=t("./base/base-plugin"),n=o.extend({render:function(){return this.$el=i('<div class="vjs-hover-slider-time" aria-live="off"></div>'),this},update:function(t){t||(t={});var e=t.hoverX||0,i=t.hoverTime||"0:00",o=s.formatTime(i);this.$el.html(o),this.$el.css("left",e+"px")}});e.exports=n},{"./base/base-plugin":304,jquery:"HlZQrA","video.js":"AcVSFw"}],312:[function(t,e){"use strict";var i=(t("jquery"),t("lodash")),s=t("video.js"),o=t("./base/base-plugin"),n=t("./hover-slider-handle"),r=t("./hover-slider-time"),a=t("./progress-bar-tooltip"),l=o.extend({elSelector:".vjs-progress-holder",initialize:function(){this.children={},this.$el=this.$$(this.elSelector),this.slider_width=this.$el.width(),this.createChildren(),this.$player.on("mousemove.sliderHover",this.elSelector,i.bind(this.onMouseMove,this)),this.$player.on("mouseenter.sliderHover",this.elSelector,i.bind(this.onMouseEnter,this)),this.$player.on("mouseout.sliderHover",this.elSelector,i.bind(this.onMouseOut,this)),this.player.on("dispose",i.bind(this.dispose,this)),this.player.on("fullscreenchange",i.bind(this.onUpdateDimensions,this)),this.player.on("CRTPlayer:updateDimensions",i.bind(this.onUpdateDimensions,this))},onUpdateDimensions:function(){this.slider_width=this.$el.width()},createChildren:function(){this.children.hoverSliderHandle=new n(this.player),this.children.hoverSliderTime=new r(this.player),this.player.options_.crtOptions.filmstrip&&(this.$el.addClass("with-filmstrip"),this.children.progressBarTooltip=new a(this.player)),this.appendChildren()},appendChildren:function(){i.each(this.children,i.bind(function(t){this.$el.append(t.render().$el)},this))},updateChildren:function(t){i.each(this.children,function(e){e.update(t)})},onMouseMove:function(t){this.$el.removeClass("auto-hide");var e=s.findPosition(this.$el[0]),i=t.pageX-e.left,o=s.Slider.prototype.calculateDistance.apply(this.player.controlBar.progressControl,[t.originalEvent]),n=o*this.player.player().duration(),r=n/this.player.player().duration();0>i?i=0:i>this.slider_width&&(i=this.slider_width),this.updateChildren({hoverX:i,hoverTime:n,hoverPercent:r})},onMouseOut:function(){this.$el.addClass("auto-hide")},onMouseEnter:function(){this.$el.removeClass("auto-hide")},dispose:function(){i.each(this.children,function(t){i.result(t,"dispose")}),o.prototype.dispose.apply(this,arguments)}});e.exports=l},{"./base/base-plugin":304,"./hover-slider-handle":310,"./hover-slider-time":311,"./progress-bar-tooltip":314,jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],313:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("video.js"),n=o.Component.extend({isHidden:!0,init:function(t,e){o.Component.call(this,t,e),t.ready(s.bind(this.onReady,this))},onReady:function(){this.$player=i(this.player().el_),this.$el=i(this.el()),this.$loader=this.$el.find(".Knight-Rider-loader");var t=s.bind(this.hideLoader,this),e=s.bind(this.showLoader,this);this.player().on("waiting",e),this.player().on("canplay",t),this.player().on("canplaythrough",t),this.player().on("playing",t),this.player().on("seeking",e),this.player().on("seeked",t),this.player().on("ended",t),this.player().on("resolutionchange",e)},createEl:function(){return o.Component.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",innerHTML:'<div class="Knight-Rider-loader centered"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>',"aria-label":"loading"})},hideLoader:function(){return this.isHidden?this:(this.$loader.removeClass("animate"),this.$player.removeClass("vjs-loading"),this.isHidden=!0,this)},showLoader:function(){return this.isHidden?(this.$loader.addClass("animate"),this.$player.addClass("vjs-loading"),this.isHidden=!1,this):this},dispose:function(){o.Component.prototype.dispose.apply(this,arguments),this.$player=null,this.$el=null}});e.exports=n},{jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],314:[function(t,e){"use strict";var i=t("jquery"),s=(t("lodash"),t("video.js"),t("./base/base-plugin")),o=s.extend({filmstrip_thumbnail_count:10,render:function(){var t=this.player.options_.crtOptions.filmstrip,e=t.url,s=.5*t.width,o=.5*t.height,n=6;return this.$el=i('<div class="crt-progress-tooltip"></div>'),this.$thumbnail=i('<div class="crt-progress-tooltip-thumbnail"></div>'),this.$el.css({transform:"translateX(-50%)",width:s+n+"px",height:o+n+"px"}),this.$thumbnail.css({width:s+"px",height:o+"px","background-image":"url("+e+")","background-size":s*this.filmstrip_thumbnail_count+"px "+o+"px"}),this.$el.append(this.$thumbnail),this},update:function(t){t||(t={});var e=t.hoverX||0;this.$el.css("left",e+"px");var i=isNaN(t.hoverPercent)?0:100*t.hoverPercent,s=100/(this.filmstrip_thumbnail_count-1),o=Math.floor(i/this.filmstrip_thumbnail_count)*s;this.$thumbnail.css("background-position",o+"% 0%")}});e.exports=o},{"./base/base-plugin":304,jquery:"HlZQrA",lodash:"K2RcUv","video.js":"AcVSFw"}],315:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="mute-icon"><div class="speaker"></div><div class="unmuted"></div><div class="muted"></div></div><div><span class="vjs-control-text">Mute</span></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],316:[function(t,e){"use strict";function i(t,e){var i=s.merge({},p(),e);s.extend(i,s.pick(e,"techOrder"));var r=n.defer(),l=function(){var t;e.src&&e.type?(this.src(e),r.resolve(this)):e.file?(t=e.file.type||"video/mp4",this.src({src:a(e.file),type:t}),r.resolve(this),delete e.file):r.resolve(this)};return o(t,i,l),r.promise}var s=t("lodash"),o=t("video.js"),n=t("when"),r=t("prima/lib/data"),a=t("app/lib/create-object-url"),l=t("./hover-slider"),h=t("./detect-buffering"),d=t("./event-dispatcher");o.BigPlayToggle=t("./big-play-toggle"),o.AnimatingMuteToggle=t("./animating-mute-toggle"),o.CrtSeekBar=t("./crt-seekbar"),o.LoadingSpinner=t("./loading-spinner"),o.HDToggle=t("./hd-toggle"),o.log=s.noop,o.log.error=s.noop,o.log.warn=s.noop,o.log.history=[];var c=function(t){this.crt=this.options_.crt,this.options_.crt=null,this.hoverSlider=new l(this,t),this.detectBuffering=new h(this,t),this.eventDispatcher=new d(this,t)};o.plugin("crt",c);var u,p=function(){var t=r.get("Context/hosts");return u||(u={children:["mediaLoader","posterImage","bigPlayToggle",{name:"controlBar",children:["playToggle","currentTimeDisplay","timeDivider","durationDisplay","remainingTimeDisplay",{name:"progressControl",children:["crtSeekBar"]},"fullscreenToggle","hDToggle","animatingMuteToggle","loadingSpinner"]},"errorDisplay"],plugins:{crt:{}},crtOptions:{filmstrip:!1,hdUrl:!1,duration:null},controls:!0,autoplay:!1,defaultVolume:.8,flash:{swf:t.assets_host+"/assets/src/scripts/vendor/video-js/video-js-swf-4.5.2.swf"},techOrder:["html5","flash"]}),u};e.exports=i},{"./animating-mute-toggle":303,"./big-play-toggle":305,"./crt-seekbar":306,"./detect-buffering":307,"./event-dispatcher":308,"./hd-toggle":309,"./hover-slider":312,"./loading-spinner":313,"app/lib/create-object-url":274,lodash:"K2RcUv","prima/lib/data":398,"video.js":"AcVSFw",when:"RG2dij"}],317:[function(t,e){"use strict";var i=t("./views/drawerform.js");e.exports=i},{"./views/drawerform.js":319}],318:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<h1 class="form-heading">',__p+=title?""+(null==(__t=__(title))?"":__t):""+(null==(__t=__("Flag this post"))?"":__t),__p+='</h1><div class="form-description">',__p+=description?""+(null==(__t=__(description))?"":__t):""+(null==(__t=__("Seeing something you shouldn't? This is the place to tell us about it. %1$sLearn more%2$s about how we handle these matters and what you can do to help.",'<a href="/docs/discovery#moderationheader" target="_blank">',"</a>"))?"":__t),__p+="</div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],319:[function(t,e){"use strict";var i=t("jquery"),s=(t("lodash"),t("prima/view")),o=t("prima/lib/translate"),n=t("prima/mixins/accessor"),r=t("prima/events"),a=t("./imageupload"),l=t("./fieldvalidation"),h=t("./errortags"),d=s.extend({mixins:[n],templateAttributes:{__:o,formKey:i("#tumblr_form_key").attr("content")},initialize:function(t){t=t||{},this.set("complete",!1),this.fieldValidation=new l({el:this.$el}),this.imageUpload=new a({el:this.$el}),this.errortags=new h({mobileMode:"undefined"!=typeof t.mobileMode?t.mobileMode:!1}),this._bindEvents()},_bindEvents:function(){this.listenTo(r,"drawer:close",this._teardown),this.listenTo(r,"drawerform:validation",this._updateCompleteStatus)},_updateCompleteStatus:function(t){this.set("complete",t.status)},_teardown:function(){this.fieldValidation.remove(),this.imageUpload.remove(),this.errortags.remove()}});e.exports=d},{"./errortags":320,"./fieldvalidation":321,"./imageupload":323,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/mixins/accessor":425,"prima/view":460}],320:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/mixins/accessor"),r=t("prima/view"),a=t("prima/events"),l=t("velocity-animate"),h=r.extend({mixins:[n],el:".form-container",defaultText:o("A few details, please"),initialize:function(t){this.set("mobileMode","undefined"!=typeof t&&t.mobileMode?t.mobileMode:!1),this.errorTags={},this.listenTo(a,"drawerform:errortag:show",this.showErrorTag),this.listenTo(a,"drawerform:errortag:remove",this.removeErrorTag),this.listenTo(a,"drawerform:errortag:removeall",this.removeAllErrorTags)},showErrorTag:function(t){if("undefined"!=typeof t&&t.field){var e=t.field,o=t.text||this.defaultText,n=e.attr("name");this.errorTags[n]||(this.errorTags[n]=i("<div>").addClass("drawer-error-tag").text(o),this.get("mobileMode")?(this.errorTags[n].css({top:e.position().top}).addClass(n).appendTo(e.closest(".form-container")),l.animate(this.errorTags[n],"fadeIn",{duration:100,easing:"easeInOut"}),l.animate(this.errorTags[n],"fadeOut",{duration:100,easing:"easeIn",delay:3e3,complete:s.bind(function(){this.removeErrorTag({field:e})},this)})):("undefined"==typeof this.drawer&&(this.$drawer=i(".drawer"),this.$drawer.on("scroll",s.bind(this.updateErrortagPosition,this))),this.errorTags[n].css({top:e.offset().top,right:this.$drawer.width()}).insertAfter(this.$drawer),l.animate(this.errorTags[n],{translateX:["-5px","0px"]},{duration:100,easing:"easeInOut"})))}},removeErrorTag:function(t){var e=t.field,i=e.attr("name");"undefined"!=typeof this.errorTags&&this.errorTags[i]&&(this.errorTags[i].remove(),delete this.errorTags[i])},removeAllErrorTags:function(){"undefined"!=typeof this.errorTags&&this.errorTags&&s.each(this.errorTags,function(t){t&&(t.remove(),t="")})},updateErrortagPosition:function(){"undefined"!=typeof this.errorTags&&this.errorTags&&s.each(this.errorTags,function(t,e){var s=i('.form-container [name="'+e+'"]');s?t.css({top:s.offset().top}):(t.remove(),this.removeErrorTag({field:s}))},this)},remove:function(){this.removeAllErrorTags(),"undefined"!=typeof this.$drawer&&this.$drawer.off("scroll",s.bind(this.updateErrortagPosition,this)),r.prototype.remove.apply(this)}});e.exports=h},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/mixins/accessor":425,"prima/view":460,"velocity-animate":"lWl/mc"}],321:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/view"),r=t("prima/events"),a=t("prima/lib/validators"),l=5e3,h=n.extend({events:{'change [data-validate-input="dropdown"]':"fieldValidationHandler",'keyup [data-validate-input="email"]':"fieldValidationHandler",'blur [data-validate-input="email"]':"fieldValidationHandler",'keyup [data-validate-input="text"]':"fieldValidationHandler",'blur [data-validate-input="text"]':"fieldValidationHandler",'change [data-validate-input="file"]':"fieldValidationHandler",'change [data-validate-input="checkbox"]':"validateAllFields"},validationErrorMessages:{email:o("We gotta write you back, though")},initialize:function(){this.listenTo(r,"drawerform:validation:trigger",this.validateAllFields)},validateAllFields:function(){var t=i("[data-validate-input]"),e=t.length>0;s.each(t,function(t){var s=i(t).data("validate-input"),o=i(t).val();return this.isFieldValid(o,s)?void 0:(e=!1,!1)},this),r.trigger("drawerform:validation",{status:e})},fieldValidationHandler:function(t){var e=i(t.target),s=e.val(),o=e.data("validate-input"),n=e.data("error-text");this.isFieldValid(s,o)?(e.hasClass("error")&&e.removeClass("error"),r.trigger("drawerform:errortag:remove",{field:e})):"focusout"===t.type&&(e.addClass("error"),r.trigger("drawerform:errortag:show",{field:e,text:this.validationErrorMessages[n]})),this.validateAllFields()},isFieldValid:function(t,e){var i;switch(e){case"email":i=a.isEmail(t);break;case"text":i=!a.isBlank(t)&&a.maxLength(t,l);break;case"file":i=!a.isBlank(t);break;case"dropdown":i=!a.isBlank(t);break;case"checkbox":i=this.isAtLeastOneChecked()}return i},isAtLeastOneChecked:function(){var t=i('input[type="checkbox"]:checked');return t.length>0}});e.exports=h},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/lib/validators":424,"prima/view":460}],322:[function(t,e){"use strict";var i=t("prima/lib/translate"),s=t("prima/view"),o=t("../templates/formheader.tpl"),n=s.extend({className:"form-header",initialize:function(t){return t=t||{},this.templateAttributes={__:i,title:"undefined"!=typeof t.title?t.title:"",description:"undefined"!=typeof t.description?t.description:""},this},render:function(){return this.$el.html(o(this.templateAttributes)),this}});e.exports=n},{"../templates/formheader.tpl":318,"prima/lib/translate":423,"prima/view":460}],323:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/translate"),n=t("prima/view"),r=t("prima/events"),a=15e6,l=n.extend({events:{"change .image-upload":"onImageUploadClick","click .btn-remove-uploaded":"onRemoveImageClick"},onImageUploadClick:function(t){var e=t.currentTarget;if(this.imageUploadEl=i(".image-upload-input"),this.imagePreviewEl=i(".image-upload-preview"),e.files&&e.files[0]){if(e.files[0].size>a)return r.trigger("drawerform:errortag:show",{field:this.imageUploadEl,text:o("File is too big.")}),void i(e).replaceWith(i(e).val("").clone(!0));r.trigger("drawerform:errortag:remove",{field:this.imageUploadEl}),this.imageUploadEl.addClass("hidden");var n=new FileReader;n.readAsDataURL(e.files[0]),n.onload=s.bind(function(t){this.imagePreviewEl.removeClass("hidden"),t.target.result&&t.target.result.length?(this.imagePreviewEl.find("img").attr("src",t.target.result),this.imagePreviewEl.addClass("shown")):this.imageUploadEl.removeClass("hidden")},this)}},onRemoveImageClick:function(){var t=i(".image-upload-input input");t.replaceWith(t.val("").clone(!0)),i(".image-upload-input input").trigger("change"),this.imagePreviewEl.removeClass("shown"),this.imageUploadEl.removeClass("hidden")}});e.exports=l},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/view":460}],324:[function(t,e){"use strict";var i=t("./views/knight-rider-loader-view.js");e.exports=i},{"./views/knight-rider-loader-view.js":326}],325:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="knight-rider-loader '+(null==(__t=variation)?"":_.escape(__t))+'" data-js-knightrider><div class="knight-rider-bar"></div><div class="knight-rider-bar"></div><div class="knight-rider-bar"></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],326:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/mixins/selectorcache"),r=t("prima/mixins/accessor"),a=t("../templates/knight-rider-loader.tpl"),l=s.extend({className:"knight-rider-container",mixins:[o,n,r],template:a,defaults:{variation:"",loading:!1},initialize:function(t){t=i.extend({},t),i.extend(this.attributes,i.pick(t,i.keys(this.defaults))),this.listenTo(this,"change:loading",this._onChangeLoading)
},_onChangeLoading:function(t,e){this.$el.toggleClass("loading",e),this.js$("knightRider").toggleClass("animate",e),this.$el.toggle(e)},serialize:function(){return this.toJSON()},render:function(){return this.$el.html(this.template(this.serialize())),this._onChangeLoading(this,this.get("loading")),this}});e.exports=l},{"../templates/knight-rider-loader.tpl":325,lodash:"K2RcUv","prima/mixins/accessor":425,"prima/mixins/selectorcache":435,"prima/mixins/subviewable":436,"prima/view":460}],327:[function(t,e){"use strict";e.exports={SharePopoverView:t("./views/share-popover"),FeatureHelpPopoverView:t("./views/feature-help-popover")}},{"./views/feature-help-popover":334,"./views/share-popover":336}],328:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/model"),o=t("prima/lib/translate"),n=s.extend({defaults:{flags:[{name:"nsfw",label:o("This should be filtered")},{name:"spam",label:o("This is spam")},{name:"general",label:i.sprintf(o("This violates Tumblr's %1$sCommunity Guidelines%2$s"),'<a class="community_guidelines_link" href="https://www.tumblr.com/policy/community" target="_blank">',"</a>")}],violations:[{name:"hate",label:o("Malicious speech")},{name:"minors",label:o("Harm to minors")},{name:"selfharm",label:o("Promotion or glorification of self-harm")},{name:"gore",label:o("Gore, mutilation, bestiality, or necrophilia")},{name:"attribution",label:o("Misattribution or non-attribution")},{name:"impersonation",label:o("Confusion or impersonation")},{name:"harassment",label:o("Harassment")}]}});e.exports=n},{lodash:"K2RcUv","prima/lib/translate":423,"prima/model":439}],329:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/model"),n=t("prima/lib/data"),r=t("prima/lib/flags"),a=t("app/components/post-embed-code"),l=o.extend({urlRoot:function(){var t=n.get("Context/hosts");return s.isEmpty(t)?"http://www.tumblr.com":t.www_host},defaults:{embed_code:"",form_key:i("#tumblr_form_key").attr("content"),has_facebook:!1,has_user:!1,is_private:!1,permalink_label:"",post_id:"",post_tiny_url:"",post_url:"",show_email:!0,show_embed:!0,show_facebook:!0,show_permalink:!0,show_pinterest:!0,show_twitter:!0,show_flagging:!0,tumblelog_name:"",twitter_username:"",embed_key:"",pinterest_share_window:{}},initialize:function(){this.get("embed_code")||this.set("embed_code",new a(this.toJSON()).getCode()),r.bool("enable_share_embed_code")||this.set("show_embed",!1),r.bool("pinterest_sharing")||this.set("show_pinterest",!1)},shareEmail:function(t){return this.share("/svc/share/email",t)},shareTwitter:function(t){return this.share("/svc/share/twitter",t)},shareFacebook:function(t){return this.share("/svc/share/facebook",t)},sharePinterest:function(t){return this.share("/svc/share/pinterest",t)},facebookStatus:function(){return i.ajax({url:this.urlRoot()+"/svc/facebook_status",type:"post",data:{form_key:this.get("form_key")}})},share:function(t,e){return e=e||[],e.push({name:"form_key",value:this.get("form_key")}),i.ajax({url:this.urlRoot()+t,type:"post",data:e,success:s.bind(function(){this.trigger("success")},this),error:s.bind(function(){this.trigger("error")},this)}),this}});e.exports=l},{"app/components/post-embed-code":61,jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/data":398,"prima/lib/flags":"f/LVtH","prima/model":439}],330:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="","undefined"!=typeof template&&"standard"===template?(__p+='<div class="popover tutorial '+(null==(__t=name)?"":_.escape(__t))+'_step">',"undefined"!=typeof title&&(__p+='<h3 class="title">'+(null==(__t=title)?"":__t)+"</h3>"),__p+='<p class="content">'+(null==(__t=content)?"":_.escape(__t))+"</p>","undefined"!=typeof ok_text&&(__p+='<button class="chrome blue ok_button" type="button">'+(null==(__t=ok_text)?"":_.escape(__t))+"</button>"),__p+="</div>"):"undefined"!=typeof template&&"appearance"===template&&(__p+='<div class="popover tutorial '+(null==(__t=name)?"":_.escape(__t))+'_step"><div class="popover_inner">',"undefined"!=typeof title&&(__p+='<h3 class="title">'+(null==(__t=title)?"":__t)+"</h3>"),__p+='<p class="content">'+(null==(__t=content)?"":_.escape(__t))+'</p></div><div class="appearance small" style="background-color:'+(null==(__t=appearance_data.global_theme_params.background_color)?"":_.escape(__t))+"; color:"+(null==(__t=appearance_data.global_theme_params.background_color)?"":_.escape(__t))+'"><div class="navigation"><a class="chrome edit_button" href="/settings/blog/'+(null==(__t=appearance_data.name)?"":_.escape(__t))+'">'+(null==(__t=edit_text)?"":_.escape(__t))+'</a></div><div class="header_image" style="background-image:url('+(null==(__t=appearance_data.global_theme_params.header_image_focused)?"":_.escape(__t))+')"></div><div class="avatar '+(null==(__t=appearance_data.global_theme_params.avatar_shape)?"":_.escape(__t))+'" style="background-image:url('+(null==(__t=appearance_data.avatar_url)?"":_.escape(__t))+')"><img src="'+(null==(__t=appearance_data.avatar_url)?"":_.escape(__t))+'" alt=""></div><div class="info" style="color:'+(null==(__t=appearance_data.global_theme_params.title_color)?"":_.escape(__t))+'">',appearance_data.title&&(__p+='<h1 class="title" style="font-weight:'+(null==(__t=appearance_data.global_theme_params.title_font_weight)?"":_.escape(__t))+'">'+(null==(__t=appearance_data.title)?"":_.escape(__t))+"</h1>"),__p+="",appearance_data.description&&(__p+='<div class="description"><p class="description_inner">'+(null==(__t=appearance_data.description)?"":_.escape(__t))+"</p></div>"),__p+="</div></div></div>"),__p+='<div class="glass blue"></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],331:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover moderation"><div class="popover_inner"><div class="popover_header">'+(null==(__t=__("Flag this post"))?"":__t)+'<a class="moderation_help_link" href="https://www.tumblr.com/docs/discovery#moderationheader" target="_blank"><span class="icon_help"></span></a></div><form class="popover_form" action="/svc/flag" method="post"><input type="hidden" name="tumblelog_name" value="'+(null==(__t=tumblelog)?"":__t)+'"> <input type="hidden" name="post_id" value="'+(null==(__t=post_id)?"":__t)+'"> <input type="hidden" name="root_id" value="'+(null==(__t=root_id)?"":__t)+'">',_.each(flags,function(t){__p+='<div class="popover_form_row">';var e="flag_"+t.name;__p+='<input type="radio" id="'+(null==(__t=e)?"":__t)+'" name="flag" value="'+(null==(__t=t.name)?"":__t)+'"><label for="'+(null==(__t=e)?"":__t)+'" class="form_label">'+(null==(__t=t.label)?"":__t)+"</label>","nsfw"===t.name&&safe_search&&(__p+='<div class="popover_form_row_help">'+(null==(__t=_.sprintf(__("Adult-oriented content is currently being hidden ( %1$s ) but this post still showed up."),'<i class="icon_lock_thick_12"></i>'))?"":__t)+"</div>"),__p+="</div>"}),__p+='<div class="violation_types_wrapper">',_.each(violations,function(t){__p+='<div class="popover_form_row">';var e="violation_"+t.name;__p+='<input type="radio" id="'+(null==(__t=e)?"":__t)+'" name="violation" value="'+(null==(__t=t.name)?"":__t)+'"><label for="'+(null==(__t=e)?"":__t)+'" class="form_label">'+(null==(__t=t.label)?"":__t)+"</label></div>"}),__p+='</div><div class="popover_form_row ignore"><label class="binary_switch"><input type="checkbox" name="flag_ignore" checked="checked"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label for="ignore">'+(null==(__t=_.sprintf(__("Ignore %1$s"),tumblelog))?"":__t)+'</label></div><button class="chrome red full_width submit_flag">'+(null==(__t=__("Flag"))?"":__t)+"</button></form></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],332:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover popover_menu popover_gradient popover_share_social"><div class="popover_inner"><ul class="share_options active" data-tumblelog-name="'+(null==(__t=tumblelog_name)?"":_.escape(__t))+'" data-post-id="'+(null==(__t=post_id)?"":_.escape(__t))+'" data-root-id="'+(null==(__t=root_id)?"":_.escape(__t))+'" data-post-url="'+(null==(__t=post_url)?"":_.escape(__t))+'" data-post-tiny-url="'+(null==(__t=post_tiny_url)?"":_.escape(__t))+'" data-embed-key="'+(null==(__t=embed_key)?"":_.escape(__t))+'" data-embed-did="'+(null==(__t=embed_did)?"":_.escape(__t))+'">',is_private||(__p+="",show_permalink&&(__p+='<li class="share_permalink popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="permalink" href="'+(null==(__t=post_url)?"":_.escape(__t))+'" target="_blank" class="external" title="'+(null==(__t=permalink_label)?"":_.escape(__t))+'">'+(null==(__t=permalink_label)?"":_.escape(__t))+'<i class="icon icon_arrow_carrot_right"></i></a></li>'),__p+="",show_embed&&(__p+='<li class="embed_post popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="embed" href="#">'+(null==(__t=__("Embed"))?"":_.escape(__t))+"</a></li>"),__p+="",show_email&&(__p+='<li class="share_email popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="email" href="#">'+(null==(__t=__("Email"))?"":_.escape(__t))+"</a></li>"),__p+="",show_twitter&&(__p+='<li class="share_twitter popover_menu_item" data-twitter-username="'+(null==(__t=twitter_username)?"":_.escape(__t))+'"><a class="popover_menu_item_anchor" data-share-type="twitter" href="#">'+(null==(__t=__("Twitter"))?"":_.escape(__t))+"</a></li>"),__p+="",show_facebook&&(__p+='<li class="share_facebook popover_menu_item" data-has-facebook="'+(null==(__t=has_facebook?"1":"")?"":__t)+'"><a class="popover_menu_item_anchor" data-share-type="facebook" href="#">'+(null==(__t=__("Facebook"))?"":_.escape(__t))+"</a></li>"),__p+="",show_pinterest&&(__p+='<li class="share_pinterest popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="pinterest" href="#">'+(null==(__t=__("Pinterest"))?"":_.escape(__t))+"</a></li>"),__p+="",show_flagging&&(__p+='<li class="flag_post popover_menu_item"><a class="popover_menu_item_anchor" href="#">'+(null==(__t=__("Flag this post"))?"":_.escape(__t))+"</a></li>"),__p+="",show_reporting_links&&(__p+='<li class="popover_menu_item"><a class="popover_menu_item_anchor" target="_blank" href="'+(null==(__t=abuse_url)?"":_.escape(__t))+'">'+(null==(__t=__("Report Abuse"))?"":_.escape(__t))+"</a></li>"),__p+=""),__p+="</ul>",is_private||(__p+='<form method="post" class="share_form email_form" id="share_email_'+(null==(__t=post_id)?"":_.escape(__t))+'" novalidate><div class="form_wrapper"><div class="share_label" data-embed-label="'+(null==(__t=__("Embed"))?"":_.escape(__t))+'"></div><span class="cancel service icon_arrow_thin_left"></span><div class="input_group"><ul><li><input type="email" class="email_address" name="email_address" maxlength="100" placeholder="'+(null==(__t=__("Email"))?"":_.escape(__t))+'" title="'+(null==(__t=__("Email"))?"":_.escape(__t))+'"> <input type="hidden" name="post_id" value="'+(null==(__t=post_id)?"":_.escape(__t))+'"> <input type="hidden" name="tumblelog_name" value="'+(null==(__t=tumblelog_name)?"":_.escape(__t))+'"> <span class="cancel icon_close"></span></li><li><textarea name="message" class="share_message" maxlength="255" placeholder="'+(null==(__t=__("Message (Optional)"))?"":_.escape(__t))+'" title="'+(null==(__t=__("Message (Optional)"))?"":_.escape(__t))+'"></textarea><div class="character_count">140</div></li></ul></div>',show_embed&&(__p+='<div class="embed_code_wrapper"><textarea name="embed_code" class="embed_code_text" spellcheck="false" readonly="readonly">'+(null==(__t=embed_code)?"":_.escape(__t))+"</textarea></div>"),__p+="",has_user&&(__p+='<div class="reply_to" title="'+(null==(__t=__("Let them reply to"))?"":_.escape(__t))+'"><div class="menu_item_option"><label class="binary-switch"><input type="checkbox" id="allow_reply_to_'+(null==(__t=post_id)?"":_.escape(__t))+'" class="reply_to_input" name="allow_reply_to"> <span class="binary-switch-track"></span> <span class="binary-switch-button"></span></label></div><label class="menu_item_label" for="allow_reply_to_'+(null==(__t=post_id)?"":_.escape(__t))+'">'+(null==(__t=__("Let them reply to <span>"))?"":__t)+"</label></div>"),__p+='<div class="error_status"></div><button type="submit" class="flat-button blue email_submit" data-label-sending="'+(null==(__t=__("Sending..."))?"":_.escape(__t))+'" data-label="'+(null==(__t=__("Send"))?"":_.escape(__t))+'" disabled="disabled">'+(null==(__t=__("Send"))?"":_.escape(__t))+'</button></div></form><div class="status" data-sent="'+(null==(__t=__("Sent!"))?"":_.escape(__t))+'" data-error="'+(null==(__t=__("Error!"))?"":_.escape(__t))+'"><span class="status_message">'+(null==(__t=__("Sent!"))?"":_.escape(__t))+"</span></div>"),__p+="</div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],333:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("prima/view"),n=t("prima/events"),r=t("prima/mixins/popoverbase"),a=t("app/components/blog-card"),l=o.extend({mixins:[r],className:"tumblelog_popover popover popover--blog-card",blogCardView:null,initialize:function(t){t||(t={}),t.identifier="TumblelogPopover",o.prototype.initialize.call(this,t)},openPopover:function(){return this.blogCardView?(this.render(),this):(this.blogCardView=new a({model:this.model}),void this.listenToOnce(this.blogCardView,"ready",this.render))},closePopover:function(){this.animateOut(),i.delay(i.bind(this.teardown,this),250)},onMouseMove:function(t){this.overElement(t,this.$el)||this.overElement(t,this.$pinned)?this.teardownTimer&&(clearTimeout(this.teardownTimer),this.teardownTimer=null):this.teardownTimer||(this.teardownTimer=i.delay(i.bind(this.closePopover,this),300))},overElement:function(t,e){var i=e.offset();return t.pageX>i.left&&t.pageY>i.top&&t.pageX<i.left+e.outerWidth()&&t.pageY<i.top+e.outerHeight()},render:function(){return this.blogCardView.render(),this.$el.html(this.blogCardView.el),i.defer(i.bind(this.animateIn,this)),this.boundMouseMove=i.bind(this.onMouseMove,this),s("body").on("mousemove",this.boundMouseMove),this._logOpen(),this},animateIn:function(){return this.$el.css("opacity",1),this},animateOut:function(){return this.$el.css("opacity",0),this},_logOpen:function(){n.trigger("popover:blogcard:open",{loggingData:{blog:this.model.get("name")}})},teardown:function(){return s("body").off("mousemove",this.boundMouseMove),this.$el.remove(),this}});e.exports=l},{"app/components/blog-card":10,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/mixins/popoverbase":432,"prima/view":460}],334:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/view"),o=t("prima/events"),n=t("prima/lib/domeventor"),r=t("prima/utils/bindendevent").transition,a=t("../templates/feature-help-popover.tpl"),l={TOP:1,BOTTOM:2,LEFT:4,RIGHT:8,CENTER:16},h=s.extend({className:"tour_guide",template:a,events:{"click .glass":"_onDismiss","click .ok_button":"_onDismiss"},_onDismiss:function(t){t.preventDefault(),this.hide(),this.trigger("hide")},_onScroll:function(t){this.scrollPosition=t,this.isDim&&this.fadeGlass()},initialize:function(){this.$body=i("body"),this.$highlighted=i(),this.$glass=i(),this.$popover=i(),this.isDim=!1,this.isOpen=!1,this.openScrollPosition=0,this.highlightedClass="",this.scrollPosition=n.rect(),this.listenTo(o,"DOMEventor:flatscroll",this._onScroll)},setHighlighted:function(t,e){this.$highlighted=t,this.highlightedClass=e},show:function(t){return this.config=t,this.$el.html(this.template(t)),this.$body.addClass("tour_guide_open").append(this.$el),this.isOpen=!0,this.config.glass&&(this.$el.addClass("dim"),this.isDim=!0),this.config.name&&this.$body.attr("data-help-popover",this.config.name),this.config.glass&&this.$highlighted.length&&this.$highlighted.addClass("tour_guide_element").addClass(this.highlightedClass),this.openScrollPosition=this.$highlighted.length?this.scrollPosition.windowScrollTop:this.scrollPosition.windowScrollTop+.5*this.scrollPosition.windowHeight,this.$glass=this.$(".glass"),this.$popover=this.$(".popover"),this.delegateEvents(),this.positionPopover(),this},hide:function(){this.$el.addClass("removing"),this.$body.addClass("help-popover-removing"),r(this.$el,this.remove.bind(this))},remove:function(){this.undelegateEvents(),this.isDim=!1,this.isOpen=!1,this.config=null,this.$el.removeClass("dim removing").remove(),this.$body.removeClass("tour_guide_open help-popover-removing").removeAttr("data-help-popover"),this.$highlighted.length&&(this.$highlighted.off(".tour_guide_highlighted").removeClass("tour_guide_element").removeClass(this.highlightedClass),this.$highlighted=i(),this.highlightedClass="")},fadeGlass:function(){var t=(this.openScrollPosition-this.scrollPosition.windowScrollTop)/this.scrollPosition.windowHeight,e=t>0?1-t:t+1;return 0>=e?(this.isDim=!1,this.hide(),void this.trigger("hide")):void this.$glass.css("opacity",e)},positionPopover:function(){if(this.$popover.length){var t=this.$popover.outerHeight(!0),e=this.$popover.outerWidth(!0);if(this.$highlighted.length){var s,o,n=this.config.position,r=this.$highlighted.offset(),a=this.$highlighted.outerWidth(),h=r.left,d=r.top,c=d-t<this.scrollPosition.windowScrollTop+80;if(n||(n=l.CENTER|c?l.BOTTOM:l.TOP),n&l.LEFT?(o=h,this.$popover.addClass("horizontal-left")):n&l.RIGHT?(o=h-e+a,this.$popover.addClass("horizontal-right")):(o=h-.5*(e-a),this.$popover.addClass("horizontal-center")),this.$popover.css("left",o),this.config.fixed_position)return void(i("#site_notice").length&&this.$popover.css("margin-top","+="+i("#site_notice").outerHeight()+"px"));n&l.TOP?(s=d-t,this.$popover.addClass("vertical-top")):(s=d+this.$highlighted.outerHeight(),this.$popover.addClass("vertical-bottom")),this.$popover.css("top",s)}else this.$popover.addClass("centered").css({top:.5*this.scrollPosition.windowHeight-.5*t,left:.5*this.scrollPosition.windowWidth-.5*e})}}},{POSITION:l});e.exports=h},{"../templates/feature-help-popover.tpl":330,jquery:"HlZQrA","prima/events":396,"prima/lib/domeventor":400,"prima/utils/bindendevent":442,"prima/view":460}],335:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("prima/lib/translate"),a=t("prima/mixins/popoverbase"),l=t("app/models/tumblelog"),h=t("app/components/dialog"),d=t("../models/post_moderation_popover"),c=t("../templates/post_moderation.tpl"),u=o.extend({className:"popover--post-moderation",mixins:[a],template:c,events:{'change input[name="flag"]':"onChangeFlag",'change input[name="violation"]':"onChangeViolation",'change input[name="flag_ignore"]':"onChangeIgnore","change input":"onChangeForm",submit:"onSubmit"},selectedFlag:null,selectedViolation:null,ignore:!0,initialize:function(t){this.options=s.extend({},t),this.model=new d,this.postModel=this.options.post,this.tumblelog=this.postModel.tumblelog||(this.postModel.tumblelog=new l(this.postModel.get("tumblelog_data")))},cacheSelectors:function(){this.$form=this.$el.find("form"),this.$submitButton=this.$form.find(".submit_flag"),this.$violationsContainer=this.$form.find(".violation_types_wrapper"),this.$violationInputs=this.$violationsContainer.find("input")},onChangeViolation:function(t){var e=i(t.currentTarget);this.selectedViolation=e.val()},onChangeFlag:function(t){var e=i(t.currentTarget);this.selectedFlag=e.val()},onChangeForm:function(){this.toggleViolations(),this.$submitButton.prop("disabled",!this.isValid())},onChangeIgnore:function(t){var e=i(t.currentTarget);this.ignore=e.is(":checked"),this.ignore?this.tumblelog.ignore():this.tumblelog.unignore()},onSubmit:function(t){t.preventDefault();var e=this.$form.serializeArray(),o={};s.each(e,function(t){o[t.name]=t.value}),i.ajax({url:this.$form.attr("action"),type:this.$form.attr("method")||"POST",data:o,with_form_key:!0,success:s.noop,error:function(){var t=r("Sorry, we seem to be having technical trouble.  Please try again later.");h.alert(t)}}),this.teardown(),n.trigger("flagged:"+this.tumblelog.get("name"))},toggleViolations:function(){"general"===this.selectedFlag?this.$violationsContainer.show():(this.$violationsContainer.hide(),this.selectedViolation=null,this.$violationInputs.prop("checked",!1))},isValid:function(){if(!this.ignore){if(!this.selectedFlag)return!1;if("general"===this.selectedFlag&&!this.selectedViolation)return!1}return!0},serialize:function(){return{__:r,safe_search:i(".nsfw_filter_enabled").length,flags:this.model.get("flags"),violations:this.model.get("violations"),root_id:this.postModel.get("root_id"),post_id:this.postModel.get("id"),tumblelog:this.tumblelog.get("name"),ignore:this.ignore}},render:function(){return this.$el.html(this.template(this.serialize())),this.delegateEvents(),this.cacheSelectors(),this},reset:function(){this.selectedFlag=null,this.selectedViolation=null,this.ignore=!0},teardown:function(){return this.reset(),this.$el.remove(),this}});e.exports=u},{"../models/post_moderation_popover":328,"../templates/post_moderation.tpl":331,"app/components/dialog":20,"app/models/tumblelog":278,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423,"prima/mixins/popoverbase":432,"prima/view":460}],336:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("prima/utils/cookie"),a=t("prima/mixins/popoverbase"),l=t("../templates/share-popover.tpl"),h=t("../models/share-popover"),d=o.extend({className:"popover--post-share-popover",mixins:[a],template:l,defaults:{popoverData:{},forceSocialFallback:!1,forceEmailFallback:!1},events:{"click .embed_post":"__embedPostClick","click .share_email":"__emailTriggerClick","click .share_facebook":"__shareFacebookClick","click .share_pinterest":"__sharePinterestClick","click .share_twitter":"__shareTwitterClick","click .share_permalink":"__sharePermalinkClick","click .flag_post":"__flagPostClick","click .cancel":"__cancelClick","input .email_address":"__emailFormInput","input .twitter .share_message":"__shareTwitterInput","change .reply_to_input":"__replyToChange","keydown .share_form":"__submitKeydown","submit .share_form":"__submit","focus input":"__suspendKeyCommands","focus textarea":"__suspendKeyCommands","blur textarea":"__resumeKeyCommands","blur input":"__resumeKeyCommands"},__embedPostClick:function(t){t.preventDefault(),n.trigger("dashboard-share:embed"),this._showEmbedCode()},__emailTriggerClick:function(t){t.preventDefault(),n.trigger("dashboard-share:email"),this._toggleEmailForm()},__shareFacebookClick:function(t){t.preventDefault(),n.trigger("dashboard-share:facebook"),this._shareFacebook()},__sharePinterestClick:function(t){t.preventDefault(),n.trigger("dashboard-share:pinterest"),this._sharePinterest()},__shareTwitterClick:function(t){t.preventDefault(),n.trigger("dashboard-share:twitter"),this._shareTwitter()},__sharePermalinkClick:function(){this.resetAndHide()},__flagPostClick:function(t){t.preventDefault(),this.onClickOutside(),n.trigger("abuseform:open",{post:this.model})},__cancelClick:function(t){t.preventDefault(),this._cancelOrClose()},__emailFormInput:function(){var t=d.validateEmail(this.$emailAddress.val());this.$submitButton.attr("disabled",!t)},__shareTwitterInput:function(t){t.preventDefault();var e=d.validateTwitter(this.$shareMessage.val(),this.$characterCount);this.$submitButton.attr("disabled",!e)},__replyToChange:function(t){var e=i(t.currentTarget).is(":checked");r.set("share_popover_reply_to",e,31536e3)},__submitKeydown:function(t){13===t.keyCode&&(t.ctrlKey||t.metaKey||t.altKey)&&(t.preventDefault(),t.stopPropagation(),this.submitForm())},__submit:function(){return this.submitForm(),!1},__submitSuccess:function(){this.$status.show(),this._fadeoutPopover()},__submitError:function(){this.$errorStatus.html(this.errorText),this.$submitButton.html(this.$submitButton.data("label")),this.$submitButton.attr("disabled",!1),this.$errorStatus.addClass("active")},__suspendKeyCommands:function(){n.trigger("keycommands:suspend")},__resumeKeyCommands:function(){n.trigger("keycommands:resume")},_shareTwitter:function(){!this.options.forceSocialFallback&&this.twitterUsername?(this.$serviceCancel.show(),this.$submitButton.html("Tweet"),this.$shareForm.data("type","twitter"),this.$shareLabel.text("@"+this.twitterUsername),this.$shareMessage.val(" [URL]"),this.$shareForm.addClass("active"),this.$shareOptions.removeClass("active"),this.$shareMessage.get(0).setSelectionRange(0,0),this.$shareMessage.attr("placeholder",""),this.$submitButton.attr("disabled",!1),this.$shareForm.addClass("twitter"),d.validateTwitter(this.$shareMessage.val(),this.$characterCount),this.$shareForm.hasClass("active")&&this.placeholderSupported&&(this.$shareMessage.focus(),this.$shareMessage.get(0).setSelectionRange(0,0))):this._shareTwitterFallback()},_shareTwitterFallback:function(){window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(this.tinyUrl||this.url),"twitter-share-dialog","width=626,height=258");var t=this._getGenericShareData();this.model.shareTwitter(t),this.resetAndHide()},_shareFacebook:function(){!this.options.forceSocialFallback&&this.hasFacebook?this.model.facebookStatus().done(s.bind(this._shareFacebookSuccess,this)).fail(s.bind(this._shareFacebookFallback,this)):this._shareFacebookFallback()},_shareFacebookSuccess:function(t){t?(this.$serviceCancel.show(),this.$submitButton.html(this.$submitButton.data("label")),this.$shareForm.data("type","facebook"),this.$shareLabel.text(t),this.$submitButton.attr("disabled",!1),this.$shareForm.addClass("facebook"),this.$shareOptions.toggleClass("active"),this.$shareForm.toggleClass("active"),this.$shareForm.hasClass("active")&&this.placeholderSupported&&this.$shareMessage.focus()):this._shareFacebookFallback()},_shareFacebookFallback:function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(this.url),"facebook-share-dialog","width=626,height=436");var t=this._getGenericShareData();this.model.shareFacebook(t),this.resetAndHide()},_sharePinterest:function(){var t=this.model.get("pinterest_share_window");window.open(t.url,t.name,t.dimensions);var e=this._getGenericShareData();this.model.sharePinterest(e),this.resetAndHide()},_toggleEmailForm:function(){return this.options.forceEmailFallback||!this.model.get("has_user")?void this._emailFormFallback():(this.$submitButton.html(this.$submitButton.data("label")),this.$shareForm.data("type","email"),this.$shareOptions.toggleClass("active"),this.$shareForm.toggleClass("active"),this.$replyTo.addClass("active"),void(this.$shareForm.hasClass("active")&&this.$emailAddress.length&&this.$emailAddress.focus()))},_emailFormFallback:function(){var t=this._getGenericShareData();this.model.shareEmail(t);var e="mailto:?body="+this.url;if(this.model.get("embed_key")){var i=window.open();i.document.write('<html><script>location.href = "'+e+'";setTimeout(function(){window.close();},500);</script></html>'),i.document.close()}else window.location.href=e;this.resetAndHide()},_showEmbedCode:function(){this.$serviceCancel.show(),this.$shareForm.data("type","embed"),this.$shareLabel.text(this.$shareLabel.data("embed-label")),this.$shareForm.addClass("active"),this.$shareOptions.removeClass("active"),this.$shareMessage.attr("placeholder",""),this.$shareForm.addClass("embed");var t=this.$shareForm.find(".embed_code_text");t.length&&(t.focus(function(){t.select()}),t.focus())},_fadeoutPopover:function(){setTimeout(s.bind(function(){this.$el.fadeOut(150,s.bind(this.resetAndHide,this))},this),1250)},_cancelOrClose:function(){var t=this.$emailAddress.val()||"";"email"===this.$shareForm.data("type")&&t.length?(this.$emailAddress.val(""),this.$submitButton.attr("disabled",!0)):this.resetForm()},_getGenericShareData:function(){return[{name:"post_id",value:this.model.get("post_id")},{name:"tumblelog_name",value:this.model.get("tumblelog_name")},{name:"share_fallback",value:!0}]},initialize:function(t){this.options=s.extend({},this.defaults,t),this.model=new h(this.options.popoverData),this.listenTo(this.model,"error",this.__submitError),this.listenTo(this.model,"success",this.__submitSuccess)},cacheSelectors:function(){this.$shareForm=this.$(".share_form"),this.$shareLabel=this.$(".share_label"),this.$replyTo=this.$(".reply_to"),this.$shareOptions=this.$(".share_options"),this.$submitButton=this.$("button.email_submit"),this.$emailAddress=this.$(".email_address"),this.$shareMessage=this.$(".share_message"),this.$embedCode=this.$(".embed_code_text"),this.$characterCount=this.$(".character_count"),this.$serviceCancel=this.$(".cancel.service"),this.$status=this.$(".status"),this.$errorStatus=this.$(".error_status"),this.$statusMessage=this.$(".status_message"),this.$replyToInput=this.$(".reply_to_input"),this.sentText=this.$status.data("sent")||"",this.errorText=this.$status.data("error")||"",this.$(".share_twitter").length&&(this.twitterUsername=this.$(".share_twitter").data("twitter-username")),this.$(".share_facebook").length&&(this.hasFacebook=this.$(".share_facebook").data("has-facebook")),this.url=this.$shareOptions.data("post-url"),this.tinyUrl=this.$shareOptions.data("post-tiny-url"),this.tumblelogName=this.$shareOptions.data("tumblelog-name"),this.embedKey=this.$shareOptions.data("embed-key"),this.postId=this.$shareOptions.data("post-id"),this.rootId=this.$shareOptions.data("root-id")},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.cacheSelectors(),this.$replyToInput.prop("checked","true"===r.get("share_popover_reply_to")),this},resetForm:function(){this.$serviceCancel.hide(),this.$submitButton.html(this.$submitButton.data("label")),this.$submitButton.attr("disabled",!0),this.$emailAddress.val(""),this.$shareMessage.val(""),this.$shareMessage.attr("placeholder",this.$shareMessage.attr("title")),this.$shareOptions.addClass("active"),this.$shareForm.removeClass("active"),this.$shareForm.removeClass("facebook"),this.$shareForm.removeClass("twitter"),this.$shareForm.removeClass("embed"),this.$status.hide(),this.$statusMessage.html(this.sentText),this.$replyTo.removeClass("active"),this.$errorStatus.removeClass("active"),this.$el.show()},resetAndHide:function(){this.resetForm(),this.teardown()},submitForm:function(){var t=this.$shareForm.serializeArray();switch(this.$shareForm.data("type")){case"facebook":this.model.shareFacebook(t);break;case"twitter":this.model.shareTwitter(t);break;default:this.model.shareEmail(t)}this.$submitButton.attr("disabled",!0),this.$submitButton.html(this.$submitButton.data("label-sending"))},teardown:function(){return this.__resumeKeyCommands(),this.$el.remove(),this}},{placeholderSupport:function(){var t=document.createElement("input");return"placeholder"in t},validateEmail:function(t){var e=/\S+@\S+\.\S+/;return e.test(t)},validateTwitter:function(t,e){var i=t.match(/\[URL\]/gi),s=i?24*i.length:0,o=140-t.length-s,n=e&&e.length?e:!1;return n&&(n.removeClass("character-limit").html(o),10>o&&n.addClass("character-limit")),0>o||140===o?!1:!0}});e.exports=d},{"../models/share-popover":329,"../templates/share-popover.tpl":332,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/mixins/popoverbase":432,"prima/utils/cookie":446,"prima/view":460}],337:[function(t,e){"use strict";function i(t){return"string"==typeof t||t&&"object"==typeof t&&"[object String]"==u.call(t)||!1}function s(){var t=new m;return t.cid=g,g+=1,f[t.cid]=t,t}function o(t,e){for(var i,s=_.length-1;s>=0;s--)_[s].message_callback(t,e);for(s=v.length-1;s>=0;s--)i=v[s],i&&i.shouldRespond&&i.shouldRespond(t,e)&&i.cb(t,e)}function n(t){var e=this;if(t.cid_response&&t.cid_response in f){var i=f[t.cid_response];
i.resolve.call(null,e,t.response),delete f[t.cid_response]}}function r(t){if(t||(t={}),!(h&&h.stringify&&h.parse))throw"Must have JSON parsing and stringify";if(t.iframe&&(t.window=t.iframe.contentWindow,!t.origin)){var e=t.iframe.src,i=e.match(/^(http(?:s)?:\/\/[\w_\-\.]+(?::\d+)?)\/?/);i&&(t.origin=i[1])}this.namespace=t.namespace?t.namespace+":":"",this.origin=t.origin||"*",this.responders={_method_callback_responder:n,_syn:c(this._syn,this)},this._on_connected=new p,this._unanswered_calls={},this.on_connection(c(this.enable_sending_post_message,this)),_.push(this),t.window&&this.setWindow(t.window)}function a(t,e,i){i||(i=this.origin),t.postMessage(e,i)}var l=t("prima/utils/clean-window-object"),h=l("JSON",function(t){return t&&t.stringify}),d=[].slice,c=function(t,e){return function(){return t.apply(e,arguments)}},u=Object.prototype.toString,p=t("./utils/one_time_event"),m=t("./utils/deferred"),g=1,f={},_=[],v=[];!function(){var t=window.addEventListener?"addEventListener":"attachEvent",e=window[t],i="attachEvent"===t?"onmessage":"message";e(i,function(t){var e;if("string"==typeof t.data){try{t.data&&"{"===t.data[0]&&(e=h.parse(t.data))}catch(i){}e&&e.method&&o(t,e)}},!1)}(),r.prototype.setWindow=function(t){if(t){this.window=t;var e=this.call("_syn");e.then(c(function(t,e){"ack"===e&&this._is_connected()},this))}},r.on=function(t,e){var i;i="*"===t?function(){return!0}:"*"===t[t.length-1]?function(e,i){return 0===i.method.indexOf(t.substring(0,t.length-2))}:function(e,i){return i.method===t},v.push({shouldRespond:i,cb:e})},r.off=function(t){for(var e,i=v.length-1;i>=0;i--)if(v[i].cb===t){e=i;break}return e&&e>-1?(v.splice(e,1),!0):!1},r.prototype.match_origin=function(t){return"*"===this.origin?!0:this.origin===t},r.prototype.message_callback=function(t,e){var s;if((!this.window||t.source===this.window)&&this.match_origin(t.origin)){if(e.method&&e.method.slice(0,this.namespace.length)===this.namespace&&(s=e.method.slice(this.namespace.length,e.method.length)),e.args&&i(e.args))try{e.args=h.parse(e.args)}catch(o){return}this.call_responder(s,t,e)}},r.prototype.call_responder=function(t,e,i){var s,o;if(t){if(i.args||(i.args=[]),o=this.responders[t],!o)return this._unanswered_calls[t]||(this._unanswered_calls[t]=[]),void this._unanswered_calls[t].push(arguments);s=o.apply(e,i.args),i.cid&&"_method_callback_responder"!==t&&this.send_to_window(e.source,"_method_callback_responder",{cid_response:i.cid,response:s})}},r.prototype._syn=function(){return this._is_connected(),"ack"},r.prototype._is_connected=function(){this.connected||(this.connected=!0,this._on_connected.trigger(this))},r.prototype.on_connection=function(){return this._on_connected.push.apply(this._on_connected,arguments),this},r.prototype.method=function b(t){var e=this,b=function(){var i=1<=arguments.length?d.call(arguments,0):[];return i.unshift(t),e.send.apply(e,i)};return b},r.prototype.call=function(){var t=1<=arguments.length?d.call(arguments,0):[];return this.window?(t.unshift(this.window),this.call_on_window.apply(this,t)):void console.warn("no window specified on channel")},r.prototype.call_on_window=function(t,e){var i=3<=arguments.length?d.call(arguments,2):[],o=s();try{var n=h.stringify({method:this.namespace+e,args:i,cid:o.cid});"_syn"===e||"_method_callback_responder"===e?a.call(this,t,n):this.send_post_message(t,n)}catch(r){o.reject(r)}return o.promise()},r.prototype.send=function(){var t=1<=arguments.length?d.call(arguments,0):[];return this.window?(t.unshift(this.window),this.send_to_window.apply(this,t)):void console.warn("no window specified on channel")},r.prototype.send_to_window=function(t,e){var i=3<=arguments.length?d.call(arguments,2):[],s=h.stringify({method:this.namespace+e,args:i});"_syn"===e||"_method_callback_responder"===e?a.call(this,t,s):this.send_post_message(t,s)},r.prototype.send_post_message=function(){this._delayed_sent_messages||(this._delayed_sent_messages=[]),this._delayed_sent_messages.push(arguments)},r.prototype.enable_sending_post_message=function(){if(this.send_post_message=a,this._delayed_sent_messages){for(var t=0;t<this._delayed_sent_messages.length;t+=1)a.apply(this,this._delayed_sent_messages[t]);delete this._delayed_sent_messages}},r.prototype.listening_to=function(t){return t in this.responders},r.prototype.listen_to=function(t,e,s){if(i(t)){if(t in this.responders)return void console.warn("already listening to this method, turn it off first");if(s&&(e=c(e,s)),this.responders[t]=e,this._unanswered_calls[t]){var o,n=this._unanswered_calls[t];delete this._unanswered_calls[t];for(var r=0;r<n.length;r+=1)o=n[r],this.call_responder.apply(this,o)}}else{var a=t;for(t in a)a.hasOwnProperty(t)&&this.listen_to(t,a[t],s)}},r.prototype.stop_listen_to=function(t){return"_method_callback_responder"===t?void console.warn("cannot disable the method callback responder"):void delete this.responders[t]},e.exports=r},{"./utils/deferred":338,"./utils/one_time_event":339,"prima/utils/clean-window-object":444}],338:[function(t,e){"use strict";function i(){this._on_resolved=new n,this._on_rejected=new n,this.then=o(this.then,this),this.fail=o(this.fail,this),this.resolve=o(this.resolve,this),this.reject=o(this.reject,this)}var s=[].slice,o=function(t,e){return function(){return t.apply(e,arguments)}},n=t("./one_time_event");i.prototype.then=function(){return this._on_resolved.push.apply(this._on_resolved,arguments),this},i.prototype.success=i.prototype.then,i.prototype.fail=function(){return this._on_resolved.push.apply(this._on_rejected,arguments),this},i.prototype.resolve=function(){return this.resolved||this.rejected?void 0:(this._on_resolved.trigger.apply(this._on_resolved,arguments),this.resolved=!0,this)},i.prototype.reject=function(){return this.resolved||this.rejected?void 0:(this._on_rejected.trigger.apply(this._on_rejected,arguments),this.rejected=!0,this)},i.prototype.reject_timeout=function(){var t=1<=arguments.length?s.call(arguments,0):[],e=t.shift();return setTimeout(o(function(){this.reject.apply(this,t)},this),e),this},i.prototype.promise=function(){function t(){var t=this;this.fail=function(){return e.fail.apply(e,arguments),t},this.then=function(){return e.then.apply(e,arguments),t},this.success=this.then,this.reject_timeout=function(){return e.reject_timeout.apply(e,arguments),t},this.cid=e.cid}var e=this;return new t},e.exports=i},{"./one_time_event":339}],339:[function(t,e){"use strict";function i(){this.length=0}var s=[].slice,o=[].push;i.prototype={slice:s,indexOf:Array.prototype.indexOf},i.prototype.push=function(){if(this.triggered_with)for(var t=1<=arguments.length?s.call(arguments,0):[],e=0;e<t.length;e+=1)t[e].apply(null,this.triggered_with);return o.apply(this,arguments)},i.prototype.trigger=function(){var t=1<=arguments.length?s.call(arguments,0):[],e=this.length;this.triggered_with=t;for(var i=0;e>i;i+=1)this[i].apply(null,this.triggered_with);return this},e.exports=i},{}],340:[function(t,e){"use strict";function i(t,e){return e||(e={}),t.jquery?(e.el=t,e.model||(e.model=new s(e.el.data("json")))):e.model=t instanceof s?t:new s(t),new o(e)}var s=t("app/models/post"),o=t("./views/post_view");e.exports=i},{"./views/post_view":372,"app/models/post":277}],341:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/mixin"),n=function(){for(var t="transform WebkitTransform MozTransform OTransform msTransform".split(" "),e=0;e<t.length;e++)if(void 0!==document.createElement("div").style[t[e]])return!0;return!1}(),r=new o({before:{initialize:function(){this._draggable={dragging:!1,dragX:!1,$doc:i(document),pointerDown:!1,transform:n},this.events=s.extend({"mousedown [data-draggabletags]":"_dragEvents","touchstart [data-draggabletags]":"_dragEvents","touchmove [data-draggabletags]":"_dragEvents","mouseleave [data-draggabletags]":"_dragEvents","mouseup [data-draggabletags]":"_dragEvents","touchend [data-draggabletags]":"_dragEvents","click [data-draggabletags] a":"_dragLinkHandler"},s.result(this,"events")),this.$el.one("mouseenter",s.bind(this._dragSetup,this))}},_dragSetup:function(){this._dragOverflowing()&&this.$el.addClass("draggable")},_dragGetInnerEl:function(){return this._draggable.$dragInner||(this._draggable.$dragInner=this.$("[data-draggabletags]")),this._draggable.$dragInner},_dragOverflowing:function(){return this.$el.width()<this._dragGetInnerEl().width()},_dragCheckMouseOut:function(t){var e=t.relatedTarget||t.toElement;e&&"HTML"!==e.nodeName||this._dragEnd(t)},_dragGetDimensions:function(){var t=this.$el.width(),e=this._dragGetInnerEl().width();return{parentWidth:t,innerWidth:e,maxLeft:0,maxRight:t-e-10}},_dragEvents:function(t){switch(t.type){case"mousedown":case"touchstart":this._dragStart(t);break;case"mousemove":case"touchmove":this._draggable.pointerDown&&this._dragMove(t);break;case"touchend":case"mouseup":this._dragEnd(t)}},_dragBindDocEvents:function(){this._draggable.$doc.on("mousemove.tagsDraggable",s.bind(this._dragEvents,this)),this._draggable.$doc.on("mouseup.tagsDraggable",s.bind(this._dragReset,this)),this._draggable.$doc.on("mouseout",s.bind(this._dragCheckMouseOut,this))},_dragUnbindDocEvents:function(){this._draggable.$doc.off("mousemove.tagsDraggable"),this._draggable.$doc.off("mouseup.tagsDraggable"),this._draggable.$doc.off("mouseout")},_dragLinkHandler:function(t){this._draggable.dragging&&(t.stopPropagation(),t.preventDefault())},_dragStart:function(t){if(t.preventDefault(),!this._draggable.dragging&&!this._draggable.pointerDown&&this._dragOverflowing()){var e=parseInt(this.$el.css("padding-left").replace("px",""));this._draggable.pointerDown=!0,this._draggable.startX=this._dragGetInnerEl().position().left-e,this._draggable.pageX="pageX"in t?t.pageX:t.originalEvent.touches[0].pageX,this._dragBindDocEvents()}},_dragMove:function(t){t.preventDefault(),t.stopPropagation(),this._dragGetInnerEl().addClass("dragging"),this._draggable.dragging=!0;var e=("clientX"in t?t.clientX:t.originalEvent.touches[0].clientX)-this._draggable.pageX;this._draggable.dragX=e+this._draggable.startX,this._dragSet(this._draggable.dragX)},_dragSet:function(t){this._draggable.transform?this._dragGetInnerEl().css("transform","translate("+t+"px, 0)"):this._dragGetInnerEl().css("left",t)},_dragResetPosition:function(){var t=this._dragGetDimensions();this._draggable.dragX>t.maxLeft?this._dragSet(t.maxLeft):this._draggable.dragX<t.maxRight&&this._dragSet(t.maxRight)},_dragEnd:function(t){t.preventDefault(),t.stopPropagation();var e=s.bind(this._dragReset,this);s.delay(e,100)},_dragReset:function(){(this._draggable.dragging||this._draggable.pointerDown)&&(this._draggable.dragging=!1,this._draggable.pointerDown=!1,this._dragGetInnerEl().removeClass("dragging"),this._dragResetPosition(),this._dragUnbindDocEvents())}});e.exports=r},{jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/mixin":420}],342:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/view"),o=t("prima/mixins/subviewable"),n=t("prima/mixins/loggedouthelper"),r=s.extend({mixins:[o,n],initialize:function(t){this.buildSubviews(t.subViews)},buildSubviews:function(t){t||(t={}),i(this.hasSubViews).each(function(e,s){var o=t[s];if(o!==!1){var n={model:this.model,el:this.$('[data-subview="'+s+'"]')};t[s]&&i.isObject(t[s])&&(n.subViews=t[s]);var r=new e(n);i.result(r,"shouldAttachAsSubview")!==!1&&(this.subViews[s]=r)}},this)},attachedToDOM:function(){i(this.subViews).filter("attachedToDOM").invoke("attachedToDOM")},beforeTeardown:function(){return this.stopListening(this.model),this},render:function(){return this.attachSubViews(),this},afterRender:function(){this.renderSubViews()},remove:function(){this.teardown(),s.prototype.remove.apply(this,arguments)}});e.exports=r},{lodash:"K2RcUv","prima/mixins/loggedouthelper":431,"prima/mixins/subviewable":436,"prima/view":460}],343:[function(t,e){"use strict";var i=t("../../../base_view"),s=i.extend({hasSubViews:{}});e.exports=s},{"../../../base_view":342}],344:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("../base_view"),n=o.extend({events:{"click img":"toggle"},initialize:function(t){o.prototype.initialize.call(this,t),this.$("p > .toggle_inline_image").each(function(t,e){s(e).wrap(s('<div class="image_wrapper"></div>'))})},toggle:function(){this.toggleInline(),this.toggleExternal(),this.toggleThumbnail(),this.toggleHighres()},toggleInline:function(){this.$el.find(".toggle_inline_image").toggleClass("inline_image")},toggleExternal:function(){i.each(this.$el.find(".inline_external_image"),function(t){var e=s(t),i=e.attr("external_src");if(e.toggleClass("enlarged"),e.hasClass("enlarged"))e.attr("src",e.attr("original_src"));else{e.attr("original_src",e.attr("src")),e.attr("loader")&&e.attr("src",e.attr("loader"));var o=new Image;o.onload=function(){e.attr("src",i)},o.src=i}})},toggleThumbnail:function(){var t=this.$el.find(".image_thumbnail");if(t.length){var e=t.hasClass("enlarged");t.toggleClass("enlarged"),t.attr("width",t.data(e?"thumbnail-width":"width")),t.attr("height",t.data(e?"thumbnail-height":"height"))}},toggleHighres:function(){this.$el.find(".photo_info").toggleClass("hidden")}});e.exports=n},{"../base_view":342,jquery:"HlZQrA",lodash:"K2RcUv"}],345:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/translate"),o=t("prima/events"),n=t("../base_view"),r=n.extend({events:{click:"_onClick"},className:"expand-post-content",classOnTruncatedEl:"truncated-content",transitionTime:50,initialize:function(t){this.parent=t.parent,this.parent.subViews||(this.parent.subViews={}),this.parent.subViews.expandContent=this,this.$photoPostIcons=this.parent.$(".photo-post-icons")},_onClick:function(){this.expand()},expand:function(){this.parent.$el.velocity(this._parentDesiredCSS(),this.transitionTime,i.bind(function(){o.trigger("post:photo_expanded",this.parent.$el),o.trigger("search:post:photo_expanded",this.parent.$el)},this)),this.$photoPostIcons.velocity({bottom:this.originalPhotoPostBottom},this.transitionTime,i.bind(function(){this.$photoPostIcons.css("bottom",""),this.$photoPostIcons=null},this)),this.$el.velocity({opacity:0},this.transitionTime,i.bind(function(){this.remove(),delete this.parent.subViews.expandContent},this))},_parentTruncatedCSS:function(){return{"max-height":this.parent.limitHeightTo+this.$el.height(),overflow:"hidden"}},_parentDesiredCSS:function(){return{"max-height":this.parent.desiredHeight}},render:function(){if(n.prototype.render.apply(this,arguments),this.$el.attr("data-subview","expandContent"),this.$el.text(s("Expand")),this.parent.$el.after(this.$el),this.parent.$el.css(this._parentTruncatedCSS()),this.$photoPostIcons.length){var t=this.$photoPostIcons[0].offsetTop;if(t>this.parent.limitHeightTo){var e=t-this.parent.limitHeightTo+20;this.originalPhotoPostBottom=parseFloat(this.$photoPostIcons[0].style.bottom),this.$photoPostIcons.css({bottom:e})}}return this}});e.exports=r},{"../base_view":342,lodash:"K2RcUv","prima/events":396,"prima/lib/translate":423}],346:[function(t,e){"use strict";var i=t("prima/events"),s=t("../base_view"),o=s.extend({events:{click:"_onExpand"},_onExpand:function(t){t.preventDefault();var e=this.$el.parent(),s=e.find(".post_media.truncated"),o=s.find("img.photo");this.$el.remove(),s.removeClass("truncated"),s.velocity({"max-height":o.attr("height")},50,function(){i.trigger("post:photo_expanded",e)})}});e.exports=o},{"../base_view":342,"prima/events":396}],347:[function(t,e){"use strict";var i=t("prima/lib/flags"),s=t("../base_view"),o=t("./media_view"),n=t("./body_view"),r=t("./expand_media_view"),a=t("./expand_content_view"),l=s.extend({hasSubViews:{media:o,expand:r,body:n},events:{tumblelogPopover:"__popoverLaunched"},limitHeightTo:400,limitBuffer:150,attachedToDOM:function(){this.limitHeight(),s.prototype.attachedToDOM.apply(this,arguments)},limitHeight:function(){if(this.limitHeightTo&&i.bool("truncate_all_brick_posts")){var t=this.$el.height();if(this.desiredHeight=t,t>this.limitHeightTo+this.limitBuffer){var e=new a({parent:this});e.render()}}},__popoverLaunched:function(){this.subViews.expandContent&&this.subViews.expandContent.expand()}});e.exports=l},{"../base_view":342,"./body_view":344,"./expand_content_view":345,"./expand_media_view":346,"./media_view":348,"prima/lib/flags":"f/LVtH"}],348:[function(t,e){"use strict";function i(t){var e=t.model.get("type");switch(e){case"photo":return new o(t);case"photoset":return new n(t);case"audio":return new r(t);case"video":return new s(t)}}var s=t("./video/media_view"),o=t("./photo/photo_media/photo_media_view"),n=t("./photo/photo_media/photoset_media_view"),r=t("./audio/audio_media/player_view");i.prototype.shouldAttachAsSubview=!1,e.exports=i},{"./audio/audio_media/player_view":343,"./photo/photo_media/photo_media_view":349,"./photo/photo_media/photoset_media_view":350,"./video/media_view":351}],349:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/events"),o=t("../../../base_view"),n=o.extend({events:{click:"_openLightbox"},_openLightbox:function(t){var e=i(t.currentTarget).data("lightbox");e&&(s.trigger("tumblelogPopover:init",[e]),this.$el.trigger("tumblelogPopover",[{opened:!0}]))}});e.exports=n},{"../../../base_view":342,jquery:"HlZQrA","prima/events":396}],350:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/events"),n=t("../../../base_view"),r=t("components/knight-rider-loader"),a=n.extend({events:{click:"displayShownPhotoInLightbox",mouseenter:function(){this.toggleLoader(!0)},mouseleave:function(){this.toggleLoader(!1)}},initialize:function(){this.boundShowNextPhotosetPhotoAndReCycle=s.bind(this.showNextPhotosetPhotoAndReCycle,this),this.loader=new r({variation:"small"}),this.$(".photo-post-icons").append(this.loader.render().$el),this.$deferredImgs=this.$("img[data-src]"),this.$el.hoverIntent({over:s.bind(this.cyclePhotoset,this),out:s.bind(this.stopPhotosetCycle,this),interval:350})},loadDeferreds:function(){this.$deferredImgs.length&&(this.$deferredImgs.imagesLoaded(s.bind(function(){this.toggleLoader(!1),this.$deferredImgs=[],this._cycling&&this.cyclePhotoset()},this)),this.$deferredImgs.each(function(t,e){var s=i(e);s.attr("src",""),s.attr("src",s.data("src"))}))},cyclePhotoset:function(t){return this._cycling=!0,this.$deferredImgs.length?void this.loadDeferreds():(s.isNumber(t)||(t=1300),this._photosetCycleRate||this.showNextPhotosetPhoto(),this._photosetCycleRate=t,this.$photoset().css("background-color","#000"),this._photosetCycleTimeout&&clearTimeout(this._photosetCycleTimeout),this._photosetCycleTimeout=setTimeout(this.boundShowNextPhotosetPhotoAndReCycle,this._photosetCycleRate),void o.trigger("PhotosetMediaView:cycle",{view:this}))},showNextPhotosetPhotoAndReCycle:function(){this.showNextPhotosetPhoto(),this.cyclePhotoset()},showNextPhotosetPhoto:function(){var t=this.$shown().next();t.length||(t=this.$photoset().find(".photoset_photo:first")),this.$shown().removeClass("shown"),t.addClass("shown"),this._$shown=t},stopPhotosetCycle:function(){clearTimeout(this._photosetCycleTimeout),this._photosetCycleRate=null,this._cycling=!1,this.$photoset().css("background-color",""),this.toggleLoader(!1)},$photoset:function(){return"_$photoset"in this||(this._$photoset=this.$(".photoset_photos")),this._$photoset},$shown:function(){return this._$shown&&this._$shown.length||(this._$shown=this.$photoset().find(".photoset_photo.shown")),this._$shown&&this._$shown.length||(this._$shown=this.$photoset().find(".photoset_photo:last").addClass("shown")),this._$shown},toggleLoader:function(t){this.$deferredImgs.length&&(this.loader.set("loading",t),this.$el.toggleClass("loading-deferred-images",t))},displayShownPhotoInLightbox:function(){var t=this.$shown().data("lightbox"),e=s.collect(this.$photoset().find("[data-lightbox]"),function(t){return i(t).data("lightbox")}),n=s.indexOf(e,t);o.trigger("tumblelogPopover:init",e,n+1),this.stopPhotosetCycle(),this.$el.trigger("tumblelogPopover",[{opened:!0}])}});e.exports=a},{"../../../base_view":342,"components/knight-rider-loader":324,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396}],351:[function(t,e){"use strict";function i(t){var e=s(t.el),i=e.find("video[data-crt-video]");return i.length?(t.$video=i,new o(t)):new n(t)}var s=t("jquery"),o=t("./native_media_view"),n=t("./poster_media_view");e.exports=i},{"./native_media_view":352,"./poster_media_view":353,jquery:"HlZQrA"}],352:[function(t,e){"use strict";var i=t("components/crt"),s=t("../../base_view"),o=s.extend({initialize:function(t){this.$video=t.$video||this.$("video[data-crt-video]"),this.video=this.$video[0],this.video&&i.playerFactory([this.video])}});e.exports=o},{"../../base_view":342,"components/crt":301}],353:[function(t,e){"use strict";var i=(t("jquery"),t("../../base_view")),s=i.extend({events:{click:"toggleVideoPlayer"},toggleVideoPlayer:function(){var t=this.$(".video_embed"),e=t.data("render-context"),i=this.$("script.embed_source");return"blank"===e?void window.open(t.data("post-url")):void(i.length&&(this.$(".video_poster").hide(),i.parent().html(i.html())))}});e.exports=s},{"../../base_view":342,jquery:"HlZQrA"}],354:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":342}],355:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":342}],356:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":342}],357:[function(t,e){"use strict";var i=t("../../base_view"),s=t("./share_menu_view"),o=t("./admin_menu_view"),n=t("./creator_menu_view"),r=t("./sponsor_menu_view"),a=t("./ignore_view"),l=t("./photo_reply_view"),h=t("./reply_view"),d=t("./reblog_view"),c=t("./like_view"),u=i.extend({hasSubViews:{shareMenu:s,adminMenu:o,creatorMenu:n,sponsorMenu:r,ignore:a,photoReply:l,reply:h,reblog:d,like:c}});e.exports=u},{"../../base_view":342,"./admin_menu_view":354,"./creator_menu_view":355,"./ignore_view":356,"./like_view":359,"./photo_reply_view":360,"./reblog_view":361,"./reply_view":362,"./share_menu_view":363,"./sponsor_menu_view":364}],358:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="post_animated_heart post_poof'+(null==(__t=liked?"":" unliked")?"":__t)+'"><span class="heart_left"></span><span class="heart_right"></span></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],359:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=t("../../base_view"),n=t("prima/mixins/loggedouthelper"),r=t("prima/events"),a=t("./like_button_heart.tpl"),l=o.extend({heartTemplate:a,mixins:[n],events:function(){return{click:this.isLoggedIn()?"onClick":this.redirect("/register?redirect_to=/explore")}},initialize:function(){this.listenTo(this.model,"like:set",this.updateLikeStatus),this.listenTo(this.model,"unlike:set",this.updateLikeStatus),this.render()},onClick:function(t){t.preventDefault(),this._liked()?(this.model.unlike(),this._logUnlike()):(this.model.like(),this._logLike())},render:function(){return this},_liked:function(){return this.model.get("liked")},updateLikeStatus:function(){var t=this._liked();this.$el.toggleClass("liked",t);var e=s(this.heartTemplate({liked:t}));this.$el.append(e),i.delay(function(){e.fadeOut(200,function(){e.remove()})},300)},_logLike:function(){r.trigger("post:like:set",{loggingData:{blog:this.model.get("tumblelog"),post_id:this.model.id,position:this.model.get("collection_index"),initiator:"post_masonry"}})},_logUnlike:function(){r.trigger("post:unlike:set",{loggingData:{blog:this.model.get("tumblelog"),postId:this.model.id,position:this.model.get("collection_index"),initiator:"post_masonry"}})}});e.exports=l},{"../../base_view":342,"./like_button_heart.tpl":358,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/mixins/loggedouthelper":431}],360:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":342}],361:[function(t,e){"use strict";var i=t("lodash"),s=t("jquery"),o=(t("prima/lib/flags"),t("prima/mixins/accessor")),n=t("../../base_view"),r=t("prima/mixins/loggedouthelper"),a=t("prima/events"),l=n.extend({mixins:[o,r],events:function(){return{click:this.isLoggedIn()?"onClick":this.redirectLink()}},initialize:function(){this.listenTo(this.model,"fastreblog:success",this.onFastReblogged),this.render()},render:function(){return this.$el.toggleClass("reblogged",!!this.get("startedFastReblog")||!!this.model.get("reblogged")),this.$el.toggleClass("queued",!!this.get("fastRebloggedQueue")),this.started_fast_reblog=!1,this},onClick:function(t){return event.preventDefault(),this._logReblog(),t.altKey&&!this.model.reblogged?(this.set("startedFastReblog",!0),this.model.fastReblog()):this.model.reblog()},onFastReblogged:function(t){this.set("fastReblogQueue",t);var e=s('<div class="post_reblog_poof post_poof"></div>');t&&e.addClass("queue"),this.get("startedFastReblog")||this.$el.height()>s(window).height()&&e.css("top",.5*s(window).height()),this.$el.append(e),i.delay(function(t){e.fadeOut(200,function(){e.remove(),t.render()})},300,this)},_logReblog:function(){a.trigger("post:log-reblog",{loggingData:{blog:this.model.get("tumblelog"),post_id:this.model.id,position:this.model.get("collection_index"),initiator:"post_masonry"}})}});e.exports=l},{"../../base_view":342,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/flags":"f/LVtH","prima/mixins/accessor":425,"prima/mixins/loggedouthelper":431}],362:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":342}],363:[function(t,e){"use strict";var i=t("../../base_view"),s=t("components/popover/views/share-popover"),o=i.extend({events:{click:"openSharePopover"},openSharePopover:function(t){t.preventDefault();var e={popoverData:this.model.get("share_popover_data"),pinnedTarget:this.$el};this.popover=new s(e),this.popover.render()}});e.exports=o},{"../../base_view":342,"components/popover/views/share-popover":336}],364:[function(t,e){"use strict";var i=t("../../base_view"),s=i.extend({});e.exports=s},{"../../base_view":342}],365:[function(t,e){"use strict";var i=t("../base_view"),s=t("./controls"),o=t("./notes_view"),n=i.extend({hasSubViews:{controls:s,notes:o}});e.exports=n},{"../base_view":342,"./controls":357,"./notes_view":366}],366:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/events"),o=t("../base_view"),n=o.extend({events:{"click .note_count":"showNotes","click .note .follow":"followFromNote"},initialize:function(){this.bindEvents()},bindEvents:function(){this.listenTo(this.model,"change:liked",this.updateCount)},render:function(){this.$notesLabel=this.$el.find(".note_link_current")},updateCount:function(t,e){var i,s=this.$notesLabel.text();e?(i=this.$notesLabel.data("more"),this.$notesLabel.data("less",s)):(i=this.$notesLabel.data("less"),this.$notesLabel.data("more",s)),this.$notesLabel.text(i),this.$notesLabel.attr("title",i)},showNotes:function(t){s.trigger("useraction:click:post:notes",{event:t})},followFromNote:function(t){t.preventDefault();var e=i(t.currentTarget),o=e.closest(".note"),n=o.data("tumblelog");if(n){if(!this.isLoggedIn())return void window.open("/follow/"+n);o.addClass("is_following"),s.trigger("useraction:click:notes:follow",n)}}});e.exports=n},{"../base_view":342,jquery:"HlZQrA","prima/events":396}],367:[function(t,e){"use strict";var i=t("prima/lib/flags"),s=t("prima/events"),o=t("../base_view"),n=t("components/popover/views/post_moderation_popover"),r=o.extend({events:{click:"onClick"},onClick:function(t){i.bool("abuse_forms")?s.trigger("abuseform:open",{post:this.model}):(t.preventDefault(),this.popover=new n({post:this.model,pinnedTarget:this.$el}),this.popover.render())}});e.exports=r},{"../base_view":342,"components/popover/views/post_moderation_popover":335,"prima/events":396,"prima/lib/flags":"f/LVtH"}],368:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/events"),o=t("prima/view"),n=t("prima/mixins/loggedouthelper"),r=o.extend({mixins:[n],events:function(){return{click:this.isLoggedIn()?"onClick":this.redirect("/register?redirect_to=/explore")}},initialize:function(){this.pt=this.model.get("pt"),this.model=this.model.tumblelog,this.listenTo(this.model,"change:following",this.updateFollowStatus)},onClick:function(t){t.preventDefault(),this._log_follow(),this.model.follow({pt:this.pt,source:"FOLLOW_SOURCE_DISCOVER_POSTS_GRID"})},_log_follow:function(){var t=this.$el.closest("article"),e=JSON.parse(t.attr("data-json"));s.trigger("post:log_follow",{loggingData:{postId:e.id,tumblelog:e.tumblelog,position:t.index()}})},_following:function(){return this.model.get("following")},updateFollowStatus:function(){this._following()?(this.$el.addClass("active animated poof"),i.delay(function(t){t.addClass("final_state")},1e3,this.$el)):this.$el.removeClass("active animated poof final_state")}});e.exports=r},{lodash:"K2RcUv","prima/events":396,"prima/mixins/loggedouthelper":431,"prima/view":460}],369:[function(t,e){"use strict";var i=t("../base_view"),s=t("./follow_view"),o=t("./info_view"),n=t("./flag_view"),r=i.extend({hasSubViews:{follow:s,info:o,flagMenu:n}});e.exports=r},{"../base_view":342,"./flag_view":367,"./follow_view":368,"./info_view":370}],370:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/events"),o=t("prima/mixins/loggedouthelper"),n=t("../base_view"),r=t("components/popover/views/blog_card_popover"),a=n.extend({hidePopoverTimeout:null,mixins:[o],initialize:function(){n.prototype.initialize.apply(this,arguments),this.isLoggedIn()&&this.$el.hoverIntent({over:i.bind(this.showBlogCardPopover,this),out:i.noop,sensitivity:3})},showBlogCardPopover:function(){this.popover&&(this.popover.teardown(),this.popover=null);var t=this.$el.closest("article"),e=JSON.parse(t.attr("data-json"));s.trigger("TumblelogPopover:log_follow_open",{loggingData:{postId:e.id,tumblelog:e.tumblelog,position:t.index()}}),this.popover=new r({model:this.model.tumblelog,pinnedTarget:this.$el}),this.popover.openPopover()},hideBlogCardPopover:function(){this.popover&&this.popover.closePopover()},teardown:function(){this.$el.off("mouseenter mouseleave")}});e.exports=a},{"../base_view":342,"components/popover/views/blog_card_popover":333,lodash:"K2RcUv","prima/events":396,"prima/mixins/loggedouthelper":431}],371:[function(t,e){"use strict";var i=t("../base_view"),s=t("components/post/mixins/draggabletags"),o=i.extend({mixins:[s]});e.exports=o},{"../base_view":342,"components/post/mixins/draggabletags":341}],372:[function(t,e){"use strict";var i=t("prima/events"),s=t("./base_view"),o=t("./header"),n=t("./content"),r=t("./footer"),a=t("./post_tags"),l=s.extend({hasSubViews:{header:o,content:n,footer:r,tags:a},initialize:function(){s.prototype.initialize.apply(this,arguments),this.render()},render:function(){return s.prototype.render.apply(this,arguments),this.bindEvents(),this},bindEvents:function(){this.listenTo(i,"flagged:"+this.model.tumblelog.get("name"),this.onFlagged)},onFlagged:function(){this.$el.addClass("is_flagged")}});e.exports=l},{"./base_view":342,"./content":347,"./footer":365,"./header":369,"./post_tags":371,"prima/events":396}],373:[function(t,e){"use strict";var i,s=t("prima/component"),o=(t("store"),t("./models/dot")),n=t("./views/dot"),r=t("./views/popover"),a=s.extend({name:"TumblrDot",autoAppend:!0,view:function(){var t=new o(this.data),e=new r({model:t,popoverContainer:this.container,pinnedSide:"top",pinnedTarget:this.container,shift:{x:-10,y:0}}),i=new n({el:this.container,model:t,popoverView:e});return i},append:function(){return this.view.render(),this}});e.exports=function(){return i||(i=new a),i}},{"./models/dot":374,"./views/dot":380,"./views/popover":381,"prima/component":395,store:481}],374:[function(t,e){"use strict";var i=t("prima/model"),s=i.extend({defaults:{approved:!1,avatar_url:"",frame_count:0,frame_height:16,frame_rate:30,frame_width:22,following:!1,image:!1,image_url:"",is_animated:!1,locale:"US",name:"",premium:!1,premium_tumblelog:!1,premium_tumblelog_id:0,pt:"",search_text:"","serve-id":"",styles:"",timing:"",title:"",tooltip:"",tooltip_offset:"",tumblelog_url:"",url:""}});
e.exports=s},{"prima/model":439}],375:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<span class="tumblr-dot pt" style="'+(null==(__t=styles)?"":_.escape(__t))+'" data-pt="'+(null==(__t=pt)?"":_.escape(__t))+'"><a class="tumblr-dot-link" href="'+(null==(__t=url)?"":_.escape(__t))+'"></a></span>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],376:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<span class="tumblr-dot" style="'+(null==(__t=styles)?"":_.escape(__t))+'"><a class="tumblr-dot-link" href="'+(null==(__t=url)?"":_.escape(__t))+'"></a></span>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],377:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover tumblr-dot-popover"><div class="popover-inner"><div class="tumblr-dot-heading heading-plain">'+(null==(__t=tooltip)?"":__t)+"</div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],378:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover tumblr-dot-popover"><div class="popover-inner"><div class="tumblr-dot-heading">'+(null==(__t=tooltip)?"":__t)+'</div><div class="tooltip-sponsored-blog"><ul class="tumblelog-list"><li class="item"><a href="'+(null==(__t=tumblelog_url)?"":__t)+'" class="follow-item-list-blog blog'+(null==(__t=following?"":" has-follow-button")?"":__t)+'" target="_blank" data-peepr="{&quot;tumblelog&quot;:&quot;'+(null==(__t=premium_tumblelog)?"":_.escape(__t))+'&quot;}"><div class="hide-overflow"><span class="tumblelog-name">'+(null==(__t=premium_tumblelog)?"":__t)+'</span> <small class="tumblelog-title">'+(null==(__t=title)?"":__t)+'</small></div><div class="avatar" style="background-image:url(\''+(null==(__t=avatar_url)?"":__t)+'\')"><img src="'+(null==(__t=avatar_url)?"":__t)+'" class="avatar-img" alt=""></div></a>',following||(__p+=' <a class="follow plus-follow-button" href="/follow/'+(null==(__t=premium_tumblelog)?"":__t)+'" data-tumblelog-name="'+(null==(__t=premium_tumblelog)?"":__t)+'" data-follow-source="FOLLOW_SOURCE_DOT_POPOVER" title="Follow"><span class="icon_plus follow_icon"></span></a>'),__p+="</li></ul></div></div></div>";return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],379:[function(require,module,exports){var _=require("lodash");module.exports=Function(_.keys(_.templateSettings.imports),"return "+function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="popover tumblr-dot-popover"><div class="popover-inner"><div class="tumblr-dot-heading">'+(null==(__t=tooltip)?"":__t)+'</div><a class="tumblr-dot-search" href="'+(null==(__t=url)?"":_.escape(__t))+'"><i class="icon_search dot_tooltip_left"></i>'+(null==(__t=search_text)?"":_.escape(__t))+' <i class="icon_arrow_carrot_right dot_tooltip_right"></i></a></div></div>';return __p}.toString()).apply(void 0,_.values(_.templateSettings.imports))},{lodash:"K2RcUv"}],380:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/view"),n=t("prima/events"),r=t("prima/mixins/generate-logging-data"),a=t("prima/mixins/renderable"),l=t("../templates/dot/dot.tpl"),h=t("../templates/dot/dot-premium.tpl"),d=o.extend({events:{mouseenter:"onEnter",mouseleave:"onLeave",click:"onClick"},mixins:[a,r],initialize:function(t){this.template=this.getTemplate(),this.appendDisplayData(this.model),this.setSearchTextData(this.model),this.model.get("is_animated")&&this.initAnimation(),this.popoverView=t.popoverView},getTemplate:function(){return this.model.get("premium")||this.model.get("search_text")?h:l},appendDisplayData:function(t){var e='background-image:url("'+t.get("image_url")+'");';t.get("frame_count")&&(e+=" background-size:"+t.get("frame_count")*t.get("frame_width")+"px "+t.get("frame_height")+"px;"),t.set("styles",e)},setSearchTextData:function(t){if(t.get("search_text")){var e=t.get("search_text");"string"==typeof e?t.set("search_text",e):t.set("search_text",e[Math.floor(Math.random()*e.length)])}},onEnter:function(){this.popoverView.render(),this.onHover()},onLeave:function(){this.popoverView.teardown()},onHover:s.once(function(){n.trigger("Capture:push","tumblr_dot_usage","hover"),n.trigger("useraction:hover:dot",{model:this.model,loggingData:this.loggingData({userAction:"hover"})})}),onClick:function(t){i(t.target).hasClass("tumblr-dot-link")&&(n.trigger("Capture:push","tumblr_dot_usage","click",{click_location:"dot"}),n.trigger("useraction:click:dot",{model:this.model,loggingData:this.loggingData({userAction:"click_thru"})}))},initAnimation:function(){this.frame_rate=this.model.get("frame_rate"),this.frame_width=this.model.get("frame_width"),this.looping=this.model.get("looping"),this.frame_count=this.model.get("frame_count")-1,this.current_frame=0,this.frame_timing=this.model.get("timing"),this.frame_timing?this.staggerAnimation():setInterval(s.bind(function(){this.updateFrame()},this),1e3/this.frame_rate)},staggerAnimation:function(){this.updateFrame();var t=1e3*this.frame_timing[this.current_frame],e=setTimeout(s.bind(function(){this.staggerAnimation()},this),t);this.looping||this.current_frame!=this.frame_count||clearTimeout(e)},updateFrame:function(){this.current_frame++,this.current_frame>this.frame_count&&(this.current_frame=0),this.$(".tumblr-dot").css({"background-position":"-"+this.current_frame*this.frame_width+"px 0px"})},render:function(){return n.trigger("Capture:push","tumblr_dot_usage","impression"),this.$el.html(this.template(this.model.toJSON())),this}});e.exports=d},{"../templates/dot/dot-premium.tpl":375,"../templates/dot/dot.tpl":376,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/mixins/generate-logging-data":428,"prima/mixins/renderable":434,"prima/view":460}],381:[function(t,e){"use strict";var i=t("jquery"),s=t("prima/view"),o=t("prima/events"),n=t("app/components/dialog"),r=t("prima/mixins/renderable"),a=t("prima/mixins/popoverbase"),l=t("prima/mixins/loggedouthelper"),h=t("prima/mixins/generate-logging-data"),d=t("../templates/popover/popover.tpl"),c=t("../templates/popover/popover-premium.tpl"),u=t("../templates/popover/popover-plain.tpl"),p=t("app/models/tumblelog"),m=s.extend({events:function(){return{"click .follow":this.isLoggedIn()?"followClicked":"loggedOutFollowClicked","click .item":"postsClicked"}},mixins:[r,a,l,h],getTemplate:function(){return this.model.get("premium")?c:this.model.get("url")&&this.model.get("search_text")?d:u},initialize:function(){this.template=this.getTemplate(),this.model.get("premium")&&(this.tumblelog=new p({name:this.model.get("premium_tumblelog"),pt:this.model.get("pt")})),this.logPopoverImpression()},postsClicked:function(t){t.preventDefault(),i(t.target).hasClass("follow_icon")||o.trigger("useraction:click:dot_blog",{model:this.model,loggingData:this.loggingData({userAction:"posts"})})},followClicked:function(t){t.preventDefault();var e=this.$el.find(".follow");this.tumblelog.save_following({following:!0},{source:e.data("follow-source"),pt:this.model.get("pt")}).fail(function(){n.alert("Sorry, we seem to be having technical trouble. Please try again later.")}),e.addClass("follow_poof"),this.model.set("following",!0)},loggedOutFollowClicked:function(t){t.preventDefault(),window.location="/register?redirect_to=/follow/"+this.model.get("premium_tumblelog")},close:function(){this.remove()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},teardown:function(){this.$el.empty()},logPopoverImpression:function(){o.trigger("Capture:push","tumblr_dot_usage","impression:popover")}});e.exports=m},{"../templates/popover/popover-plain.tpl":377,"../templates/popover/popover-premium.tpl":378,"../templates/popover/popover.tpl":379,"app/components/dialog":20,"app/models/tumblelog":278,jquery:"HlZQrA","prima/events":396,"prima/mixins/generate-logging-data":428,"prima/mixins/loggedouthelper":431,"prima/mixins/popoverbase":432,"prima/mixins/renderable":434,"prima/view":460}],382:[function(t,e){"use strict";var i=t("backbone"),s=t("lodash"),o=t("prima/class"),n=t("prima/events"),r=t("prima/lib/logger"),a=[];a.push(t("prima/lib/loglady/endpoints/cslogger"));var l=/^\/(.+)\/([gimy]*)$/,h=o.extend({constructor:function(){this._eventHandlers=[],this.setupEndpoints(),this.initialize();var t=s.result(this,"events")||{};s(t).each(this._addEventHandlerByString,this);var e=s.result(this,"eventBus");this.listenTo(e,"all",this._handleEvent),r.log("LogLady","[instrument]",this.logKey)},logSpots:a,eventBus:n,_addEventHandlerByString:function(t,e){var i,s=e.match(l);if(s){var o=new RegExp(s[1],s[2]);i=function(t){var e=t.match(o);if(e){for(var i=new Array(e.length-1),s=0;s<e.length;s+=1)s>0&&(i[s-1]=e[s]);return i}}}else if("*"===e[e.length-1]){var n=e.substring(0,e.length-1);i=function(t){var e=t.indexOf(n);return 0===e?[t.substring(n.length,t.length)]:void 0}}else i=function(t){return t===e?[t]:null};this._addEventHandler(t,i)},_addEventHandler:function(t,e){this._eventHandlers.push({method:t,matcher:e})},_handleEvent:function(t,e){for(var i,o,n,r=this._eventHandlers.length-1;r>=0;r--)i=this._eventHandlers[r],n=i.callback||this[i.method],n&&(o=i.matcher.call(this,t,e),s.isArray(o)&&(e&&e.loggingData&&o.push(s.cloneDeep(e.loggingData)),n.apply(this,o)))},setupEndpoints:function(){var t=s.result(this,"logSpots");this.loggers=s(t).map(function(t){return t(this)},this).compact().value()},initialize:s.noop,log:function(){for(var t=this.loggers.length-1;t>=0;t--){var e=this.loggers[t];e.trigger.apply(e,arguments)}}},{start:function(){return this._setupInstance||(this._setupInstance=new this),this._setupInstance}});s.extend(h.prototype,i.Events),e.exports=h},{backbone:"5kFNoY",lodash:"K2RcUv","prima/class":393,"prima/events":396,"prima/lib/logger":403,"prima/lib/loglady/endpoints/cslogger":408}],383:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"dashboard_sharing",events:{"dashboard-share:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){e=e||{},this.log(t,e)}});e.exports=s},{"logs/instruments/base":382}],384:[function(t,e){"use strict";var i=t("lodash"),s=t("logs/instruments/base"),o=s.extend({logKey:"dashboard_embed",events:{"/post:((?:un)?docked)/":"log","post:embed:stateChange":"logStateChange"},logStateChange:function(t,e){if(!i.isEmpty(e)&&e.state&&e.postID&&e.service){if("tumblr"===e.service)return;this.log(e.state,{service:e.service,post_id:e.postID})}}});e.exports=o},{lodash:"K2RcUv","logs/instruments/base":382}],385:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"helpform",events:{"helpform:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});e.exports=s},{"logs/instruments/base":382}],386:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"keycommands_trigger",events:{"keycommands:*":"handleEvent"},initialize:function(){this.hasLoggedJK=!1},handleEvent:function(t,e){if("jk"===t){if(this.hasLoggedJK)return;this.hasLoggedJK=!0}this.log(t,e)}});e.exports=s},{"logs/instruments/base":382}],387:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"loginregister",events:{"loginregister:*":"handleEvent"},initialize:function(){this.hasStartedFunnel=!1},logEnv:{actionType:"/login"===document.location.pathname?"login":"register",captchaType:"recaptcha"},handleEvent:function(t,e){if("beginFlow"===t){if(this.hasStartedFunnel)return;this.hasStartedFunnel=!0}this.log(t,e)}});e.exports=s},{"logs/instruments/base":382}],388:[function(t,e){"use strict";var i=t("logs/instruments/base"),s=i.extend({logKey:"related_recommendations",events:{"rapid-recommendations:*":"handleEvent"},logEnv:{location:document.location.pathname},handleEvent:function(t,e){this.log(t,e)}});e.exports=s},{"logs/instruments/base":382}],389:[function(t,e){"use strict";var i=t("lodash"),s=t("logs/instruments/base"),o=s.extend({logKey:"vendorbutton",logEnv:{referrer:document.location.pathname},events:{"VendorButton:*":"handleEvent"},handleEvent:function(t,e){var s=i.extend({},e);s.post_id=e.postData.id,s.root_post_id=e.postData.root_id,s.tumblelog=e.postData.tumblelog,delete s.postData,this.log(t,s)}});e.exports=o},{lodash:"K2RcUv","logs/instruments/base":382}],390:[function(t,e){"use strict";var i=t("lodash"),s=t("logs/instruments/base"),o=s.extend({logKey:"videoplayer",logEnv:{referrer:document.location.pathname},events:{"VideoPlayer:cacheUnload":"cacheUnloadLog","VideoPlayer:timeupdate":"updateLogCache","VideoPlayer:*":"log"},initialize:function(){this.excludedEvents=["cacheUnload","timeupdate"],this.unloadData={},i.each(this.loggers,function(t){t.before_unloaded=i.bind(this.beforeUnloaded,this)},this)},log:function(t){i.contains(this.excludedEvents,t)||s.prototype.log.apply(this,arguments)},cacheUnloadLog:function(t,e){this.unloadData[e.id]=e},beforeUnloaded:function(){i.each(this.unloadData,function(t){this.log("unload",t)},this)},updateLogCache:function(t,e){var s=["elapsed","position"];this.unloadData[e.id]=i.extend(this.unloadData[e.id],i.pick(e,s))}});e.exports=o},{lodash:"K2RcUv","logs/instruments/base":382}],391:[function(t,e){"use strict";var i=t("lodash"),s={loadedLogs:[],init:function(){},startLogs:function(t){i.each(t,function(t){var e=t.start();this.loadedLogs.push(e.logKey)},this)},startLog:function(t){this.startLogs([t])}};e.exports=s},{lodash:"K2RcUv"}],392:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/class"),o=t("prima/lib/data"),n=t("prima/lib/logger"),r=t("prima/lib/translate"),a=t("prima/lib/templateutils"),l=t("logs/logging-manager"),h=s.extend({constructor:function(t){this.setup(t),this.initialize()},setup:function(t){o.setup(t),n.log("Exec","Bootstrap/Data"),r.setup(t.Translations),n.log("Exec","Bootstrap/Translations"),l.init(),n.log("Exec","Bootstrap/logs")},initialize:function(){throw new Error("No router defined")}});i.extend(i.templateSettings.imports,a),e.exports=h},{lodash:"K2RcUv","logs/logging-manager":391,"prima/class":393,"prima/lib/data":398,"prima/lib/logger":403,"prima/lib/templateutils":421,"prima/lib/translate":423}],393:[function(t,e){"use strict";function i(){}var s=t("backbone"),o=t("./lib/extendwithmixins");i.extend=s.Model.extend,o.applyTo(i),e.exports=i},{"./lib/extendwithmixins":402,backbone:"5kFNoY"}],394:[function(t,e){"use strict";var i=t("backbone"),s=t("./mixins/withformkeytrue"),o=t("./lib/extendwithmixins"),n=i.Collection.extend();s.applyTo(n.prototype),o.applyTo(n),e.exports=n},{"./lib/extendwithmixins":402,"./mixins/withformkeytrue":438,backbone:"5kFNoY"}],395:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("./class"),n=t("./lib/data"),r=(t("./lib/logger"),t("./utils/ensure-element")),a=t("./mixins/accessor/simple"),l=["selector","container","rootEl","view","viewOptions","autoAppend"],h=o.extend({name:null,rootEl:null,selector:null,view:null,viewOptions:{},autoAppend:!1,defaults:{},constructor:function(t){t||(t={}),this.cid=i.uniqueId("component"),i.extend(this,i.pick(t,l));var e=i.result(this,"defaults"),o=i.extend({},i.pick(t,i.keys(e)),e);this.attributes={},this.set(o,{silent:!0}),this.changed={},(this.autoAppend||this.selector)&&this.setContainer(),this.selector||(this.selector=this.defaultSelector),this.view&&this.view.prototype&&this.view.prototype instanceof s.View?this.view=new this.view(this.viewOptions):i.isFunction(this.view)&&(this.view=this.view.call(this,this.viewOptions)),this.initialize.apply(this,arguments),this.autoAppend&&this.append()},initialize:i.noop,setContainer:function(){return this.selector||(this.selector=this.defaultSelector),this.container=this.selector,this.container},getOwnData:function(){return this.data},remove:function(){i.result(this,"beforeRemove"),this.view&&i.isFunction(this.view.remove)&&this.view.remove();var t=["container","view","defaults","attributes"];return i.each(t,i.bind(function(t){this[t]&&delete this[t]},this)),this.stopListening(),this.trigger("remove"),this},append:function(){return this.view&&i.isFunction(this.view.render)&&(this.container?this.container.appendChild(this.view.render().el):this.view.render()),this.trigger("append"),this}});Object.defineProperties(h.prototype,{defaultSelector:{get:function(){return"[prima-component="+this.name+"]"},set:function(){}},container:{get:function(){return this._container},set:function(t){var e=r(t,this.rootEl);this._container=e}},data:{get:function(){return this._data||(this._data=n.get("Components/"+this.name)),this._data},set:function(t){this._data=t}}}),a.mixin.applyTo(h.prototype),e.exports=h},{"./class":393,"./lib/data":398,"./lib/logger":403,"./mixins/accessor/simple":426,"./utils/ensure-element":448,backbone:"5kFNoY",lodash:"K2RcUv"}],396:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=function(){};o.extend=s.Model.extend,i.extend(o.prototype,s.Events),o.prototype.trigger=function(){return i.isObject(arguments[1])&&(arguments[1].loggingData=arguments[1].loggingData||{}),s.Events.trigger.apply(this,arguments)},e.exports=new o},{backbone:"5kFNoY",lodash:"K2RcUv"}],397:[function(t,e){"use strict";function i(t,e){this.options=e||{},this._onClick=s.bind(this._onClick,this,t),document.addEventListener("click",this._onClick,!0)}var s=t("lodash"),o=t("jquery"),n=t("backbone");i.prototype._onClick=function(t,e){t===e.target||o.contains(t,e.target)?this.trigger("click:inside"):(this.trigger("click:outside"),this.options.preventInteraction&&(e.preventDefault(),e.stopPropagation()))},i.prototype.remove=function(){return document.removeEventListener("click",this._onClick,!0),this.off(),this},s.extend(i.prototype,n.Events),e.exports=i},{backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv"}],398:[function(t,e){"use strict";function i(t){if(!n)throw new Error("Data hasn't been initialized with `setup`.");if(!r.isString(t))return null;var e=a(n,t.replace(/\//g,"."));return r(e).cloneDeep()}function s(t){if(!n)throw new Error("Data hasn't been initialized with `setup`.");return r.isString(t)?l(n,t.replace(/\//g,".")):null}function o(t){n=r.isObject(t)?t:{}}var n,r=t("lodash"),a=t("../utils/getpath"),l=t("../utils/haspath");e.exports={get:i,has:s,setup:r.once(o)}},{"../utils/getpath":450,"../utils/haspath":451,lodash:"K2RcUv"}],399:[function(t,e){"use strict";function i(t){t=s.extend({entries:{},name:"Dictionary"},t),this._hadLastLookup=!1,this._entries=t.entries,this._name=t.name}var s=t("lodash"),o=(t("./logger"),function(t,e,i){null!=i||(i=this);var s=t.apply(i,e);return e=Array.prototype.slice.call(e,1),e.unshift(s),e});i.prototype.addEntries=function(t){return s.extend(this._entries,t),this},i.prototype.lookup=function(t){return s.has(this._entries,t)?(this._hadLastLookup=!0,this._entries[t]):(this._hadLastLookup=!1,t)},i.prototype.lookupWithFormatting=function(t){var e;return arguments.length>1?(e=this.lookup(s.sprintf.apply(this,arguments)),this._hadLastLookup||(e=s.sprintf.apply(this,o(this.lookup,arguments,this)))):e=this.lookup(t),e},i.prototype.get=function(t){var e=this.lookupWithFormatting.apply(this,arguments);return!this._hadLastLookup,e},i.prototype.getEntries=function(){return s(this._entries).cloneDeep()},e.exports=i},{"./logger":403,lodash:"K2RcUv"}],400:[function(t,e){"use strict";function i(){function t(){o(),d.trigger("DOMEventor:flatresize",p),e=!1}var e;u.on("resize.DOMEventor-nextResizeLoop",function(){e||(g(t),e=!0)})}function s(){function t(){i--||(m.documentHeight=p.documentHeight,p.documentHeight=c.height(),i=1),m.windowScrollTop=m.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=u.scrollTop(),d.trigger("DOMEventor:flatscroll",p),e=!1}var e,i=0;u.on("scroll.DOMEventor-nextScrollLoop",function(){e||(g(t),e=!0)})}function o(){m.documentHeight=p.documentHeight,p.documentHeight=c.height(),m.windowHeight=p.windowHeight,p.windowHeight=u.height(),m.windowWidth=p.windowWidth,p.windowWidth=u.width(),m.windowScrollTop=m.windowScrollY=p.windowScrollTop,p.windowScrollTop=p.windowScrollY=u.scrollTop()}function n(){var t=[],e={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"leftmeta",92:"rightmeta",93:"rightmeta",96:"num0",97:"num1",98:"num2",99:"num3",100:"num4",101:"num5",102:"num6",103:"num7",104:"num8",105:"num9",106:"multiply",107:"add",109:"subtract",110:"decimal",111:"devide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"forwardslash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebracket",222:"singlequote"};c.on("keydown.DOMEventor keyup.DOMEventor",function(i){var s=i.type;if("keyup"===s||"keydown"===s){var o=h(i.target),n=i.which;if(!((o.is("input")||o.is("textarea")||o.is("select"))&&n>=48&&90>=n)||i.metaKey||i.ctrlKey||i.altKey){n>=48&&90>=n&&"keydown"===s&&(t[n]=1);var r="";for(var a in t)"keydown"===s&&n!==parseInt(a,10)&&(r+=e[a]?e[a]+"+":"");var l=s+":"+(i.altKey&&18!==n?"alt+":"")+(i.ctrlKey&&17!==n?"ctrl+":"")+(i.metaKey&&91!==n&&92!==n&&93!==n?"meta+":"")+(i.shiftKey&&16!==n?"shift+":"")+(r||"")+(e[n]||"");d.trigger("DOMEventor:"+l,i,l),"keyup"===s&&(t=[])}}}),d.off("DOMEventor:startKeyboardObserver"),d.on("DOMEventor:stopKeyboardObserver",r)}function r(){c.off("keydown.DOMEventor keyup.DOMEventor"),d.on("DOMEventor:startKeyboardObserver",n),d.off("DOMEventor:stopKeyboardObserver")}function a(){o(),s(),i(),n(),d.on("DOMEventor:updateRect",o)}var l=t("lodash"),h=t("jquery"),d=t("../events"),c=h(document),u=h(window),p={},m={};p.documentHeight=m.documentHeight=null,p.windowHeight=m.windowHeight=null,p.windowWidth=m.windowHeight=null,p.windowScrollTop=m.windowScrollTop=null,p.windowScrollY=m.windowScrollY=null;var g=!Object.hasOwnProperty.call(window,"requestAnimationFrame")&&window.requestAnimationFrame||!Object.hasOwnProperty.call(window,"webkitRequestAnimationFrame")&&window.webkitRequestAnimationFrame||!Object.hasOwnProperty.call(window,"mozRequestAnimationFrame")&&window.mozRequestAnimationFrame||!Object.hasOwnProperty.call(window,"oRequestAnimationFrame")&&window.oRequestAnimationFrame||function(t){window.setTimeout(function(){t()},50)},f={init:l.once(a),rect:function(){return p},lastRect:function(){return m}};e.exports=f},{"../events":396,jquery:"HlZQrA",lodash:"K2RcUv"}],401:[function(t,e){"use strict";function i(t){function e(){n.removeEventListener("DOMContentLoaded",e),t()}n.addEventListener("DOMContentLoaded",e)}function s(t){o||(o=/^loaded|^i|^c/.test(n.readyState)),o?setTimeout(t):i(t)}var o,n=document;e.exports=s},{}],402:[function(t,e){"use strict";function i(t){var e=n.apply(this,arguments);return o.has(t,"mixins")&&t.mixins.forEach(function(t){t.applyTo(e.prototype)}),e}function s(t){t.extend=i}var o=t("lodash"),n=t("backbone").Model.extend;e.exports.applyTo=s},{backbone:"5kFNoY",lodash:"K2RcUv"}],403:[function(t,e){"use strict";var i=t("lodash"),s=(t("./domready"),{}),o=function(){return s};s.log=o,s.logSaw=o,s.count=i.noop,s.echo=o,s.flush=o,s.flushCount=o,s.groupNameWithUrl=i.identity,e.exports=s},{"./domready":401,lodash:"K2RcUv"}],404:[function(t,e){"use strict";function i(t){this.watching={},this.pending_events=[],this.endpoint=t.endpoint,t.event_payload_name&&(this.event_payload_name=t.event_payload_name),t.event_filter&&(this.event_filter=t.event_filter),s.bindAll(this,"_flush_from_timeout"),this._flush_from_timeout();var e=t.EventClass||g;this.Log=m.extend({EventClass:e}),o(window).on("beforeunload.log_lady",s.bind(this._flush_on_unload,this))}var s=t("lodash"),o=t("jquery"),n=t("backbone"),r=(t("prima/lib/logger"),t("prima/lib/flags")),a=t("prima/utils/realnow"),l=a.getRealNow,h=t("../utils/extend-with-defaults"),d=t("../utils/uuid"),c=t("../utils/send-beacon"),u=[].slice,p=t("./config"),m=t("./log"),g=t("./logladyphp/event"),f=1e3;s.extend(i.prototype,n.Events,{initialize:s.noop,defaults:{flush_rate:15*f},min_flush_rate:function(){var t=s.map(this.watching,function(t){return s.result(t,"flush_rate")});return t.push(this.defaults.flush_rate),s.min(t)},set_flush_rate:function(t){return t&&(this.defaults.flush_rate=t),this.flush_rate=this.min_flush_rate(),this.flush_is_overdue()&&this._flush_from_timeout(),this.flush_rate},flush:function(){var t=this.build_payload();if(!(t[this.event_payload_name].length<1)&&r.bool("log_lady"))return c(this.endpoint,t,!this.unloading),this.last_flush_at=l(),!0},_flush_on_unload:function(){this._flush_timeout&&clearTimeout(this._flush_timeout),this._trigger_unloads(),this.unloading=!0,this.flush()},_trigger_unloads:function(){var t;for(var e in this.watching)t=this.watching[e],"function"==typeof t.unloaded&&t.unloaded()},_flush_from_timeout:function(){this._flush_timeout&&clearTimeout(this._flush_timeout);var t=this.flush();t!==!1&&(this._flush_timeout=setTimeout(this._flush_from_timeout,this.flush_rate))},flush_is_overdue:function(){this.last_flush_at||(this.last_flush_at=l());var t=l()-this.last_flush_at;return t>this.flush_rate},watch:function(){var t,e,i,o=u.apply(arguments);for(i=0;i<o.length;i++)t=o[i],this.is_valid(t)&&(t.log_lady=this,this.watching[t.log_key]&&(e=this.watching[t.log_key],e&&s.isFunction(e.replaced)&&e.replaced(t)),this.watching[t.log_key]=t);return this.set_flush_rate(),this},pending_log_events:function(){var t=this.pending_events;return this.pending_events=[],t},event_payload_name:"events",event_filter:function(){return!0},build_payload:function(){var t=s.merge({},this.watching,[this]),e=s(t).collect(function(t){return t.pending_log_events()}).flatten().filter(this.event_filter).collect(s.bind(function(t){return t.json},this)).value(),i={};return i[this.event_payload_name]=e,i},is_valid:function(t){var e=!!t;return e&&(e=s.result(t,"log_key")),e&&(e=s.result(t,"uuid")),e&&(e=s.isFunction(t.pending_log_events)),e},log:function(t,e){if(t){if(!(t in this.watching)){e&&e.log_key&&console.warn("log key gets overridden by log name");var i=p("keys",t);e=s.extend({},i,e,{log_key:t});var o=new this.Log(e);this.watch(o)}return this.watching[t]}},new_uuid:d}),i.extend=h,i.Log=m,e.exports=i},{"../utils/extend-with-defaults":417,"../utils/send-beacon":418,"../utils/uuid":419,"./config":406,"./log":410,"./logladyphp/event":412,backbone:"5kFNoY",jquery:"HlZQrA",lodash:"K2RcUv","prima/lib/flags":"f/LVtH","prima/lib/logger":403,"prima/utils/realnow":455}],405:[function(t,e){"use strict";var i,s=t("prima/lib/data"),o=function(){return i||(i=s.get("Components/LogLady")),i};e.exports=o()},{"prima/lib/data":398}],406:[function(t,e){"use strict";function i(){for(var t,e=n.apply(arguments),i=o,r=0;r<e.length;r++){if(t=e[r],!i||!s.has(i,t))return;i=i[t]}return i}var s=t("lodash"),o=t("./bootstrap"),n=[].slice;e.exports=i},{"./bootstrap":405,lodash:"K2RcUv"}],407:[function(t,e){"use strict";function i(t){return o.isString(t)?t:JSON.stringify(t)}function s(t,e,s){this.name=e,this.log_key=o.result(t,"log_key"),this.data=s||null;var n=a(),h=o.result(t,"generate_relative_id"),d=o.result(t,"env"),c=t.uuid,u={category:this.log_key},p=8,m=new Array(p);m[0]=i(n),m[1]=i(l),m[2]=i(c),m[3]=i(h),m[4]=i(r.getElapsed(n)),m[5]=i(e),m[6]=i(s),m[7]=i(d),u.fields=m,this.json=u}var o=t("lodash"),n=t("prima/utils/cookie"),r=t("prima/utils/realnow"),a=r.getRealNow,l=n.get("tmgioct");e.exports=s},{lodash:"K2RcUv","prima/utils/cookie":446,"prima/utils/realnow":455}],408:[function(t,e){"use strict";function i(t){var e=s.result(t,"logKey"),i=s.result(t,"logEnv");if(e){var n=s.result(t,"logOptions")||{};return i&&(n.env=i),o.log(e,n)}}var s=t("lodash"),o=t("./logger");e.exports=i},{"./logger":409,lodash:"K2RcUv"}],409:[function(t,e){"use strict";var i=t("../base"),s=t("./event"),o=new i({EventClass:s,event_payload_name:"payload",event_filter:function(){return!0},endpoint:"/services/cslog"});e.exports=o},{"../base":404,"./event":407}],410:[function(t,e){"use strict";function i(t,e){t.uuid?(e=t,t=e.uuid):e||!t||s.isString(t)||(e=t,t=void 0),this.options=s.extend({},this.defaults,e),delete this.options.log_key,delete this.options.env,delete this.options.uuid,a(this,"uuid",t||this._generate_uuid()),e.env||(e.env={}),s.each(e.flags,function(t){e.env.flags||(e.env.flags={}),e.env.flags[t]=n.bool(t)}),a(this,"env",e.env),this.log_key=e.log_key||this.log_key,this.events=[],this.event_count=0,this.pending_events=[],this.event_counts={},this.started_at||(this.started_at=this.options.started_at||r.getRealNow()),delete this.options.started_at,this.initialize(e),this.options.init_event&&this.trigger("init")}var s=t("lodash"),o=t("backbone"),n=t("prima/lib/flags"),r=t("prima/utils/realnow"),a=t("../utils/define-immutable-property"),l=t("../utils/extend-with-defaults"),h=t("../utils/uuid"),d=t("./config"),c=t("./logladyphp/event");s.extend(i.prototype,o.Events,{EventClass:c,initialize:s.noop,_generate_uuid:function(){return d("default_session")||h()},defaults:{init_event:!0,keep_counts:!1},pending_log_events:function(){var t=this.pending_events;return this.pending_events=[],t},generate_relative_id:function(){return this.event_count},unloaded:function(t){t||(t={}),t=this.before_unloaded(t)||{},this.options.keep_counts&&s.extend(t,{event_counts:this.event_counts}),s.isEmpty(t)||this.trigger("unload",t)},before_unloaded:function(t){return t},replaced:function(t){this.before_replaced(t);for(var e=this.pending_log_events();e.length;)this.log_lady.pending_events.push(e.shift())},before_replaced:s.noop,trigger:function(t,e){var i=new this.EventClass(this,t,e);return this.options.keep_counts&&"init"!==t&&"unload"!==t&&(this.event_counts[t]||(this.event_counts[t]=0),this.event_counts[t]++),this.event_count+=1,this.pending_events.push(i),o.Events.trigger.call(this,t,i,this),this}}),i.extend=l,e.exports=i},{"../utils/define-immutable-property":416,"../utils/extend-with-defaults":417,"../utils/uuid":419,"./config":406,"./logladyphp/event":412,backbone:"5kFNoY",lodash:"K2RcUv","prima/lib/flags":"f/LVtH","prima/utils/realnow":455}],411:[function(t,e){"use strict";var i=t("lodash"),s=t("../config"),o=i.keys(s("keys"));e.exports=function(t){return o.indexOf(t.log_key)>=0}},{"../config":406,lodash:"K2RcUv"}],412:[function(t,e){"use strict";function i(t,e,i){this.name=e,this.log_key=s.result(t,"log_key"),this.data=i||null;var o=n(),a=s.result(t,"generate_relative_id"),l=s.result(t,"env"),h=t.uuid,d={};d.log_key=this.log_key,d.uuid=h,d.event=this.name,d.ts=o,a!==!1&&void 0!==a&&(d.rid=a),d.elapsed=d.ts-r,d.data=this.data,d.env=l,this.json=d}var s=t("lodash"),o=t("prima/utils/realnow"),n=o.getRealNow,r=o.realStartedAt;e.exports=i},{lodash:"K2RcUv","prima/utils/realnow":455}],413:[function(t,e){"use strict";var i=t("prima/events"),s=t("../base"),o=t("./event"),n=t("./event-filter"),r=new s({EventClass:o,event_payload_name:"events",event_filter:n,endpoint:"/svc/log/lady"});i.on("Capture:push",function(t,e,i){r.log(t,{init_event:!1}).trigger(e,i)}),e.exports=r},{"../base":404,"./event":412,"./event-filter":411,"prima/events":396}],414:[function(t,e){"use strict";var i=t("./endpoints/logladyphp/logger");
e.exports=i},{"./endpoints/logladyphp/logger":413}],415:[function(t,e){"use strict";function i(t){var e,s;Object.freeze(t);for(s in t)e=t[s],t.hasOwnProperty(s)&&null!==e&&"object"==typeof e&&!Object.isFrozen(e)&&i(e)}e.exports=i},{}],416:[function(t,e){"use strict";function i(t,e,i){s.isObject(i)&&o(i),Object.defineProperty(t,e,{value:i,writeable:!1,enumerable:!0,configurable:!1})}var s=t("lodash"),o=t("./deepfreeze");e.exports=i},{"./deepfreeze":415,lodash:"K2RcUv"}],417:[function(t,e){"use strict";function i(t,e){var i,o=this;i=t&&s.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},s.extend(i,o,e);var n=function(){this.constructor=i};return n.prototype=o.prototype,i.prototype=new n,t.defaults&&(s.extend(i.prototype.defaults,t.defaults),delete t.defaults),t&&s.extend(i.prototype,t),i.__super__=o.prototype,i}var s=t("lodash");e.exports=i},{lodash:"K2RcUv"}],418:[function(t,e){"use strict";function i(t,e,i){return!!n.ajax({url:t,type:"POST",data:JSON.stringify(e),contentType:"application/json",async:i})}function s(t,e,s){var o=window.navigator.sendBeacon(t,JSON.stringify(e));return o||(o=i(t,e,s)),o}var o,n=t("jquery");o=window.navigator&&window.navigator.sendBeacon?s:i,e.exports=o},{jquery:"HlZQrA"}],419:[function(t,e){"use strict";function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"===t?e:3&e|8;return i.toString(16)})}e.exports=i},{}],420:[function(t,e){"use strict";function i(t,e){h.each(e,function(e,i){var s=t[i];t[i]=function(){return e.apply(this,arguments),s.apply(this,arguments)}})}function s(t,e){h.each(e,function(e,i){var s=t[i];t[i]=function(){var t=s.apply(this,arguments);return e.apply(this,arguments),t}})}function o(t,e){h.each(e,function(e,i){var s=t[i];t[i]=function(){var t=h.toArray(arguments);return t.unshift(h.bind(s,this)),e.apply(this,t)}})}function n(t,e){h.each(e,function(e,i){var s=i in t?t[i]:!1;t[i]=function(){var t=h.toArray(arguments),i=s?h.bind(s,this):h.noop;return t.unshift(i),e.apply(this,t)}})}function r(t,e){h.defaults(t,e)}function a(t,e){h.extend(t,e)}function l(){this.mixins=h.filter(arguments,function(t){return t instanceof l}),this.properties=arguments[this.mixins.length]||{}}var h=t("lodash");l.prototype.mixins=null,l.prototype.properties=null,l.prototype.applyTo=function(t){var e=this.properties;r(t,e.defaults),a(t,e.extend),h.extend(t,h.omit(e,"before","after","around","onto","defaults","extend","applyTo")),h.invoke(this.mixins,"applyTo",t),i(t,e.before),s(t,e.after),o(t,e.around),n(t,e.onto),h.isFunction(e.applyTo)&&e.applyTo.apply(this,arguments)},l.before=i,l.after=s,l.around=o,l.onto=n,e.exports=l},{lodash:"K2RcUv"}],421:[function(t,e){"use strict";{var i=t("prima/lib/translate"),s=t("./subview");t("prima/lib/logger")}e.exports={__:i,_subview:s}},{"./subview":422,"prima/lib/logger":403,"prima/lib/translate":423}],422:[function(t,e){"use strict";e.exports=function(t){return'<noscript data-subview="'+t+'"></noscript>'}},{}],423:[function(t,e){"use strict";function i(t){n.addEntries(s.isObject(t)?t:{})}var s=t("lodash"),o=t("./dictionary"),n=new o({name:"Translations"}),r=s.bind(n.get,n);r.setup=s.once(i),e.exports=r},{"./dictionary":399,lodash:"K2RcUv"}],424:[function(t,e){"use strict";var i=t("jquery"),s={isBlank:function(t){return""===i.trim(t)},minLength:function(t,e){return t.length>=e},maxLength:function(t,e){return t.length<=e},range:function(t,e,i){return t.length>=e&&t.length<=i},pattern:function(t,e){return new RegExp(e,"gi").test(t)?!0:!1},isEmail:function(t){return this.pattern(t,"^[a-zA-Z0-9._+-]+@[a-zA-Z0-9][a-zA-Z0-9.-]*[.]{1}[a-zA-Z]{2,20}$")},equals:function(t,e){return t===e}};e.exports=s},{jquery:"HlZQrA"}],425:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("../../lib/mixin"),n=t("./simple"),r=new o(i.extend({},n.props,{defaults:i.extend({},s.Events),before:{initialize:function(){var t=i.defaults({},i.result(this,"defaults"));this.attributes={},this.set(t),this.changed={}}}}));e.exports=r},{"../../lib/mixin":420,"./simple":426,backbone:"5kFNoY",lodash:"K2RcUv"}],426:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("../../lib/mixin"),n=s.Model.prototype,r={get:n.get,has:n.has,set:n.set,unset:n.unset,clear:n.clear,hasChanged:n.hasChanged,changedAttributes:n.changedAttributes,previous:n.previous,toJSON:n.toJSON,toggle:function(t){this.set(t,!this.get(t))},_validate:i.constant(!0)},a=new o(i.extend({},r,{defaults:i.extend({},s.Events)}));e.exports={props:r,mixin:a}},{"../../lib/mixin":420,backbone:"5kFNoY",lodash:"K2RcUv"}],427:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/mixin"),o=new s({delegateObject:function(t){var e={},o={};t&&(i.each(t,function(t,i){"undefined"!=typeof t&&("function"==typeof t?e[i]=t:o[i]=t)},this),s.onto(this,e),i.extend(this,o))}});e.exports=o},{lodash:"K2RcUv","prima/lib/mixin":420}],428:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/lib/mixin"),o=new s({loggingData:function(t){var e={};return!i.isEmpty(this.model)&&i.isFunction(this.model.toJSON)&&(e.modelData=this.model.toJSON()),i.isObject(t)&&(e=i.extend(e,t)),e}});e.exports=o},{lodash:"K2RcUv","prima/lib/mixin":420}],429:[function(t,e){"use strict";var i=t("prima/lib/mixin"),s=t("prima/events"),o=t("lodash"),n=t("./registry"),r=new i({__bindKeycommands:function(){o.result(this,"keycommands")&&(o.each(o.result(this,"keycommands"),this.__bindKey,this),n.add({id:this.__keyId,keys:o.keys(o.result(this,"keycommands"))}))},__bindKey:function(t,e){this.listenTo(s,"DOMEventor:"+e,this.__keyFn)},__keyFn:function(t,e){!this.__keysDisabled&&n.shouldRun(e,this.__keyId)&&this[this.keycommands[e]].apply(this,arguments)},focusKeys:function(){n.focus(this.__keyId)},unfocusKeys:function(){n.unfocus(this.__keyId)},soloKeys:function(){n.solo(this.__keyId)},unSoloKeys:function(){n.unSolo(this.__keyId)},disableKeys:function(){this.__keysDisabled=!0},enableKeys:function(){this.__keysDisabled=!1},before:{initialize:function(){this.keycommands||(this.keycommands={}),this.__keysDisabled=!1,this.__keyId=o.uniqueId("keycomms"),this.__bindKeycommands()},stopListening:function(){n.remove(this.__keyId)}}});e.exports=r},{"./registry":430,lodash:"K2RcUv","prima/events":396,"prima/lib/mixin":420}],430:[function(t,e){"use strict";var i=t("prima/class"),s=t("lodash"),o=i.extend({soloId:null,constructor:function(){this.keySets=[]},add:function(t){this.keySets.unshift(t)},remove:function(t){var e=this.getSetForId(t);e&&(this.unSolo(t),this.keySets=s.without(this.keySets,e))},focus:function(t){var e=this.getSetForId(t);e&&(this.keySets=s.without(this.keySets,e),this.keySets.unshift(e))},unfocus:function(t){var e=this.getSetForId(t);e&&(this.keySets=s.without(this.keySets,e),this.keySets.push(e))},solo:function(t){var e=this.getSetForId(t);e&&(this.soloId=t)},unSolo:function(t){this.soloId===t&&(this.soloId=null)},getSetForId:function(t){return this.keySets[s.findIndex(this.keySets,{id:t})]},getSetsWithKey:function(t){return s.where(this.keySets,{keys:[t]})},shouldRun:function(t,e){var i=this.getSetsWithKey(t);return this.soloId===e?!0:i.length>1?i[0].id===e:!0}});e.exports=new o},{lodash:"K2RcUv","prima/class":393}],431:[function(t,e){"use strict";var i=t("prima/lib/mixin"),s=t("prima/lib/flags"),o=new i({isLoggedIn:function(){return s.bool("is_logged_in")},redirect:function(t){return function(e){e.preventDefault(),window.location.href=t}},redirectLink:function(t){return t||(t="/register"),function(e){var i=e.currentTarget.attributes.href,s=t+"?redirect_to=";s+=encodeURIComponent(i?i.value:window.location.href),e.preventDefault(),window.location.href=s}}});e.exports=o},{"prima/lib/flags":"f/LVtH","prima/lib/mixin":420}],432:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("../lib/mixin"),n=t("prima/events"),r=t("prima/mixins/subviewable"),a=!1,l=i("body"),h=t("prima/lib/clickoutside"),d=function(t){return s.noop},c=new o(r,{removeAutoTeardown:function(){this._popoverBase.clickOutside&&(this._popoverBase.clickOutside.remove(),this._popoverBase.clickOutside=null)},setupAutoTeardown:function(){this._rendered&&(this.removeAutoTeardown(),this._popoverBase.autoTeardown&&(this._popoverBase.clickOutside=new h(this.el,this.options),this._popoverBase.clickOutside.on("click:outside",this.onClickOutside,this)))},onClickOutside:function(){this._popoverBase.shouldTeardown?(this._popoverBase.lastAutoTeardown=s.now(),this.teardown()):this._popoverBase.shouldTeardown=!0},reposition:function(){if(!this.$pinned.closest("body").length)return void this.$el.css("visibility","hidden");var t=this.pinnedRect(),e={scrollTop:this.isContainerBody?0:this.$container.scrollTop(),scrollLeft:this.isContainerBody?0:this.$container.scrollLeft(),realTop:this.isContainerBody?0:this.$container.offset().top,realLeft:this.isContainerBody?0:this.$container.offset().left},i=this._popoverBase.shift,o=this._popoverBase.pinnedSide,n={visibility:"visible"},r={},a=this.$el.width(),l=null,h=null,d=null,c=null;this.debug("reposition: pinnedSide=%s, shift=%O, pinnedRect=%O",o,i,t),"top"===o||"bottom"===o?(s.extend(n,{left:t.left+Math.floor(t.width/2)+i.x}),r={top:t.top+e.scrollTop-i.y,bottom:t.top+e.scrollTop+t.height+i.y,left:t.left+e.scrollLeft-i.x,right:t.left+e.scrollLeft+t.width+i.x},r.center=(r.right-r.left)/2,l=e.realTop+r.top-this.$el.height(),h=e.realTop+r.bottom+this.$el.height(),"top"===o&&this._crossesViewportEdge("top",l)&&!this._crossesViewportEdge("bottom",h)&&(o="bottom"),"bottom"===o&&this._crossesViewportEdge("bottom",h)&&!this._crossesViewportEdge("top",l)&&(o="top"),"bottom"===o?s.extend(n,{top:r.bottom,transform:"translateX(-50%)"}):"top"===o&&s.extend(n,{top:r.top,transform:"translateX(-50%) translateY(-100%)"}),d=e.realLeft+(r.center+r.left)-a/2,c=e.realLeft+(r.center+r.left)+a/2,this._crossesViewportEdge("left",d)&&!this._crossesViewportEdge("right",c)&&s.extend(n,{left:this._popoverBase.minDistanceFromContainer+"px",transform:"top"===o?"translateX(0) translateY(-100%)":"translateX(0)"}),!this._crossesViewportEdge("left",d)&&this._crossesViewportEdge("right",c)&&s.extend(n,{left:"auto",right:this._popoverBase.minDistanceFromContainer+"px",transform:"top"===o?"translateX(0) translateY(-100%)":"translateX(0)"})):"left"===o||"right"===o?(s.extend(n,{top:t.top-i.y}),r={left:t.left+e.scrollLeft-i.x,right:t.left+e.scrollLeft+t.width+i.x},d=e.realLeft+r.left-this.$el.width(),c=e.realLeft+r.right+this.$el.width(),"left"===o&&this._crossesViewportEdge("left",d)&&!this._crossesViewportEdge("right",c)&&(o="right"),"right"===o&&this._crossesViewportEdge("right",c)&&!this._crossesViewportEdge("left",d)&&(o="left"),"left"===o?s.extend(n,{left:r.left,transform:"translateX(-100%) translateY(-50%)"}):"right"===o&&s.extend(n,{left:r.right,transform:"translateY(-50%)"})):s.extend(n,{top:t.top-i.y,left:t.left+i.x,transform:""}),s.extend(n,{transform:n.transform}),this.$el.css(n),this.debug("reposition: ad-hoc css %O",n),this.$el.removeClass("top bottom left right").addClass(o)},_crossesViewportEdge:function(t,e){var s=i(window),o={top:s.scrollTop(),left:s.scrollLeft(),right:s.scrollLeft()+s.width(),bottom:s.scrollTop()+s.height()};return this.debug("viewportCheck against %s side (%s) coordinate=[%s]",t,o[t],e),"top"===t?o.top>e:"bottom"===t?o.bottom<e:"left"===t?o.left>e:"right"===t?o.right<e:void 0},isRendered:function(){return this._rendered},isOrWasRecentlyRendered:function(){var t=this._popoverBase.lastAutoTeardown,e=s.now()-t;return 100>e||this._rendered},setPinnedSide:function(t){return this._popoverBase.pinnedSide=t,this},setPinnedTarget:function(t){return this.$pinned=i(t),this.debug("setPinnedTarget: %O",this.$pinned),this},setPopoverContainer:function(t){return this.$container=i(t),this.isContainerBody=this.$container.is(l),this.debug("setPopoverContainer: %O, isContainerBody=%s",this.$container,this.isContainerBody),this},setShift:function(t){if(!s.isObject(t)||!s.isNumber(t.x)||!s.isNumber(t.y))throw new Error("Popover shift needs to be: {Object} => x: {Number}, y: {Number}");return this._popoverBase.shift.x=t.x,this._popoverBase.shift.y=t.y,this},getShift:function(){return this._popoverBase.shift},_initializeDebugger:function(){this.debug=a?d(this):s.noop},defaults:{pinnedRect:function(){var t,e,i=this.$container.offset();this._popoverBase.isFixedPosition?(t=this.$pinned.position(),e=this.$pinned.offset()):(t=this.$pinned.offset(),e=t);var s={};return s.height=this.$pinned.outerHeight(),s.width=this.$pinned.outerWidth(),s.top=Math.round(t.top-i.top),s.left=Math.round(e.left-i.left),s.bottom=Math.round(s.top+s.height),s.right=Math.round(s.left+s.width),this.debug("pinnedRect calculation: container %O, pinned %O, containerOffset %O, pinnedOffset %O",this.$container,this.$pinned,i,e),this.debug("pinnedRect results: height(pinnedOuterHeight)=%s, width(pinnedOuterWidth)=%s, top(pTop-cTop)=%s, left=(pLeft-cLeft)=%s, bottom(top+height)=%s, right(left+width)=%s",s.height,s.width,s.top,s.left,s.bottom,s.right),s}},after:{initialize:function(t){var e={identifier:"popover",pinnedSide:"bottom",className:"popover--base",autoTeardown:!0,teardownOnEscape:!0,minDistanceFromContainer:10,shift:{x:0,y:0},clickOutside:null,lastAutoTeardown:0,shouldTeardown:!0,isFixedPosition:!1};this._popoverBase=s.defaults(s.pick(t||{},s.keys(e)),e),this._initializeDebugger(),this.setPinnedTarget(t.pinnedTarget||null),this.setPopoverContainer(t.popoverContainer||l)},render:function(){this.$el.addClass(this._popoverBase.className),this.$el.appendTo(this.$container);var t=this.$el.children().first(),e=t.width();t.width(e-e%2),this._popoverBase.autoTeardown&&this.setupAutoTeardown(),this.reposition(),this.isContainerBody&&(this.debug("DOMEventor subscribe: flatresize + flatscroll reposition active"),this.listenTo(n,"DOMEventor:flatresize",this.reposition),this._popoverBase.isFixedPosition||this.listenTo(n,"DOMEventor:flatscroll",this.reposition)),this._popoverBase.teardownOnEscape&&this.listenTo(n,"DOMEventor:keyup:escape",this.teardown),this.trigger("open",this),n.trigger(this._popoverBase.identifier+":open",this)},teardown:function(){this._popoverBase.teardownOnEscape&&this.stopListening(n,"DOMEventor:keyup:escape"),this.$el.off("mousewheel DOMMouseScroll"),this.removeAutoTeardown(),this.trigger("close",this),n.trigger(this._popoverBase.identifier+":close",this)}}});e.exports=c},{"../lib/mixin":420,jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/clickoutside":397,"prima/mixins/subviewable":436}],433:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("../lib/mixin"),n=new o({defaults:{whenEvent:function(t,e){return 1===arguments.length&&(e=t,t=this),s.promise(i.bind(function(i){this.listenToOnce(t,e,function(){i.call(void 0,arguments)})},this))}}});e.exports=n},{"../lib/mixin":420,lodash:"K2RcUv",when:"RG2dij"}],434:[function(t,e){"use strict";function i(t){var e=this[t];this[t]=function(){return this._rendered||this.rendering?e.apply(this,arguments):this}}var s=t("lodash"),o=t("../lib/mixin"),n=new o({js$:function(t){var e="[data-js-"+t+"]";return s.isEmpty(this._js$Cache[e])?this._js$Cache[e]=this.$el.find(e):this._js$Cache[e]},applyTo:function(t){s.each(t.renderableMethods,i,t),s(t.events).values().uniq().each(i,t)},defaults:{teardown:function(){return this},dispose:function(){return this},attachSubViews:function(){return s.forEach(this._subViews,function(t,e){var i=this.$('[data-subview="'+e+'"]');i.length>1&&(i=i.first()),i.replaceWith(t.$el),t.$el.attr("data-subview",e)},this),this},renderSubViews:function(t){return s.forEach(this._subViews,function(e){e.render(),t&&s.isFunction(e.renderSubViews)&&e.renderSubViews(t)},this),this},reRender:function(){return this.teardown(),this.render()}},around:{initialize:function(t){this._initialized=!1,this._rendering=!1,this._rendered=!1,this._removed=null,this._subViews={},this._js$Cache={};var e=t.apply(this,s.rest(arguments));return this._initialized=!0,this.$el.attr("data-cid",this.cid),e},render:function(t){if(this._rendered)return this;this._rendering=!0;var e=t.apply(this,s.rest(arguments));return this.attachSubViews(),this._rendering=!1,this._rendered=!0,e}},after:{teardown:function(){s.each(this._subViews,function(t,e){s.isFunction(t.teardown)&&t.teardown(),this.stopListening(t),this._subViews[e]=null},this),s.each(this._js$Cache,function(t,e,i){i[e]=null}),this._rendered=!1},remove:function(){this._removed=!0,this._subViews=null},dispose:function(){this._rendered&&this.teardown(),this._removed||this.remove(),this.off()}}});e.exports=n},{"../lib/mixin":420,lodash:"K2RcUv"}],435:[function(t,e){"use strict";function i(t){return s.trim(t)}var s=t("lodash"),o=t("../lib/mixin"),n=function(t,e){return t=i(t),e&&s.isFunction(this.$$)&&delete this.$$.cache[t],t},r=function(t){return this.$$?(t=i(t),this.$(t)):void 0},a=function(t){this.$$&&(t=i(t),delete this.$$.cache[t])},l=function(t){return this.$$?(t=i(t),delete this.$$.cache[t],this.$(t)):void 0},h=function(){this.$$&&(s.forEach(this.$$.cache,function(t,e,i){delete i[e]}),this.$$.cache={})},d=function(t){return"[data-js-"+t+"]"},c=function(t){return function(){var t=s.memoize(s.bind(r,this),s.bind(n,this));t.update=s.bind(l,this),t.remove=s.bind(a,this),t.empty=s.bind(h,this);var e=function(e,i){return t(d(e),i)};return e.update=function(e){t.update(d(e))},e.remove=function(e){t.remove(d(e))},this.$$=t,this.js$=e,this.$$initialize=s.noop,t}.call(t)},u=new o({defaults:{$$cacheKeys:{},$$cacheSelectors:function(t){return"undefined"==typeof t&&(t=this.$$cacheKeys),s.forEach(t,function(t){this.$$.update(t)},this),this},$$initialize:function(){return c(this)},$$:function(){return c(this).apply(this,arguments)}},before:{initialize:function(){this.$$initialize()},render:function(){this.$$.empty()}},after:{setElement:function(){s.isFunction(this.$$.empty)&&this.$$.empty()},remove:function(){s.isFunction(this.$$.empty)&&this.$$.empty()},render:function(){s.isFunction(this.$$cacheSelectors)&&this.$$cacheSelectors()}}});e.exports=u},{"../lib/mixin":420,lodash:"K2RcUv"}],436:[function(t,e){"use strict";var i=t("lodash"),s=t("../lib/mixin"),o=new s({defaults:{teardown:function(){return this},beforeTeardown:function(){},afterTeardown:function(){return this.teardownSubViews()},render:function(){return this},beforeRender:function(){},afterRender:function(){return this.renderSubViews()},attachSubView:function(t,e){if(1===arguments.length)if("string"==typeof t){if(e=t,t=this.subViews[e],!t)return this}else e=t.$el.data("subview")||"";var i=this.$('[data-subview="'+e+'"]');return i.length>1&&(i=i.first()),t&&i.length&&(i.replaceWith(t.$el),t.$el.attr("data-subview",e)),this},attachSubViews:function(){return i.forEach(this.subViews,this.attachSubView,this),this},teardownSubViews:function(){return i.forEach(this.subViews,function(t,e){t&&i.isFunction(t.teardown)&&t.teardown(),this.subViews[e]=null},this),this.subViews={},this},renderSubViews:function(){return i.forEach(this.subViews,function(t){t&&i.isFunction(t.render)&&t.render()},this),this},isInitialized:function(){return this._initialized},isRendered:function(){return this._rendered},isRendering:function(){return this._rendering},isRemoved:function(){return this._removed}},around:{initialize:function(t){this._initialized=!1,this._rendering=!1,this._rendered=!1,this._removed=!1,this.subViews={};var e=t.apply(this,i.rest(arguments));return this._initialized=!0,e},teardown:function(t){var e=i.rest(arguments);i.isFunction(this.beforeTeardown)&&this.beforeTeardown.apply(this,e);var s=t.apply(this,e);return i.isFunction(this.afterTeardown)&&this.afterTeardown.apply(this,e),this._rendered=!1,s},render:function(t){var e=i.rest(arguments);this._rendering=!0,i.isFunction(this.beforeRender)&&this.beforeRender.apply(this,e);var s=t.apply(this,e);return i.isFunction(this.afterRender)&&this.afterRender.apply(this,e),this._rendering=!1,this._rendered=!0,s}},after:{remove:function(){this._removed=!0,this.subViews=null}}});e.exports=o},{"../lib/mixin":420,lodash:"K2RcUv"}],437:[function(t,e){"use strict";var i=t("jquery"),s=t("lodash"),o=t("prima/lib/mixin"),n=t("prima/events"),r=new o({defaults:{$tabLimiterEl:i(),_tabLimiterAutoFocus:!1,_tabLimiterItems:[],_tabLimiterSelector:["input","select","textarea","button","object","a","div"],_tabLimiterCurrentIndex:-1,_tabLimiterEnterKey:!0},__tabLimiterTabKeydown:function(t){return t.preventDefault(),t.stopPropagation(),t.shiftKey&&-1===this._tabLimiterCurrentIndex&&(this._tabLimiterCurrentIndex=0),this._tabLimiterCurrentIndex=(this._tabLimiterCurrentIndex+(t.shiftKey?-1:1)+this._tabLimiterItems.length)%this._tabLimiterItems.length,this._focusTabbableItem(),!1},__tabLimiterItemKeydown:function(t){t=t||window.event;var e=t.which||t.keyCode;if(13===e){t.preventDefault(),t.stopPropagation();var s=i(t.target),o=s.find("input");return o.length?o.trigger("click"):s.trigger("click"),!1}},__tabbableItemFocus:function(t){var e=s.indexOf(this._tabLimiterItems,t.target);this._tabLimiterCurrentIndex=e>=0?e:this._tabLimiterCurrentIndex},_focusTabbableItem:function(){if(this.$tabLimiterEl&&this.$tabLimiterEl.length){var t=i(this._tabLimiterItems[this._tabLimiterCurrentIndex]);t.length&&t.focus()}},isTabbable:function(t){var e=i(t),s=t.nodeName.toLowerCase(),o=e.attr("tabindex"),n=!1;return n=/input|select|textarea|button|object/.test(s)?!t.disabled&&!e.is(":hidden"):(t.href||!isNaN(o))&&!e.is(":hidden"),(isNaN(o)||o>=0)&&n},updateTabbableItems:function(){this.$tabLimiterEl&&this.$tabLimiterEl.length&&(this._tabLimiterItems=s.filter(this.$tabLimiterEl.find(this._tabLimiterSelector.join(",")),s.bind(function(t){return this.isTabbable(t)},this)),this._tabLimiterItems.length&&(this._tabLimiterItems=s.sortBy(this._tabLimiterItems,function(t){return t.tabIndex})))},catchTabs:function(t){if(this.releaseTabs(),this.$tabLimiterEl=t?i(t):this.$tabLimiterEl,this.$tabLimiterEl&&this.$tabLimiterEl.length){this.updateTabbableItems(),this._tabLimiterAutoFocus&&this._focusTabbableItem();var e=this._tabLimiterSelector.join(",");this.listenTo(n,"DOMEventor:keydown:tab",this.__tabLimiterTabKeydown),this.listenTo(n,"DOMEventor:keydown:shift+tab",this.__tabLimiterTabKeydown),this.$tabLimiterEl.on("focus.tablimiter",e,s.bind(this.__tabbableItemFocus,this)),this._tabLimiterEnterKey&&this.$tabLimiterEl.on("keydown.tablimiter",e,s.bind(this.__tabLimiterItemKeydown,this))}},releaseTabs:function(){this.$tabLimiterEl&&this.$tabLimiterEl.length&&(this._tabLimiterItems=[],this._tabLimiterCurrentIndex=-1,this.stopListening(n,"DOMEventor:keydown:tab",this.__tabLimiterTabKeydown),this.stopListening(n,"DOMEventor:keydown:shift+tab",this.__tabLimiterTabKeydown),this.$tabLimiterEl.off(".tablimiter"))}});e.exports=r},{jquery:"HlZQrA",lodash:"K2RcUv","prima/events":396,"prima/lib/mixin":420}],438:[function(t,e){"use strict";var i=t("../lib/mixin"),s=new i({before:{sync:function(t,e,i){i.with_form_key=!0}}});e.exports=s},{"../lib/mixin":420}],439:[function(t,e){"use strict";var i=t("backbone"),s=t("./mixins/withformkeytrue"),o=t("./lib/extendwithmixins"),n=i.Model.extend({});s.applyTo(n.prototype),o.applyTo(n),e.exports=n},{"./lib/extendwithmixins":402,"./mixins/withformkeytrue":438,backbone:"5kFNoY"}],440:[function(t,e){"use strict";var i=t("backbone"),s=t("prima/bootloader"),o=(t("prima/lib/logger"),t("logs/logging-manager")),n=i.Router.extend({root:"/",logs:function(){return[]},constructor:function(){o.startLogs(this.logs()),i.Router.apply(this,arguments)},getName:function(){return"Prima/Router"}},{Bootloader:s,bootloader:function(t){return new this.Bootloader(t)}});e.exports=n},{backbone:"5kFNoY","logs/logging-manager":391,"prima/bootloader":392,"prima/lib/logger":403}],441:[function(t,e){"use strict";function i(t,e){function i(t,e){var i,o;if(!s.isObject(t))throw new Error("SingletonModel requires attributes");if(i=t[u],s.isEmpty(i)&&!s.isNumber(i))throw new Error('SingletonModel attributes require a "'+u+'"');if(o=d[i],c[i]++||(c[i]=1),o)s.keys(t).length>=2&&o.set(t,e),o.collection!==!0&&(o.collection=!0);else{d[i]=this;try{Object.defineProperty(this,"collection",{value:!0,configurable:!1,enumerable:!0,writable:!1})}finally{this.collection||(this.collection=!0)}this.constructor.__super__.constructor.call(this,t,e),h.add(this)}return o||this}function r(){return this.id}function a(){return h}function l(){0===--c[this.id]&&(delete d[this.id],delete c[this.id],h.remove(this))}t||(t={}),e||(e={});var h=new o.Collection,d=Object.create(null),c=Object.create(null),u=t.idAttribute||n.prototype.idAttribute;return t.constructor=i,t.release=l,t.toString=r,t.toJSON=t.toJSON||n.prototype.toJSON,e.getCollection=a,n.extend(t,e)}var s=t("lodash"),o=t("backbone"),n=t("./model");e.exports.extend=i},{"./model":439,backbone:"5kFNoY",lodash:"K2RcUv"}],442:[function(t,e){"use strict";function i(){var t,e,i={animation:null,transition:null},s=document.createElement("div"),o={animation:"animationend",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in o)if(void 0!==s.style[e]){i.animation=o[e];break}var n={transition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in n)if(void 0!==s.style[t]){i.transition=n[t];break}return i}function s(t,e){r.animation?n(t).one(r.animation,function(t){e(t)}):setTimeout(function(t){e(t)},0)}function o(t,e){r.transition?n(t).one(r.transition,function(t){e(t)}):setTimeout(function(t){e(t)},0)}var n=t("jquery"),r=i();e.exports={animation:s,transition:o}},{jquery:"HlZQrA"}],443:[function(t,e){"use strict";var i=t("lodash"),s=t("prima/class"),o={requestFullscreen:["requestFullScreen"]},n=s.extend({vendors:["moz","webkit","ms","o","khtml"],el:document.body||document.documentElement,get:i.memoize(function(t){var e=this._getProp(t);return!e&&o[t]&&i.each(o[t],function(t){var i=this._getProp(t);i&&(e=i)},this),e}),prop:function(t){return!!this.get(t)},_getProp:function(t){var e=!1;return"string"==typeof this.el[t]?t:"string"==typeof this._styles()[t]?t:(t=t.charAt(0).toUpperCase()+t.substr(1),i.forEach(this.vendors,function(i){"undefined"!=typeof this.el[i+t]&&(e=i+t),"undefined"!=typeof this._styles()[i+t]&&(e=i+t)},this),e)},_styles:i.memoize(function(){return this.el.style})});e.exports=new n},{lodash:"K2RcUv","prima/class":393}],444:[function(t,e){"use strict";function i(t,e){if(t in s)return s[t];var i=window[t];if(!e||!e(i)){var o=document.createElement("iframe");document.body.appendChild(o),i=o.contentWindow[t],document.body.removeChild(o)}return s[t]=i,i}var s={};e.exports=i},{}],445:[function(t,e){"use strict";function i(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)}function s(t){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function o(t,e,i){var s=Math.min(Math.min(t,e),i),o=Math.max(Math.max(t,e),i),n=o-s,r={h:6,s:o?(o-s)/o:0,v:o/255};return n?r.h+=o===t?(e-i)/n:o===e?2+(i-t)/n:4+(t-e)/n:r.h=0,r.h=60*r.h%360,r}function n(t,e,i){var s,o,n;if(e){s=o=n=0;var r=(t+360)%360/60,a=i*e,l=i-a,h=a*(1-Math.abs(r%2-1));1>r?(s=a,o=h):2>r?(s=h,o=a):3>r?(o=a,n=h):4>r?(o=h,n=a):5>r?(n=a,s=h):(n=h,s=a),s+=l,o+=l,n+=l}else s=o=n=i;return{r:Math.round(255*s),g:Math.round(255*o),b:Math.round(255*n)}}function r(t){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=s(t),i=o(e.r,e.g,e.b);return i}function a(t,e,s){var o=n(t,e,s),r=i(o.r,o.g,o.b);return r}function l(t,e){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var i,s,o,n=parseInt(t,16),r=0>e?0:255,a=0>e?-e:e,l=n>>16,h=n>>8&255,d=255&n;return i=Math.round((r-l)*a)+l,s=Math.round((r-h)*a)+h,o=Math.round((r-d)*a)+d,"#"+(16777216+65536*i+256*s+o).toString(16).slice(1)}function h(t){return"string"==typeof t&&(t=r(t)),t.s<.2&&t.v>.8?"#444":"#FFF"}function d(t,e,i){var s={upperBound:.8,lowerBound:.2,diffBound:.1,hueBound:15};c.extend(s,i);var o=s.upperBound,n=s.lowerBound,r=s.diffBound,a=s.hueBound,l=Math.abs(t.h-e.h),h=Math.abs(t.s-e.s),d=Math.abs(t.v-e.v);return r>=l&&r>=h&&r>=d?!0:r>=h&&r>=d&&(h>=o||n>=h&&d>=o||n>=d&&a>=l)?!0:!1}var c=t("lodash");e.exports={rgbToHex:i,hexToRgb:s,rgbToHsv:o,hsvToRgb:n,hexToHsv:r,hsvToHex:a,brighten:l,readable:h,compare:d}},{lodash:"K2RcUv"}],446:[function(t,e){"use strict";function i(t){return new RegExp(t+"=([^;]+)").test(decodeURIComponent(document.cookie))}function s(t){return new RegExp(t+"=([^;]+)").test(decodeURIComponent(document.cookie))?RegExp.$1:null}function o(t,e,i,s){"object"==typeof e&&(e=JSON.stringify(e));var o=encodeURIComponent(t)+"="+encodeURIComponent(e);if(l.isPlainObject(i)&&(s=i,i=s?s.expires:!1),s=l.extend({expires:i},c,s),s.expires instanceof Date)o+=";expires="+s.expires.toGMTString();else if("number"==typeof s.expires){var n=new Date;n.setTime(n.getTime()+1e3*s.expires),o+=";expires="+n.toGMTString()}s.path&&(o+=";path="+encodeURI(s.path)),s.secure&&(o+=";secure"),s.domain&&(o+=";domain="+encodeURI(s.domain)),document.cookie=o}function n(t){o(t,"",-1)}function r(t,e){var i=s(t);try{i=JSON.parse(i)}catch(o){return i}return e?d(i,e):i}function a(t,e,i,s){var n;l.isPlainObject(e)?(s=i,n=e):(n=r(t)||{},l.isPlainObject(n)||(n={}),h(n,e,i)),o(t,JSON.stringify(n),s)}var l=t("lodash"),h=t("./setpath"),d=t("./getpath"),c={path:"/",secure:!1,domain:""},u={has:i,get:s,set:o,unset:n,getHash:r,setHash:a};e.exports=u},{"./getpath":450,"./setpath":458,lodash:"K2RcUv"}],447:[function(t,e){"use strict";function i(t,e,i){return function(){i||(i=this);var s=arguments;return setTimeout(function(){t.apply(i,s)},e)}}e.exports=i},{}],448:[function(t,e){"use strict";function i(t){return t&&t.nodeType&&1===t.nodeType}var s=t("lodash");e.exports=function(t,e){if(i(t))return t;if(s.isString(t)){var o=(e||document).querySelector(t);if(i(o))return o}return t&&t.jquery?t.get(0):!1}},{lodash:"K2RcUv"}],449:[function(t,e){"use strict";function i(t,e){e=e||"Exposer";var i=window;s.each(t,function(t,s){if(n(i,s))throw new Error('"'+s+'" already exists');o.log(e,"%s.%s",i,s),r(i,s,t)})}var s=t("lodash"),o=t("../lib/logger"),n=t("./haspath"),r=t("./setpath");e.exports=i},{"../lib/logger":403,"./haspath":451,"./setpath":458,lodash:"K2RcUv"}],450:[function(t,e){"use strict";function i(t,e){"string"==typeof t&&(e=t,t=window),e=e.split(".");for(var i;;){if(i=e.shift(),!(i in t))return;if(0===e.length)return t[i];t=t[i]}}e.exports=i},{}],451:[function(t,e){"use strict";function i(t,e){"string"==typeof t&&(e=t,t=window),e=e.split(".");for(var i;;){if(i=e.shift(),!(i in t))return!1;if(0===e.length)return!0;t=t[i]}}e.exports=i},{}],452:[function(t,e){"use strict";var i=t("jquery"),s=function(t,e,i){if(0===i)return 0;var s=null==i?e:e/i;return 2===arguments.length?Math.round(t*s):void 0},o=function(t,e,i){if(0===i)return 0;var s=null==i?e:e/i;return Math.round(t/s)},n=function(t,e,i,n){var r=t,a=e,l=t/e,h=i/n;return(t>i||e>n)&&(l>h?(r=i,a=o(r,l)):(a=n,r=s(a,l))),{width:r,height:a}},r=function(t,e,i,n,r,a){null!=r||(r=.5),null!=a||(a=.5);var l=0,h=0,d=t,c=e,u=t/e,p=i/n;return u>p?(d=s(e,p),l=Math.round(r*(t-d))):p>u&&(c=o(t,p),l=Math.round(a*(e-c))),{left:l,top:h,width:d,height:c}},a=function(t){var e;t instanceof i?(e=t,t=e.get(0)):e=i(t);var s=document.createElement("canvas");return s.width=t.width||e.width(),s.height=t.height||e.height(),s},l=function(t,e,s){var o;t instanceof i?(o=t,t=o.get(0)):o=i(t),e?e instanceof i&&(e=e.get(0)):e=a(t);var n=e.width,r=e.height,l=e.getContext("2d");return l.save(),s&&(l.translate(e.width,0),l.scale(-1,1)),l.drawImage(t,0,0,n,r),l.restore(),e},h=function(t,e,s,n,r,a){var l;t instanceof i?(l=t,t=l.get(0)):l=i(t);var h=90===n||270===n;h?a&&s>a&&(e=o(a,s,e),s=a):a&&e>a&&(s=o(a,e,s),e=a);var d=document.createElement("canvas");h?(d.width=s,d.height=e):(d.width=e,d.height=s);var c=d.getContext("2d");return c.save(),c.translate(.5*d.width,.5*d.height),c.rotate(n*Math.PI/180),r&&c.scale(-1,1),c.drawImage(t,-.5*e,-.5*s,e,s),c.restore(),d
},d={widthForHeight:s,heightForWidth:o,maxSize:n,cropBox:r,createCanvasForEl:a,drawElToCanvas:l,drawScaledAndRotated:h};e.exports=d},{jquery:"HlZQrA"}],453:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("prima/class"),n="FileReader"in window&&"readAsDataURL"in FileReader.prototype,r=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL,a=[],l=t("app/vendor/jpegmeta").JpegFile,h=o.extend({constructor:function(t){null!=t&&this.read(t)},read:function(t,e){if(!i.isUndefined(e)||(e=!0),this.file=t,!t)return s.reject("No file to read");if(!n)return s.reject("FileReader is not supported");t.type.match(/image\/(jpg|jpeg)/i)||(e=!1);var o;return o=e&&"readAsBinaryString"in FileReader.prototype?this.readBinaryString(t).then(i.bind(function(e){try{var s=new l(e.binary,t.name);e.rotation=function(t){switch(t){case 1:return 0;case 2:return 0;case 3:return 180;case 4:return 180;case 5:return 270;case 6:return 90;case 7:return 90;case 8:return 270;default:return 0}}(s.tiff.Orientation.value),e.mirrored=function(t){switch(t){case 2:return!0;case 4:return!0;case 5:return!0;case 7:return!0;default:return!1}}(s.tiff.Orientation.value)}catch(o){}return this.readDataUrl(t).then(i.bind(function(t){return i.extend(e,t)},this))},this)):this.readDataUrl(t),this.promise=o,o},readDataUrl:function(t){var e=new FileReader;return"readAsDataURL"in e?s.promise(function(i,s){e.onload=function(t){var s=t.target.result;i(s),e.onload=null,e.onerror=null},e.onerror=function(){s(),e.onload=null,e.onerror=null},e.readAsDataURL(t)}).then(i.bind(this._onLoadDataUrl,this),i.bind(this._onError,this)):s.reject("FileReader.readAsDataURL is not supported")},_onLoadDataUrl:function(t){var e={base64:t,file:this.file};return r&&(e.objectUrl=r(this.file),a.push(e.objectUrl)),s.resolve(e)},readBinaryString:function(t){var e=new FileReader;return"readAsBinaryString"in e?s.promise(function(i,s){e.onload=function(t){var s=t.target.result;i(s),e.onload=null,e.onerror=null},e.onerror=function(){s(),e.onload=null,e.onerror=null},e.readAsBinaryString(t)}).then(i.bind(this._onLoadBinaryString,this),i.bind(this._onError,this)):s.reject("FileReader.readAsBinaryString is not supported")},_onLoadBinaryString:function(t){return s.resolve({binary:t,file:this.file})},_onError:function(t){return s.reject("Failed to read file")}},{read:function(t,e){var i=new h(t,e);return i.promise},canReadFiles:function(){return n}});e.exports=h},{"app/vendor/jpegmeta":283,lodash:"K2RcUv","prima/class":393,when:"RG2dij"}],454:[function(t,e){"use strict";var i=t("lodash"),s=t("when"),o=t("prima/class"),n=o.extend({constructor:function(t){null!=t&&this.load(t)},load:function(t){if(this.src=t,!t)return s.reject("No URL to load");var e=this,o=s.promise(function(i,s){var o=new Image;o.src=t,e._img=o,o.onload=function(){i(o),o.onload=null,o.error=null},o.onerror=function(){s(o),o.onload=null,o.error=null},o.complete&&(o.naturalWidth||o.naturalHeight?"function"==typeof o.onload&&o.onload():"function"==typeof o.onerror&&o.onerror())});return this.promise=o=o.then(i.bind(this._onLoad,this),i.bind(this._onError,this)),o},_onLoad:function(t){return this._img===t?(this.width=t.naturalWidth,this.height=t.naturalHeight,this.src=t.src,this.loaded=!0,s.resolve({width:this.width,height:this.height,src:this.src})):this.promise},_onError:function(t){return this._img===t?(this.width=null,this.height=null,this.src=t.src,this.loaded=!1,s.reject(this.src+" failed to load")):this.promise}},{load:function(t){var e=new n(t);return e.promise}});e.exports=n},{lodash:"K2RcUv","prima/class":393,when:"RG2dij"}],455:[function(t,e){"use strict";var i,s=t("../lib/data"),o=t("./getpath"),n=function(t,e){var i=t&&t.timing&&t.timing.responseStart||Date.now();return function(){return e+(Date.now()-i)}}(window.performance,s.get("Context/time")),r={getRealNow:o("Tumblr.getRealNow"),realStartedAt:o("Tumblr.real_started_at"),startedAt:o("Tumblr.started_at")},a=function(){return i||(i=r.getRealNow?r:{getRealNow:n,realStartedAt:n(),startedAt:(new Date).getTime()}),i};e.exports=a(),e.exports.getElapsed=function(t){return t||(t=this.getRealNow()),t-this.realStartedAt}},{"../lib/data":398,"./getpath":450}],456:[function(t,e){"use strict";var i=function(t,e){return e||(e=this),function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),t.apply(e,i)}};e.exports=i},{}],457:[function(t,e){"use strict";var i=t("lodash"),s=t("when/sequence"),o=function(t,e){t=i.map(t,function(t){return i.bind(t,this)},e||this);var o=Array.prototype.slice.call(arguments,1);return o[0]=t,s.apply(void 0,o)};e.exports=o},{lodash:"K2RcUv","when/sequence":482}],458:[function(t,e){"use strict";function i(t,e,i){"string"==typeof t&&(i=e,e=t,t=window),e=e.split(".");for(var s,o=e.pop();e.length;)s=e.shift(),t=s in t?t[s]:t[s]={};return t[o]=i}e.exports=i},{}],459:[function(t,e){"use strict";var i=t("lodash"),s={aElement:document.createElement("a"),acceptedProtocols:["http:","https:","tumblr:","mailto:"],parseUrl:function(t){if(!i.startsWith(t,"http"))throw new URIError("Missing protocol in URL to be parsed. Must be http or https");return this.aElement.setAttribute("href",t),{url:t,protocol:this.aElement.protocol,host:this.aElement.hostname,port:this.aElement.port,query:this.aElement.search,hash:this.aElement.hash,path:this.aElement.pathname}},parseTumblelogUrl:function(t){try{-1===t.indexOf("://")&&(t="http://"+t);var e=this.parseUrl(t),s=!1;if(i.endsWith(e.host,"tumblr.com")?s=e.host.match(/([a-zA-Z0-9-_]+)\.tumblr\.com/i):i.endsWith(e.host,"tumblr.net")?s=e.host.match(/([a-zA-Z0-9-_]+)\.[a-zA-Z0-9-_]+\.[a-zA-Z0-9-_]+\.tumblr.net/i):i.endsWith(e.host,"t.dev")&&(s=e.host.match(/([a-zA-Z0-9-_]+)\.t\.dev/i)),s){var o=s[1];if("www"===o)return!1;var n={tumblelog_name:o},r=e.path.match(/post\/([0-9]+)/i);return r&&(n.post_id=r[1]),n}return!1}catch(a){return!1}},isTumblelogUrl:function(t){return this.parseTumblelogUrl(t)===!1?!1:!0},hasAllowedProtocol:function(t){this.aElement.setAttribute("href",t);var e=this.aElement.protocol;if(":"===e&&(e=location.protocol),-1===this.acceptedProtocols.indexOf(e))throw new Error("Unsupported protocol detected in URL: "+t);return!0},isAbsoluteUrl:function(t){var e=new RegExp("^(?:[a-z]+:)?//","i");return!!e.test(t||"")},getParameter:function(t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},httpBuildQuery:function(t,e){var i=[];for(var s in t)if(t.hasOwnProperty(s)){var o=e?e+"["+s+"]":s,n=t[s];if(!n)continue;i.push("object"==typeof n?this.httpBuildQuery(n,o):encodeURIComponent(o)+"="+encodeURIComponent(n))}return i.join("&")},buildUrl:function(t,e){return t+"?"+this.httpBuildQuery(e)},getQueryStringHash:function(t){var e={};return t.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(t,i,s,o){e[i]=o}),e},isProtocolRelative:function(t){var e=new RegExp("^//[^/]","i");return e.test(t||"")},addProtocolIfMissing:function(t,e){if(i.any(this.acceptedProtocols,function(e){return i.startsWith(t,e)}))return t;if(-1===this.acceptedProtocols.indexOf(e))throw new Error("Attempting to add an unsupported protocol: "+e);return(this.isProtocolRelative(t)?e:e+"//")+t}};e.exports=s},{lodash:"K2RcUv"}],460:[function(t,e){"use strict";function i(t,e){e||(e={}),t||(t=[]),s.each(t,function(t){s.isFunction(this[t])&&this[t].call(this,e)},this)}var s=t("lodash"),o=t("backbone"),n=t("./lib/extendwithmixins"),r=["model","collection","el","id","attributes","className","tagName","events"],a=["_setup"],l=o.View.extend({constructor:function(t){this.cid=s.uniqueId("view"),t||(t={}),s.extend(this,s.pick(t,r)),this._elAttributes=this.attributes,this.attributes={},this._ensureElement(),this.setupMethods=s.union(a,this.constructor.__super__.setupMethods,this.setupMethods),i.call(this,this.setupMethods,t),this.initialize.apply(this,arguments),this.delegateEvents()},_setup:s.noop,_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"),!1);else{var t=s.extend({},s.result(this,"_elAttributes"));this.id&&(t.id=s.result(this,"id")),this.className&&(t["class"]=s.result(this,"className"));var e=o.$("<"+s.result(this,"tagName")+">").attr(t);this.setElement(e,!1)}}});n.applyTo(l),e.exports=l},{"./lib/extendwithmixins":402,backbone:"5kFNoY",lodash:"K2RcUv"}],461:[function(t,e){"use strict";var i=t("lodash"),s=t("backbone"),o=t("./item"),n=o.extend({setupMethods:["_setupBaseView"],_setupBaseView:function(t){t||(t={}),this.subviews=i.extend({},this.subviews||{},t.subviews||{})},initialize:i.noop,_registerSubview:function(t){return this._subviews||(this._subviews=[]),this._subviews.push(t),t},appendSubview:function(t,e){return i.isString(e)&&(e=this.$(e)),this._registerSubview(t),t.render(),(e||this.$el).append(t.el),t},renderSubviews:function(){this.subviews&&i.each(this.subviews,function(t,e){t instanceof s.View?this.renderSubview(t,{name:e}):this.renderSubview(e)},this)},renderSubview:function(t,e){e||(e={});var o,n;i.isString(t)?(n=t,t=this.subviews[t],o={selector:t.container||"[data-subview="+n+"]",options:i.result(t,"options")||{},prepareView:t.prepareView||function(e,i){var s=new t.constructor(i);return s.$el.attr('data-subview="'+n+'"'),e.replaceWith(s.$el),s}}):t instanceof s.View&&(n=e.name||"",o={selector:e.container||"[data-subview="+n+"]",prepareView:e.prepareView||function(e){return t.$el.attr('data-subview="'+n+'"'),e.replaceWith(t.$el),t}});var r=i.bind(function(){var e;this.el&&(e=this.$(o.selector))&&(t=this[n]=o.prepareView.call(this,e,o.options),t.render(),this._registerSubview(t))},this);this.rendered?r():this.once("rendered",r,this)},_afterRender:function(){this.renderSubviews(),o.prototype._afterRender.apply(this,arguments)},_beforeRemove:function(){this._subviews&&i.chain(this._subviews).flatten().invoke("remove")}});e.exports=n},{"./item":462,backbone:"5kFNoY",lodash:"K2RcUv"}],462:[function(t,e){"use strict";function i(t){return s.isFunction(t.serialize)?t.serialize():s.isFunction(t.toJSON)?t.toJSON():void 0}var s=t("lodash"),o=t("prima/mixins/accessor/simple"),n=t("../view"),r=n.extend({rendered:!1,disposed:!1,keepElement:!1,_setup:function(t){var e=s.extend({},s.result(this.constructor.__super__,"defaults"),s.result(this,"defaults"));s.extend(e,s.pick(t,s.keys(e))),this.attributes={},this.set(e),this.changed={};var i=this.render;this.render=s.bind(function(){this._beforeRender.apply(this,arguments),this.beforeRender.apply(this,arguments);var t=i.apply(this,arguments);return this._afterRender.apply(this,arguments),this.afterRender.apply(this,arguments),t},this);var o=this.remove;this.remove=s.bind(function(){if(this.disposed)return this;this._beforeRemove.apply(this,arguments),this.beforeRemove.apply(this,arguments);var t=o.apply(this,arguments);return this.afterRemove.apply(this,arguments),this._afterRemove.apply(this,arguments),t},this)},_beforeRender:s.noop,beforeRender:s.noop,render:function(){return this.disposed?!1:(this.renderWithTemplate(),this)},_afterRender:function(){this.rendered=!0,this.trigger("rendered",this)},afterRender:s.noop,getTemplateData:function(){var t=i(this);return this.model&&(t.model=i(this.model)),this.collection&&(t.collection={items:i(this.collection),length:this.collection.length}),t},renderWithTemplate:function(t){if(!this.template)throw new Error("Template function needed.");var e;return e=s.isFunction(this.template)?this.template(t||this.getTemplateData()):this.template,this.$el.html(e),this},_beforeRemove:s.noop,beforeRemove:s.noop,remove:function(){return this.keepElement?(this.undelegateEvents(),this.stopListening()):n.prototype.remove.apply(this,arguments),this},_afterRemove:function(){var t=["el","$el","options","model","collection","subviews","_subviews","defaults","attributes"];s.each(t,s.bind(function(t){this[t]&&delete this[t]},this)),this.rendered=!1,this.disposed=!0},afterRemove:s.noop,cacheElements:function(t){for(var e in t)this[e]=this.$(t[e])}});o.mixin.applyTo(r.prototype),e.exports=r},{"../view":460,lodash:"K2RcUv","prima/mixins/accessor/simple":426}],463:[function(t,e){!function(t){"use strict";function i(){this.frames=[],this.lastId=0,this.raf=s,this.batch={hash:{},read:[],write:[],mode:null}}{var s=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||function(t){window.clearTimeout(t)}}i.prototype.read=function(t,e){var i=this.add("read",t,e),s=i.id;this.batch.read.push(i.id);var o="reading"===this.batch.mode||this.batch.scheduled;return o?s:(this.scheduleBatch(),s)},i.prototype.write=function(t,e){var i=this.add("write",t,e),s=this.batch.mode,o=i.id;this.batch.write.push(i.id);var n="writing"===s||"reading"===s||this.batch.scheduled;return n?o:(this.scheduleBatch(),o)},i.prototype.defer=function(t,e,i){"function"==typeof t&&(i=e,e=t,t=1);var s=this,o=t-1;return this.schedule(o,function(){s.run({fn:e,ctx:i})})},i.prototype.clear=function(t){if("function"==typeof t)return this.clearFrame(t);var e=this.batch.hash[t];if(e){var i=this.batch[e.type],s=i.indexOf(t);delete this.batch.hash[t],~s&&i.splice(s,1)}},i.prototype.clearFrame=function(t){var e=this.frames.indexOf(t);~e&&this.frames.splice(e,1)},i.prototype.scheduleBatch=function(){var t=this;this.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),this.batch.scheduled=!0},i.prototype.uniqueId=function(){return++this.lastId},i.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},i.prototype.runBatch=function(){try{this.batch.mode="reading",this.flush(this.batch.read),this.batch.mode="writing",this.flush(this.batch.write),this.batch.mode=null}catch(t){throw this.runBatch(),t}},i.prototype.add=function(t,e,i){var s=this.uniqueId();return this.batch.hash[s]={id:s,fn:e,ctx:i,type:t}},i.prototype.run=function(t){var e=t.ctx||this,i=t.fn;if(delete this.batch.hash[t.id],!this.onError)return i.call(e);try{i.call(e)}catch(s){this.onError(s)}},i.prototype.loop=function(){var t=this,e=this.raf;this.looping||(e(function i(){var s=t.frames.shift();t.frames.length?e(i):t.looping=!1,s&&s()}),this.looping=!0)},i.prototype.schedule=function(t,e){return this.frames[t]?this.schedule(t+1,e):(this.loop(),this.frames[t]=e)},t=t||new i,"undefined"!=typeof e&&e.exports?e.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):window.fastdom=t}(window.fastdom)},{}],464:[function(){(function(t){function e(t,i){if({}.hasOwnProperty.call(e.cache,t))return e.cache[t];var s=e.resolve(t);if(!s)throw new Error("Failed to resolve module "+t);var o={id:t,require:e,filename:t,exports:{},loaded:!1,parent:i,children:[]};i&&i.children.push(o);var n=t.slice(0,t.lastIndexOf("/")+1);return e.cache[t]=o.exports,s.call(o.exports,o,o.exports,n,t),o.loaded=!0,e.cache[t]=o.exports}e.modules={},e.cache={},e.resolve=function(t){return{}.hasOwnProperty.call(e.modules,t)?e.modules[t]:void 0},e.define=function(t,i){e.modules[t]=i};var i=function(e){return e="/",{title:"browser",version:"v0.10.26",browser:!0,env:{},argv:[],nextTick:t.setImmediate||function(t){setTimeout(t,0)},cwd:function(){return e},chdir:function(t){e=t}}}();e.define("/gif.coffee",function(t){function i(t,e){return{}.hasOwnProperty.call(t,e)}function s(t,e){for(var i=0,s=e.length;s>i;++i)if(i in e&&e[i]===t)return!0;return!1}function o(t,e){function s(){this.constructor=t}for(var o in e)i(e,o)&&(t[o]=e[o]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t}var n,r,a,l,h;a=e("events",t).EventEmitter,n=e("/browser.coffee",t),h=function(t){function e(t){var e,i;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t);for(e in r)i=r[e],null!=this.options[e]?this.options[e]:this.options[e]=i}return o(e,t),r={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null},l={delay:500,copy:!1},e.prototype.setOption=function(t,e){return this.options[t]=e,null==this._canvas||"width"!==t&&"height"!==t?void 0:this._canvas[t]=e},e.prototype.setOptions=function(t){var e,s;return function(o){for(e in t)i(t,e)&&(s=t[e],o.push(this.setOption(e,s)));return o}.call(this,[])},e.prototype.addFrame=function(t,e){var i,s;null==e&&(e={}),i={},i.transparent=this.options.transparent;for(s in l)i[s]=e[s]||l[s];if(null!=this.options.width||this.setOption("width",t.width),null!=this.options.height||this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!=ImageData&&t instanceof ImageData)i.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?i.data=this.getContextData(t):i.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?i.data=this.getImageData(t):i.image=t}return this.frames.push(i)},e.prototype.render=function(){var t,e;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(e){for(var i=function(){var t;t=[];for(var e=0;0<=this.frames.length?e<this.frames.length:e>this.frames.length;0<=this.frames.length?++e:--e)t.push(e);return t}.apply(this,arguments),s=0,o=i.length;o>s;++s)t=i[s],e.push(null);return e}.call(this,[]),e=this.spawnWorkers();for(var i=function(){var t;t=[];for(var i=0;e>=0?e>i:i>e;e>=0?++i:--i)t.push(i);return t}.apply(this,arguments),s=0,o=i.length;o>s;++s)t=i[s],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},e.prototype.abort=function(){for(var t;;){if(t=this.activeWorkers.shift(),!(null!=t))break;console.log("killing active worker"),t.terminate()}return this.running=!1,this.emit("abort")},e.prototype.spawnWorkers=function(){var t;return t=Math.min(this.options.workers,this.frames.length),function(){var e;e=[];for(var i=this.freeWorkers.length;this.freeWorkers.length<=t?t>i:i>t;this.freeWorkers.length<=t?++i:--i)e.push(i);return e}.apply(this,arguments).forEach(function(t){return function(e){var i;return console.log("spawning worker "+e),i=new Worker(t.options.workerScript),i.onmessage=function(t){return function(e){return t.activeWorkers.splice(t.activeWorkers.indexOf(i),1),t.freeWorkers.push(i),t.frameFinished(e.data)}}(t),t.freeWorkers.push(i)}}(this)),t},e.prototype.frameFinished=function(t){return console.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,s(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},e.prototype.finishRendering=function(){var t,e,i,s,o,n,r;o=0;for(var a=0,l=this.imageParts.length;l>a;++a)e=this.imageParts[a],o+=(e.data.length-1)*e.pageSize+e.cursor;o+=e.pageSize-e.cursor,console.log("rendering finished - filesize "+Math.round(o/1e3)+"kb"),t=new Uint8Array(o),n=0;for(var h=0,d=this.imageParts.length;d>h;++h){e=this.imageParts[h];for(var c=0,u=e.data.length;u>c;++c)r=e.data[c],i=c,t.set(r,n),n+=i===e.data.length-1?e.cursor:e.pageSize}return s=new Blob([t],{type:"image/gif"}),this.emit("finished",s,t)},e.prototype.renderNextFrame=function(){var t,e,i;if(0===this.freeWorkers.length)throw new Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(t=this.frames[this.nextFrame++],i=this.freeWorkers.shift(),e=this.getTask(t),console.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(i),i.postMessage(e))},e.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},e.prototype.getImageData=function(t){var e;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),e=this._canvas.getContext("2d"),e.setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},e.prototype.getTask=function(t){var e,i;if(e=this.frames.indexOf(t),i={index:e,last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:"chrome"===n.name},null!=t.data)i.data=t.data;else if(null!=t.context)i.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");i.data=this.getImageData(t.image)}return i},e}(a),t.exports=h}),e.define("/browser.coffee",function(t){var e,i,s,o,n;o=navigator.userAgent.toLowerCase(),s=navigator.platform.toLowerCase(),n=o.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],i="ie"===n[1]&&document.documentMode,e={name:"version"===n[1]?n[3]:n[1],version:i||parseFloat("opera"===n[1]&&n[4]?n[4]:n[2]),platform:{name:o.match(/ip(?:ad|od|hone)/)?"ios":(o.match(/(?:webos|android)/)||s.match(/mac|win|linux/)||["other"])[0]}},e[e.name]=!0,e[e.name+parseInt(e.version,10)]=!0,e.platform[e.platform.name]=!0,t.exports=e}),e.define("events",function(t,e){i.EventEmitter||(i.EventEmitter=function(){});var s=e.EventEmitter=i.EventEmitter,o="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=10;s.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._events.maxListeners=t},s.prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||o(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"!=typeof e){if(o(e)){for(var i=Array.prototype.slice.call(arguments,1),s=e.slice(),n=0,r=s.length;r>n;n++)s[n].apply(this,i);return!0}return!1}switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:var i=Array.prototype.slice.call(arguments,1);e.apply(this,i)}return!0},s.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",t,e),this._events[t])if(o(this._events[t])){if(!this._events[t].warned){var i;i=void 0!==this._events.maxListeners?this._events.maxListeners:n,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}this._events[t].push(e)}else this._events[t]=[this._events[t],e];else this._events[t]=e;return this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(t,e){var i=this;return i.on(t,function s(){i.removeListener(t,s),e.apply(this,arguments)}),this},s.prototype.removeListener=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var i=this._events[t];if(o(i)){var s=i.indexOf(e);if(0>s)return this;i.splice(s,1),0==i.length&&delete this._events[t]}else this._events[t]===e&&delete this._events[t];return this},s.prototype.removeAllListeners=function(t){return t&&this._events&&this._events[t]&&(this._events[t]=null),this},s.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),o(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}}),t.GIF=e("/gif.coffee")}).call(this,this)},{}],465:[function(t,e){var i=(t("lodash"),function(){function t(t,e){"number"==typeof t&&"number"==typeof e&&this.element.css({left:t+"px",top:e+"px"})}function e(){var t=this.element.get(0).getBoundingClientRect().left;0>t&&this.element.css("left","+="+-1*t+"px");var e=this.element.get(0).getBoundingClientRect().top;0>e&&this.element.css("top","+="+-1*e+"px")}var i=function(t){return this.element?(t=t||{},this.onShow=t.onShow||function(t){t.element.show()},this.onHide=t.onHide||function(t){t.element.hide()},this.isShown=!1,void this.element.hide()):(console.error("ControlBase requires an element"),null)};return i.prototype.hide=function(){this.isShown&&(this.isShown=!1,this.onHide(this))},i.prototype.showOverTarget=function(t,i){var s=t-this.element.width()/2,o=i-this.element.height()-10;this.show(s,o),e.call(this)},i.prototype.show=function(e,i){t.call(this,e,i),this.isShown||(this.isShown=!0,this.onShow(this))},i.prototype.size=function(t,e){t&&"number"==typeof t&&this.element.width(t),e&&"number"==typeof e&&this.element.width(e)},i}());e.exports=i},{lodash:"K2RcUv"}],466:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./sanitize"),n=function(){function t(t){t.normalize();for(var e=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1);e.nextNode();){var i=e.currentNode,o=s(i).parent().is(t);o&&""!==i.nodeValue.trim()&&s(i).wrap("<p>")}}function e(e){t(e),s(e).children().each(function(){var t=s(this).get(0),e=t.nodeName===p,i=t.nodeName===m;g(t)||f(t)||e||i||s(this).wrap("<p>")})}function n(t){return i.filter(s(t).find("*").toArray(),function(t){return g(t)||v(t)})}function r(t,o){t.normalize(),o||e(t);var r=n(t);(r.length||!o)&&(o&&(e(t),r=n(t)),s(t).empty(),i.each(r,function(e){var o=i.some(s(e).children().toArray(),function(t){return g(t)});(v(e)||!d(e)&&!o)&&s(t).append(e)}))}function a(t){var e=n(t);i.each(e,function(t){s(t).find("br:last-child").remove(),s(t).append("<br>"),s(t).contents().unwrap()})}function l(t){var i=b(t);i.shift();for(var o=i.shift();o&&!s(o).is("[contentEditable]");){var n=o.parentNode;s(o).contents().unwrap(),e(n),o=i.shift()}}function h(t){if(t&&t.length){for(var e=t.shift(),o=!1,n=["style","dir"];e;){var r=s(e).find("span").toArray();"SPAN"===e.nodeName&&r.push(e),r.length&&(o=!0),s(r).contents().unwrap(),i.each(n,function(t){s(e).removeAttr(t),s(e).find("["+t+"]").removeAttr(t)}),e=t.shift()}return o}}function d(t,e){var i=s(t).text();e&&(i=i.replace(/\n|\r/gm,"").trim());var o=t&&t.nodeName===m;return""===i&&!f(t)&&!_(t)&&!o}var c=["P","H2","BLOCKQUOTE","UL","OL","PRE"],u=["FIGURE","IFRAME","IMG","HR"],p="DIV",m="HR",g=function(t){return i.contains(c,t.nodeName)},f=function(t){return t&&i.contains(u,t.nodeName)},_=function(t){return s(t).find(u.join()).length},v=function(t){return"false"===s(t).attr("contenteditable")},b=function(t){return i.filter(t,function(t){return i.contains(c,t.nodeName)})},y=function(t){this.sanitizeConfig=t};return y.prototype.flattenBlocksDown=function(t,e){r(t,e)},y.prototype.unwrapParentBlocks=function(t){l(t)},y.prototype.scrubSpansAndBadAttrs=function(t,e){return h(t,e)},y.prototype.blockifyInlineNodes=function(t){e(t)},y.prototype.inlinify=function(t){a(t)},y.prototype.getBlockNodes=function(t){return n(t)},y.prototype.isEmptyElement=function(t,e){return d(t,e)},y.prototype.filterHTML=function(t){var e=document.createElement("div");e.innerHTML=t;var i=new o(this.sanitizeConfig),s=i.clean_node(e),n=document.createElement("div");n.appendChild(s.cloneNode(!0));var r=n.innerHTML,a=r.replace(/(?:\r?\n|\r)+/,"");return a=a.replace(/[<]p[>][ ]*[<]\/p[>]/g,"")},y.prototype.filterPlaintext=function(t,e){var s=i.escape(t);return s=s.replace(/\r\n/g,"\n"),s=s.replace(/\r/g,"\n"),e&&(s=s.replace(/\n([ ]*\n)+/g,"</p><p>")),s=s.replace(/\n/g,"<br>"),e&&(s="<p>"+s+"</p>"),s},y.prototype.convertToBrowserSpaces=function(t){return t.replace(/[ ]{2}/g,"  ").replace(/[ ]$/," ")},y.prototype.sanitizeIFrames=function(t){var e=document.createElement("div");return e.innerHTML=t,s(e).find("iframe").each(function(){s(this).attr("data-original-src",s(this).attr("src")),s(this).attr("src","javascript:''")}),e.innerHTML},y.prototype.unSanitizeIFrames=function(t){var e=document.createElement("div");return e.innerHTML=t,s(e).find("iframe[data-original-src]").each(function(){s(this).attr("src",s(this).attr("data-original-src")),s(this).removeAttr("data-original-src")}),e.innerHTML},y}();e.exports=n},{"./sanitize":475,jquery:"HlZQrA",lodash:"K2RcUv"}],467:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("velocity-animate"),n=o.animate,r=t("./controlBase"),a=function(){function t(){var t=this,e=i.reduce(this.controlsOrder,function(t,e){return i.has(this.controls,e)&&t.push(this.template(i.extend({name:e},this.controls[e]))),t},[],this);this.element=s("<div />",{"class":"bubbles"}).css({position:"absolute",top:0,left:0}).html(e),this.buttons=s(this.element).find("[data-command]"),this.hide(),this.buttons.on("mousedown",function(t){t.preventDefault()}),this.buttons.on("mouseup",function(e){e.preventDefault(),l.call(t,this)})}function e(){i.each(this.controls,function(t,e){i.has(t,"keyboard")&&this.keyboardEvents.on(t.keyboard,i.partial(a.bind(this),e)),i.has(t,"keyboardInverse")&&this.keyboardEvents.on(t.keyboardInverse,i.partial(o.bind(this),e))},this)}function o(t){i.has(this.controls,t)&&u[t]&&a.call(this,t)}function a(t){var e,s,o,n;i.has(this.controls,t)&&(e=u[t],s=this.controls[t],o=s.command,n=s.el,e&&this.inverseCommand&&"function"==typeof this.inverseCommand?this.inverseCommand(o,n,this):this.applyCommand&&"function"==typeof this.applyCommand&&this.applyCommand(o,n,this),this.onAction(this))}function l(t){a.call(this,s(t).attr("data-name"))}function h(){this.buttons.removeClass("active"),this.buttons.filter(function(){return u[s(this).attr("data-name")]}).addClass("active")}function d(t,e){var i=!1;return s.each(t,function(t,s){return s===e||"undefined"!=typeof s.nodeName&&s.nodeName===e?(i=!0,!1):void 0}),i}var c='<div class="<%= className %>" title="<%= title %>" data-name="<%= name %>" data-el="<%= el %>" data-command="<%= command %>" data-type="<%= type %>">&nbsp;</div>',u={},p=function(s,o,n){n=n||{},this.applyCommand=s,this.inverseCommand=o,this.template=i.template(n.template||c),this.controls=n.controls||{},this.controlsOrder=n.controlsOrder||i.keys(this.controls),this.onAction=n.onAction||i.noop,this.keyboardEvents=n.keyboardEvents,t.call(this),this.keyboardEvents&&e.call(this),r.call(this,n)};return i.assign(p.prototype,r.prototype),p.prototype.setActives=function(t){u=i.reduce(this.controls,function(e,i,s){var o=i.command,n=(i.el||"").toUpperCase(),r=d(t,n),a=!1;try{a=document.queryCommandEnabled(o)&&document.queryCommandState(o)}catch(l){a=!1}return e[s]=a||r,e},{},this),h.call(this)},p.prototype.open=function(t,e){if(!this.isShown){var i=s(this.element).children("[data-command]"),o=s(this.element).find(".shim");s(this.element).css({width:"auto"}),o.remove(),i.removeAttr("style")}this.showOverTarget(t,e)},p.prototype.closeWithShim=function(t,e,o,r){var a=s(this.element),l=s(t),h=s('<div class="shim">&nbsp;</div>').get(0),d=i.has(n,"Promise");o=d?o:200;var c=a.width();a.css("width",c+e);var u=l.position().left,p=c/2-(u+e/2);l.before(h).hide();var m=s(h).offset().left+p,g=s(h).offset().top;this.isAnimating=!0,i.forEach(this.buttons,function(t){n(t,"stop"),n(t,{opacity:0},{duration:.5*o})}),n(a,{left:"+="+p},{easing:"ease",duration:o});var f=n(h,{width:e},{easing:"ease",duration:o}),_=i.bind(function(){i.isFunction(r)&&r.call(this,m,g),this.isAnimating=!1,this.hide()},this);d?f.then(_):i.delay(_,o)},p.prototype.getActiveStates=function(){return u},p}();e.exports=a},{"./controlBase":465,jquery:"HlZQrA",lodash:"K2RcUv","velocity-animate":"lWl/mc"}],468:[function(t,e){var i=t("lodash"),s=function(){function t(){return navigator.platform.match(/^Win/i)?"Win":navigator.platform.match(/^Mac/i)?"Mac":navigator.platform.match(/^Linux/i)?"Linux":navigator.platform
}function e(){return i.extend({},this.prettyMapping,this.platformPrettyMapping[t.call(this)])}function s(){return this.platformModifiers[t.call(this)]||{}}function o(){var e=t.call(this);return i.has(this.platformPrettySeperators,e)?this.platformPrettySeperators[e]:this.seperator}function n(t){return this.specialKeys[t.keyCode]||String.fromCharCode(t.keyCode)}function r(t){return i.filter(this.modifiers,function(e){return t[e+"Key"]})}function a(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}var l=["ctrl","meta","alt","shift"],h="+",d={37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",187:"PLUS",61:"PLUS",188:"COMMA",189:"MINUS",173:"MINUS",190:"DOT"},c={LEFT:"←",RIGHT:"→",DOWN:"↓",UP:"↑",PLUS:"+",COMMA:",",MINUS:"-",DOT:"."},u={Win:{meta:"ctrl"},Linux:{meta:"ctrl"}},p={Mac:{meta:"⌘",shift:"⇧",alt:"⌥"}},m={Win:"-",Linux:"-",Mac:""},g=function(t){t=t||{},this.modifiers=t.modifiers||l,this.separator=t.separator||h,this.specialKeys=t.specialKeys||d,this.prettyMapping=t.prettyMapping||c,this.platformModifiers=t.platformsModififiers||u,this.platformPrettyMapping=t.platformPrettyModifiers||p,this.platformPrettySeperators=t.platformPrettySeperators||m};return g.prototype.translate=function(t){var e=r.call(this,t);return 0===e.length?null:e.concat(n.call(this,t)).join(this.separator)},g.prototype.normalize=function(t){var e=t.split(this.separator),o=s.call(this),n="";return i.each(this.modifiers,function(t){var s=i.indexOf(e,t.toLowerCase()),r=o[t]||t;s>=0&&(n+=r+this.separator,e.splice(s,1))},this),n+e.join(this.separator).toUpperCase()},g.prototype.pretty=function(t){var s=this.normalize(t),n=e.call(this),r=o.call(this);return i.map(s.split(this.separator),function(t){return n[t]||a(t)},this).join(r)},g}();e.exports=s},{lodash:"K2RcUv"}],469:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./controlBase"),n=function(){function t(){this.element=s("<div />",{"class":"inline-controls"}).css({position:"absolute",top:0,left:0}),this.opener=s("<div />",{"class":"opener"}),this.isTrayOpen=!1;var t=this;this.opener.on("mousedown",function(i){return i.preventDefault(),i.stopPropagation(),e.call(t,null,!0),!1}),this.tray=s("<div />",{"class":"tray"}),this.element.append(this.opener),this.element.append(this.tray),this.hide()}function e(t,e){"boolean"!=typeof t&&(t=!this.isTrayOpen),t?(this.openTray.call(this,this.tray),this.isTrayOpen=!0,this.onTrayOpened.call(this,e)):(this.closeTray.call(this,this.tray),this.isTrayOpen=!1,this.onTrayClosed.call(this,e)),s(this.opener).toggleClass("open",this.isTrayOpen),e?s(this.opener).toggleClass("closed",!this.isTrayOpen):s(this.opener).removeClass("closed")}var n=function(e){e=e||{},this.openTray=e.openTray||this.openTray,this.closeTray=e.closeTray||this.closeTray,this.onTrayOpened=e.onTrayOpened||function(){},this.onTrayClosed=e.onTrayClosed||function(){},this.customOffset=e.customOffset||i.noop,this.keyboardEvents=e.keyboardEvents,t.call(this),o.call(this,e)};i.assign(n.prototype,o.prototype);var r=i.memoize(function(t,e){var s;return i.isFunction(e)?s=e.call():i.isObject(e)&&(s=e),i.pick(i.defaults(i.isObject(s)?s:{},{x:t.x||t,y:t.y||0}),["x","y"])});return n.prototype.addToTray=function(t,e){var i;e=e||{},this.tray.append(t),i=e.keyboard,this.keyboardEvents&&i&&this.keyboardEvents.on(i.shortcut,i.callback,i.context)},n.prototype.openTray=function(t){t.show()},n.prototype.closeTray=function(t){t.hide()},n.prototype.open=function(t,i){if(t){i=r(i||0,this.customOffset||0);var o=s(t).position(),n=parseInt(s(t).css("margin-top"),10)||0;e.call(this,!1),this.show(o.left+i.x,o.top+i.y+n)}},n.prototype.close=function(){e.call(this,!1),this.hide()},n.prototype.toggleTrayWithIntent=function(t){e.call(this,t,!0)},n}();e.exports=n},{"./controlBase":465,jquery:"HlZQrA",lodash:"K2RcUv"}],470:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./humanKeys"),n=function(){function t(){s(this.element).on("keydown.keycombos",n.bind(this)),this.listening=!0}function e(){s(this.element).off("keydown.keycombos"),this.listening=!1}function n(t){var e=this.humanKeys.translate(t);e&&a.call(this,e)&&(r.call(this,e,t),t.preventDefault(),t.stopImmediatePropagation())}function r(t,e){i.each(h.call(this,t),function(t){i.has(t,"callback")&&i.has(t,"context")&&t.callback.call(t.context,e)})}function a(t){return h.call(this,t).length>0}function l(t,e){var s=h.call(this,t);return i.filter(s,{callback:e}).length>0}function h(t){return i.has(this.subscribers,t)?this.subscribers[t]:[]}function d(e,s,o){return l.call(this,e,s)?void 0:(i.has(this.subscribers,e)||(this.subscribers[e]=[]),this.subscribers[e].push({callback:s,context:o}),this.listening||t.call(this),this)}function c(){this.subscribers={},e.call(this)}function u(t,s){return t?i.has(this.subscribers,t)?(s&&(this.subscribers[t]=i.reject(this.subscribers[t],{callback:s})),s&&0!==this.subscribers[t].length||delete this.subscribers[t],0===i.values(this.subscribers).length&&e.call(this),this):this:(c.call(this),this)}var p=function(t){t=t||{},this.debounceRate=t.debounceRate||100,this.element=t.element||document,this.humanKeys=t.humanKeys||new o,this.subscribers={},this.listening=!1};return p.prototype.on=function(t,e,i){return d.call(this,this.humanKeys.normalize(t),e,i)},p.prototype.off=function(t,e){return u.call(this,t?this.humanKeys.normalize(t):null,e)},p}();e.exports=n},{"./humanKeys":468,jquery:"HlZQrA",lodash:"K2RcUv"}],471:[function(t,e){var i={RichTextEditor:t("./richTextEditor"),PlainTextEditor:t("./plainTextEditor"),SelectionContext:t("./selectionContext"),SelectionPersistence:t("./selectionPersistence"),HumanKeys:t("./humanKeys")};e.exports=i},{"./humanKeys":468,"./plainTextEditor":473,"./richTextEditor":474,"./selectionContext":476,"./selectionPersistence":477}],472:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("velocity-animate"),n=t("./utils"),r=t("./selectionPersistence"),a=t("./controlBase"),l=function(){function t(){this.element=s("<div />",{"class":"link-bubbles"}).css({position:"absolute",top:0,left:0}),this.linkUrl=s("<div />",{"class":"url"}),this.linkEditInput=s("<input />",{type:"text",placeholder:"http://"}),this.linkEditDone=s("<div />",{"class":"done"}).text("Done"),this.linkUrl.hide(),this.linkUrl.append(this.linkEditInput).append(this.linkEditDone),e.call(this),this.element.append(this.linkUrl),this.hide()}function e(){var t=this,e=s("<div />",{"class":"options"}),i={edit:function(){l.call(this)},remove:function(){var t=window.getSelection(),e=document.createRange();e.selectNodeContents(this.linkElement),t.removeAllRanges(),t.addRange(e),window.document.execCommand("unlink",!1,null),t.removeAllRanges(),this.onChange(),this.hide()},open:function(){var t=s(this.linkElement).attr("href");-1===t.indexOf("://")&&(t="http://"+t),window.open(t,"_blank")}};for(var o in i){var n=s("<div />",{"class":o}).text(o);s(n).on("click",function(e){return function(){e.call(t)}}(i[o])),e.append(n)}e.hide(),s(this.element).append(e)}function l(){this.linkElement||console.error("Cannot edit link without a valid linkElement");var t=this.linkElement;h.call(this,function(e){s(t).attr("href",e)},s(t).attr("href"))}function h(t,e){e&&(this.linkEditInput.val(e),this.linkUrl.addClass("modified"));var i=this,o=function(){var e=s(i.linkEditInput).val().trim();t(e),i.onChange(),i.close()};s(this.linkEditInput).on("keydown",function(t){i.linkUrl.addClass("modified"),t.keyCode===c.enter?(t.preventDefault(),o()):t.keyCode===c.esc&&(i.close(),i.onDismiss(),t.stopPropagation())}),s(this.linkEditInput).on("keyup",function(t){t.keyCode!==c.esc&&t.keyCode!==c.enter&&d.call(i)}),s(this.linkEditInput).on("paste",function(){i.linkUrl.addClass("modified"),d.call(i)}),this.linkEditDone.on("click",function(t){t.preventDefault(),o()}),this.element.find(".options").hide(),this.linkUrl.show(),this.show(),d.call(this),s(this.linkEditInput).focus()}function d(){var t=s(this.linkEditInput).val(),e=s(this.linkEditDone).outerWidth(),i=s(this.linkUrl).outerWidth()-s(this.linkUrl).width(),r=n.calcTextWidth(s(this.linkEditInput).get(0),t),a=n.calcTextWidth(s(this.linkEditInput).get(0),"A"),l=r+e+i+a,h=l<this.minWidth?this.minWidth:l;h=h>this.maxWidth?this.maxWidth:h;var d=s(this.element),c=h-d.width();if(0!==c){var u=Math.floor(c/2);o(d,{width:h,left:"-="+u},{duration:40,easing:"ease"})}}var c={shift:16,enter:13,esc:27,"delete":8,tab:9},u=function(e){this.onChange="onChange"in e&&i.isFunction(e.onChange)?e.onChange:i.noop,this.onDismiss=e.onDismiss||i.noop,this.bypassClasses="bypassClasses"in e&&i.isArray(e.bypassClasses)?e.bypassClasses:[],this.maxWidth="maxWidth"in e&&i.isNumber(e.maxWidth)?e.maxWidth:600,this.minWidth="minWidth"in e&&i.isNumber(e.minWidth)?e.minWidth:200,this.linkElement=null,t.call(this),a.call(this)};return i.assign(u.prototype,a.prototype),u.prototype.createLink=function(t){h.call(this,function(e){r.restoreSelection(t),window.document.execCommand("createLink",!1,e);var i=window.getSelection(),s=i.getRangeAt(0);s.collapse(!1),i.removeAllRanges(),i.addRange(s)})},u.prototype.showOptions=function(t){this.linkElement=t,this.linkUrl.hide(),this.element.css({width:"",left:0}),this.element.find(".options").show()},u.prototype.close=function(){this.linkUrl.hide(),this.element.find(".options").hide(),this.element.css("width",""),this.linkEditInput.val("").unbind(),this.linkEditDone.unbind(),this.linkUrl.removeClass("modified"),this.linkElement=null,this.hide()},u.prototype.isValidLink=function(t){return t?!i.some(this.bypassClasses,function(e){return s(t).hasClass(e)}):!1},u}();e.exports=l},{"./controlBase":465,"./selectionPersistence":477,"./utils":479,jquery:"HlZQrA",lodash:"K2RcUv","velocity-animate":"lWl/mc"}],473:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("./dataFilter"),n=t("./selectionPersistence"),r=t("./selectionContext"),a=t("./undoManager"),l=function(){function t(){u.call(this,f);var t=s("<div />",{"data-js":"editor-wrapper","class":"editor-wrapper"}).css("position","relative"),i=s("<div />",{"data-js":"editor-slot","class":"editor-slot"}).css("position","relative");s(this.element).wrap(t).wrap(i),this.placeholderElement=s("<div />",{"data-js":"editor-placeholder","class":"editor-placeholder"}).css("position","absolute"),i=s(this.element).parent(),i.append(this.placeholderElement),h.call(this),e.call(this)}function e(){var t=this;s(this.element).on("input keydown keyup keypress mousedown mouseup",function(e){t.config.onClientEvent.call(t,e)}),s(this.element).on("keydown",function(e){return 16===e.keyCode&&(t.keyModifiers.shift=!0),13===e.keyCode?(t.config.forceSingleLine||e.metaKey||g(this,!1),void e.preventDefault()):void i.defer(function(){t.onChange(e)})}),s(this.element).on("keyup",function(e){16===e.keyCode&&(t.keyModifiers.shift=!1),l.call(t,e),t.onChange(e)});var e=!1;s(this.element).on("mouseup",function(){e=!1,l.call(t)}),s(this.element).on("mousedown",function(){e=!0}),s(this.element).on("mouseleave",function(){e&&l.call(t)}),s(this.element).on("paste",function(e){var i=(e.originalEvent||e).clipboardData;t.config.pasteHook(i,t.keyModifiers.shift)||d.call(t,i,e),e.preventDefault()}),s(this.element).on("drop",function(t){t.stopPropagation(),t.preventDefault()}),this.placeholderElement.on("click",function(){t.isEmpty()&&s(t.element).focus()}),s(this.element).on("focus",function(){i.defer(function(){t.onChange()})})}function l(){var t=this;setTimeout(function(){var e=window.getSelection();t.config.onSelection.call(t,e)},200)}function h(){var t=this.isEmpty()?this.config.placeholder:"",e=s(this.placeholderElement);e.html(t);var i=e.outerHeight();i&&s(this.element).css("min-height",Math.max(parseInt(e.css("min-height"),10)||0,i))}function d(t,e){var s="";if(i.contains(t.types,"text/plain"))s=t.getData("text/plain"),s=this.dataFilter.filterPlaintext(s),m.call(this,s);else{if(!i.contains(t.types,"text/html"))return;s=t.getData("text/html"),s=this.dataFilter.filterHTML(s);var o=s.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1"),n=document.createElement("div");n.innerHTML=o;var r=n.textContent||n.innerText||"",a=r.split("\n").join("<br>");m.call(this,a)}if(this.config.forceSingleLine){var l=p.call(this).replace(/<br\s*\/*>/g," ");u.call(this,l)}this.onChange(e)}function c(){s(this.element).contents().filter(function(){return 3===this.nodeType}).wrap("<span></span>")}function u(t){s(this.element).html(t)}function p(){return s(this.element).html().trim()}function m(t){if(t=t.replace(/[<]br\s?\/?[>]$/,""),t=this.dataFilter.convertToBrowserSpaces(t),!t)return void console.warn("Cannot insert empty data");var e=r.getSelection();if(!e||!e.focusNode)return void console.warn("Cannot insert without the editor having a cursor or selection");var i=e.getRangeAt(0);i.deleteContents();var s=i.createContextualFragment(t);i.insertNode(s),e.removeAllRanges(),i.collapse(!1),e.addRange(i)}function g(t,e){if(e||t.lastChild&&"br"===t.lastChild.nodeName.toLowerCase()||t.appendChild(document.createElement("br")),window.getSelection){var i=window.getSelection(),s=i.getRangeAt(0),o=document.createElement("br");s.deleteContents(),s.insertNode(o),s.setStartAfter(o),s.setEndAfter(o),s.collapse(!1),i.removeAllRanges(),i.addRange(s)}}var f="<span>&#8203;</span>",_="<span>​</span>",v=/\u200B/g,b=function(e,s){if(!e)throw new Error("A valid element parameter is required to initalize the editor");this.element=e,this.config={placeholder:!1,onChange:function(){},onSelection:function(){},onClientEvent:function(){},pasteHook:function(){return!1},filterForSetData:function(t){return t},filterForGetData:function(t){return t},filterRules:{elements:["p","br","div"],attributes:{},remove_contents:["style","noscript","script","meta"],protocols:{}},forceSingleLine:!1},i.extend(this.config,s||{}),this.dataFilter=new o(this.config.filterRules),this.onChange=function(){c.call(this),h.call(this),this.config.onChange.apply(this,arguments)},this.keyModifiers={shift:!1},this.undoManager=new a(this),t.call(this)};return b.prototype.getData=function(t){var e=p.call(this);e=this.config.filterForGetData.call(this,e);var i=e.replace(/<br(\s*)\/*>/gi,"\n").replace(/(<[p|div])/gi,"\n$1").replace(v,""),s=document.createElement("div");s.innerHTML=i;var o=s.textContent||s.innerText||"",n=t?o.trim():o;return n},b.prototype.setData=function(t){t=this.config.filterForSetData.call(this,t),t=this.dataFilter.filterPlaintext(t),u.call(this,t),this.onChange()},b.prototype.setHTML=function(t){u.call(this,t),this.onChange()},b.prototype.getHTML=function(){return p.call(this)},b.prototype.insertData=function(t,e){e&&(t=this.dataFilter.filterHTML(t)),m.call(this,t),this.onChange()},b.prototype.blur=function(){return s(this.element).blur()},b.prototype.focus=function(t){var e=s(this.element).focus();return t||this.setCursorToEnd(),e},b.prototype.hasFocus=function(){return s(this.element).is(":focus")},b.prototype.setPlaceholder=function(t){this.config.placeholder=t,h.call(this)},b.prototype.isEmpty=function(){var t=this.getData(!1);if(""===t||"\n"===t||"\r\n"===t)return!0;var e=p.call(this);return e===f||e===_||""===e},b.prototype.getCurrentElement=function(){return r.getNearestElement()},b.prototype.setCursorToStart=function(){var t=s(this.element).children().first().get(0);t&&n.setToStart(t)},b.prototype.setCursorToEnd=function(){var t=s(this.element).children().last().get(0);t&&n.setToEnd(t)},b}();e.exports=l},{"./dataFilter":466,"./selectionContext":476,"./selectionPersistence":477,"./undoManager":478,jquery:"HlZQrA",lodash:"K2RcUv"}],474:[function(t,e){var i=t("lodash"),s=t("jquery"),o=t("velocity-animate").animate,n=t("./linkControl"),r=t("./formattingControls"),a=t("./dataFilter"),l=t("./selectionPersistence"),h=t("./selectionContext"),d=t("./inlineControls"),c=t("./utils"),u=t("./undoManager"),p=t("./keyComboEvents"),m=t("./humanKeys"),g=(window.URL||window.webkitURL||window.mozURL||window.msURL||{}).createObjectURL,f=function(){function t(t,e){return i.mapValues(t,function(t,e){return e.match(/^on[A-Z]/)&&i.isFunction(t)?i.bind(t,this):t},e)}function e(){M.call(this,re);var t=s("<div />",{"data-js":"editor-wrapper","class":"editor-wrapper"}).css("position","relative"),e=s("<div />",{"data-js":"editor-slot","class":"editor-slot"}).css("position","relative");s(this.element).wrap(t).wrap(e),e=s(this.element).parent(),this.wrapper=e.parent().get(0),this.placeholderElement=s("<div />",{"data-js":"editor-placeholder","class":"editor-placeholder"}).css("position","absolute"),e.append(this.contextualControls.element),e.append(this.linkControl.element),e.append(this.placeholderElement),e.append(this.inlineControls.element),L.call(this),this.controlBar=s("<div />",{"data-js":"control-bar","class":"control-bar disabled"});var o=s("<div />",{"class":"static-controls control"});this.controlBar.append(o),this.controlBar.append(this.staticControls.element);var n=this;o.on("mousedown",function(t){t.preventDefault(),t.stopPropagation();var e=h.getNodeList();n.staticControls.setActives(i.pluck(e,"nodeName"));var o=s(this).position();return n.staticControls.isShown?n.staticControls.hide():n.staticControls.open(o.left+s(this).width()/2,0),n.contextualControls.hide(),n.linkControl.close(),!1}),this.config.showStaticControls&&s(this.wrapper).append(this.controlBar),f.call(this),k.call(this)}function f(){var t=this,e=function(){var e=t.inlineControls.isTrayOpen||t.contextualControls.isShown||t.staticControls.isShown||t.linkControl.isShown;return e};s(this.element).on("input keydown keyup keypress mousedown mouseup",function(e){t.controlBar.removeClass("disabled"),t.config.onClientEvent.call(t,e)}),s(this.element).on("keydown",function(i){return i.keyCode===ue.shift&&(t.keyModifiers.shift=!0),i.keyCode===ue.esc?void(e()&&(t.contextualControls.hide(),t.staticControls.hide(),t.inlineControls.isTrayOpen&&t.inlineControls.toggleTrayWithIntent(!1),i.stopPropagation())):(i.keyCode===ue.backspace?(x.call(t,i),H.call(t)):i.keyCode===ue.enter&&(v.call(t,i),_.call(t,i)),$.call(t,i),void F.call(t,i))}),s(this.element).on("keyup",function(e){e.keyCode===ue.shift?t.keyModifiers.shift=!1:e.keyCode===ue.enter?(H.call(t),b.call(t)):(e.keyCode===ue.backspace||e.keyCode===ue["delete"])&&(P.call(t),i.defer(function(){w.call(t)}));var s=!1;e.keyCode===ue.right&&!e.shiftKey&&t.inlineControls&&(s=t.inlineControls.isShown),e.keyCode===ue.esc||s||(F.call(t,e),t.onChange())});var o=!1;s(this.element).on("mouseup",function(){o=!1,F.call(t)}),s(this.element).on("mousedown",function(){o=!0}),document.addEventListener("mousedown",function(e){t.wrapper===e.target||s.contains(t.wrapper,e.target)||(o=!1,y.call(t),t.controlBar.addClass("disabled"))},!0),document.addEventListener("mouseup",function(){o&&(F.call(t),o=!1)},!0),s(this.element).on("focus",function(){t.controlBar.removeClass("disabled"),i.defer(function(){t.onChange()})}),s(this.element).on("blur",function(){i.defer(function(){if(!e()){var i=h.getSelection();i&&h.isInContext(i,t.element)&&i.removeAllRanges(),t.lastSelection=null,F.call(t)}})}),s(this.element).on("paste",function(e){var i=(e.originalEvent||e).clipboardData;i&&(t.config.pasteHook(i,t.keyModifiers.shift)||I.call(t,i),D.call(t),e.preventDefault())}),s(this.element).on("cut",function(){t.contextualControls.hide(),t.staticControls.hide(),t.linkControl.close(),i.defer(function(){w.call(t),D.call(t),t.onChange()})})}function _(t){var e,o,n=h.getNodeByNames(he);n&&!this.keyModifiers.shift&&h.isCursorAtEnd(n)&&(o=s(n),e=o.text(),t.preventDefault(),e.match(/\n\n$/)?(i.last(o.contents()).remove(),this.insertNewParagraphAfter(n)):(o.append("\n\n"),l.setToEnd(n)))}function v(t){var e=h.getNodeByNames(["BLOCKQUOTE"]);if(e&&!this.keyModifiers.shift&&h.isCursorAtEnd(e)){t.preventDefault();var i="BR"===e.lastChild.nodeName?e.lastChild:null;if(!i){var o=document.createElement("br");s(e).append(o),i=o}if(i.previousSibling&&"BR"===i.previousSibling.nodeName)s(i).remove(),this.insertNewParagraphAfter(e);else{var n=document.createElement("br"),r=document.createElement("span");s(e).append(n),s(e).append(r),l.setToStart(r),s(r).remove()}}}function b(){var t=h.getNodeByNames(["BLOCKQUOTE"]);if(t){var e=h.getNodeByNames(le),i=e===t,o=s(e).is(":last-child");i&&this.dataFilter.isEmptyElement(t)?S.call(this,"formatBlock","p"):!i&&this.dataFilter.isEmptyElement(e)&&o&&(s(e).remove(),s(t).find("p").each(function(){s(this).find("br:last-child").length||s(this).append("<br>"),s(this).contents().unwrap()}),this.insertNewParagraphAfter(t))}}function y(){this.contextualControls.hide(),this.staticControls.hide(),this.linkControl.close(),this.inlineControls.close()}function w(){if(!s(this.element).has(ce.join()).length){var t=s(this.element).find("ul:not(:has(li)),ol:not(:has(li))");t.remove();var e=i.some(s(this.element).children().toArray(),function(t){return s(t).text().length>0});e||(M.call(this,""),H.call(this),L.call(this))}}function x(t){var e=h.getSelection();if(e.isCollapsed){var i=N.call(this);if(i&&!(l.saveSelection(i).start>0)){var o=s(i).prev().get(0);o&&se.call(this,o)&&(s(o).remove(),t.preventDefault())}}}function k(){var t=this,e=s(t.element).offset().top,o=null,n="dragstart dragenter dragleave dragover dragend drop",r=!1,a=function(t){var e=t.dataTransfer.types&&i.some(t.dataTransfer.types,function(t){return"Files"===t});return e},l=function(t){return"false"===s(t.target||t.srcElement).attr("contenteditable")},h=function(e,s,o){e.length&&(t.onChange(),i.each(e,function(e){t.config.onFileAdded.call(t,e,s,o)}),F.call(t))},d=function(t,e){return t<e.top+.66*e.height},c=function(t,i){var o=s(i).offset().top-e,n=s(i).get(0).getBoundingClientRect().height,r=t>o+.66*n;return{element:i,top:o,bottom:o+n,height:n,isAfter:r}},u=function(){s(t.element).find(".over-top, .over-bottom").each(function(){s(this).removeClass("over-top").removeClass("over-bottom"),""===s(this).attr("class").trim()&&s(this).removeAttr("class")})},p=function(i){var n=null,r=i.pageY-e,a=s(t.element).children();o&&r>o.top&&d(r,o)||(a.each(function(){var t=c(r,this);return d(r,t)&&(i.target||i.srcElement)!==this?(n=t,!1):void 0}),n||(n=c(r,a.last().get(0)),n.isAfter=!0),n&&o&&o.element===n.element&&o.isAfter===n.isAfter||(u(),o=n))};s(t.element).unbind(n),s(t.element).on("dragleave",function(){u()}),s(t.element).on("dragover",function(t){return r?(i.debounce(p,100)(t.originalEvent),o&&(s(o.element).addClass(o.isAfter?"over-bottom":"over-top"),a(t.originalEvent)&&t.stopPropagation()),void t.preventDefault()):(t.preventDefault(),void t.stopPropagation())}),s(t.element).on("dragenter",function(t){t.preventDefault(),a(t.originalEvent)&&(r="file")}),s(t.element).on("dragstart",function(e){if(y.call(t),l(e.originalEvent)){r="media";var o=e.originalEvent.target||e.originalEvent.srcElement,n=e.originalEvent.dataTransfer;if(n){n.effectAllowed="move",n.dropEffect="move";try{var a=s(o).find("img").attr("src")||"";a.match(/^\s*data:/)&&(a=""),n.setData("text/uri-list",a),n.setData("text/plain",a)}catch(e){}}i.defer(function(){s(o).addClass("dragging")})}}),s(t.element).on("drop",function(t){u(),a(t.originalEvent)&&h(t.originalEvent.dataTransfer.files,o.element,o.isAfter?1:-1),t.stopPropagation(),t.preventDefault()}),s(t.element).on("dragend",function(e){if(l(e.originalEvent)){u();var i=e.originalEvent.target||e.originalEvent.srcElement,n=s(i).data("origHeight"),a=i;if(o&&a!==o.element){var h=s(i).remove();o.isAfter?s(o.element).after(h):s(o.element).before(h),X.call(t,h)}s(a).animate({height:n},200,function(){s(a).removeClass("dragging")}),t.onChange(),F.call(t)}r=!1})}function C(t,e,i){var o=s(this.element),n=l.saveSelection(this.element);o.find(i).wrap("<"+e+">"),o.find(i).contents().unwrap(),l.restoreSelection(n),window.document.execCommand(t),o.find(e).wrap("<"+i+">"),o.find(e).contents().unwrap(),l.restoreSelection(n)}function S(t,e,o){var n=this,r=function(){window.document.execCommand(t),n.config.flattenBlocks&&j.call(n)},a=function(){var t=l.saveSelection(n.element),e=200,i=240;!o||o.isAnimating||t.selection.isCollapsed||setTimeout(function(){s(n.linkControl.linkEditInput).focus();var r=function(i,o){var r=i-s(n.wrapper).offset().left,a=o-s(n.wrapper).offset().top;n.linkControl.size(e),n.linkControl.show(r,a),n.linkControl.createLink(t)};o.closeWithShim(o.element.find(".link").get(0),e,i,r),t.selection.removeAllRanges(),n.blur(!0)},30)},d=function(t){var e,i=h.getNodeByNames(["BLOCKQUOTE"]),s=h.getNodeByNames(he);i&&(T.call(n,"formatBlock",i.nodeName.toLowerCase()),n.dataFilter.inlinify(i)),s&&T.call(n,"formatBlock",s.nodeName.toLowerCase()),E.call(n,["UL","OL"]),e=window.document.execCommand("formatBlock",!1,"<"+t+">"),e||"blockquote"!==t||window.document.execCommand("indent"),R.call(this)},c=function(){var t=n.contextualControls.controls,e=n.contextualControls.getActiveStates();i.each(e,function(e,i){var s=t[i];e&&T.call(n,s.command,s.el)}),window.document.execCommand("removeFormat")};switch(t){case"formatBlock":d(e);break;case"createLink":a();break;case"insertOrderedList":r();break;case"insertUnorderedList":r();break;case"removeFormat":c();break;case"insertHTML":C.call(this,"underline","U",e);break;default:window.document.execCommand(t)}F.call(this),P.call(this),n.onChange()}function T(t,e){switch(t){case"formatBlock":switch(e){case"blockquote":E.call(this,["UL","OL"]);break;default:window.document.execCommand("formatBlock",!1,"<p>")}j.call(this);break;case"insertOrderedList":E.call(this,"OL");break;case"insertUnorderedList":E.call(this,"UL");break;case"createLink":window.document.execCommand("unlink");break;case"insertHTML":C.call(this,"underline","U",e);break;default:window.document.execCommand(t)}P.call(this),F.call(this),this.onChange()}function $(t){var e=function(){var t=h.getNodeByNames(["UL","OL"]);return!!t};t.keyCode===ue.tab&&e()&&(t.preventDefault(),t.stopPropagation(),t.shiftKey?(S.call(this,"outdent"),e()||S.call(this,"formatBlock","p")):S.call(this,"indent"))}function R(){var t=h.getNodeByNames(he);t&&s(t).find("br").replaceWith("\n")}function E(t){for(var e=["UL","OL"],s=!1,o=null;o=h.getNodeByNames(t);)window.document.execCommand(i.contains(e,o.nodeName)?"outdent":"outdent");s||h.getNodeByNames(["H2"])||window.document.execCommand("formatBlock",!1,"<p>"),this.dataFilter.blockifyInlineNodes(this.element)}function j(){var t=l.saveSelection(this.element),e=h.getNodeList();this.dataFilter.unwrapParentBlocks(e),l.restoreSelection(t)}function P(){var t=l.saveSelection(this.element),e=h.getNodeList(),i=this.dataFilter.scrubSpansAndBadAttrs(e);i&&t.end>t.start&&l.restoreSelection(t)}function F(){var t=this;setTimeout(function(){var e=window.getSelection();e.isCollapsed?U.call(t,e):A.call(t,e),J.call(t),B.call(t),t.config.onSelection.call(t,e),h.isInContext(e,t.element)&&(t.lastSelection=l.saveSelection(t.element)),D.call(t),L.call(t)},20)}function A(t){if(h.isInContext(t,this.element)){var e=h.getContextCoordinates(s(this.element).parent().parent()),o=h.getNodeList(t);this.contextualControls.setActives(i.pluck(o,"nodeName")),this.staticControls.setActives(i.pluck(o,"nodeName")),this.linkControl.close(),this.inlineControls.close(),""!==t.toString().trim()&&e&&!this.staticControls.isShown&&this.contextualControls.open(e.x,e.y)}}function U(t){this.contextualControls.hide();var e=h.getNodeList(t),o=i.find(e,function(t){return"A"===t.nodeName});if(this.linkControl.isValidLink(o)){var n=h.getContextCoordinates(s(this.element).parent().parent(),o);this.linkControl.showOptions(o),this.linkControl.showOverTarget(n.x,n.y)}else this.linkControl.close();this.staticControls.setActives(i.pluck(e,"nodeName"))}function D(){var t=h.getSelection(),e=t&&t.isCollapsed;if(!e||!h.isInContext(t,this.element))return void this.inlineControls.close();var i=N.call(this);if(i&&"P"===i.nodeName&&this.dataFilter.isEmptyElement(i)&&!this.isEmpty())this.inlineControls.open(i);else if(this.isEmpty()){this.inlineControls.open(i);var s=c.calcTextWidth(this.placeholderElement,this.config.placeholder);this.inlineControls.open(i,s)}else this.inlineControls.close()}function L(){var t=this.isEmpty()?this.config.placeholder:"",e=s(this.placeholderElement);e.html(t);var i=e.outerHeight();i&&s(this.element).css("min-height",Math.max(parseInt(e.css("min-height"),10)||0,i))}function I(t){var e="";if(t.items&&t.items.length){var o=i.find(t.items,function(t){return/image\/\w+/.test(t.type)});if(o){var n=o.getAsFile();if(n)return void this.config.onFileAdded.call(this,n)}}i.contains(t.types,"text/html")?e=t.getData("text/html"):(e=t.getData("text/plain"),e=this.dataFilter.filterPlaintext(e,!0)),e=e.replace(new RegExp("</t(d|h)></tr>","g"),"<br></td></tr>"),e=e.replace(/\u00a0/g," "),e=this.dataFilter.filterHTML(e),e=this.dataFilter.convertToBrowserSpaces(e);var r=document.createElement("div");r.innerHTML=e,this.dataFilter.flattenBlocksDown(r,!0),s(r).find(ce.join()).remove();var a=i.some(r.children,function(t){return i.contains(le,t.nodeName)});if(a){var l=h.getSelection(),d=l.getRangeAt(0);d.deleteContents();var c=N.call(this);if(""===s(c).text().trim()){var u=s(c).index(),p=s(c).parent(),m=u+r.children.length-1;s(c).replaceWith(r.children);var g=s(p).children().eq(m).get(0);d.selectNodeContents(g),d.collapse(!1),l.removeAllRanges(),l.addRange(d)}else{var f=i.escape(r.textContent);i.contains(he,c.nodeName)||(f=f.replace(/\n/g,"<br>")),q.call(this,f)}}else q.call(this,r.innerHTML);this.onChange()}function M(t){s(this.element).html(t)}function O(){return s(this.element).html().trim()}function q(t){if(!t)return void console.warn("Cannot insert empty data");var e=h.getSelection();if(!e||!e.focusNode)return void console.warn("Cannot insert without the editor having a cursor or selection");var i=e.getRangeAt(0);i.deleteContents(),t=this.dataFilter.convertToBrowserSpaces(t);var s=document.createElement("div");s.innerHTML=t;for(var o,n=s.lastChild,r=document.createDocumentFragment();o=s.firstChild;)r.appendChild(o);i.insertNode(r),i.setStartAfter(n),i.collapse(!1),e.removeAllRanges(),e.addRange(i)}function V(){var t=N.call(this);if(!t){var e=s(this.element).children(le.join());if(!e.length)return null;t=e.last().get(0)}return t}function N(){var t=h.getSelection()||this.lastSelection;return h.getNodeByNames(le,!0,t)}function H(){var t=V.call(this);if(t){if("div"===t.nodeName.toLowerCase())try{window.document.execCommand("formatBlock",!1,"<p>")}catch(e){}}else M.call(this,re),this.setCursorToStart()}function B(){var t=s(this.element).children(de.join()).last().get(0);t||s(this.element).append(re)}function z(t,e,o,n){var r=this,a=function(t){var a=i.uniqueId(),l=0===t.lastIndexOf("data:",0)?"file":t;r.mediaTracker[a]={originalSource:l,file:e};var h=s("<img />",{src:t});s(h).attr(r.config.imgKeyAttr,a);var d=s("<figure />");d.append(h),G.call(r,d.get(0).outerHTML,o,n),r.config.onAsyncImageAdded.call(r,a,t,e),r.onChange()};if(!t&&e)if(g)a(g(e));else{var l=new FileReader;l.onload=function(t){a(t.target.result)},l.readAsDataURL(e)}else{if("string"!=typeof t)return void console.warn("Unknown source type for inserting an image.");a(t)}}function K(t){return s(this.element).find("img["+this.config.imgKeyAttr+'="'+t+'"]').get(0)}function W(t,e){var i=K.call(this,t);s(i).attr("src",e),this.mediaTracker[t].updatedSource=e}function G(t,e,i){var o;e=e||V.call(this),o=this.dataFilter.isEmptyElement(e.outerHTML,!0)?0:h.isCursorAtStart(e)?-1:1,i="number"==typeof i?i:o;var n=s(t).get(0),r=Y.call(this,n);X.call(this,r),0>i?s(e).before(r):i>0?s(e).after(r):0===i&&s(e).replaceWith(r),y.call(this);var a=s(r).nextAll(de.join()).get(0);a||(a=s(re).get(0),s(r).after(a)),l.setToStart(a),Q.call(this,r,!1,F)}function Q(t,e,n){var r=this;e=e||!1,n=n||i.noop;var a=s(t),l=a.find("figure"),h=a.find(".media-button"),d=200;return a.length&&l.length?(e&&h.length&&h.hide(),o(l,{opacity:e?0:[1,0],translateY:e?-25:[0,-25]},{duration:.9*d,easing:"easeOutQuad",complete:function(){l.removeAttr("style")}}),void o(t,e?"slideUp":"slideDown",{duration:d,easing:"easeOutQuart",begin:function(){a.css("pointer-events","none")},complete:function(){a.css("pointer-events",""),n.call(r,t)}})):void n.call(r)}function J(){var t=this,e=N.call(this);s(e).removeClass(t.config.fakeClass),s(t.element).children("p").each(function(i,o){e!==o&&t.dataFilter.isEmptyElement(o)&&(0===i&&se.call(t,s(o).next().get(0))||s(o).is(":last-child")&&se.call(t,s(o).prev().get(0))?Z.call(t,o):se.call(t,s(o).prev().get(0))&&se.call(t,s(o).next().get(0))?Z.call(t,o):s(o).hasClass(t.config.fakeClass)&&s(o).remove()),void 0!==s(o).attr("class")&&""===s(o).attr("class").trim()&&s(o).removeAttr("class")
}),s(this.element).children("."+this.config.mediaHolderClass).each(function(){var e=s(this).next().get(0);(!e||se.call(t,e))&&s(this).after(Z.call(t));var i=s(this).prev().get(0);i||s(this).before(Z.call(t))})}function Z(t){return t=t||s(re).get(0),s(t).addClass(this.config.fakeClass),t}function Y(t){var e=s(t),o=s("<div />",{"class":this.config.mediaHolderClass,contentEditable:!1,draggable:!0});i.forEach(this.config.mediaHolderSubclasses,function(t,i){(e.is(i)||e.find(i).length)&&o.addClass(t)}),e.wrap(o);var n=e.parent(),r=s(this.config.mediaKillerMarkup);r.addClass("media-killer"),n.append(r);var a=!o.hasClass("media-holder-draggable");if(a){var l=s(this.config.mediaMoverMarkup);l.addClass("media-mover"),n.append(l)}return n}function X(t){var e=this,i=t?s(t):s(this.element).find('[contenteditable="false"]');i.each(function(t,i){var o=s(i);o.off("keydown").on("keydown",function(t){(t.keyCode===ue["delete"]||t.keyCode===ue.backspace)&&o.remove(),t.preventDefault(),t.stopPropagation()});var n=null;o.on("mousedown",function(t){n=t.originalEvent.target}),o.on("dragstart",function(t){var e=s(n);e.hasClass("media-killer")&&(t.preventDefault(),t.stopPropagation()),o.hasClass("media-holder-draggable")||e.hasClass("media-mover")||(t.preventDefault(),t.stopPropagation())}),o.on("mouseup",function(t){var i=s(n);i.hasClass("media-killer")&&n===t.target&&Q.call(e,o,!0,function(){o.remove(),w.call(e),F.call(e),e.onChange()})}),o.on("mouseenter",function(t){s(t.currentTarget).addClass("show-controls")}),o.on("mouseleave",function(t){s(t.currentTarget).removeClass("show-controls")})})}function te(t){i.each(s(t).find("."+this.config.mediaHolderClass),function(t){s(t).find(".media-killer, .media-mover").remove();var e=s(t).children().first();e.length?s(e).unwrap():(s(t).contents().wrap("<div>"),s(t).children().first().unwrap().contents().unwrap())})}function ee(t){var e=this,o=s(t).find("."+this.config.fakeClass+", ."+this.config.fakeClass+"-intent");i.each(o,function(t){e.dataFilter.isEmptyElement(t)&&s(t).remove()})}function ie(){var t=this;i.each(s(this.element).find(ce.join()),function(e){var s=h.getParentNodes(e),o=i.some(s,function(t){return i.contains(ce,t.nodeName)});oe.call(t,e)||o||Y.call(t,e)})}function se(t){return s(t).hasClass(this.config.mediaHolderClass)}function oe(t){var e=s(t).closest("[class="+this.config.mediaHolderClass+"]");return e.length?e.get(0):null}function ne(t,e,o){var n,r;return e=i.isBoolean(e)?e:!1,t=t||V.call(this),n=s(t)[e?"prev":"next"](),!o&&n.length>0&&this.dataFilter.isEmptyElement(n)?(l.setToStart(n.get(0)),n):(r=s(re).get(0),s(t)[e?"before":"after"](r),l.setToStart(r),r)}var re="<p><br></p>",ae="<p></p>",le=["P","H2","BLOCKQUOTE","UL","OL","DIV","PRE"],he=["PRE"],de=["P","H2","BLOCKQUOTE","UL","OL","PRE"],ce=["IMG","IFRAME","FIGURE","HR"],ue={shift:16,enter:13,esc:27,backspace:8,"delete":46,tab:9,right:39},pe=function(o,c){if(!o)throw new Error("A valid element parameter is required to initalize the editor");c=c||{},this.element=o,this.humanKeys=new m,this.keyComboEvents=c.keyComboEvents||new p({element:this.element,humanKeys:this.humanKeys});var g=i.template("<%= title %> (<%= shortcut %>)"),f=function(t,e){return g({title:t,shortcut:this.humanKeys.pretty(e)})}.bind(this);this.config={placeholder:!1,onChange:i.noop,onSelection:function(){},onAsyncImageAdded:function(){},onFileAdded:function(){},onClientEvent:function(){},flattenBlocks:!0,runIFrameSanitization:!1,mediaHolderClass:"media-holder",imgKeyAttr:"data-img-key",fakeClass:"fake",mediaHolderSubclasses:{img:"media-holder-draggable",hr:"media-holder-draggable media-holder-hr"},mediaKillerMarkup:"<div>×</div>",mediaMoverMarkup:"<div>&#8597;</div>",pasteHook:function(){return!1},filterForSetData:function(t){return t},filterForGetData:function(t){return t},filterRules:{elements:["a","b","i","ul","ol","li","p","h2","blockquote","img","iframe","figure","br","hr","pre","sub","sup","small"],attributes:{a:["href","title"],img:["src","alt"],hr:["data-label"],iframe:["src","width","height","frameborder"]},classnames:{hr:["read-more"]},remove_contents:["style","noscript","script","meta"],protocols:{a:{href:["http","https","mailto"]}}},animateShowControls:function(t){t.element.show()},animateHideControls:function(t){t.element.hide()},linkConfig:{bypassClasses:[],onChange:function(){this.onChange.call(this)},onDismiss:function(){this.lastSelection&&(l.restoreSelection(this.lastSelection),F.call(this))}},inlineControlsConfig:{openTray:d.prototype.openTray,closeTray:d.prototype.closeTray,onTrayOpened:function(){},onTrayClosed:function(){},keyboardEvents:this.keyComboEvents},formattingControlsConfig:{controls:{bold:{el:"b",className:"bold",command:"bold",type:"inline",title:f("Bold","meta+b"),keyboard:"meta+b"},italic:{el:"i",className:"italic",command:"italic",type:"inline",title:f("Italic","meta+i"),keyboard:"meta+i"},headline:{el:"h2",className:"headline",command:"formatBlock",type:"block",title:f("Headline","meta+shift+2"),keyboard:"meta+shift+2"},link:{el:"a",className:"link",command:"createLink",type:"inline",title:f("Link","meta+k"),keyboard:"meta+k"},strikethrough:{el:"strike",className:"strikethrough",command:"strikethrough",type:"inline",title:f("Strikethrough","meta+shift+6"),keyboard:"meta+shift+6"},orderedList:{el:"ol",className:"ordered-list",command:"insertOrderedList",type:"list",title:f("Ordered List","meta+shift+7"),keyboard:"meta+shift+7"},unorderedList:{el:"ul",className:"unordered-list",command:"insertUnorderedList",type:"list",title:f("Unordered List","meta+shift+8"),keyboard:"meta+shift+8"},blockquote:{el:"blockquote",className:"quote",command:"formatBlock",type:"block",title:f("Blockquote","meta+shift+9"),keyboard:"meta+shift+9"},clear:{el:"",command:"removeFormat",type:"inline",keyboard:"meta+shift+0"},pre:{el:"pre",command:"formatBlock",type:"block",keyboard:"meta+alt+1"},superscript:{el:"sup",command:"superscript",type:"inline",keyboard:"meta+dot"},subscript:{el:"sub",command:"subscript",type:"inline",keyboard:"meta+comma"},small:{el:"small",command:"insertHTML",type:"inline",keyboard:"meta+shift+minus",keyboardInverse:"meta+shift+plus"}},controlsOrder:["bold","italic","headline","link","strikethrough","orderedList","unorderedList","blockquote"],onShow:function(t){i.isFunction(this.animateShowControls)?this.animateShowControls.call(this,t):t.element.show()},onHide:function(t){i.isFunction(this.animateHideControls)?this.animateHideControls.call(this,t):t.element.hide()},onAction:function(t){var e=h.getNodeList();t.setActives(e)}},showStaticControls:!0},i.merge(this.config,c||{}),this.applyCommand=i.bind(S,this),this.inverseCommand=i.bind(T,this),this.animateShowControls=i.bind(this.config.animateShowControls,this),this.animateHideControls=i.bind(this.config.animateHideControls,this),this.onChange=function(){L.call(this),this.config.onChange.call(this)};var _=t(this.config.linkConfig,this);this.linkControl=new n(_);var v=t(this.config.inlineControlsConfig,this);this.inlineControls=new d(v);var b=t(i.defaults({keyboardEvents:this.keyComboEvents},this.config.formattingControlsConfig),this);this.contextualControls=new r(this.applyCommand,this.inverseCommand,b);var y=this.config.formattingControlsConfig.onShow,w=this.config.formattingControlsConfig.onHide,x=t(i.defaults({onShow:function(t){y.apply(this,arguments),t.listener=t.listener||function(){var e=h.getNodeList();t.setActives(e),document.removeEventListener("mousedown",t.listener,!1)},document.addEventListener("mousedown",t.listener)},onHide:function(t){w.apply(this,arguments),document.removeEventListener("mousedown",t.listener,!1)}},this.config.formattingControlsConfig),this);this.staticControls=new r(this.applyCommand,this.inverseCommand,x),this.dataFilter=new a(this.config.filterRules),this.keyModifiers={shift:!1},this.undoManager=new u(this,i.bind(function(){for(var t in this.mediaTracker){var e=this.mediaTracker[t].updatedSource;if(e){var i=K.call(this,t);s(i).attr("src",e)}}D.call(this)},this)),this.mediaTracker={},e.call(this)};return pe.prototype.getData=function(t,e){var o=this,n=O.call(this);n=this.config.filterForGetData.call(this,n),this.config.runIFrameSanitization&&(n=this.dataFilter.unSanitizeIFrames(n));var r=document.createElement("div");if(r.innerHTML=n,te.call(this,r),ee.call(this,r),e||s(r).find("["+o.config.imgKeyAttr+"]").removeAttr(o.config.imgKeyAttr),t)for(var a=function(t){var e=s(r).children(":"+t+"-child").get(0);return e&&o.dataFilter.isEmptyElement(e,!0)?e:null},l=function(){return i.compact([a("first"),a("last")])};l().length;)i.forEach(l(),function(t){s(t).remove()});return r.innerHTML},pe.prototype.setData=function(t,e,i){e&&(t=this.config.filterForSetData.call(this,t),t=this.dataFilter.filterHTML(t)),this.config.runIFrameSanitization&&(t=this.dataFilter.sanitizeIFrames(t)),M.call(this,t),ie.call(this),i?this.dataFilter.flattenBlocksDown(this.element):this.dataFilter.blockifyInlineNodes(this.element),H.call(this),X.call(this),B.call(this),this.onChange()},pe.prototype.insertData=function(t,e,i){e&&(t=this.dataFilter.filterHTML(t)),q.call(this,t),i&&this.dataFilter.flattenBlocksDown(h.getNearestElement()),this.onChange()},pe.prototype.blur=function(t){return t||y.call(this),s(this.element).blur()},pe.prototype.focus=function(t){var e=s(this.element).focus();return t||this.setCursorToEnd(),e},pe.prototype.hasFocus=function(){return s(this.element).is(":focus")},pe.prototype.setPlaceholder=function(t){this.config.placeholder=t,L.call(this)},pe.prototype.insertMedia=function(t,e,i,s){e&&(t=this.dataFilter.filterHTML(t)),G.call(this,t,i,s),this.onChange()},pe.prototype.addControl=function(t){var e=s(this.wrapper).find("[data-js=control-bar]");e.append(t)},pe.prototype.isEmpty=function(){var t=O.call(this);return""===t||"<br>"===t||t===re||t===ae},pe.prototype.getCurrentElement=function(){return h.getNearestElement()},pe.prototype.getAsyncImage=function(t){return K.call(this,t)},pe.prototype.insertAsyncImage=function(t,e,i,s){z.call(this,t,e,i,s),this.onChange()},pe.prototype.updateAsyncImage=function(t,e){W.call(this,t,e),this.onChange("updateAsyncImage")},pe.prototype.setCursorToStart=function(t){var e=s(this.element).children().first().get(0);e&&l.setToStart(e),t||F.call(this)},pe.prototype.setCursorToEnd=function(t){var e=s(this.element).children().last().get(0);e&&l.setToEnd(e),t||F.call(this)},pe.prototype.insertNewParagraphAfter=function(t,e){return ne.call(this,t,!1,e)},pe.prototype.insertNewParagraphBefore=function(t,e){return ne.call(this,t,!0,e)},pe.prototype.isEmptyElement=function(t){return t=t||V.call(this),this.dataFilter.isEmptyElement(t)},pe.prototype.hasSelection=function(t){return t=t||V.call(this),h.hasSelection(t)},pe.prototype.isCursorAtEnd=function(t){return t=t||V.call(this),h.isCursorAtEnd(t)},pe.prototype.isCursorAtStart=function(t){return t=t||V.call(this),h.isCursorAtStart(t)},pe.prototype.teardown=function(){this.keyComboEvents.off()},pe}();e.exports=f},{"./dataFilter":466,"./formattingControls":467,"./humanKeys":468,"./inlineControls":469,"./keyComboEvents":470,"./linkControl":472,"./selectionContext":476,"./selectionPersistence":477,"./undoManager":478,"./utils":479,jquery:"HlZQrA",lodash:"K2RcUv","velocity-animate":"lWl/mc"}],475:[function(t,e){function i(){var t,e;for(e=arguments[0]||{},this.config={},this.config.elements=e.elements?e.elements:[],this.config.attributes=e.attributes?e.attributes:{},this.config.attributes[i.ALL]=this.config.attributes[i.ALL]?this.config.attributes[i.ALL]:[],this.config.allow_comments=e.allow_comments?e.allow_comments:!1,this.allowed_elements={},this.config.protocols=e.protocols?e.protocols:{},this.config.classnames=e.classnames?e.classnames:{},this.config.add_attributes=e.add_attributes?e.add_attributes:{},this.dom=e.dom?e.dom:document,t=0;t<this.config.elements.length;t++)this.allowed_elements[this.config.elements[t]]=!0;if(this.config.remove_element_contents={},this.config.remove_all_contents=!1,e.remove_contents)if(e.remove_contents instanceof Array)for(t=0;t<e.remove_contents.length;t++)this.config.remove_element_contents[e.remove_contents[t]]=!0;else this.config.remove_all_contents=!0;this.transformers=e.transformers?e.transformers:[]}i.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i,i.RELATIVE="__RELATIVE__",i.ALL="__ALL__",i.prototype.clean_node=function(t){function e(t,e){var i;for(i=0;i<e.length;i++)if(e[i]===t)return i;return-1}function s(){var t,e,i=[],s={};for(t=0;t<arguments.length;t++)if(arguments[t]&&arguments[t].length)for(e=0;e<arguments[t].length;e++)s[arguments[t][e]]||(s[arguments[t][e]]=!0,i.push(arguments[t][e]));return i}function o(t){var e;switch(t.nodeType){case 1:r.call(this,t);break;case 3:e=t.cloneNode(!1),this.current_element.appendChild(e);break;case 5:e=t.cloneNode(!1),this.current_element.appendChild(e);break;case 8:this.config.allow_comments&&(e=t.cloneNode(!1),this.current_element.appendChild(e));break;default:console&&console.log&&console.log("unknown node type",t.nodeType)}}function n(t,i){for(var s=[],o=0;o<t.length;o++)-1!==e(t[o],i)&&s.push(t[o]);return s}function r(t){var r,l,h,d,c,u,p,m,g,f,_,v=a.call(this,t);if(t=v.node,h=t.nodeName.toLowerCase(),l=this.current_element,this.allowed_elements[h]||v.whitelist){this.current_element=this.dom.createElement(t.nodeName),l.appendChild(this.current_element);var b=this.config.attributes;for(d=s(b[h],b[i.ALL],v.attr_whitelist),this.config.classnames[h]&&this.config.classnames[h].length&&d.push("class"),r=0;r<d.length;r++){u=d[r];var y="object"==typeof d[r]||d[r]instanceof Object;u=y?d[r].name:d[r],c=t.attributes[u],c&&(m=c.value,_=!0,this.config.protocols[h]&&this.config.protocols[h][u]&&(g=this.config.protocols[h][u],f=c.value.toLowerCase().match(i.REGEX_PROTOCOL),_=f?-1!==e(f[1],g):-1!==e(i.RELATIVE,g)),"class"===u&&this.config.classnames[h]&&(m=n(m.split(" "),this.config.classnames[h]).join(" "),_=!!m),y&&(_=c.value.toLowerCase().match(d[r].value)),_&&(p=document.createAttribute(u),p.value=m,this.current_element.setAttributeNode(p)))}if(this.config.add_attributes[h])for(u in this.config.add_attributes[h])p=document.createAttribute(u),p.value=this.config.add_attributes[h][u],this.current_element.setAttributeNode(p)}else if(-1!==e(t,this.whitelist_nodes)){for(this.current_element=t.cloneNode(!0);this.current_element.childNodes.length>0;)this.current_element.removeChild(this.current_element.firstChild);l.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[h])for(r=0;r<t.childNodes.length;r++)o.call(this,t.childNodes[r]);this.current_element.normalize&&this.current_element.normalize(),this.current_element=l}function a(t){var i,o,n,r={attr_whitelist:[],node:t,whitelist:!1};for(i=0;i<this.transformers.length;i++)if(n=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:t,node_name:t.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom}),null!==n){if("object"!=typeof n)throw new Error("transformer output must be an object or null");if(n.whitelist_nodes&&n.whitelist_nodes instanceof Array)for(o=0;o<n.whitelist_nodes.length;o++)-1===e(n.whitelist_nodes[o],this.whitelist_nodes)&&this.whitelist_nodes.push(n.whitelist_nodes[o]);r.whitelist=n.whitelist?!0:!1,n.attr_whitelist&&(r.attr_whitelist=s(r.attr_whitelist,n.attr_whitelist)),r.node=n.node?n.node:r.node}return r}var l=this.dom.createDocumentFragment();this.current_element=l,this.whitelist_nodes=[];for(var h=0;h<t.childNodes.length;h++)o.call(this,t.childNodes[h]);return l.normalize&&l.normalize(),l},e.exports=i},{}],476:[function(t,e){var i=t("lodash"),s=t("jquery"),o=function(){var t={getParentNodes:function(e,i){if(i=i||[],!e||t.isEditorNode(e))return i;var s=e.parentNode;return t.isEditorNode(s)?i:s?(i.push(s),t.getParentNodes(s,i)):i},getNodeList:function(e){e=e||t.getSelection();var s=e&&e.anchorNode?e.anchorNode:null;if(!s||t.isEditorNode(s))return[];var o=e.focusNode,n=[s];o&&!t.isEditorNode(o)&&n.concat([o]);var r=t.getParentNodes(s),a=t.getParentNodes(o);n=n.concat(r).concat(a);var l=i.union(n);return l},getNodeByNames:function(e,s,o){var n=[].concat(e),r=t.getNodeList(o);return i.find(s?r.reverse():r,function(t){return i.contains(n,t.nodeName)})},getNearestElement:function(e){e=e||t.getSelection();var s=t.getNodeList();return i.find(s,function(t){return 1===t.nodeType})},getContextCoordinates:function(e,i){var o=t.getSelection(),n=o.getRangeAt(0).cloneRange(),r=s(e).offset();if(i||!o.isCollapsed){var a=(i||n).getBoundingClientRect();return{x:a.left+a.width/2-r.left,y:a.top-r.top+s(window).scrollTop()}}if(n.getClientRects){n.collapse(!0);var l=n.getClientRects()[0];if(l)return{x:l.left-r.left,y:l.top-r.top+s(window).scrollTop()}}},getSelection:function(){var t=window.getSelection();if(t.anchorNode){var e=s(t.anchorNode).closest("[contenteditable]").length;return e?t:null}return null},collapseToEnd:function(){var e=t.getSelection();e&&e.collapseToEnd()},collapseToStart:function(){var e=t.getSelection();e&&e.collapseToStart()},isInContext:function(t,e){return s(t.anchorNode).closest(e).length>0},isEditorNode:function(t){return s(t).is('[contentEditable="true"]')},hasSelection:function(){var e=t.getSelection();return e&&!e.isCollapsed},rangeFromElement:function(e){var i,s,o=t.getSelection();return o&&o.isCollapsed?(s=o.getRangeAt(0),i=s.cloneRange(),i.selectNodeContents(e),i.setEnd(s.startContainer,s.startOffset),i):!1},isCursorAtEnd:function(t){var e=this.rangeFromElement(t);return e?e.toString().length===t.textContent.length:!1},isCursorAtStart:function(t){var e=this.rangeFromElement(t);return e?0===e.startOffset&&0===e.endOffset:!1}};return t}();e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],477:[function(t,e){var i=function(){return{saveSelection:function(t,e){if(e=e||window.getSelection(),!e||!e.rangeCount)return null;var i=e.getRangeAt(0),s=i.cloneRange();s.selectNodeContents(t),s.setEnd(i.startContainer,i.startOffset);var o=s.toString().length;return{container:t,start:o,end:o+i.toString().length,selection:e,anchorNode:e.anchorNode}},restoreSelection:function(t){if(t){var e=0,i=document.createRange();i.setStart(t.container,0),i.collapse(!0);for(var s,o=[t.container],n=!1,r=!1;!r&&(s=o.pop());)if(3===s.nodeType){var a=e+s.length;!n&&t.start>=e&&t.start<=a&&(i.setStart(s,t.start-e),n=!0),n&&t.end>=e&&t.end<=a&&(i.setEnd(s,t.end-e),r=!0),e=a}else for(var l=s.childNodes.length;l--;)o.push(s.childNodes[l]);var h=window.getSelection();h.removeAllRanges();try{h.addRange(i)}catch(d){}}},setToStart:function(t){if(t){var e=document.createRange();e.setStart(t,0),e.setEnd(t,0),e.collapse(!0);var i=window.getSelection();i.removeAllRanges();try{i.addRange(e)}catch(s){}}},setToEnd:function(t){for(var e=[t],i=null,s=t,o=0;i=e.pop();)if(3===i.nodeType)s=i,o=i.length;else for(var n=i.childNodes.length;n--;)e.push(i.childNodes[n]);var r=document.createRange();r.setStart(s,o),r.setEnd(s,o),r.collapse(!0);var a=window.getSelection();a.removeAllRanges();try{a.addRange(r)}catch(l){}}}}();e.exports=i},{}],478:[function(t,e){var i=t("lodash"),s=t("jquery"),o=(t("./utils"),t("./selectionPersistence")),n=function(){function t(){var t=this,i=function(t){return/Mac/.test(navigator.platform)?t.metaKey:t.ctrlKey};s(this.editor.element).on("keydown",function(s){return s.keyCode===d.z&&i(s)?(s.shiftKey?n.call(t):e.call(t),s.preventDefault(),!1):void 0})}function e(){if(l.call(this),this.undoStates.length){var t=this.undoStates.pop();h.call(this,t),this.redoStates.push(this.currState),r.call(this)}}function n(){if(this.redoStates.length){var t=this.redoStates.pop();h.call(this,t),this.undoStates.push(this.currState),r.call(this)}}function r(){this.currState=a.call(this)}function a(){var t={data:this.editor.getData(!0,!0),selection:o.saveSelection(this.editor.element)};return t}function l(){var t=a.call(this);return this.currState?void(t.data!==this.currState.data&&(this.undoStates.push(this.currState),this.currState=t)):void(this.currState=t)}function h(t){if(this.isRestoring=!0,this.editor.setData(t.data,!0),t.selection)o.restoreSelection(t.selection);else{var e=window.getSelection();e.removeAllRanges()}this.afterRestore()}var d={command:91,control:17,shift:16,z:90},c=500,u=function(e,s){this.editor=e,this.modifierKeyCode=!1,this.isShift=!1,this.currState=null,this.undoStates=[],this.redoStates=[],this.afterRestore=s,this.isRestoring=!1;var o=this,n=i.debounce(function(){l.call(o)},c),r=e.onChange;e.onChange=function(t){if(o.isRestoring)o.isRestoring=!1;else{if("updateAsyncImage"===t)return;o.currState?n():l.call(o)}r.call(this)},t.call(this)};return u.prototype.undo=function(){e.call(this)},u.prototype.redo=function(){n.call(this)},u}();e.exports=n},{"./selectionPersistence":477,"./utils":479,jquery:"HlZQrA",lodash:"K2RcUv"}],479:[function(t,e){var i=t("lodash"),s=t("jquery"),o=function(){var t=function(){};return t.calcTextWidth=function(t,e){var o=["font-style","font-weight","font-size","font-family"],n=i.reduce(o,function(e,i){return e+" "+s(t).css(i)},"").trim(),r=document.createElement("canvas"),a=r.getContext("2d");a.font=n;var l=a.measureText(e);return Math.round(l.width)},t}();e.exports=o},{jquery:"HlZQrA",lodash:"K2RcUv"}],480:[function(t,e){var i=document.createElement("style");document.head.appendChild(i);var s=i.styleSheet?function(t){i.styleSheet.cssText=t}:function(t){for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(document.createTextNode(t))},o=function(t){return s(i.innerHTML.replace(t,""))};e.exports.style=i,e.exports.inject=s,e.exports.eject=o},{}],481:[function(t,e){!function(t){function i(){try{return a in t&&t[a]}catch(e){return!1}}function s(t){return t.replace(/^d/,"___$&").replace(p,"___")}var o,n={},r=t.document,a="localStorage",l="script";if(n.disabled=!1,n.version="1.3.17",n.set=function(){},n.get=function(){},n.has=function(t){return void 0!==n.get(t)},n.remove=function(){},n.clear=function(){},n.transact=function(t,e,i){null==i&&(i=e,e=null),null==e&&(e={});var s=n.get(t,e);i(s),n.set(t,s)},n.getAll=function(){},n.forEach=function(){},n.serialize=function(t){return JSON.stringify(t)},n.deserialize=function(t){if("string"!=typeof t)return void 0;try{return JSON.parse(t)}catch(e){return t||void 0}},i())o=t[a],n.set=function(t,e){return void 0===e?n.remove(t):(o.setItem(t,n.serialize(e)),e)},n.get=function(t,e){var i=n.deserialize(o.getItem(t));return void 0===i?e:i},n.remove=function(t){o.removeItem(t)},n.clear=function(){o.clear()},n.getAll=function(){var t={};return n.forEach(function(e,i){t[e]=i}),t},n.forEach=function(t){for(var e=0;e<o.length;e++){var i=o.key(e);t(i,n.get(i))}};else if(r.documentElement.addBehavior){var h,d;try{d=new ActiveXObject("htmlfile"),d.open(),d.write("<"+l+">document.w=window</"+l+'><iframe src="/favicon.ico"></iframe>'),d.close(),h=d.w.frames[0].document,o=h.createElement("div")}catch(c){o=r.createElement("div"),h=r.body}var u=function(t){return function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(o),h.appendChild(o),o.addBehavior("#default#userData"),o.load(a);var i=t.apply(n,e);return h.removeChild(o),i}},p=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");n.set=u(function(t,e,i){return e=s(e),void 0===i?n.remove(e):(t.setAttribute(e,n.serialize(i)),t.save(a),i)}),n.get=u(function(t,e,i){e=s(e);var o=n.deserialize(t.getAttribute(e));return void 0===o?i:o}),n.remove=u(function(t,e){e=s(e),t.removeAttribute(e),t.save(a)}),n.clear=u(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(a);for(var i,s=0;i=e[s];s++)t.removeAttribute(i.name);t.save(a)}),n.getAll=function(){var t={};return n.forEach(function(e,i){t[e]=i}),t},n.forEach=u(function(t,e){for(var i,s=t.XMLDocument.documentElement.attributes,o=0;i=s[o];++o)e(i.name,n.deserialize(t.getAttribute(i.name)))})}try{var m="__storejs__";n.set(m,m),n.get(m)!=m&&(n.disabled=!0),n.remove(m)}catch(c){n.disabled=!0}n.enabled=!n.disabled,"undefined"!=typeof e&&e.exports&&this.module!==e?e.exports=n:"function"==typeof define&&define.amd?define(n):t.store=n}(Function("return this")())},{}],482:[function(t,e){!function(t){t(function(t){var e=t("./when"),i=e.Promise.all,s=Array.prototype.slice;return function(t){function o(t){return n.push(t),n}var n=[];return i(s.call(arguments,1)).then(function(i){return e.reduce(t,function(t,s){return e(s.apply(void 0,i),o)},n)})}})}("function"==typeof define&&define.amd?define:function(i){e.exports=i(t)})},{"./when":"RG2dij"}]},{},[]);